[
    {
        "id": "e25f4966a4da0bd8",
        "type": "tab",
        "label": "test_flow",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e1de889cd6928bd7",
        "type": "tab",
        "label": "hbw_modified",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b097a95f4a4d5fd0",
        "type": "tab",
        "label": "dps_modified",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b68bbce92754c7f5",
        "type": "tab",
        "label": "DRILL _Modif",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "12d77bbd6f79a8bf",
        "type": "tab",
        "label": "MILL _modif",
        "disabled": false,
        "info": "eine Schnittstelle, die den lokalen MQTT-Broker mit\r\ndem OPCUA-Server der Fraese verbindet.",
        "env": []
    },
    {
        "id": "2acde404c8501321",
        "type": "tab",
        "label": "AIQS_modif",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3f8971c7785c0a4b",
        "type": "tab",
        "label": "PLCs",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0fed82592f6f61c7",
        "type": "tab",
        "label": "DPS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "71de62f6245167bc",
        "type": "tab",
        "label": "WebSocket",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "efa2a92c452b46f6",
        "type": "tab",
        "label": "FTS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "04fb1970364bf715",
        "type": "tab",
        "label": "DRILL",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "19d805df40a787da",
        "type": "tab",
        "label": "MILL",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2e420980abe586e7",
        "type": "tab",
        "label": "HBW",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "bdd8e8bb1cc76f16",
        "type": "tab",
        "label": "AIQS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "178d4ec7b06e55a6",
        "type": "tab",
        "label": "NodeRed Init",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6c1ff1b06d8a3172",
        "type": "tab",
        "label": "DB_connectivity",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "01cc220f0e9e940f",
        "type": "tab",
        "label": "Flux 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "61a81265606bc34b",
        "type": "tab",
        "label": "NodeRed Init",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5d12353eb287ac3b",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "590cef45263277f3",
        "type": "tab",
        "label": "Store",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a941df4dfaa3ef82",
        "type": "subflow",
        "name": "handle-actions (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "796d3b2bff9c8445"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "2800fb9ec787f9d6",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "e9a2aa001ba01330",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "90a0051f1617683a",
                        "port": 0
                    },
                    {
                        "id": "152363633c148c89",
                        "port": 0
                    },
                    {
                        "id": "d54b71758f5fcd13",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "796d3b2bff9c8445",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "2876f9e731fcac7c",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "66587e5c3f596288",
        "type": "subflow",
        "name": "handle-actions (2) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "29cc9f9db61ac7a6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "3b1e1d02273b0473",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "0e74869b5d90c756",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "80f5cf6e95889111",
                        "port": 0
                    },
                    {
                        "id": "08f3d186831e0928",
                        "port": 0
                    },
                    {
                        "id": "3874e7c1495f58af",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "29cc9f9db61ac7a6",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "0411044ba54c7ec8",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "1b897516f5bf21fa",
        "type": "subflow",
        "name": "handle-actions",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "35bb3bae6cae9a4c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "dc414fb188f715a6",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "6c70068076961807",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "6c733024026db14e",
                        "port": 0
                    },
                    {
                        "id": "4ffa811ecb746d4f",
                        "port": 0
                    },
                    {
                        "id": "09075949c82779fc",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "35bb3bae6cae9a4c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "2950af8db6503c05",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "6a25ecd632542087",
        "type": "subflow",
        "name": "load-factsheet",
        "info": "This flow is used to load a factsheet from the filesystem with the provided path.\r\nUse the configuration of the subflow instance to set the path to the factsheet.\r\n\r\nRemember that it has to be an absolute filepath, otherwise the file will be loaded \r\nrelative to the work directory of the Node-RED process.",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 160,
                "wires": [
                    {
                        "id": "eccbae14041fd8d1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 100,
                "wires": [
                    {
                        "id": "ae8c0f5da4317371",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "FACTSHEET_FILE",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-file-o",
                    "label": {
                        "en-US": "Path to factsheet"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#b3d2e9",
        "outputLabels": [
            "factsheet"
        ],
        "icon": "node-red/parser-json.svg"
    },
    {
        "id": "a91568669d27b6cc",
        "type": "subflow",
        "name": "get-opcua-address",
        "info": "Retrieves an environment variable from the list of global environment variables\r\nand sets it to `msg.endpoint` for use with the Flex Connector.",
        "category": "",
        "in": [],
        "out": [
            {
                "x": 700,
                "y": 80,
                "wires": [
                    {
                        "id": "1221e1a68d16c50c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "Address",
                "type": "str",
                "value": "OPCUA_ADDRESS",
                "ui": {
                    "icon": "font-awesome/fa-font",
                    "label": {
                        "en-US": "Address"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#b3d2e9",
        "outputLabels": [
            "value of variable"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 840,
            "y": 140,
            "wires": [
                {
                    "id": "21158da447f511de",
                    "port": 0
                },
                {
                    "id": "dfbe04cbe5e0e705",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "ea935d7649fccac4",
        "type": "subflow",
        "name": "update-rack-position",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "448fc81733591706"
                    }
                ]
            }
        ],
        "out": [],
        "env": [
            {
                "name": "RACK_POSITION",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-archive",
                    "label": {
                        "en-US": "Rack Position"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "rackposition-updates"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 300,
            "y": 240,
            "wires": [
                {
                    "id": "f965220d4db8fa46",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "7173b966cb38f0e0",
        "type": "subflow",
        "name": "update-calibration",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 140,
                "wires": [
                    {
                        "id": "32b0de7a18bf11ad"
                    }
                ]
            }
        ],
        "out": [],
        "env": [
            {
                "name": "AVAILABLE_POSITIONS",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-bullseye",
                    "label": {
                        "en-US": "Available Positions"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            },
            {
                "name": "CURRENT_POSITION",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-bullseye",
                    "label": {
                        "en-US": "Current Position"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "calib-values"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 960,
            "y": 160,
            "wires": [
                {
                    "id": "030b08ea813bc11c",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "fb6b02d4d9963179",
        "type": "subflow",
        "name": "vda-status-finished InstantAction",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "a065343fb9fd80f0"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "a065343fb9fd80f0",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 320,
            "y": 160,
            "wires": [
                {
                    "id": "b9c02eadd51d2391",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "07a7fc5bcd60a12a",
        "type": "subflow",
        "name": "vda-status-running InstantAction",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 120,
                "wires": [
                    {
                        "id": "f77653d3181ab432"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 620,
                "y": 120,
                "wires": [
                    {
                        "id": "f77653d3181ab432",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 420,
            "y": 200,
            "wires": [
                {
                    "id": "2490563da31e8fd4",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "105d02aba31c4a1d",
        "type": "subflow",
        "name": "check-nodeValue-is-true",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "2eb17eba88eb7a2a"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 390,
                "y": 80,
                "wires": [
                    {
                        "id": "2eb17eba88eb7a2a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "inputLabels": [
            "opcua-boolean"
        ],
        "outputLabels": [
            "is-true"
        ],
        "icon": "node-red/alert.svg",
        "status": {
            "x": 300,
            "y": 160,
            "wires": [
                {
                    "id": "bfe7d55dce5e2b71",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "468f2460ce66f11e",
        "type": "subflow",
        "name": "check-opcua-connection",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "e439d1ef2174715f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 850,
                "y": 80,
                "wires": [
                    {
                        "id": "e439d1ef2174715f",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "inputLabels": [
            "OPCUA-Messages"
        ],
        "outputLabels": [
            "MQTT-Status"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 240,
            "y": 280,
            "wires": [
                {
                    "id": "d8c7f42fd8b72ff8",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "d86e8f9e7358411d",
        "type": "subflow",
        "name": "handle-actions (2)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "6b1adb47955dfa19"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "7627f392f659e98b",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "5c2a0b381fb03123",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "d6ca931e948c60f0",
                        "port": 0
                    },
                    {
                        "id": "4e80a2f5720dd67d",
                        "port": 0
                    },
                    {
                        "id": "e5c6dd3d7d2bac39",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "6b1adb47955dfa19",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "399d5d4a2b75c79a",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "986b054aaf6007a7",
        "type": "subflow",
        "name": "handle-actions",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "a8eab7014ae73972"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "045d68bba0243095",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "5d6adc0772166eda",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "7cedca42200365ca",
                        "port": 0
                    },
                    {
                        "id": "621c53f68219b83d",
                        "port": 0
                    },
                    {
                        "id": "b5111d09739c6634",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "a8eab7014ae73972",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "62a5b49d4e6e6fdf",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "c3f24fefbef21f97",
        "type": "subflow",
        "name": "handle-actions (3)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "1a8a1f4cf0866e23"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "839c39b4b59c222a",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "955189e21fc05e33",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "6ea220e7e7c1a836",
                        "port": 0
                    },
                    {
                        "id": "86b62247ea5ccccc",
                        "port": 0
                    },
                    {
                        "id": "e2b0499499c24c93",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "1a8a1f4cf0866e23",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "dd2e1e84c851cc54",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "1ff920852c2c4442",
        "type": "subflow",
        "name": "handle-actions (2) (2)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "3581ead0f0c78fa9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "caec311c0818f3db",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "96504ba6fcd53ead",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "503909a7518f0605",
                        "port": 0
                    },
                    {
                        "id": "059f00d9f9520a33",
                        "port": 0
                    },
                    {
                        "id": "577ffc9e35e218bb",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "3581ead0f0c78fa9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "6b84d95b463182e6",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "b16337867a692514",
        "type": "subflow",
        "name": "handle-actions (4)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "a871cf6694831b8a"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "50d4de46b9960306",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "175d8abf79729351",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "396bacc16b872545",
                        "port": 0
                    },
                    {
                        "id": "5c22f7b8a1637a11",
                        "port": 0
                    },
                    {
                        "id": "89c672a6cd75206a",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "a871cf6694831b8a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "55e8d8e5d3322817",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "366624545bcd46b3",
        "type": "subflow",
        "name": "handle-actions (5)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "78ba141e36588695"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "39b506b93a26554d",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "c85adb0623a6f4a5",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "8e9a90fb23729ef8",
                        "port": 0
                    },
                    {
                        "id": "9bcc993d806dc415",
                        "port": 0
                    },
                    {
                        "id": "a262f2dbcc051402",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "78ba141e36588695",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "fa77f184a4e19353",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "fbc0621029d72e19",
        "type": "subflow",
        "name": "vda-status-finished InstantAction (1)",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "77d39716693e6870"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "77d39716693e6870",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 320,
            "y": 160,
            "wires": [
                {
                    "id": "fd628a0e7ede4ea9",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "473f5011528a6e13",
        "type": "subflow",
        "name": "handle-actions (6)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "b3d74b8fa7544111"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "a457078ddb83f6ab",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "9c4cc2b7b76d6692",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "e6ce7470184867a1",
                        "port": 0
                    },
                    {
                        "id": "a2b951bc75496b68",
                        "port": 0
                    },
                    {
                        "id": "9d40caf2ca4e76c0",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "b3d74b8fa7544111",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "9c563315f6c5dbb6",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "3dfc453382178c7d",
        "type": "subflow",
        "name": "vda-status-finished InstantAction (2)",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "613d75f1c4d05abd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "613d75f1c4d05abd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 320,
            "y": 160,
            "wires": [
                {
                    "id": "e154682e60317603",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "ac86906fc2073a6f",
        "type": "subflow",
        "name": "handle-actions (7)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "d7641e4226cbbdf9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "f7f9faf920c0ab73",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "98a94cdf5523ebb0",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "8a534ef816e3aaf1",
                        "port": 0
                    },
                    {
                        "id": "d2dfda05af4d11e3",
                        "port": 0
                    },
                    {
                        "id": "a91d577df08694a5",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "d7641e4226cbbdf9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "fe5cffc8a4a89fb9",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "67a9482494b7bade",
        "type": "subflow",
        "name": "vda-status-finished InstantAction (3)",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "01e483f7e5e8f4ea"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "01e483f7e5e8f4ea",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 320,
            "y": 160,
            "wires": [
                {
                    "id": "24845102a736866e",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "f3a1307d7c660cff",
        "type": "subflow",
        "name": "handle-actions (8)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "55b50e2b90252fd9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "2c3e6f0d7c5909c1",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "096561d33a85ba4a",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "ece69ba36aebadce",
                        "port": 0
                    },
                    {
                        "id": "e3378ee54e4dcd68",
                        "port": 0
                    },
                    {
                        "id": "8246808a2fe44ad7",
                        "port": 0
                    }
                ]
            },
            {
                "x": 680,
                "y": 280,
                "wires": [
                    {
                        "id": "55b50e2b90252fd9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "dc94cb070be9034d",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "76fb0696f941be3b",
        "type": "subflow",
        "name": "vda-status-finished InstantAction (4)",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "f95e26328b6cb0fe"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "f95e26328b6cb0fe",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#FDD0A2",
        "outputLabels": [
            "toMQTT"
        ],
        "icon": "node-red/status.svg",
        "status": {
            "x": 320,
            "y": 160,
            "wires": [
                {
                    "id": "f973ca5ebed6990e",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "fe6c5275f1fb180e",
        "type": "subflow",
        "name": "handle-actions (1) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "dfdb31ca2469b5a9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "1e8016f06fcbf24e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "4b4550040c06fd91",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "216ff15b615f2346",
                        "port": 0
                    },
                    {
                        "id": "a7c88da5f416ef3b",
                        "port": 0
                    },
                    {
                        "id": "4ee1669c7586347d",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "dfdb31ca2469b5a9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "a833e4c6ea322026",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "6623726ed7b3b603",
        "type": "subflow",
        "name": "handle-actions (2) (1) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "a08fd93b5321fac7"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "16b4e3b65b47a427",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "0d1988c61a3ba902",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "fc1a4b7cd23261cc",
                        "port": 0
                    },
                    {
                        "id": "3813f66664d6f583",
                        "port": 0
                    },
                    {
                        "id": "f6878e30e98dbf96",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "a08fd93b5321fac7",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "ced7f54cfa75f29c",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "6848ea4e725143d4",
        "type": "subflow",
        "name": "handle-actions (9)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "ef121c79f9fccc38"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "3d8d67106d87d97f",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "98f935fa06266957",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "f09593f09b559dbe",
                        "port": 0
                    },
                    {
                        "id": "5462c2b6bda9ad00",
                        "port": 0
                    },
                    {
                        "id": "f8e6e8cbb88ebfab",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "ef121c79f9fccc38",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "7310cf61af527a95",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "27e3b5a6a27dfb07",
        "type": "subflow",
        "name": "handle-actions (2) (3)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "a342345f7f70adde"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "c27bbb4c944408fa",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "5cc1f2486b7f7a68",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "b5b3796991f90a62",
                        "port": 0
                    },
                    {
                        "id": "42dda04e83d6d855",
                        "port": 0
                    },
                    {
                        "id": "54a05b7fd64ab8ba",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "a342345f7f70adde",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "b41689afc1defd47",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "5dd9a3ea3d36c5e7",
        "type": "subflow",
        "name": "handle-actions (10)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "d4e41148ad7c7297"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "a6926492ff09038c",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "dafbd30a43bfbe44",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "791892d6f74a8fc7",
                        "port": 0
                    },
                    {
                        "id": "1bef33880c3faf4e",
                        "port": 0
                    },
                    {
                        "id": "35a291fa01e739d2",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "d4e41148ad7c7297",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "7a2d1ca5ccdb12cc",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "416e768ad0dd8fe2",
        "type": "subflow",
        "name": "handle-actions (3) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "61b3064c360f5117"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "111fa6ca44dc884d",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "6f12e698bbe0e652",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "d1a47a582519de7f",
                        "port": 0
                    },
                    {
                        "id": "6eb7071b9a650ef4",
                        "port": 0
                    },
                    {
                        "id": "da454a461b0fdb7c",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "61b3064c360f5117",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "5af6fd1a0b7f63d2",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "9234b63e1a4ef5fe",
        "type": "subflow",
        "name": "handle-actions (2) (2) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "b21c503338b1f546"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "38eb44f502ed7ffc",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "3b3aeb9ac8f53e34",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "d312327ae8170daf",
                        "port": 0
                    },
                    {
                        "id": "03dac1d00ff712bd",
                        "port": 0
                    },
                    {
                        "id": "0b8ee26bf2b84e13",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "b21c503338b1f546",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "96d16d7b4022341b",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "98415d4f51dc9a1e",
        "type": "subflow",
        "name": "handle-actions (4) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "c0bf64c913e813c1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "bcc58817d9644e19",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "6e8f2bec4cea3953",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "c8f547c575b07025",
                        "port": 0
                    },
                    {
                        "id": "70ff57bb867ac348",
                        "port": 0
                    },
                    {
                        "id": "fa14291fff360832",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "c0bf64c913e813c1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "633c595a9a390fe5",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "0b90a6fc2e611af1",
        "type": "subflow",
        "name": "handle-actions (5) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "d4c20d76361caea1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "e22a21387b27bac9",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "2480b69c3cdf0f4d",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "2bead0bf5887874c",
                        "port": 0
                    },
                    {
                        "id": "93bb4744a54c12c9",
                        "port": 0
                    },
                    {
                        "id": "7b376e52930be96a",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "d4c20d76361caea1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "23ba99edc98119e4",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "7d3b2d5805495822",
        "type": "subflow",
        "name": "handle-actions (6) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "266e27d1f1e44c92"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "80a861b3a4f591d6",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "71117effb3f31ccc",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "94f609d0b50ebd7b",
                        "port": 0
                    },
                    {
                        "id": "609a871c6f22e070",
                        "port": 0
                    },
                    {
                        "id": "9d1cce1f55989b11",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "266e27d1f1e44c92",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "e52b48c285b0df17",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "6ae11647b552316e",
        "type": "subflow",
        "name": "handle-actions (7) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "1d3b9111a43a44a3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "c24e9d3a4132418e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "b2d1f232b67184b8",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "577f55e563cc9ecd",
                        "port": 0
                    },
                    {
                        "id": "a3966c36a53790c3",
                        "port": 0
                    },
                    {
                        "id": "6eb836b5f4a88039",
                        "port": 0
                    }
                ]
            },
            {
                "x": 620,
                "y": 200,
                "wires": [
                    {
                        "id": "1d3b9111a43a44a3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT",
            "afterFactsheetUpdate"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "1cef9e3cb541329c",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "4a591b1ca8fe0bf6",
        "type": "subflow",
        "name": "handle-actions (8) (1)",
        "info": "Flow to handle orders and instantActions",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 160,
                "wires": [
                    {
                        "id": "57499961c19ee016"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2390,
                "y": 220,
                "wires": [
                    {
                        "id": "f9b3c2ead1fed98b",
                        "port": 0
                    }
                ]
            },
            {
                "x": 2140,
                "y": 680,
                "wires": [
                    {
                        "id": "f3a27f6e0f6daf68",
                        "port": 0
                    }
                ]
            },
            {
                "x": 3060,
                "y": 80,
                "wires": [
                    {
                        "id": "4984958e50b05d95",
                        "port": 0
                    },
                    {
                        "id": "63373ba35b460ce5",
                        "port": 0
                    },
                    {
                        "id": "2bc0059c06184adf",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#b3d2e9",
        "inputLabels": [
            "serialNumber"
        ],
        "outputLabels": [
            "order",
            "supportedInstantAction",
            "forMQTT"
        ],
        "icon": "node-red/parser-json.svg",
        "status": {
            "x": 360,
            "y": 820,
            "wires": [
                {
                    "id": "47b449a6503aa3b4",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "2daeb980dd1c982f",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "name": "OPCUA-INPUT",
        "style": {
            "label": true,
            "stroke": "#7fb7df"
        },
        "nodes": [
            "311287dbfbf37fd3",
            "fc599d22ccd574a2",
            "7574b19f8c742349",
            "4938b2e07b92453e",
            "e572a650f7fb5a7a",
            "4e8c19bbae111924",
            "681458b8eb61d615",
            "ce7a90dd937307c8"
        ],
        "x": 114,
        "y": 199,
        "w": 912,
        "h": 282
    },
    {
        "id": "651b892d91c059ed",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "name": "MQTT-INPUT",
        "style": {
            "label": true,
            "stroke": "#ffC000"
        },
        "nodes": [
            "dfedc79f9c8e3b8a",
            "a4407ff64d862642",
            "7b1c186d0126121a",
            "12b6aa988c96c9fb",
            "444d2d13d871c4d1",
            "31a3ee846bfad4d2",
            "069e736edfbf73dc",
            "0b67e1207ab5fbfe",
            "e75b1cb10a38be2a",
            "9e47401f49f5c6e9",
            "54a1d3db60c49611"
        ],
        "x": 454,
        "y": 1413,
        "w": 3352,
        "h": 740
    },
    {
        "id": "18add21960208cd5",
        "type": "group",
        "z": "178d4ec7b06e55a6",
        "name": "Global-Reset",
        "style": {
            "stroke": "none",
            "fill": "#ffbfbf",
            "label": true,
            "color": "#000000",
            "fill-opacity": "0.3"
        },
        "nodes": [
            "d2eca94f5d095240",
            "02cea52e4d112e16",
            "6926a73975a02af4",
            "811aa747b8613b24"
        ],
        "x": 94,
        "y": 579,
        "w": 752,
        "h": 82
    },
    {
        "id": "c5d50add89336f77",
        "type": "group",
        "z": "2acde404c8501321",
        "name": "CHECK_QUALITY for TXT",
        "style": {
            "stroke": "#ffC000",
            "label": true
        },
        "nodes": [
            "0424fc990b21791f",
            "0e1592f93726ce2e",
            "fc1841ebfae81247"
        ],
        "x": 1254,
        "y": 1919,
        "w": 562,
        "h": 102
    },
    {
        "id": "651507c0d9985127",
        "type": "group",
        "z": "2acde404c8501321",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "126cee3c77536702",
            "f72e14b5fc7abbf2"
        ],
        "x": 1254,
        "y": 2039,
        "w": 572,
        "h": 82
    },
    {
        "id": "0c2639f67b75e26f",
        "type": "group",
        "z": "2acde404c8501321",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "0783aec6a1731686",
            "3a6767b90d2575ab",
            "37409311a820900f"
        ],
        "x": 54,
        "y": 359,
        "w": 672,
        "h": 122
    },
    {
        "id": "2b02fa69cc69be86",
        "type": "group",
        "z": "2acde404c8501321",
        "name": "CHECK_QUALITY for Calibration Image",
        "style": {
            "stroke": "#ffC000",
            "label": true
        },
        "nodes": [
            "702e0d4ef7f8668c",
            "e462e67586083065"
        ],
        "x": 1194,
        "y": 939,
        "w": 302,
        "h": 82
    },
    {
        "id": "903773a8fcd9e150",
        "type": "group",
        "z": "b68bbce92754c7f5",
        "name": "OPCUA-INPUT",
        "style": {
            "label": true,
            "stroke": "#7fb7df"
        },
        "nodes": [
            "e6aa627fa2d83815",
            "73003f37ba2b43ca",
            "dc3f1461c9ceda1e",
            "22ef9861d495dd8b",
            "940ebb3618ee3c08",
            "cad68111d8c4d32f",
            "d1bde1208aefd194",
            "9ffeceb7ac71f3c1"
        ],
        "x": 264,
        "y": 1639,
        "w": 912,
        "h": 282
    },
    {
        "id": "444d2d13d871c4d1",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "FTS-MQTT-TOPICS",
        "style": {
            "label": true
        },
        "nodes": [
            "13b75ae128c53483",
            "d479659b47100903",
            "14c894248b36e415",
            "76bcb858cb35637f"
        ],
        "x": 694,
        "y": 1439,
        "w": 232,
        "h": 202
    },
    {
        "id": "31a3ee846bfad4d2",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "HBW-STOCK-MQTT-TOPIC",
        "style": {
            "label": true
        },
        "nodes": [
            "d5152b4134dcfb1f"
        ],
        "x": 734,
        "y": 1659,
        "w": 184,
        "h": 82
    },
    {
        "id": "069e736edfbf73dc",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "DPS-MQTT-TOPIC",
        "style": {
            "label": true
        },
        "nodes": [
            "66e055f1f053982b"
        ],
        "x": 674,
        "y": 1759,
        "w": 252,
        "h": 82
    },
    {
        "id": "0b67e1207ab5fbfe",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "MQTT-IN",
        "style": {
            "label": true
        },
        "nodes": [
            "ee49f6de58624806",
            "c03d070a1bd0d44e"
        ],
        "x": 1034,
        "y": 1629,
        "w": 312,
        "h": 142
    },
    {
        "id": "e75b1cb10a38be2a",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "MQTT-JSON-CONVERTING",
        "style": {
            "label": true
        },
        "nodes": [
            "7614537a083b33af",
            "144b6bc9e6bc95fe"
        ],
        "x": 1534,
        "y": 1619,
        "w": 252,
        "h": 142
    },
    {
        "id": "9e47401f49f5c6e9",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "MQTT-DPS-HANDLING",
        "style": {
            "label": true
        },
        "nodes": [
            "35e48063b1c5fb09",
            "5f4c11218571e240"
        ],
        "x": 1528,
        "y": 1793,
        "w": 2124,
        "h": 334
    },
    {
        "id": "35e48063b1c5fb09",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "9e47401f49f5c6e9",
        "name": "DPS-MQTT-JSON-CONVERTING",
        "style": {
            "label": true
        },
        "nodes": [
            "b1a76099fe2cd28f",
            "49cc93164bff6a2c",
            "dfd7cfeb7049b921"
        ],
        "x": 1554,
        "y": 1856.5,
        "w": 412,
        "h": 144.5
    },
    {
        "id": "5f4c11218571e240",
        "type": "group",
        "z": "3f8971c7785c0a4b",
        "g": "9e47401f49f5c6e9",
        "name": "DPS-TIMING",
        "style": {
            "label": true
        },
        "nodes": [
            "2e8859e6fb018137",
            "dc4a1e7192773f8c",
            "6399f50d6c88fc6e",
            "c0d620d24d447148",
            "328027d52c8d6a95",
            "33ec3fc4f13273af",
            "0ea7be49ac02efa6",
            "ce3ceaf769e2af71",
            "764a332ab38c7996",
            "9f67fbf39105ca72",
            "bb6475ebad4b3a4b",
            "54b198c624ec43e0",
            "ecf41d5240381885",
            "76f8732ebcd1de6f",
            "41cae3d6cdebf43e"
        ],
        "x": 2154,
        "y": 1819,
        "w": 1472,
        "h": 282
    },
    {
        "id": "4",
        "type": "influxdb",
        "hostname": "host.docker.internal",
        "port": "8086",
        "protocol": "http",
        "database": "not_used",
        "name": "Influx 2.0",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://host.docker.internal:8086",
        "timeout": "10",
        "rejectUnauthorized": true
    },
    {
        "id": "15b84ed331dcc49c",
        "type": "mqtt-broker",
        "name": "docker_mqtt",
        "broker": "mosquitto",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "5",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "module/v1/ff/NodeRed/status",
        "birthQos": "1",
        "birthRetain": "true",
        "birthPayload": "{\"connectionState\":\"ONLINE\"}",
        "birthMsg": {},
        "closeTopic": "module/v1/ff/NodeRed/status",
        "closeQos": "1",
        "closeRetain": "true",
        "closePayload": "{\"connectionState\":\"OFFLINE\"}",
        "closeMsg": {},
        "willTopic": "module/v1/ff/NodeRed/status",
        "willQos": "1",
        "willRetain": "true",
        "willPayload": "{\"connectionState\":\"CONNECTIONBROKEN\"}",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "1688373ab61bf50e",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "b0304d7a5e30fa26",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "54c7382455c7e109",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "0966ee4e57d8f7be",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "12c89180c7296d90",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "6e321873fd269b56",
        "type": "websocket-listener",
        "path": "/ws/data",
        "wholemsg": "false"
    },
    {
        "id": "061fc1a8298650a8",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://hbw:4843",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "HBW_Server_docker",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "46f8b2363b259b7f",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://quality:4842",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "AIQS_Server_docker",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "484db7503e21eb9d",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://mill:4841",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "MILL_Server_docker",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "498894fd271dd208",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://drill:4840",
        "endpointMustExist": true,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "DRILL_Server",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": true,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "6238c7029418140a",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://127.0.0.1:4843",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "DPS_SERVER",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "opcua_connector",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://127.0.0.1:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "Local OPC UA",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": ""
    },
    {
        "id": "ba470ffb3c3a9f2d",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://127.0.0.1:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "DRILL_Server",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "e9baec42328fc918",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://127.0.0.1:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "LOCAL_drill",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": 10
    },
    {
        "id": "90582fb778f3aece",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://drill:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "LOCAL_drill_process",
        "showErrors": false,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": 10
    },
    {
        "id": "d1cfe01b472edddf",
        "type": "OPCUA-IIoT-Connector",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://drill:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "DrillConnector",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": 10
    },
    {
        "id": "7439f9c4361337ae",
        "type": "OPCUA-IIoT-Connector",
        "z": "12d77bbd6f79a8bf",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://192.168.0.40:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "MILL_OPCUA",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "1000",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "b4d433573f375564",
        "type": "OPCUA-IIoT-Connector",
        "z": "b68bbce92754c7f5",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://drill:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "DRILL1_OPCUA_docker",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "1000",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "c7fddcd91d392583",
        "type": "OPCUA-IIoT-Connector",
        "z": "2acde404c8501321",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://192.168.0.70:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "AIQS1_OPCUA",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "1000",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "e5ff6c0d70297737",
        "type": "OPCUA-IIoT-Connector",
        "z": "e1de889cd6928bd7",
        "discoveryUrl": "",
        "endpoint": "opc.tcp://192.168.0.80:4840",
        "endpointMustExist": false,
        "keepSessionAlive": true,
        "loginEnabled": false,
        "name": "HBW1_OPCUA",
        "showErrors": true,
        "securityPolicy": "None",
        "securityMode": "None",
        "individualCerts": false,
        "publicCertificateFile": "",
        "privateKeyFile": "",
        "defaultSecureTokenLifetime": "",
        "autoSelectRightEndpoint": false,
        "strategyMaxRetry": "",
        "strategyInitialDelay": "1000",
        "strategyMaxDelay": "",
        "strategyRandomisationFactor": "",
        "requestedSessionTimeout": "",
        "connectionStartDelay": "",
        "reconnectDelay": "",
        "maxBadSessionRequests": "10"
    },
    {
        "id": "b85edc4a.8f134",
        "type": "ui_tab",
        "name": "Module Debug",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "7ef8e15a37b8acdf",
        "type": "ui_group",
        "name": "Debug Tools",
        "tab": "b85edc4a.8f134",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "fe4067d3fa596075",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "a4e045d7ed66ba05",
        "type": "mongodb",
        "hostname": "db",
        "topology": "direct",
        "connectOptions": "",
        "port": 27017,
        "db": "aps",
        "name": ""
    },
    {
        "id": "16b28f271e605065",
        "type": "mongodb",
        "hostname": "db",
        "topology": "direct",
        "connectOptions": "",
        "port": "27017",
        "db": "aps",
        "name": "APS MongoDB"
    },
    {
        "id": "mongodb_config",
        "type": "mongodb",
        "hostname": "mongo_container",
        "topology": "direct",
        "connectOptions": "authSource=admin",
        "port": "27017",
        "db": "aps",
        "name": "MongoDB APS"
    },
    {
        "id": "1e20f142c5472af7",
        "type": "mongodb",
        "hostname": "db",
        "topology": "direct",
        "connectOptions": "",
        "port": 27017,
        "db": "dps",
        "name": ""
    },
    {
        "id": "338d54d557e793cf",
        "type": "influxdb",
        "hostname": "host.docker.internal",
        "port": 8086,
        "protocol": "http",
        "database": "database",
        "name": "influx db server",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://host.docker.internal:8086",
        "timeout": 10,
        "rejectUnauthorized": true
    },
    {
        "id": "cb4dd2325f0bfab1",
        "type": "postgreSQLConfig",
        "name": "",
        "host": "host.docker.internal",
        "hostFieldType": "str",
        "port": 5432,
        "portFieldType": "num",
        "database": "aps",
        "databaseFieldType": "str",
        "ssl": "false",
        "sslFieldType": "bool",
        "applicationName": "",
        "applicationNameType": "str",
        "max": 10,
        "maxFieldType": "num",
        "idle": 1000,
        "idleFieldType": "num",
        "connectionTimeout": 10000,
        "connectionTimeoutFieldType": "num",
        "user": "mahdi",
        "userFieldType": "str",
        "password": "MahdiPassword",
        "passwordFieldType": "str"
    },
    {
        "id": "1d8af14727bd15b5",
        "type": "postgreSQLConfig",
        "name": "newDb",
        "host": "host.docker.internal",
        "hostFieldType": "str",
        "port": 5432,
        "portFieldType": "num",
        "database": "aps",
        "databaseFieldType": "str",
        "ssl": "false",
        "sslFieldType": "bool",
        "applicationName": "",
        "applicationNameType": "str",
        "max": 10,
        "maxFieldType": "num",
        "idle": 1000,
        "idleFieldType": "num",
        "connectionTimeout": 10000,
        "connectionTimeoutFieldType": "num",
        "user": "mahdi",
        "userFieldType": "str",
        "password": "MahdiPassword",
        "passwordFieldType": "str"
    },
    {
        "id": "152363633c148c89",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "942e50b9e32cfa93",
        "type": "mqtt in",
        "z": "a941df4dfaa3ef82",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "ea2f04ae346c612b",
                "67fd47185004b37b"
            ]
        ]
    },
    {
        "id": "172c408170ea9fe2",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "942e50b9e32cfa93"
            ]
        ]
    },
    {
        "id": "d4b0b4872bfc19cd",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "942e50b9e32cfa93"
            ]
        ]
    },
    {
        "id": "90a0051f1617683a",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "796d3b2bff9c8445",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "172c408170ea9fe2",
                "d4b0b4872bfc19cd",
                "df149938e348ab3b",
                "54522c9053253a4a"
            ]
        ]
    },
    {
        "id": "df149938e348ab3b",
        "type": "delay",
        "z": "a941df4dfaa3ef82",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "90a0051f1617683a"
            ]
        ]
    },
    {
        "id": "54522c9053253a4a",
        "type": "delay",
        "z": "a941df4dfaa3ef82",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "152363633c148c89"
            ]
        ]
    },
    {
        "id": "ea2f04ae346c612b",
        "type": "switch",
        "z": "a941df4dfaa3ef82",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "d7edf028b89ed28e",
                "cebd1b03883f3c2f"
            ],
            [
                "d6743905e4bb4ce9",
                "cebd1b03883f3c2f",
                "2f56e7bd69194eee"
            ]
        ]
    },
    {
        "id": "d54b71758f5fcd13",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "0dd7dac24f620bdc",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "e9a2aa001ba01330"
            ],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "de094f01e95267cc",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "0dd7dac24f620bdc"
            ],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d6743905e4bb4ce9",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "de094f01e95267cc"
            ]
        ]
    },
    {
        "id": "e9a2aa001ba01330",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "5fc65f720f90c261",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "e84d82144fcd3da6"
            ],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d7edf028b89ed28e",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "5fc65f720f90c261"
            ]
        ]
    },
    {
        "id": "e84d82144fcd3da6",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "c6c47cb6533a38aa"
            ],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c6c47cb6533a38aa",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "4663e09b0f6e34a8"
            ],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2800fb9ec787f9d6",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "d54b71758f5fcd13"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "4663e09b0f6e34a8",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "2800fb9ec787f9d6"
            ]
        ]
    },
    {
        "id": "bb35538923a3f187",
        "type": "debug",
        "z": "a941df4dfaa3ef82",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "cebd1b03883f3c2f",
        "type": "function",
        "z": "a941df4dfaa3ef82",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "bb35538923a3f187"
            ]
        ]
    },
    {
        "id": "ec94b19d10685ae9",
        "type": "catch",
        "z": "a941df4dfaa3ef82",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "d7c746f4a7af0634"
            ]
        ]
    },
    {
        "id": "d7c746f4a7af0634",
        "type": "debug",
        "z": "a941df4dfaa3ef82",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "2876f9e731fcac7c",
        "type": "status",
        "z": "a941df4dfaa3ef82",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "67fd47185004b37b",
        "type": "debug",
        "z": "a941df4dfaa3ef82",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "2f56e7bd69194eee",
        "type": "debug",
        "z": "a941df4dfaa3ef82",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "08f3d186831e0928",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "a7693266ac8bf0a7",
        "type": "mqtt in",
        "z": "66587e5c3f596288",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "ae98e6f218d61a7c",
                "e90e13427a9cb31e"
            ]
        ]
    },
    {
        "id": "3f2444266dd1e585",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "a7693266ac8bf0a7"
            ]
        ]
    },
    {
        "id": "bbb5bbe984da2753",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "a7693266ac8bf0a7"
            ]
        ]
    },
    {
        "id": "80f5cf6e95889111",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "29cc9f9db61ac7a6",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "3f2444266dd1e585",
                "bbb5bbe984da2753",
                "d1dd9472cf0b9b7c",
                "faa222f5c7589d03"
            ]
        ]
    },
    {
        "id": "d1dd9472cf0b9b7c",
        "type": "delay",
        "z": "66587e5c3f596288",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "80f5cf6e95889111"
            ]
        ]
    },
    {
        "id": "faa222f5c7589d03",
        "type": "delay",
        "z": "66587e5c3f596288",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "08f3d186831e0928"
            ]
        ]
    },
    {
        "id": "ae98e6f218d61a7c",
        "type": "switch",
        "z": "66587e5c3f596288",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "d4ae706b95623e90",
                "62a6d78976a44552"
            ],
            [
                "be682f3431cbcbce",
                "62a6d78976a44552",
                "0c1035761ef4c3f8"
            ]
        ]
    },
    {
        "id": "3874e7c1495f58af",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "ea0da410f0cc702e",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "0e74869b5d90c756"
            ],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c8ce41a6cf51112d",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "ea0da410f0cc702e"
            ],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "be682f3431cbcbce",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "c8ce41a6cf51112d"
            ]
        ]
    },
    {
        "id": "0e74869b5d90c756",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "936cd4bc8a2923ab",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "d0003adb87353d7b"
            ],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d4ae706b95623e90",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "936cd4bc8a2923ab"
            ]
        ]
    },
    {
        "id": "d0003adb87353d7b",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "61f10f430ab08c57"
            ],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "61f10f430ab08c57",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "705d5594311157e2"
            ],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "3b1e1d02273b0473",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "3874e7c1495f58af"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "705d5594311157e2",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "3b1e1d02273b0473"
            ]
        ]
    },
    {
        "id": "cbd8b0d73ab6d101",
        "type": "debug",
        "z": "66587e5c3f596288",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "62a6d78976a44552",
        "type": "function",
        "z": "66587e5c3f596288",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "cbd8b0d73ab6d101"
            ]
        ]
    },
    {
        "id": "d8fa2fd3cbbdec16",
        "type": "catch",
        "z": "66587e5c3f596288",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "d746f4a56e3c4272"
            ]
        ]
    },
    {
        "id": "d746f4a56e3c4272",
        "type": "debug",
        "z": "66587e5c3f596288",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "0411044ba54c7ec8",
        "type": "status",
        "z": "66587e5c3f596288",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "e90e13427a9cb31e",
        "type": "debug",
        "z": "66587e5c3f596288",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "0c1035761ef4c3f8",
        "type": "debug",
        "z": "66587e5c3f596288",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "4ffa811ecb746d4f",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "12b7f30f89fc2761",
        "type": "mqtt in",
        "z": "1b897516f5bf21fa",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "19c73938a34f7397",
                "8ce2f7c2955c85f4"
            ]
        ]
    },
    {
        "id": "d53a1400a9f46117",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "12b7f30f89fc2761"
            ]
        ]
    },
    {
        "id": "e2dfb17bae4243cf",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "12b7f30f89fc2761"
            ]
        ]
    },
    {
        "id": "6c733024026db14e",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "35bb3bae6cae9a4c",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "d53a1400a9f46117",
                "e2dfb17bae4243cf",
                "f4b7c39ee4f042c6",
                "01e8a5d11f1c807c"
            ]
        ]
    },
    {
        "id": "f4b7c39ee4f042c6",
        "type": "delay",
        "z": "1b897516f5bf21fa",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "6c733024026db14e"
            ]
        ]
    },
    {
        "id": "01e8a5d11f1c807c",
        "type": "delay",
        "z": "1b897516f5bf21fa",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "4ffa811ecb746d4f"
            ]
        ]
    },
    {
        "id": "19c73938a34f7397",
        "type": "switch",
        "z": "1b897516f5bf21fa",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "17adb789ba506056",
                "053f4854f9598be5"
            ],
            [
                "28872e6dafa9e3de",
                "053f4854f9598be5",
                "a974696dd4a89e76"
            ]
        ]
    },
    {
        "id": "09075949c82779fc",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "fed3de4f18bfc373",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "6c70068076961807"
            ],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "3ebde9ba7aa9d231",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "fed3de4f18bfc373"
            ],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "28872e6dafa9e3de",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "3ebde9ba7aa9d231"
            ]
        ]
    },
    {
        "id": "6c70068076961807",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "00a4b26a1a2f10a2",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "80215b551d9f0179"
            ],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "17adb789ba506056",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "00a4b26a1a2f10a2"
            ]
        ]
    },
    {
        "id": "80215b551d9f0179",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "fbf2c5966ac5388c"
            ],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "fbf2c5966ac5388c",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "572f37e8b111b091"
            ],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "dc414fb188f715a6",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "09075949c82779fc"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "572f37e8b111b091",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "dc414fb188f715a6"
            ]
        ]
    },
    {
        "id": "f6506332d8af5a22",
        "type": "debug",
        "z": "1b897516f5bf21fa",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "053f4854f9598be5",
        "type": "function",
        "z": "1b897516f5bf21fa",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "f6506332d8af5a22"
            ]
        ]
    },
    {
        "id": "56cf1074a6a1ec73",
        "type": "catch",
        "z": "1b897516f5bf21fa",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "061ca8669fccfa25"
            ]
        ]
    },
    {
        "id": "061ca8669fccfa25",
        "type": "debug",
        "z": "1b897516f5bf21fa",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "2950af8db6503c05",
        "type": "status",
        "z": "1b897516f5bf21fa",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "8ce2f7c2955c85f4",
        "type": "debug",
        "z": "1b897516f5bf21fa",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "a974696dd4a89e76",
        "type": "debug",
        "z": "1b897516f5bf21fa",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "7fea810e0a1a626a",
        "type": "file in",
        "z": "6a25ecd632542087",
        "name": "",
        "filename": "factsheetFile",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "utf8",
        "allProps": false,
        "x": 340,
        "y": 100,
        "wires": [
            [
                "d329b63e50c70622"
            ]
        ]
    },
    {
        "id": "d329b63e50c70622",
        "type": "json",
        "z": "6a25ecd632542087",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 530,
        "y": 100,
        "wires": [
            [
                "ae8c0f5da4317371"
            ]
        ]
    },
    {
        "id": "ae8c0f5da4317371",
        "type": "function",
        "z": "6a25ecd632542087",
        "name": "updateFactsheet",
        "func": "const factsheet = msg.payload ?? {};\n\n// update the timestamp\nfactsheet.timestamp = new Date().toISOString();\n\n// set factsheet to payload after all updates\nmsg.factsheet = factsheet;\nmsg.payload = factsheet;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "2df87e11e653a880",
        "type": "inject",
        "z": "6a25ecd632542087",
        "name": "",
        "props": [
            {
                "p": "factsheetFile",
                "v": "FACTSHEET_FILE",
                "vt": "env"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "7fea810e0a1a626a"
            ]
        ]
    },
    {
        "id": "eccbae14041fd8d1",
        "type": "template",
        "z": "6a25ecd632542087",
        "name": "",
        "field": "factsheetFile",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{$env[\"FACTSHEET_FILE\"]}}",
        "output": "str",
        "x": 160,
        "y": 160,
        "wires": [
            [
                "7fea810e0a1a626a"
            ]
        ]
    },
    {
        "id": "f0c23c25821f9eb5",
        "type": "inject",
        "z": "a91568669d27b6cc",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 80,
        "wires": [
            [
                "1221e1a68d16c50c"
            ]
        ]
    },
    {
        "id": "1221e1a68d16c50c",
        "type": "function",
        "z": "a91568669d27b6cc",
        "name": "get environment variable",
        "func": "const globalEnvs = global.get('env');\nconst variableName = env.get('VARIABLE_NAME');\nconst endpoint = globalEnvs[variableName];\nmsg.endpoint = endpoint ?? variableName;\nmsg.payload = {\n    endpoint,\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 80,
        "wires": [
            [
                "21158da447f511de"
            ]
        ]
    },
    {
        "id": "21158da447f511de",
        "type": "template",
        "z": "a91568669d27b6cc",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{{payload.endpoint}}}",
        "output": "str",
        "x": 680,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "05d6bd6a25172c84",
        "type": "catch",
        "z": "a91568669d27b6cc",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 160,
        "y": 180,
        "wires": [
            [
                "8f1cd448d9ddbb7d"
            ]
        ]
    },
    {
        "id": "dfbe04cbe5e0e705",
        "type": "status",
        "z": "a91568669d27b6cc",
        "name": "",
        "scope": null,
        "x": 680,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "8f1cd448d9ddbb7d",
        "type": "debug",
        "z": "a91568669d27b6cc",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 180,
        "wires": []
    },
    {
        "id": "32713dd13356c372",
        "type": "function",
        "z": "ea935d7649fccac4",
        "name": "setup-listen",
        "func": "/**\n * @typedef {object} RackPosition\n * @property {{\"#address\": string, value: string }} name\n * @property {{\"#address\": string, value: boolean}} occupied\n * @property {{\"#address\": string, value: string}} type\n * @property {{\"#address\": string, value: string}} workpieceId\n * @property {{\"#address\": string, value: string}} ts\n */\n\n/** @param {string} nodeId */\nfunction getNodeName(nodeId) {\n    /** @type {Record<string, string>} */\n    const rack = flow.get(\"$parent.rack\") ?? {};\n    flow.set(\"$parent.rack\", rack);\n    /** @type {Record<string, string>} */\n    const existing = flow.get(\"$parent.rack.dictionary\") ?? {};\n    return existing[nodeId] ?? \"UNKNOWN\";\n}\n\n/**\n * @param {string} rackPosition\n * @returns {string|undefined}\n */\nfunction getRackPositionNodeId(rackPosition) {\n    /** @type {Record<string, string>} */\n    const rack = flow.get(\"$parent.rack\") ?? {};\n    flow.set(\"$parent.rack\", rack);\n    /** @type {Record<string, string>} */\n    const existing = flow.get(\"$parent.rack.dictionary\") ?? {};\n    return Object.entries(existing).filter(([_, value]) => value == rackPosition).map(([key]) => key)[0];\n}\n\n/** \n * @param {string} nodeId\n * @param {string} valueName\n * @param {string|boolean} nodeValue \n */\nfunction writeNodeValue(nodeId, valueName, nodeValue) {\n    const rackPos = env.get(\"RACK_POSITION\");\n    /** @type {Record<string, string>} */\n    const rack = flow.get(\"$parent.rack\") ?? {};\n    flow.set(\"$parent.rack\", rack);\n    /** @type {RackPosition} */\n    const rackPositionNodeId = getRackPositionNodeId(rackPos);\n    const storedPosition = flow.get(`$parent.rack.positions.${rackPos}`) ?? {\n        name: {\n            \"#address\": rackPositionNodeId,\n            value: rackPos\n        }\n    };\n    const strippedValueName = valueName.replace(`rack__${rackPos}_`, \"\");\n    storedPosition[strippedValueName] = {\n        \"#address\": nodeId,\n        value: nodeValue\n    };\n    flow.set(`$parent.rack.positions.${rackPos}`, storedPosition);\n    return storedPosition;\n}\n\nconst rackPos = env.get(\"RACK_POSITION\");\nconst valueName = getNodeName(msg.payload.nodeId);\n/** @type {string|boolean} */\nconst nodeValue = msg.payload.value.value.value;\nconst updatedRackPosition = writeNodeValue(msg.payload.nodeId, valueName, nodeValue);\nnode.status({ fill: \"green\", shape: \"dot\", text: `${rackPos}: ${updatedRackPosition.occupied.nodeValue} [${updatedRackPosition.type.nodeValue}]`});\nmsg.payload = updatedRackPosition;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 120,
        "wires": [
            [
                "0e6e260b3c5a891a"
            ]
        ]
    },
    {
        "id": "448fc81733591706",
        "type": "switch",
        "z": "ea935d7649fccac4",
        "name": "switch-opcua-messages",
        "property": "payload.nodetype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "browse",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "listen",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 100,
        "wires": [
            [
                "3d414039742f078e"
            ],
            [
                "32713dd13356c372"
            ]
        ]
    },
    {
        "id": "3d414039742f078e",
        "type": "function",
        "z": "ea935d7649fccac4",
        "name": "setup-dictionary",
        "func": "/**\n * @typedef {object} BrowseResult\n * @property {string} nodeId\n * @property {string} browseName\n * @property {string} displayName\n * @property {string} nodeClass\n * @property {string} datatypeName\n */\n/** @param {BrowseResult} result */\nfunction extractName({ browseName }) {\n  const [_, nodeName] = browseName.split(\":\");\n  return nodeName ?? \"UNKNOWN\";\n}\n\nconst browserResults = msg.payload.browserResults ?? [];\n/** @type {Record<string, string>} */\nconst rack = flow.get(\"$parent.rack\") ?? {};\nflow.set(\"$parent.rack\", rack);\n/** @type {Record<string, string>} */\nconst existing = flow.get(\"$parent.rack.dictionary\") ?? {};\n/** @type {Record<string, string>} */\nconst dictionary = browserResults.reduce((dict, result) => {\n  const nodeName = extractName(result);\n  return {\n    ...dict,\n    [result.nodeId]: nodeName,\n    [nodeName]: result.nodeId,\n  };\n}, existing);\nflow.set(\"$parent.rack.dictionary\", dictionary);\nreturn;",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 60,
        "wires": []
    },
    {
        "id": "8368fa805d3efbb7",
        "type": "catch",
        "z": "ea935d7649fccac4",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 180,
        "y": 180,
        "wires": [
            [
                "ee77e3e06bdd15cd"
            ]
        ]
    },
    {
        "id": "ee77e3e06bdd15cd",
        "type": "debug",
        "z": "ea935d7649fccac4",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 360,
        "y": 180,
        "wires": []
    },
    {
        "id": "f965220d4db8fa46",
        "type": "status",
        "z": "ea935d7649fccac4",
        "name": "",
        "scope": null,
        "x": 180,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "0e6e260b3c5a891a",
        "type": "function",
        "z": "ea935d7649fccac4",
        "name": "update-loads",
        "func": "/**\n * @typedef {object} RackPosition\n * @property {{value: string}} name\n * @property {{\"#address\": string, value: string}} workpieceId\n * @property {{\"#address\": string, value: boolean}} occupied\n * @property {{\"#address\": string, value: string}} type\n * @property {{\"#address\": string, value: string}} ts\n */\n\n/**\n * @typedef {object} Load\n * @property {string} loadType\n * @property {string} loadId\n * @property {string} [loadPosition]\n * \n * @param {string} rackPosition\n * @param {string} workpieceId\n * @param {string} type\n * @param {string} ts\n */\nfunction createLoad(rackPosition, workpieceId, type, ts) {\n    return {\n        loadType: type,\n        loadId: workpieceId,\n        loadPosition: rackPosition,\n        loadTimestamp: +ts,\n    };\n}\n\nfunction createLoads() {\n    /** @type {Record<string, RackPosition>} */\n    const rackPositions = flow.get(\"$parent.rack.positions\") ?? [];\n    return Object.values(rackPositions).map((pos) => createLoad(pos.name.value, pos.workpieceId.value, pos.type.value, pos.ts.value));\n}\n\n/** @type {RackPosition} */\nconst rackPosition = msg.payload;\n/** @type {Load[]} */\nconst existing = createLoads();\nconst updated = existing.map((el) => {\n    if (el.loadPosition == rackPosition.name.value) {\n        node.status({ shape: \"dot\", \"fill\": \"green\", text: `${el.loadPosition}: ${rackPosition.type.value ?? \"EMPTY\"} / ${rackPosition.workpieceId.value ?? \"-\"}` });\n        return createLoad(el.loadPosition, rackPosition.workpieceId.value, rackPosition.type.value, rackPosition.ts.value);\n    }\n    return el;\n});\nflow.set(\"$parent.loads\", updated);\nflow.set(\"$parent.state.loads\", updated);\nreturn;",
        "outputs": 0,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 120,
        "wires": []
    },
    {
        "id": "4eaf89b69e1eafe0",
        "type": "function",
        "z": "7173b966cb38f0e0",
        "name": "setup-listen",
        "func": "/**\n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {Record<string, number>} NodeValues\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string|NodeValues} nodeValue\n */\n\n/** \n * @param {string} nodeId \n * @returns {string} the nodeName\n */\nfunction getNodeName(nodeId) {\n    /** @type {Record<string, string>} */\n    const calibration = flow.get(\"$parent.calibration\") ?? {};\n    flow.set(\"$parent.calibration\", calibration);\n    /** @type {Record<string, string>} */\n    const existing = flow.get(\"$parent.calibration.dictionary\") ?? {};\n    return existing[nodeId] ?? \"UNKNOWN\";\n}\n\n/**\n * @param {string} nodeName\n * @returns {string} the nodeId\n */\nfunction getNodeIdByName(nodeName) {\n    /** @type {Record<string, string>} */\n    const calibration = flow.get(\"$parent.calibration\") ?? {};\n    flow.set(\"$parent.calibration\", calibration);\n    /** @type {Record<string, string>} */\n    const existing = flow.get(\"$parent.calibration.dictionary\") ?? {};\n    return Object.entries(existing).filter(([_, nn]) => nn.toLocaleLowerCase() == nodeName?.toLocaleLowerCase()).map(([nodeId]) => nodeId)[0];\n}\n\n/**\n * @param {string} nodeId\n * @param {number} nodeValue\n * @returns {ReferenceData}\n */\nfunction createReferenceData(nodeId, nodeValue) {\n    const nodeName = getNodeName(nodeId);\n    return {\n        referenceKey: nodeName,\n        referenceValue: nodeValue,\n    };\n}\n\n/** \n * @param {string} nodeId\n * @param {number} nodeValue\n * @returns {CalibrationValue}\n */\nfunction writeNodeValue(nodeId, nodeValue) {\n    /** @type {Record<string, CalibrationValue>} */\n    const nodeName = getNodeName(nodeId);\n    /** @type {CalibrationValue} */\n    const calibrationValue = flow.get(`$parent.calibration.state.${nodeName}`) ?? {\n        nodeId,\n        nodeName,\n    };\n    calibrationValue.nodeValue = nodeValue;\n    flow.set(`$parent.calibration.state.${nodeName}`, calibrationValue);\n    return calibrationValue;\n}\n\n/**\n * @param {Record<string, number>} nodeValueObject\n * @returns {CalibrationValue[]}\n */\nfunction writeNodeValues(nodeValueObject) {\n    // we are only interested in the entries of the nodeValueObject\n    return Object.entries(nodeValueObject).map(([nodeName, nodeValue]) => {\n        const nodeId = getNodeIdByName(nodeName);\n        return writeNodeValue(nodeId, nodeValue);\n    });\n}\n\n/** @type {string} */\nconst nodeId = msg.payload.nodeId;\n/** @type {number} */\nconst nodeValue = msg.payload.value.value.value;\nconst calibrationValue = writeNodeValue(nodeId, nodeValue);\nmsg.payload = calibrationValue;\nmsg.topic = \"calibration-value__\" + nodeId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 160,
        "wires": [
            [
                "50822f49e8a1ce63"
            ]
        ]
    },
    {
        "id": "32b0de7a18bf11ad",
        "type": "switch",
        "z": "7173b966cb38f0e0",
        "name": "switch-opcua-messages",
        "property": "payload.nodetype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "browse",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "listen",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 140,
        "wires": [
            [
                "93dd9c6ec05cb865",
                "885b455dfed2ed93"
            ],
            [
                "4eaf89b69e1eafe0"
            ]
        ]
    },
    {
        "id": "93dd9c6ec05cb865",
        "type": "function",
        "z": "7173b966cb38f0e0",
        "name": "setup-dictionary",
        "func": "/**\n * @typedef {object} BrowseResult\n * @property {string} nodeId\n * @property {string} browseName\n * @property {string} displayName\n * @property {string} nodeClass\n * @property {string} datatypeName\n */\n/** @param {BrowseResult} result */\nfunction extractName({ browseName }) {\n  const [_, nodeName] = browseName.split(\":\");\n  return nodeName ?? \"UNKNOWN\";\n}\n\nconst browserResults = msg.payload.browserResults ?? [];\n\n/** @type {Record<string, string>} */\nconst calibration = flow.get(\"$parent.calibration\") ?? {};\nflow.set(\"$parent.calibration\", calibration);\n\n/** @type {Record<string, string>} */\nconst existing = flow.get(\"$parent.calibration.dictionary\") ?? {};\n/** @type {Record<string, string>} */\nconst dictionary = browserResults.reduce((dict, result) => {\n  const nodeName = extractName(result);\n  return {\n    ...dict,\n    [result.nodeId]: nodeName,\n    [nodeName]: result.nodeId,\n  };\n}, existing);\nflow.set(\"$parent.calibration.dictionary\", dictionary);\nreturn;",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 100,
        "wires": []
    },
    {
        "id": "50822f49e8a1ce63",
        "type": "template",
        "z": "7173b966cb38f0e0",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{{payload.nodeId}}}: {{payload.nodeValue}} [{{payload.nodeName}}]",
        "output": "str",
        "x": 660,
        "y": 160,
        "wires": [
            [
                "030b08ea813bc11c"
            ]
        ]
    },
    {
        "id": "030b08ea813bc11c",
        "type": "delay",
        "z": "7173b966cb38f0e0",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 830,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "885b455dfed2ed93",
        "type": "function",
        "z": "7173b966cb38f0e0",
        "name": "setup-positions",
        "func": "const configuredAvailablePositions = env.get(\"AVAILABLE_POSITIONS\") ?? \"\";\nconst configuredCurrentPosition = env.get(\"CURRENT_POSITION\") ?? \"\";\n\n/** @type {Record<string, string>} */\nconst calibration = flow.get(\"$parent.calibration\") ?? {};\nflow.set(\"$parent.calibration\", calibration);\n\n/** @type {Record<string, string>} */\nconst positions = flow.get(\"$parent.calibration.positions\") ?? {};\nflow.set(\"$parent.calibration.positions\", positions);\n\nflow.set(\"$parent.calibration.positions.available\", configuredAvailablePositions);\nflow.set(\"$parent.calibration.positions.current\", configuredCurrentPosition);\n\nreturn;",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 60,
        "wires": []
    },
    {
        "id": "a065343fb9fd80f0",
        "type": "function",
        "z": "fb6b02d4d9963179",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = undefined;\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    state.errors = [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n    if (Array.isArray(msg.calibrationData)) {\n        state.information = msg.calibrationData;\n    }\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"FINISHED\", msg.actionMetadata);\nconst state = createState(actionState, msg.loads);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"green\", text: `${parentFlowName} / ${actionState.command ?? \"UNKNOWN\"}: ${actionState.state}`});\n\n// flow update\nflow.set(\"$parent.orderId\", \"0\");\nflow.set(\"$parent.orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "b9c02eadd51d2391",
        "type": "status",
        "z": "fb6b02d4d9963179",
        "name": "",
        "scope": null,
        "x": 200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "afdc0b0b98a75e61",
        "type": "catch",
        "z": "fb6b02d4d9963179",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "8b73931be8bece60"
            ]
        ]
    },
    {
        "id": "8b73931be8bece60",
        "type": "debug",
        "z": "fb6b02d4d9963179",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "f77653d3181ab432",
        "type": "function",
        "z": "07a7fc5bcd60a12a",
        "name": "vda_status_running instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"$parent.orderId\");\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    const flowErrors = flow.get(\"$parent.errors\");\n    state.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"RUNNING\", msg.actionMetadata);\nconst state = createState(actionState);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"yellow\", text: `${parentFlowName} / ${actionState.command}: ${actionState.state}`});\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "2490563da31e8fd4",
        "type": "status",
        "z": "07a7fc5bcd60a12a",
        "name": "",
        "scope": null,
        "x": 300,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "2f02d4a33ab1557a",
        "type": "catch",
        "z": "07a7fc5bcd60a12a",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 300,
        "y": 260,
        "wires": [
            [
                "2d9f81fdc288e7f7"
            ]
        ]
    },
    {
        "id": "2d9f81fdc288e7f7",
        "type": "debug",
        "z": "07a7fc5bcd60a12a",
        "name": "catch-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 470,
        "y": 260,
        "wires": []
    },
    {
        "id": "2eb17eba88eb7a2a",
        "type": "function",
        "z": "105d02aba31c4a1d",
        "name": "check-nodeValue-true",
        "func": "const nodeValue = msg.payload.value.value.value;\nif (!!nodeValue) {\n    return msg;\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "bfe7d55dce5e2b71",
        "type": "status",
        "z": "105d02aba31c4a1d",
        "name": "",
        "scope": null,
        "x": 180,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "ad7035210b2daa14",
        "type": "catch",
        "z": "105d02aba31c4a1d",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 180,
        "y": 220,
        "wires": [
            [
                "c8913195bd587863"
            ]
        ]
    },
    {
        "id": "c8913195bd587863",
        "type": "debug",
        "z": "105d02aba31c4a1d",
        "name": "catch-error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 350,
        "y": 220,
        "wires": []
    },
    {
        "id": "e439d1ef2174715f",
        "type": "function",
        "z": "468f2460ce66f11e",
        "name": "check-opcua-connection",
        "func": "/**\n * @typedef {object} Connection \n * @property {number} headerId\n * @property {string} timestamp\n * @property {string} version\n * @property {string} manufacturer\n * @property {string} serialNumber\n * @property {\"ONLINE\" | \"OFFLINE\" | \"CONNECTIONBROKEN\"} connectionState\n */\nconst MQTT_TOPIC_KEY = \"$parent.MQTT_topic\";\nconst CONNECTION_KEY = \"$parent.connection\";\nconst HEADER_ID_KEY = \"$parent.headerId\";\nconst INJECT_KEY = \"inject\";\nconst READ_KEY = \"read\";\nconst PREVIOUS_NODETYPE_KEY = \"PREVIOUS_NODETYPE\";\n\n/** @type {number} */\nconst headerId = flow.get(HEADER_ID_KEY);\n/** @type {Connection} */\nconst connection = flow.get(CONNECTION_KEY);\n/** @type {string} */\nconst previousNodetype = context.get(PREVIOUS_NODETYPE_KEY);\n/** @type {{ nodetype: string}} */\nconst { nodetype } = msg.payload;\n\nif (connection.serialNumber == \"serialNumber\") {\n    node.status({ fill: 'yellow', shape: 'dot', text: 'no initial read' });\n    // initial serialNumber read has not happened, discard message\n    return;\n}\n\nif (previousNodetype == null) {\n    // first message of message pair for checking received\n    context.set(PREVIOUS_NODETYPE_KEY, nodetype);\n    return;\n}\n\n// create new msg for connection state\nconst newMsg = { \n    topic: flow.get(MQTT_TOPIC_KEY) + \"/connection\",\n    payload: {\n        ...connection,\n        headerId,\n    }\n};\nif (previousNodetype == INJECT_KEY && nodetype == INJECT_KEY) {\n    // set connectionState to CONNECTIONBROKEN\n    newMsg.payload.connectionState = \"CONNECTIONBROKEN\";\n} else if (previousNodetype == INJECT_KEY && nodetype == READ_KEY) {\n    // set connectionState to CONNECTIONBROKEN\n    newMsg.payload.connectionState = \"ONLINE\";\n}\n// reset previousNodetype to null\ncontext.set(PREVIOUS_NODETYPE_KEY, null);\nnode.status({ fill: newMsg.payload.connectionState == 'ONLINE' ? 'green' : 'red', shape: 'dot', text: newMsg.payload.connectionState });\n\nflow.set(HEADER_ID_KEY, headerId + 1);\nflow.set(CONNECTION_KEY, newMsg.payload);\nreturn newMsg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "context.set(\"PREVIOUS_NODETYPE\", null);",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "055f3c065fbca3ef",
        "type": "catch",
        "z": "468f2460ce66f11e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 80,
        "y": 220,
        "wires": [
            [
                "384a4d17dbd91c90"
            ]
        ]
    },
    {
        "id": "d8c7f42fd8b72ff8",
        "type": "status",
        "z": "468f2460ce66f11e",
        "name": "",
        "scope": null,
        "x": 80,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "384a4d17dbd91c90",
        "type": "debug",
        "z": "468f2460ce66f11e",
        "name": "catch-error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 220,
        "wires": []
    },
    {
        "id": "4e80a2f5720dd67d",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "627a58c40ce2a73d",
        "type": "mqtt in",
        "z": "d86e8f9e7358411d",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "0fccb1b5b173e627",
                "14db09ae8f97eb8f"
            ]
        ]
    },
    {
        "id": "85041b18d6b7d9c3",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "627a58c40ce2a73d"
            ]
        ]
    },
    {
        "id": "1d8f39526bee0787",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "627a58c40ce2a73d"
            ]
        ]
    },
    {
        "id": "d6ca931e948c60f0",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6b1adb47955dfa19",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "85041b18d6b7d9c3",
                "1d8f39526bee0787",
                "951e697a692b147c",
                "ee33e3758a179e1b"
            ]
        ]
    },
    {
        "id": "951e697a692b147c",
        "type": "delay",
        "z": "d86e8f9e7358411d",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "d6ca931e948c60f0"
            ]
        ]
    },
    {
        "id": "ee33e3758a179e1b",
        "type": "delay",
        "z": "d86e8f9e7358411d",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "4e80a2f5720dd67d"
            ]
        ]
    },
    {
        "id": "0fccb1b5b173e627",
        "type": "switch",
        "z": "d86e8f9e7358411d",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "6e639d82e82ac13d",
                "ad7acc80d6286098"
            ],
            [
                "f62dcf7dfb06e5a3",
                "ad7acc80d6286098",
                "9a6c84a12d4a5f35"
            ]
        ]
    },
    {
        "id": "e5c6dd3d7d2bac39",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "a8d6fe768e50f59f",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "5c2a0b381fb03123"
            ],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2ff19e88ff331847",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "a8d6fe768e50f59f"
            ],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f62dcf7dfb06e5a3",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "2ff19e88ff331847"
            ]
        ]
    },
    {
        "id": "5c2a0b381fb03123",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "d306f526c3c254ab",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "c1a47c0f1561dd4c"
            ],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "6e639d82e82ac13d",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "d306f526c3c254ab"
            ]
        ]
    },
    {
        "id": "c1a47c0f1561dd4c",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "97a7535a24e44eaf"
            ],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "97a7535a24e44eaf",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "c60eb104ec307e8d"
            ],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "7627f392f659e98b",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "e5c6dd3d7d2bac39"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "c60eb104ec307e8d",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "7627f392f659e98b"
            ]
        ]
    },
    {
        "id": "1334333ded00c038",
        "type": "debug",
        "z": "d86e8f9e7358411d",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "ad7acc80d6286098",
        "type": "function",
        "z": "d86e8f9e7358411d",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "1334333ded00c038"
            ]
        ]
    },
    {
        "id": "05056df3c136c8c2",
        "type": "catch",
        "z": "d86e8f9e7358411d",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "99f4bbfa286e9d27"
            ]
        ]
    },
    {
        "id": "99f4bbfa286e9d27",
        "type": "debug",
        "z": "d86e8f9e7358411d",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "399d5d4a2b75c79a",
        "type": "status",
        "z": "d86e8f9e7358411d",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "14db09ae8f97eb8f",
        "type": "debug",
        "z": "d86e8f9e7358411d",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "9a6c84a12d4a5f35",
        "type": "debug",
        "z": "d86e8f9e7358411d",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "621c53f68219b83d",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "b498b0e8fd8d59ce",
        "type": "mqtt in",
        "z": "986b054aaf6007a7",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "88d47176d861bab2",
                "5eeee70e50961df3"
            ]
        ]
    },
    {
        "id": "9816024a2e15abc0",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "b498b0e8fd8d59ce"
            ]
        ]
    },
    {
        "id": "188ba8cd4794aac0",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "b498b0e8fd8d59ce"
            ]
        ]
    },
    {
        "id": "7cedca42200365ca",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "a8eab7014ae73972",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "9816024a2e15abc0",
                "188ba8cd4794aac0",
                "7a123cafb18ce5f9",
                "902e10f317f9da9d"
            ]
        ]
    },
    {
        "id": "7a123cafb18ce5f9",
        "type": "delay",
        "z": "986b054aaf6007a7",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "7cedca42200365ca"
            ]
        ]
    },
    {
        "id": "902e10f317f9da9d",
        "type": "delay",
        "z": "986b054aaf6007a7",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "621c53f68219b83d"
            ]
        ]
    },
    {
        "id": "88d47176d861bab2",
        "type": "switch",
        "z": "986b054aaf6007a7",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "c0d1419c5629361e",
                "b7c864be43c3bd7d"
            ],
            [
                "3ecc275050933880",
                "b7c864be43c3bd7d",
                "4a1d454f83d7ab32"
            ]
        ]
    },
    {
        "id": "b5111d09739c6634",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "149e0fbcf62f2057",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "5d6adc0772166eda"
            ],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d59b4d8e3b046f30",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "149e0fbcf62f2057"
            ],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "3ecc275050933880",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "d59b4d8e3b046f30"
            ]
        ]
    },
    {
        "id": "5d6adc0772166eda",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "8fa2d49a488af022",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "c7c4f693a3b1af20"
            ],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c0d1419c5629361e",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "8fa2d49a488af022"
            ]
        ]
    },
    {
        "id": "c7c4f693a3b1af20",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "ec077d02d8b96607"
            ],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "ec077d02d8b96607",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "257f1a522181e5e5"
            ],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "045d68bba0243095",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "b5111d09739c6634"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "257f1a522181e5e5",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "045d68bba0243095"
            ]
        ]
    },
    {
        "id": "97ac8c870b0fa429",
        "type": "debug",
        "z": "986b054aaf6007a7",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "b7c864be43c3bd7d",
        "type": "function",
        "z": "986b054aaf6007a7",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "97ac8c870b0fa429"
            ]
        ]
    },
    {
        "id": "9ee4f8bce1932003",
        "type": "catch",
        "z": "986b054aaf6007a7",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "c0c149e0caf1e0a2"
            ]
        ]
    },
    {
        "id": "c0c149e0caf1e0a2",
        "type": "debug",
        "z": "986b054aaf6007a7",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "62a5b49d4e6e6fdf",
        "type": "status",
        "z": "986b054aaf6007a7",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "5eeee70e50961df3",
        "type": "debug",
        "z": "986b054aaf6007a7",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "4a1d454f83d7ab32",
        "type": "debug",
        "z": "986b054aaf6007a7",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "86b62247ea5ccccc",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "bcc39ca4ba3dc65a",
        "type": "mqtt in",
        "z": "c3f24fefbef21f97",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "19079696a02a5d9e",
                "179c150255792570"
            ]
        ]
    },
    {
        "id": "fc49e05d8edc8d3f",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "bcc39ca4ba3dc65a"
            ]
        ]
    },
    {
        "id": "883f04a84a790e11",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "bcc39ca4ba3dc65a"
            ]
        ]
    },
    {
        "id": "6ea220e7e7c1a836",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1a8a1f4cf0866e23",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "fc49e05d8edc8d3f",
                "883f04a84a790e11",
                "0d6651ec4b6520f9",
                "00ab3c29c986dc31"
            ]
        ]
    },
    {
        "id": "0d6651ec4b6520f9",
        "type": "delay",
        "z": "c3f24fefbef21f97",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "6ea220e7e7c1a836"
            ]
        ]
    },
    {
        "id": "00ab3c29c986dc31",
        "type": "delay",
        "z": "c3f24fefbef21f97",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "86b62247ea5ccccc"
            ]
        ]
    },
    {
        "id": "19079696a02a5d9e",
        "type": "switch",
        "z": "c3f24fefbef21f97",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "18601b5c28b6cb35",
                "7222f0c3f32c12a7"
            ],
            [
                "ff01acc8f506f74f",
                "7222f0c3f32c12a7",
                "a252db841abac4ce"
            ]
        ]
    },
    {
        "id": "e2b0499499c24c93",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "d84a64016704634f",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "955189e21fc05e33"
            ],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "292d5d813cfe73ba",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "d84a64016704634f"
            ],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "ff01acc8f506f74f",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "292d5d813cfe73ba"
            ]
        ]
    },
    {
        "id": "955189e21fc05e33",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "d8501444c0b6a2dc",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "75f7439a655a38ce"
            ],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "18601b5c28b6cb35",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "d8501444c0b6a2dc"
            ]
        ]
    },
    {
        "id": "75f7439a655a38ce",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "a4f4cf06df8b17a3"
            ],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a4f4cf06df8b17a3",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "18fe8dd1dd236901"
            ],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "839c39b4b59c222a",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "e2b0499499c24c93"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "18fe8dd1dd236901",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "839c39b4b59c222a"
            ]
        ]
    },
    {
        "id": "8e2703d111a98f15",
        "type": "debug",
        "z": "c3f24fefbef21f97",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "7222f0c3f32c12a7",
        "type": "function",
        "z": "c3f24fefbef21f97",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "8e2703d111a98f15"
            ]
        ]
    },
    {
        "id": "2dc76f671050c4f6",
        "type": "catch",
        "z": "c3f24fefbef21f97",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "1bde327cb6161959"
            ]
        ]
    },
    {
        "id": "1bde327cb6161959",
        "type": "debug",
        "z": "c3f24fefbef21f97",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "dd2e1e84c851cc54",
        "type": "status",
        "z": "c3f24fefbef21f97",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "179c150255792570",
        "type": "debug",
        "z": "c3f24fefbef21f97",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "a252db841abac4ce",
        "type": "debug",
        "z": "c3f24fefbef21f97",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "059f00d9f9520a33",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d2b26e3ee1f6592a",
        "type": "mqtt in",
        "z": "1ff920852c2c4442",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "be5f0b0e1ef0aea3",
                "9b048cf6ebc73359"
            ]
        ]
    },
    {
        "id": "40610a904a8b01cb",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "d2b26e3ee1f6592a"
            ]
        ]
    },
    {
        "id": "066cfc338af63346",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "d2b26e3ee1f6592a"
            ]
        ]
    },
    {
        "id": "503909a7518f0605",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "3581ead0f0c78fa9",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "40610a904a8b01cb",
                "066cfc338af63346",
                "605cc1669f7f8131",
                "86a85bf24b24af6c"
            ]
        ]
    },
    {
        "id": "605cc1669f7f8131",
        "type": "delay",
        "z": "1ff920852c2c4442",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "503909a7518f0605"
            ]
        ]
    },
    {
        "id": "86a85bf24b24af6c",
        "type": "delay",
        "z": "1ff920852c2c4442",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "059f00d9f9520a33"
            ]
        ]
    },
    {
        "id": "be5f0b0e1ef0aea3",
        "type": "switch",
        "z": "1ff920852c2c4442",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "792b3cba29a5aa6c",
                "9a9fb713c65c530c"
            ],
            [
                "057b50d6b4a54206",
                "9a9fb713c65c530c",
                "fa8b59f66ce3e3f1"
            ]
        ]
    },
    {
        "id": "577ffc9e35e218bb",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "a77b659370aab3dd",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "96504ba6fcd53ead"
            ],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "bcf105881bf1c991",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "a77b659370aab3dd"
            ],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "057b50d6b4a54206",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "bcf105881bf1c991"
            ]
        ]
    },
    {
        "id": "96504ba6fcd53ead",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "69616fab90d77eba",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "860fe25baa5034aa"
            ],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "792b3cba29a5aa6c",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "69616fab90d77eba"
            ]
        ]
    },
    {
        "id": "860fe25baa5034aa",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "9339cc1659edbd59"
            ],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "9339cc1659edbd59",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "37ee0ec11d89b8c8"
            ],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "caec311c0818f3db",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "577ffc9e35e218bb"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "37ee0ec11d89b8c8",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "caec311c0818f3db"
            ]
        ]
    },
    {
        "id": "e02d5b1b0914e7b4",
        "type": "debug",
        "z": "1ff920852c2c4442",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "9a9fb713c65c530c",
        "type": "function",
        "z": "1ff920852c2c4442",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "e02d5b1b0914e7b4"
            ]
        ]
    },
    {
        "id": "7db437875f6b597a",
        "type": "catch",
        "z": "1ff920852c2c4442",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "4a799c6ebb5f281b"
            ]
        ]
    },
    {
        "id": "4a799c6ebb5f281b",
        "type": "debug",
        "z": "1ff920852c2c4442",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "6b84d95b463182e6",
        "type": "status",
        "z": "1ff920852c2c4442",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "9b048cf6ebc73359",
        "type": "debug",
        "z": "1ff920852c2c4442",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "fa8b59f66ce3e3f1",
        "type": "debug",
        "z": "1ff920852c2c4442",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "5c22f7b8a1637a11",
        "type": "function",
        "z": "b16337867a692514",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d53c7f2ed562acce",
        "type": "mqtt in",
        "z": "b16337867a692514",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "65bc2ef3a1137285",
                "b9a5a1f72476153a"
            ]
        ]
    },
    {
        "id": "632293e3a25307ec",
        "type": "function",
        "z": "b16337867a692514",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "d53c7f2ed562acce"
            ]
        ]
    },
    {
        "id": "d06338b2339c7ebe",
        "type": "function",
        "z": "b16337867a692514",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "d53c7f2ed562acce"
            ]
        ]
    },
    {
        "id": "396bacc16b872545",
        "type": "function",
        "z": "b16337867a692514",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "a871cf6694831b8a",
        "type": "function",
        "z": "b16337867a692514",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "632293e3a25307ec",
                "d06338b2339c7ebe",
                "85cf9e064adc91bf",
                "e9c706f812e53a9f"
            ]
        ]
    },
    {
        "id": "85cf9e064adc91bf",
        "type": "delay",
        "z": "b16337867a692514",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "396bacc16b872545"
            ]
        ]
    },
    {
        "id": "e9c706f812e53a9f",
        "type": "delay",
        "z": "b16337867a692514",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "5c22f7b8a1637a11"
            ]
        ]
    },
    {
        "id": "65bc2ef3a1137285",
        "type": "switch",
        "z": "b16337867a692514",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "8d4adc1174802cc7",
                "93c2dbcebde9d6b2"
            ],
            [
                "0f12c2a785142daf",
                "93c2dbcebde9d6b2",
                "080f4b5a9181972f"
            ]
        ]
    },
    {
        "id": "89c672a6cd75206a",
        "type": "function",
        "z": "b16337867a692514",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "726e7a6d9d663846",
        "type": "function",
        "z": "b16337867a692514",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "175d8abf79729351"
            ],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f64aa3a668030381",
        "type": "function",
        "z": "b16337867a692514",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "726e7a6d9d663846"
            ],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "0f12c2a785142daf",
        "type": "function",
        "z": "b16337867a692514",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "f64aa3a668030381"
            ]
        ]
    },
    {
        "id": "175d8abf79729351",
        "type": "function",
        "z": "b16337867a692514",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "585c8694ac1cd78b",
        "type": "function",
        "z": "b16337867a692514",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "c8edc5876583ef62"
            ],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "8d4adc1174802cc7",
        "type": "function",
        "z": "b16337867a692514",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "585c8694ac1cd78b"
            ]
        ]
    },
    {
        "id": "c8edc5876583ef62",
        "type": "function",
        "z": "b16337867a692514",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "621c46dd9955eb8d"
            ],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "621c46dd9955eb8d",
        "type": "function",
        "z": "b16337867a692514",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "e170908804e1b660"
            ],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "50d4de46b9960306",
        "type": "function",
        "z": "b16337867a692514",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "89c672a6cd75206a"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "e170908804e1b660",
        "type": "function",
        "z": "b16337867a692514",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "50d4de46b9960306"
            ]
        ]
    },
    {
        "id": "81cdc49162d4db88",
        "type": "debug",
        "z": "b16337867a692514",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "93c2dbcebde9d6b2",
        "type": "function",
        "z": "b16337867a692514",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "81cdc49162d4db88"
            ]
        ]
    },
    {
        "id": "68a64a0105b37c82",
        "type": "catch",
        "z": "b16337867a692514",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "c4451a21095b0141"
            ]
        ]
    },
    {
        "id": "c4451a21095b0141",
        "type": "debug",
        "z": "b16337867a692514",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "55e8d8e5d3322817",
        "type": "status",
        "z": "b16337867a692514",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "b9a5a1f72476153a",
        "type": "debug",
        "z": "b16337867a692514",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "080f4b5a9181972f",
        "type": "debug",
        "z": "b16337867a692514",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "9bcc993d806dc415",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "4cee167e99445a7d",
        "type": "mqtt in",
        "z": "366624545bcd46b3",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "cf95fcd72ddbc673",
                "a9d4933a74f7eb48"
            ]
        ]
    },
    {
        "id": "5880dbf65aff9ee5",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "4cee167e99445a7d"
            ]
        ]
    },
    {
        "id": "34ae8a36ff15bbdc",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "4cee167e99445a7d"
            ]
        ]
    },
    {
        "id": "8e9a90fb23729ef8",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "78ba141e36588695",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "5880dbf65aff9ee5",
                "34ae8a36ff15bbdc",
                "ca477bbe935bb370",
                "4795a612b00a77c1"
            ]
        ]
    },
    {
        "id": "ca477bbe935bb370",
        "type": "delay",
        "z": "366624545bcd46b3",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "8e9a90fb23729ef8"
            ]
        ]
    },
    {
        "id": "4795a612b00a77c1",
        "type": "delay",
        "z": "366624545bcd46b3",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "9bcc993d806dc415"
            ]
        ]
    },
    {
        "id": "cf95fcd72ddbc673",
        "type": "switch",
        "z": "366624545bcd46b3",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "a36f328b5a0843b0",
                "298e4e5ee73be49d"
            ],
            [
                "86de5634c84651f4",
                "298e4e5ee73be49d",
                "3c7dff366c0f94d0"
            ]
        ]
    },
    {
        "id": "a262f2dbcc051402",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "e81b22c2a8b51de9",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "c85adb0623a6f4a5"
            ],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "224eb020590c51a3",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "e81b22c2a8b51de9"
            ],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "86de5634c84651f4",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "224eb020590c51a3"
            ]
        ]
    },
    {
        "id": "c85adb0623a6f4a5",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "9f8363a76795d845",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "85aaac808cf30839"
            ],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a36f328b5a0843b0",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "9f8363a76795d845"
            ]
        ]
    },
    {
        "id": "85aaac808cf30839",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "1427ad31ceb2542b"
            ],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1427ad31ceb2542b",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "4a19717469e7b425"
            ],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "39b506b93a26554d",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "a262f2dbcc051402"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "4a19717469e7b425",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "39b506b93a26554d"
            ]
        ]
    },
    {
        "id": "514a765b63eeaebe",
        "type": "debug",
        "z": "366624545bcd46b3",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "298e4e5ee73be49d",
        "type": "function",
        "z": "366624545bcd46b3",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "514a765b63eeaebe"
            ]
        ]
    },
    {
        "id": "28383767e37d92c9",
        "type": "catch",
        "z": "366624545bcd46b3",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "3e43e33a37579782"
            ]
        ]
    },
    {
        "id": "3e43e33a37579782",
        "type": "debug",
        "z": "366624545bcd46b3",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "fa77f184a4e19353",
        "type": "status",
        "z": "366624545bcd46b3",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "a9d4933a74f7eb48",
        "type": "debug",
        "z": "366624545bcd46b3",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "3c7dff366c0f94d0",
        "type": "debug",
        "z": "366624545bcd46b3",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "77d39716693e6870",
        "type": "function",
        "z": "fbc0621029d72e19",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = undefined;\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    state.errors = [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n    if (Array.isArray(msg.calibrationData)) {\n        state.information = msg.calibrationData;\n    }\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"FINISHED\", msg.actionMetadata);\nconst state = createState(actionState, msg.loads);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"green\", text: `${parentFlowName} / ${actionState.command ?? \"UNKNOWN\"}: ${actionState.state}`});\n\n// flow update\nflow.set(\"$parent.orderId\", \"0\");\nflow.set(\"$parent.orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "fd628a0e7ede4ea9",
        "type": "status",
        "z": "fbc0621029d72e19",
        "name": "",
        "scope": null,
        "x": 200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "e86be3c334f6dca6",
        "type": "catch",
        "z": "fbc0621029d72e19",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "f22548737215fd12"
            ]
        ]
    },
    {
        "id": "f22548737215fd12",
        "type": "debug",
        "z": "fbc0621029d72e19",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "a2b951bc75496b68",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d0799013543cbc03",
        "type": "mqtt in",
        "z": "473f5011528a6e13",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "ea4cb7eb683af74f",
                "d2d675582e641658"
            ]
        ]
    },
    {
        "id": "75dd9ab44325090f",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "d0799013543cbc03"
            ]
        ]
    },
    {
        "id": "1e5923d478965a64",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "d0799013543cbc03"
            ]
        ]
    },
    {
        "id": "e6ce7470184867a1",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "b3d74b8fa7544111",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "75dd9ab44325090f",
                "1e5923d478965a64",
                "084769e212139670",
                "875e86e43c26d32f"
            ]
        ]
    },
    {
        "id": "084769e212139670",
        "type": "delay",
        "z": "473f5011528a6e13",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "e6ce7470184867a1"
            ]
        ]
    },
    {
        "id": "875e86e43c26d32f",
        "type": "delay",
        "z": "473f5011528a6e13",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "a2b951bc75496b68"
            ]
        ]
    },
    {
        "id": "ea4cb7eb683af74f",
        "type": "switch",
        "z": "473f5011528a6e13",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "63d1f83e8d60b60a",
                "33ad96b98f4885c7"
            ],
            [
                "95c41fbaa9fd8d8e",
                "33ad96b98f4885c7",
                "bce12cf49da07386"
            ]
        ]
    },
    {
        "id": "9d40caf2ca4e76c0",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "7ce6c4b4d1da51c9",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "9c4cc2b7b76d6692"
            ],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f5fae0e18160c27d",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "7ce6c4b4d1da51c9"
            ],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "95c41fbaa9fd8d8e",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "f5fae0e18160c27d"
            ]
        ]
    },
    {
        "id": "9c4cc2b7b76d6692",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "ec272a7451039896",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "0b97d90ed4d20732"
            ],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "63d1f83e8d60b60a",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "ec272a7451039896"
            ]
        ]
    },
    {
        "id": "0b97d90ed4d20732",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "80f11dcbdae2395d"
            ],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "80f11dcbdae2395d",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "96201ad58449c1e9"
            ],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a457078ddb83f6ab",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "9d40caf2ca4e76c0"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "96201ad58449c1e9",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "a457078ddb83f6ab"
            ]
        ]
    },
    {
        "id": "ba3a23f337d3c0a5",
        "type": "debug",
        "z": "473f5011528a6e13",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "33ad96b98f4885c7",
        "type": "function",
        "z": "473f5011528a6e13",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "ba3a23f337d3c0a5"
            ]
        ]
    },
    {
        "id": "41f8952cf6934183",
        "type": "catch",
        "z": "473f5011528a6e13",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "abfefa9725ddaf01"
            ]
        ]
    },
    {
        "id": "abfefa9725ddaf01",
        "type": "debug",
        "z": "473f5011528a6e13",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "9c563315f6c5dbb6",
        "type": "status",
        "z": "473f5011528a6e13",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "d2d675582e641658",
        "type": "debug",
        "z": "473f5011528a6e13",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "bce12cf49da07386",
        "type": "debug",
        "z": "473f5011528a6e13",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "613d75f1c4d05abd",
        "type": "function",
        "z": "3dfc453382178c7d",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = undefined;\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    state.errors = [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n    if (Array.isArray(msg.calibrationData)) {\n        state.information = msg.calibrationData;\n    }\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"FINISHED\", msg.actionMetadata);\nconst state = createState(actionState, msg.loads);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"green\", text: `${parentFlowName} / ${actionState.command ?? \"UNKNOWN\"}: ${actionState.state}`});\n\n// flow update\nflow.set(\"$parent.orderId\", \"0\");\nflow.set(\"$parent.orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "e154682e60317603",
        "type": "status",
        "z": "3dfc453382178c7d",
        "name": "",
        "scope": null,
        "x": 200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "3d9f8e6271131bf2",
        "type": "catch",
        "z": "3dfc453382178c7d",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "71c4c5b72298fd75"
            ]
        ]
    },
    {
        "id": "71c4c5b72298fd75",
        "type": "debug",
        "z": "3dfc453382178c7d",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "d2dfda05af4d11e3",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "05a022cb72bfead2",
        "type": "mqtt in",
        "z": "ac86906fc2073a6f",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "300703bcc31dbd2c",
                "e87743f8873407f0"
            ]
        ]
    },
    {
        "id": "3b576b1395f83cca",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "05a022cb72bfead2"
            ]
        ]
    },
    {
        "id": "d98f9dc75943ad4d",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "05a022cb72bfead2"
            ]
        ]
    },
    {
        "id": "8a534ef816e3aaf1",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "d7641e4226cbbdf9",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "3b576b1395f83cca",
                "d98f9dc75943ad4d",
                "dfbc3119856ced36",
                "6efba5b63d73fe93"
            ]
        ]
    },
    {
        "id": "dfbc3119856ced36",
        "type": "delay",
        "z": "ac86906fc2073a6f",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "8a534ef816e3aaf1"
            ]
        ]
    },
    {
        "id": "6efba5b63d73fe93",
        "type": "delay",
        "z": "ac86906fc2073a6f",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "d2dfda05af4d11e3"
            ]
        ]
    },
    {
        "id": "300703bcc31dbd2c",
        "type": "switch",
        "z": "ac86906fc2073a6f",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "922d9dd4e0e16f3c",
                "cebd0fd9b783ab11"
            ],
            [
                "b6ff87ddcf835a41",
                "cebd0fd9b783ab11",
                "a4a58c256421b818"
            ]
        ]
    },
    {
        "id": "a91d577df08694a5",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "8657531352f1486c",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "98a94cdf5523ebb0"
            ],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "953bb5d6be76d828",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "8657531352f1486c"
            ],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "b6ff87ddcf835a41",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "953bb5d6be76d828"
            ]
        ]
    },
    {
        "id": "98a94cdf5523ebb0",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "40728601d195b735",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "7504784898be2df7"
            ],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "922d9dd4e0e16f3c",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "40728601d195b735"
            ]
        ]
    },
    {
        "id": "7504784898be2df7",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "f2473b2042712e5c"
            ],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f2473b2042712e5c",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "3467f6e4fc358c6d"
            ],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f7f9faf920c0ab73",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "a91d577df08694a5"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "3467f6e4fc358c6d",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "f7f9faf920c0ab73"
            ]
        ]
    },
    {
        "id": "a770cade8731de9d",
        "type": "debug",
        "z": "ac86906fc2073a6f",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "cebd0fd9b783ab11",
        "type": "function",
        "z": "ac86906fc2073a6f",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "a770cade8731de9d"
            ]
        ]
    },
    {
        "id": "9a9573d22018aa9e",
        "type": "catch",
        "z": "ac86906fc2073a6f",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "119523d92b20d7e4"
            ]
        ]
    },
    {
        "id": "119523d92b20d7e4",
        "type": "debug",
        "z": "ac86906fc2073a6f",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "fe5cffc8a4a89fb9",
        "type": "status",
        "z": "ac86906fc2073a6f",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "e87743f8873407f0",
        "type": "debug",
        "z": "ac86906fc2073a6f",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "a4a58c256421b818",
        "type": "debug",
        "z": "ac86906fc2073a6f",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "01e483f7e5e8f4ea",
        "type": "function",
        "z": "67a9482494b7bade",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = undefined;\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    state.errors = [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n    if (Array.isArray(msg.calibrationData)) {\n        state.information = msg.calibrationData;\n    }\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"FINISHED\", msg.actionMetadata);\nconst state = createState(actionState, msg.loads);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"green\", text: `${parentFlowName} / ${actionState.command ?? \"UNKNOWN\"}: ${actionState.state}`});\n\n// flow update\nflow.set(\"$parent.orderId\", \"0\");\nflow.set(\"$parent.orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "24845102a736866e",
        "type": "status",
        "z": "67a9482494b7bade",
        "name": "",
        "scope": null,
        "x": 200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "3fceafd78cd9db10",
        "type": "catch",
        "z": "67a9482494b7bade",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "346d50a7a9dce2a7"
            ]
        ]
    },
    {
        "id": "346d50a7a9dce2a7",
        "type": "debug",
        "z": "67a9482494b7bade",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "e3378ee54e4dcd68",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "a7bfbde66760e669",
        "type": "mqtt in",
        "z": "f3a1307d7c660cff",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "02cc9b611db5107a",
                "ed3d158b4e604df8"
            ]
        ]
    },
    {
        "id": "2962656855969904",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "a7bfbde66760e669"
            ]
        ]
    },
    {
        "id": "024aa5508fc7109c",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "a7bfbde66760e669"
            ]
        ]
    },
    {
        "id": "ece69ba36aebadce",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "55b50e2b90252fd9",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "2962656855969904",
                "024aa5508fc7109c",
                "484a1e2b2e6dfdde",
                "2358234aa204b824"
            ]
        ]
    },
    {
        "id": "484a1e2b2e6dfdde",
        "type": "delay",
        "z": "f3a1307d7c660cff",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "ece69ba36aebadce"
            ]
        ]
    },
    {
        "id": "2358234aa204b824",
        "type": "delay",
        "z": "f3a1307d7c660cff",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "e3378ee54e4dcd68"
            ]
        ]
    },
    {
        "id": "02cc9b611db5107a",
        "type": "switch",
        "z": "f3a1307d7c660cff",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "615afc8071d8dab4",
                "3cffb4cb2b5bc209"
            ],
            [
                "c65d9033ec987db0",
                "3cffb4cb2b5bc209",
                "d8cb6d9600ee2322"
            ]
        ]
    },
    {
        "id": "8246808a2fe44ad7",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "af9d7f247ceef750",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "096561d33a85ba4a"
            ],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "0ea63d48bdeb2a32",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "af9d7f247ceef750"
            ],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c65d9033ec987db0",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "0ea63d48bdeb2a32"
            ]
        ]
    },
    {
        "id": "096561d33a85ba4a",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "5557b448d438817d",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "bb6d097890a1cf35"
            ],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "615afc8071d8dab4",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "5557b448d438817d"
            ]
        ]
    },
    {
        "id": "bb6d097890a1cf35",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "a01691310960e0ca"
            ],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a01691310960e0ca",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "3a5b2ce8a848eea4"
            ],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2c3e6f0d7c5909c1",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "8246808a2fe44ad7"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "3a5b2ce8a848eea4",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "2c3e6f0d7c5909c1"
            ]
        ]
    },
    {
        "id": "76962ed23e741578",
        "type": "debug",
        "z": "f3a1307d7c660cff",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "3cffb4cb2b5bc209",
        "type": "function",
        "z": "f3a1307d7c660cff",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "76962ed23e741578"
            ]
        ]
    },
    {
        "id": "572ffa36b6ebe792",
        "type": "catch",
        "z": "f3a1307d7c660cff",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "f5a42a6c675e2d39"
            ]
        ]
    },
    {
        "id": "f5a42a6c675e2d39",
        "type": "debug",
        "z": "f3a1307d7c660cff",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "dc94cb070be9034d",
        "type": "status",
        "z": "f3a1307d7c660cff",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "ed3d158b4e604df8",
        "type": "debug",
        "z": "f3a1307d7c660cff",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "d8cb6d9600ee2322",
        "type": "debug",
        "z": "f3a1307d7c660cff",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "f95e26328b6cb0fe",
        "type": "function",
        "z": "76fb0696f941be3b",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} Load\n * @property {string} type\n * @property {string} [workpieceId]\n * \n * @typedef {object} Workpiece\n * @property {string} workpieceId\n * \n * @typedef {object} Metadata\n * @property {string} [type]\n * @property {string} [workpieceId]\n * @property {Workpiece} [workpiece]\n * \n * @typedef {object} Action\n * @property {string} id\n * @property {string} command\n * @property {string} [state]\n * @property {any} [result] \n * @property {Metadata} metadata\n */\n\n/**\n * @param {string} type\n * @param {string} workpieceId\n * @returns {Load}\n */\nfunction createLoad(type, workpieceId) {\n    return {\n        type,\n        workpieceId,\n    };\n}\n\n/**\n * @param {Action} actionState\n * @param {Load[] | undefined} loads\n */\nfunction createState(actionState, loads = undefined) {\n    /** @type {object} */\n    const state = flow.get(\"$parent.state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"$parent.headerId\");\n\n    state.headerId = headerId;\n    state.loads = loads ?? state.loads ?? [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = undefined;\n    state.orderUpdateId = flow.get(\"$parent.orderUpdateId\");\n    state.errors = [];\n    state.paused = msg.modulePaused ?? state.paused;\n    state.operatingMode = msg.operatingMode ?? state.operatingMode;\n    if (Array.isArray(msg.calibrationData)) {\n        state.information = msg.calibrationData;\n    }\n\n    // headerId Update\n    flow.set(\"$parent.headerId\", headerId + 1);\n    flow.set(\"$parent.state\", state);\n    flow.set(\"$parent.loads\", loads ?? state.loads);\n    return state;\n}\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"$parent.actionState\") ?? {};\n    actionState.id = msg.actionId ?? actionState.id;\n    actionState.state = state;\n    actionState.command = msg.actionCommand ?? actionState.command;\n    actionState.metadata = metadata ?? actionState.metadata ?? {};\n    flow.set(\"$parent.actionState\", actionState);\n    return actionState;\n}\n\n// state bauen\nconst actionState = updateActionState(\"FINISHED\", msg.actionMetadata);\nconst state = createState(actionState, msg.loads);\n\n/** @type {string} */\nconst parentFlowName = flow.get(\"$parent.flowName\");\nnode.status({ shape: \"dot\", fill: \"green\", text: `${parentFlowName} / ${actionState.command ?? \"UNKNOWN\"}: ${actionState.state}`});\n\n// flow update\nflow.set(\"$parent.orderId\", \"0\");\nflow.set(\"$parent.orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f973ca5ebed6990e",
        "type": "status",
        "z": "76fb0696f941be3b",
        "name": "",
        "scope": null,
        "x": 200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "94b9e2d920fbdddf",
        "type": "catch",
        "z": "76fb0696f941be3b",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "93f791e8f22ba2e5"
            ]
        ]
    },
    {
        "id": "93f791e8f22ba2e5",
        "type": "debug",
        "z": "76fb0696f941be3b",
        "name": "catch-all-errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "a7c88da5f416ef3b",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "501b821cc19d9dcf",
        "type": "mqtt in",
        "z": "fe6c5275f1fb180e",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "25a0172d90eccb6a",
                "4f2053e58b651cbd"
            ]
        ]
    },
    {
        "id": "29f1a44221647058",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "501b821cc19d9dcf"
            ]
        ]
    },
    {
        "id": "569f5db89633f52f",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "501b821cc19d9dcf"
            ]
        ]
    },
    {
        "id": "216ff15b615f2346",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "dfdb31ca2469b5a9",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "29f1a44221647058",
                "569f5db89633f52f",
                "5f91664c8fafe2c4",
                "b324bbe8db4d1282"
            ]
        ]
    },
    {
        "id": "5f91664c8fafe2c4",
        "type": "delay",
        "z": "fe6c5275f1fb180e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "216ff15b615f2346"
            ]
        ]
    },
    {
        "id": "b324bbe8db4d1282",
        "type": "delay",
        "z": "fe6c5275f1fb180e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "a7c88da5f416ef3b"
            ]
        ]
    },
    {
        "id": "25a0172d90eccb6a",
        "type": "switch",
        "z": "fe6c5275f1fb180e",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "c283034ca149dc53",
                "2dde18d5bd4c43d4"
            ],
            [
                "1d6b5c158ee435fa",
                "2dde18d5bd4c43d4",
                "34cf0e5a316ab90f"
            ]
        ]
    },
    {
        "id": "4ee1669c7586347d",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "4a1641399f196d2b",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "4b4550040c06fd91"
            ],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2220ef1628b7b60a",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "4a1641399f196d2b"
            ],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1d6b5c158ee435fa",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "2220ef1628b7b60a"
            ]
        ]
    },
    {
        "id": "4b4550040c06fd91",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "86b61a3c88f89b4b",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "9d6721e96f488798"
            ],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c283034ca149dc53",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "86b61a3c88f89b4b"
            ]
        ]
    },
    {
        "id": "9d6721e96f488798",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "629431dee34669b0"
            ],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "629431dee34669b0",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "c0285636729b1e68"
            ],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1e8016f06fcbf24e",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "4ee1669c7586347d"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "c0285636729b1e68",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "1e8016f06fcbf24e"
            ]
        ]
    },
    {
        "id": "6eb753e294b1cf2d",
        "type": "debug",
        "z": "fe6c5275f1fb180e",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "2dde18d5bd4c43d4",
        "type": "function",
        "z": "fe6c5275f1fb180e",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "6eb753e294b1cf2d"
            ]
        ]
    },
    {
        "id": "c1039bbf6ca5af02",
        "type": "catch",
        "z": "fe6c5275f1fb180e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "8aafa0fa24cf9d81"
            ]
        ]
    },
    {
        "id": "8aafa0fa24cf9d81",
        "type": "debug",
        "z": "fe6c5275f1fb180e",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "a833e4c6ea322026",
        "type": "status",
        "z": "fe6c5275f1fb180e",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "4f2053e58b651cbd",
        "type": "debug",
        "z": "fe6c5275f1fb180e",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "34cf0e5a316ab90f",
        "type": "debug",
        "z": "fe6c5275f1fb180e",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "3813f66664d6f583",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "323d97c74233b037",
        "type": "mqtt in",
        "z": "6623726ed7b3b603",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "76418f8f0da57282",
                "95a895aa2798587d"
            ]
        ]
    },
    {
        "id": "03f532cfb91308b5",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "323d97c74233b037"
            ]
        ]
    },
    {
        "id": "accc88dda889c4ab",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "323d97c74233b037"
            ]
        ]
    },
    {
        "id": "fc1a4b7cd23261cc",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "a08fd93b5321fac7",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "03f532cfb91308b5",
                "accc88dda889c4ab",
                "0426f458e464b567",
                "7e5172cb01dbc177"
            ]
        ]
    },
    {
        "id": "0426f458e464b567",
        "type": "delay",
        "z": "6623726ed7b3b603",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "fc1a4b7cd23261cc"
            ]
        ]
    },
    {
        "id": "7e5172cb01dbc177",
        "type": "delay",
        "z": "6623726ed7b3b603",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "3813f66664d6f583"
            ]
        ]
    },
    {
        "id": "76418f8f0da57282",
        "type": "switch",
        "z": "6623726ed7b3b603",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "cad6abd0427b4db1",
                "6c47f20019ae55ed"
            ],
            [
                "a15c98b9e498d9a1",
                "6c47f20019ae55ed",
                "669ec9aec40dacc3"
            ]
        ]
    },
    {
        "id": "f6878e30e98dbf96",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "4cff27f50424a547",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "0d1988c61a3ba902"
            ],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "6c79e1ed03a43b39",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "4cff27f50424a547"
            ],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a15c98b9e498d9a1",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "6c79e1ed03a43b39"
            ]
        ]
    },
    {
        "id": "0d1988c61a3ba902",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "ed8fcf31642f26e1",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "1110a76ec895f9b5"
            ],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "cad6abd0427b4db1",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "ed8fcf31642f26e1"
            ]
        ]
    },
    {
        "id": "1110a76ec895f9b5",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "913ec6e251441431"
            ],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "913ec6e251441431",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "26c51541f2903080"
            ],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "16b4e3b65b47a427",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "f6878e30e98dbf96"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "26c51541f2903080",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "16b4e3b65b47a427"
            ]
        ]
    },
    {
        "id": "0107a25807247bd1",
        "type": "debug",
        "z": "6623726ed7b3b603",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "6c47f20019ae55ed",
        "type": "function",
        "z": "6623726ed7b3b603",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "0107a25807247bd1"
            ]
        ]
    },
    {
        "id": "0acf37459dee10ee",
        "type": "catch",
        "z": "6623726ed7b3b603",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "87703171e67fba8d"
            ]
        ]
    },
    {
        "id": "87703171e67fba8d",
        "type": "debug",
        "z": "6623726ed7b3b603",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "ced7f54cfa75f29c",
        "type": "status",
        "z": "6623726ed7b3b603",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "95a895aa2798587d",
        "type": "debug",
        "z": "6623726ed7b3b603",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "669ec9aec40dacc3",
        "type": "debug",
        "z": "6623726ed7b3b603",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "5462c2b6bda9ad00",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "f2dbc74846310747",
        "type": "mqtt in",
        "z": "6848ea4e725143d4",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "0869aea7caf9ce13",
                "72095f8df23bec8a"
            ]
        ]
    },
    {
        "id": "df0b9c20e490677f",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "f2dbc74846310747"
            ]
        ]
    },
    {
        "id": "67ea360438e26053",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "f2dbc74846310747"
            ]
        ]
    },
    {
        "id": "f09593f09b559dbe",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "ef121c79f9fccc38",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "df0b9c20e490677f",
                "67ea360438e26053",
                "6a4384790f73bbf7",
                "23c0bf495d1c4e68"
            ]
        ]
    },
    {
        "id": "6a4384790f73bbf7",
        "type": "delay",
        "z": "6848ea4e725143d4",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "f09593f09b559dbe"
            ]
        ]
    },
    {
        "id": "23c0bf495d1c4e68",
        "type": "delay",
        "z": "6848ea4e725143d4",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "5462c2b6bda9ad00"
            ]
        ]
    },
    {
        "id": "0869aea7caf9ce13",
        "type": "switch",
        "z": "6848ea4e725143d4",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "6c6b98e4701fe6ce",
                "bab14c1d737b361a"
            ],
            [
                "db31d560f00c94c1",
                "bab14c1d737b361a",
                "3b967761ea801ed2"
            ]
        ]
    },
    {
        "id": "f8e6e8cbb88ebfab",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "c99f6f8ecfb6b17f",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "98f935fa06266957"
            ],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1ed129e76ea4a6da",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "c99f6f8ecfb6b17f"
            ],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "db31d560f00c94c1",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "1ed129e76ea4a6da"
            ]
        ]
    },
    {
        "id": "98f935fa06266957",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "8a710d975b6c46ed",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "fba3303bfd88ad96"
            ],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "6c6b98e4701fe6ce",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "8a710d975b6c46ed"
            ]
        ]
    },
    {
        "id": "fba3303bfd88ad96",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "a3699cd885ccb19f"
            ],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a3699cd885ccb19f",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "5c59b01f8428ade0"
            ],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "3d8d67106d87d97f",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "f8e6e8cbb88ebfab"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "5c59b01f8428ade0",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "3d8d67106d87d97f"
            ]
        ]
    },
    {
        "id": "6729beedad0ef952",
        "type": "debug",
        "z": "6848ea4e725143d4",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "bab14c1d737b361a",
        "type": "function",
        "z": "6848ea4e725143d4",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "6729beedad0ef952"
            ]
        ]
    },
    {
        "id": "fa2377af043e9734",
        "type": "catch",
        "z": "6848ea4e725143d4",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "d563ea9f124c0195"
            ]
        ]
    },
    {
        "id": "d563ea9f124c0195",
        "type": "debug",
        "z": "6848ea4e725143d4",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "7310cf61af527a95",
        "type": "status",
        "z": "6848ea4e725143d4",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "72095f8df23bec8a",
        "type": "debug",
        "z": "6848ea4e725143d4",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "3b967761ea801ed2",
        "type": "debug",
        "z": "6848ea4e725143d4",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "42dda04e83d6d855",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "14593dbc37309c6d",
        "type": "mqtt in",
        "z": "27e3b5a6a27dfb07",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "c498d117a979b50c",
                "162d2c88f3434717"
            ]
        ]
    },
    {
        "id": "baf4da3aa749d60a",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "14593dbc37309c6d"
            ]
        ]
    },
    {
        "id": "56306efa94d92d87",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "14593dbc37309c6d"
            ]
        ]
    },
    {
        "id": "b5b3796991f90a62",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "a342345f7f70adde",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "baf4da3aa749d60a",
                "56306efa94d92d87",
                "34f624c3c9a9f9f5",
                "a02f6e2e402a0389"
            ]
        ]
    },
    {
        "id": "34f624c3c9a9f9f5",
        "type": "delay",
        "z": "27e3b5a6a27dfb07",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "b5b3796991f90a62"
            ]
        ]
    },
    {
        "id": "a02f6e2e402a0389",
        "type": "delay",
        "z": "27e3b5a6a27dfb07",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "42dda04e83d6d855"
            ]
        ]
    },
    {
        "id": "c498d117a979b50c",
        "type": "switch",
        "z": "27e3b5a6a27dfb07",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "1da1483a937a3d2f",
                "cb9e9ca66b6e8c9a"
            ],
            [
                "7b95cc95a840d8a0",
                "cb9e9ca66b6e8c9a",
                "e3c30851a91bf66a"
            ]
        ]
    },
    {
        "id": "54a05b7fd64ab8ba",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "4650c19277310717",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "5cc1f2486b7f7a68"
            ],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "910e6641ade2398f",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "4650c19277310717"
            ],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "7b95cc95a840d8a0",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "910e6641ade2398f"
            ]
        ]
    },
    {
        "id": "5cc1f2486b7f7a68",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "76ef2ae7cfd963d4",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "514699050ad1d7fe"
            ],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1da1483a937a3d2f",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "76ef2ae7cfd963d4"
            ]
        ]
    },
    {
        "id": "514699050ad1d7fe",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "f06114944278225b"
            ],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f06114944278225b",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "cb8860ecc43e9b42"
            ],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c27bbb4c944408fa",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "54a05b7fd64ab8ba"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "cb8860ecc43e9b42",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "c27bbb4c944408fa"
            ]
        ]
    },
    {
        "id": "3d88e2e37e2da167",
        "type": "debug",
        "z": "27e3b5a6a27dfb07",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "cb9e9ca66b6e8c9a",
        "type": "function",
        "z": "27e3b5a6a27dfb07",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "3d88e2e37e2da167"
            ]
        ]
    },
    {
        "id": "625a5171d3e315a2",
        "type": "catch",
        "z": "27e3b5a6a27dfb07",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "b08a747e244c1547"
            ]
        ]
    },
    {
        "id": "b08a747e244c1547",
        "type": "debug",
        "z": "27e3b5a6a27dfb07",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "b41689afc1defd47",
        "type": "status",
        "z": "27e3b5a6a27dfb07",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "162d2c88f3434717",
        "type": "debug",
        "z": "27e3b5a6a27dfb07",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "e3c30851a91bf66a",
        "type": "debug",
        "z": "27e3b5a6a27dfb07",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "1bef33880c3faf4e",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "ae6facbd17c14570",
        "type": "mqtt in",
        "z": "5dd9a3ea3d36c5e7",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "a71698fef5ab4bda",
                "8fe53ce6922d5e7a"
            ]
        ]
    },
    {
        "id": "7489201f8ea2b95d",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "ae6facbd17c14570"
            ]
        ]
    },
    {
        "id": "457d3351727e2ba8",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "ae6facbd17c14570"
            ]
        ]
    },
    {
        "id": "791892d6f74a8fc7",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "d4e41148ad7c7297",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "7489201f8ea2b95d",
                "457d3351727e2ba8",
                "2380016f65128f12",
                "db024db97d7ecd29"
            ]
        ]
    },
    {
        "id": "2380016f65128f12",
        "type": "delay",
        "z": "5dd9a3ea3d36c5e7",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "791892d6f74a8fc7"
            ]
        ]
    },
    {
        "id": "db024db97d7ecd29",
        "type": "delay",
        "z": "5dd9a3ea3d36c5e7",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "1bef33880c3faf4e"
            ]
        ]
    },
    {
        "id": "a71698fef5ab4bda",
        "type": "switch",
        "z": "5dd9a3ea3d36c5e7",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "8f5d5801ec43d087",
                "64a034b230f7f82a"
            ],
            [
                "275e23741289c65f",
                "64a034b230f7f82a",
                "9b5b5c6933d29b1c"
            ]
        ]
    },
    {
        "id": "35a291fa01e739d2",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "af0347f5423b83ab",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "dafbd30a43bfbe44"
            ],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d42bf48aabc75268",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "af0347f5423b83ab"
            ],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "275e23741289c65f",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "d42bf48aabc75268"
            ]
        ]
    },
    {
        "id": "dafbd30a43bfbe44",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "a6702ea7dccbe70f",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "0b32bcec3607122c"
            ],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "8f5d5801ec43d087",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "a6702ea7dccbe70f"
            ]
        ]
    },
    {
        "id": "0b32bcec3607122c",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "845d550405bd4676"
            ],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "845d550405bd4676",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "1145260f438827c3"
            ],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "a6926492ff09038c",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "35a291fa01e739d2"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "1145260f438827c3",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "a6926492ff09038c"
            ]
        ]
    },
    {
        "id": "9d102f9b7d0bb18d",
        "type": "debug",
        "z": "5dd9a3ea3d36c5e7",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "64a034b230f7f82a",
        "type": "function",
        "z": "5dd9a3ea3d36c5e7",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "9d102f9b7d0bb18d"
            ]
        ]
    },
    {
        "id": "8ff123925d14dfc8",
        "type": "catch",
        "z": "5dd9a3ea3d36c5e7",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "5b0e56943da9d42a"
            ]
        ]
    },
    {
        "id": "5b0e56943da9d42a",
        "type": "debug",
        "z": "5dd9a3ea3d36c5e7",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "7a2d1ca5ccdb12cc",
        "type": "status",
        "z": "5dd9a3ea3d36c5e7",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "8fe53ce6922d5e7a",
        "type": "debug",
        "z": "5dd9a3ea3d36c5e7",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "9b5b5c6933d29b1c",
        "type": "debug",
        "z": "5dd9a3ea3d36c5e7",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "6eb7071b9a650ef4",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "b81b321198d1d39b",
        "type": "mqtt in",
        "z": "416e768ad0dd8fe2",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "038d38961ac57991",
                "0c18517402c0ab63"
            ]
        ]
    },
    {
        "id": "610c2d7c701e45a0",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "b81b321198d1d39b"
            ]
        ]
    },
    {
        "id": "c0cd090b5cc1ba16",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "b81b321198d1d39b"
            ]
        ]
    },
    {
        "id": "d1a47a582519de7f",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "61b3064c360f5117",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "610c2d7c701e45a0",
                "c0cd090b5cc1ba16",
                "1cae66e10599b9c9",
                "0eaa5064f7da540d"
            ]
        ]
    },
    {
        "id": "1cae66e10599b9c9",
        "type": "delay",
        "z": "416e768ad0dd8fe2",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "d1a47a582519de7f"
            ]
        ]
    },
    {
        "id": "0eaa5064f7da540d",
        "type": "delay",
        "z": "416e768ad0dd8fe2",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "6eb7071b9a650ef4"
            ]
        ]
    },
    {
        "id": "038d38961ac57991",
        "type": "switch",
        "z": "416e768ad0dd8fe2",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "5dae36363a2a3d34",
                "c324d942e8b3c769"
            ],
            [
                "638963b6c0e52bb0",
                "c324d942e8b3c769",
                "ea9a4f54d6e1b18c"
            ]
        ]
    },
    {
        "id": "da454a461b0fdb7c",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "2e0d685941f2ec82",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "6f12e698bbe0e652"
            ],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "7ebb3fc798fb2fbb",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "2e0d685941f2ec82"
            ],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "638963b6c0e52bb0",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "7ebb3fc798fb2fbb"
            ]
        ]
    },
    {
        "id": "6f12e698bbe0e652",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "8230dc13db2a028f",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "d4c2d1364c8c1a67"
            ],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "5dae36363a2a3d34",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "8230dc13db2a028f"
            ]
        ]
    },
    {
        "id": "d4c2d1364c8c1a67",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "598107fe98f2c3c7"
            ],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "598107fe98f2c3c7",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "25c42880b645b6eb"
            ],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "111fa6ca44dc884d",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "da454a461b0fdb7c"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "25c42880b645b6eb",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "111fa6ca44dc884d"
            ]
        ]
    },
    {
        "id": "9081169e460917b1",
        "type": "debug",
        "z": "416e768ad0dd8fe2",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "c324d942e8b3c769",
        "type": "function",
        "z": "416e768ad0dd8fe2",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "9081169e460917b1"
            ]
        ]
    },
    {
        "id": "45bd2d3427c5f3ce",
        "type": "catch",
        "z": "416e768ad0dd8fe2",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "956bd8baa82d3b39"
            ]
        ]
    },
    {
        "id": "956bd8baa82d3b39",
        "type": "debug",
        "z": "416e768ad0dd8fe2",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "5af6fd1a0b7f63d2",
        "type": "status",
        "z": "416e768ad0dd8fe2",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "0c18517402c0ab63",
        "type": "debug",
        "z": "416e768ad0dd8fe2",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "ea9a4f54d6e1b18c",
        "type": "debug",
        "z": "416e768ad0dd8fe2",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "03dac1d00ff712bd",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "a8a60e9c94f122cd",
        "type": "mqtt in",
        "z": "9234b63e1a4ef5fe",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "7771a2131d103c9e",
                "2927d987b25c37fc"
            ]
        ]
    },
    {
        "id": "6b063fdc91661336",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "a8a60e9c94f122cd"
            ]
        ]
    },
    {
        "id": "887ceef4e7dcac3a",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "a8a60e9c94f122cd"
            ]
        ]
    },
    {
        "id": "d312327ae8170daf",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "b21c503338b1f546",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "6b063fdc91661336",
                "887ceef4e7dcac3a",
                "3937e62ef2cbb74e",
                "f6362cbf18070b07"
            ]
        ]
    },
    {
        "id": "3937e62ef2cbb74e",
        "type": "delay",
        "z": "9234b63e1a4ef5fe",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "d312327ae8170daf"
            ]
        ]
    },
    {
        "id": "f6362cbf18070b07",
        "type": "delay",
        "z": "9234b63e1a4ef5fe",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "03dac1d00ff712bd"
            ]
        ]
    },
    {
        "id": "7771a2131d103c9e",
        "type": "switch",
        "z": "9234b63e1a4ef5fe",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "7a559548b886c512",
                "d684c0e06ed851cc"
            ],
            [
                "d978296592ab6bd3",
                "d684c0e06ed851cc",
                "466f977f8b6faa19"
            ]
        ]
    },
    {
        "id": "0b8ee26bf2b84e13",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "11dc9a11502c5ed9",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "3b3aeb9ac8f53e34"
            ],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "b19e106b918d560c",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "11dc9a11502c5ed9"
            ],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d978296592ab6bd3",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "b19e106b918d560c"
            ]
        ]
    },
    {
        "id": "3b3aeb9ac8f53e34",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "2bd096a8589186ea",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "37282cb688df5b31"
            ],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "7a559548b886c512",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "2bd096a8589186ea"
            ]
        ]
    },
    {
        "id": "37282cb688df5b31",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "1f66c9389d9f332a"
            ],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "1f66c9389d9f332a",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "84490a45d95205cf"
            ],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "38eb44f502ed7ffc",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "0b8ee26bf2b84e13"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "84490a45d95205cf",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "38eb44f502ed7ffc"
            ]
        ]
    },
    {
        "id": "f688cd9fb29a696c",
        "type": "debug",
        "z": "9234b63e1a4ef5fe",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "d684c0e06ed851cc",
        "type": "function",
        "z": "9234b63e1a4ef5fe",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "f688cd9fb29a696c"
            ]
        ]
    },
    {
        "id": "d0b04e221c89a6a9",
        "type": "catch",
        "z": "9234b63e1a4ef5fe",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "5e9ea3bee577f4c5"
            ]
        ]
    },
    {
        "id": "5e9ea3bee577f4c5",
        "type": "debug",
        "z": "9234b63e1a4ef5fe",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "96d16d7b4022341b",
        "type": "status",
        "z": "9234b63e1a4ef5fe",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "2927d987b25c37fc",
        "type": "debug",
        "z": "9234b63e1a4ef5fe",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "466f977f8b6faa19",
        "type": "debug",
        "z": "9234b63e1a4ef5fe",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "70ff57bb867ac348",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d89e9b6a8d1d6ab5",
        "type": "mqtt in",
        "z": "98415d4f51dc9a1e",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "97b73a74a6604cd4",
                "3f4e78865a60061b"
            ]
        ]
    },
    {
        "id": "eb4e95aab65b995c",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "d89e9b6a8d1d6ab5"
            ]
        ]
    },
    {
        "id": "ad968236f76bbdb3",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "d89e9b6a8d1d6ab5"
            ]
        ]
    },
    {
        "id": "c8f547c575b07025",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "c0bf64c913e813c1",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "eb4e95aab65b995c",
                "ad968236f76bbdb3",
                "b35d42b7271cd27c",
                "37ab0a19c7180a71"
            ]
        ]
    },
    {
        "id": "b35d42b7271cd27c",
        "type": "delay",
        "z": "98415d4f51dc9a1e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "c8f547c575b07025"
            ]
        ]
    },
    {
        "id": "37ab0a19c7180a71",
        "type": "delay",
        "z": "98415d4f51dc9a1e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "70ff57bb867ac348"
            ]
        ]
    },
    {
        "id": "97b73a74a6604cd4",
        "type": "switch",
        "z": "98415d4f51dc9a1e",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "ff09d8da63a688a1",
                "eddda601475d320e"
            ],
            [
                "2994c6552ecaf137",
                "eddda601475d320e",
                "ed47065cbc85b7e1"
            ]
        ]
    },
    {
        "id": "fa14291fff360832",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "665ac90c93e9ea90",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "6e8f2bec4cea3953"
            ],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f851a81bac92fb03",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "665ac90c93e9ea90"
            ],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2994c6552ecaf137",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "f851a81bac92fb03"
            ]
        ]
    },
    {
        "id": "6e8f2bec4cea3953",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "76842a7660a9c017",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "b0fd40292e852c69"
            ],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "ff09d8da63a688a1",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "76842a7660a9c017"
            ]
        ]
    },
    {
        "id": "b0fd40292e852c69",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "b0708898448695cb"
            ],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "b0708898448695cb",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "1a383d2ebb64d013"
            ],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "bcc58817d9644e19",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "fa14291fff360832"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "1a383d2ebb64d013",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "bcc58817d9644e19"
            ]
        ]
    },
    {
        "id": "83583824969e44ef",
        "type": "debug",
        "z": "98415d4f51dc9a1e",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "eddda601475d320e",
        "type": "function",
        "z": "98415d4f51dc9a1e",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "83583824969e44ef"
            ]
        ]
    },
    {
        "id": "b37bce6d930b358c",
        "type": "catch",
        "z": "98415d4f51dc9a1e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "7fa22e1517bd07e6"
            ]
        ]
    },
    {
        "id": "7fa22e1517bd07e6",
        "type": "debug",
        "z": "98415d4f51dc9a1e",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "633c595a9a390fe5",
        "type": "status",
        "z": "98415d4f51dc9a1e",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "3f4e78865a60061b",
        "type": "debug",
        "z": "98415d4f51dc9a1e",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "ed47065cbc85b7e1",
        "type": "debug",
        "z": "98415d4f51dc9a1e",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "93bb4744a54c12c9",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "ad3e913ee4244d77",
        "type": "mqtt in",
        "z": "0b90a6fc2e611af1",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "15437a238d0a47b4",
                "cf3e23577adc87d3"
            ]
        ]
    },
    {
        "id": "7bc4655e1d18546f",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "ad3e913ee4244d77"
            ]
        ]
    },
    {
        "id": "28228f8b84b67c0f",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "ad3e913ee4244d77"
            ]
        ]
    },
    {
        "id": "2bead0bf5887874c",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "d4c20d76361caea1",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "7bc4655e1d18546f",
                "28228f8b84b67c0f",
                "24029e027608350c",
                "a1fc4fe1dfd49e29"
            ]
        ]
    },
    {
        "id": "24029e027608350c",
        "type": "delay",
        "z": "0b90a6fc2e611af1",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "2bead0bf5887874c"
            ]
        ]
    },
    {
        "id": "a1fc4fe1dfd49e29",
        "type": "delay",
        "z": "0b90a6fc2e611af1",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "93bb4744a54c12c9"
            ]
        ]
    },
    {
        "id": "15437a238d0a47b4",
        "type": "switch",
        "z": "0b90a6fc2e611af1",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "2a42ec7cca0d47bb",
                "6f59a4273524f05b"
            ],
            [
                "7f55699b7a84b6bd",
                "6f59a4273524f05b",
                "05b91a07a5469684"
            ]
        ]
    },
    {
        "id": "7b376e52930be96a",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "19f1c76302bd628c",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "2480b69c3cdf0f4d"
            ],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "aa14c06e609af4c4",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "19f1c76302bd628c"
            ],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "7f55699b7a84b6bd",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "aa14c06e609af4c4"
            ]
        ]
    },
    {
        "id": "2480b69c3cdf0f4d",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "151af6a42aa7f594",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "7d896f33889276c1"
            ],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "2a42ec7cca0d47bb",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "151af6a42aa7f594"
            ]
        ]
    },
    {
        "id": "7d896f33889276c1",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "795f982b0bf3bb43"
            ],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "795f982b0bf3bb43",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "67454af2e8a4f105"
            ],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "e22a21387b27bac9",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "7b376e52930be96a"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "67454af2e8a4f105",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "e22a21387b27bac9"
            ]
        ]
    },
    {
        "id": "b436149b9e6755f4",
        "type": "debug",
        "z": "0b90a6fc2e611af1",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "6f59a4273524f05b",
        "type": "function",
        "z": "0b90a6fc2e611af1",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "b436149b9e6755f4"
            ]
        ]
    },
    {
        "id": "3c76d6f584ccda4a",
        "type": "catch",
        "z": "0b90a6fc2e611af1",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "bc6de3befcd7ab6d"
            ]
        ]
    },
    {
        "id": "bc6de3befcd7ab6d",
        "type": "debug",
        "z": "0b90a6fc2e611af1",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "23ba99edc98119e4",
        "type": "status",
        "z": "0b90a6fc2e611af1",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "cf3e23577adc87d3",
        "type": "debug",
        "z": "0b90a6fc2e611af1",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "05b91a07a5469684",
        "type": "debug",
        "z": "0b90a6fc2e611af1",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "609a871c6f22e070",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "104ffe1e924a1ef0",
        "type": "mqtt in",
        "z": "7d3b2d5805495822",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "c6d2f9095f6f1721",
                "692270fc4aa76b55"
            ]
        ]
    },
    {
        "id": "ec82159abb88fe61",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "104ffe1e924a1ef0"
            ]
        ]
    },
    {
        "id": "a27c2961de187ba8",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "104ffe1e924a1ef0"
            ]
        ]
    },
    {
        "id": "94f609d0b50ebd7b",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "266e27d1f1e44c92",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "ec82159abb88fe61",
                "a27c2961de187ba8",
                "3a62d4e2b7c9a4dc",
                "97ac8b1574dd77bf"
            ]
        ]
    },
    {
        "id": "3a62d4e2b7c9a4dc",
        "type": "delay",
        "z": "7d3b2d5805495822",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "94f609d0b50ebd7b"
            ]
        ]
    },
    {
        "id": "97ac8b1574dd77bf",
        "type": "delay",
        "z": "7d3b2d5805495822",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "609a871c6f22e070"
            ]
        ]
    },
    {
        "id": "c6d2f9095f6f1721",
        "type": "switch",
        "z": "7d3b2d5805495822",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "add9d062f57da6a2",
                "1ffdf25e72d78ec1"
            ],
            [
                "f7433753a439b13e",
                "1ffdf25e72d78ec1",
                "62736d0729045fa4"
            ]
        ]
    },
    {
        "id": "9d1cce1f55989b11",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "c5ba8f180a8ba75b",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "71117effb3f31ccc"
            ],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "d8987d5bb4f6687d",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "c5ba8f180a8ba75b"
            ],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f7433753a439b13e",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "d8987d5bb4f6687d"
            ]
        ]
    },
    {
        "id": "71117effb3f31ccc",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "df292adbf553d4fd",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "3ce063517572cf6a"
            ],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "add9d062f57da6a2",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "df292adbf553d4fd"
            ]
        ]
    },
    {
        "id": "3ce063517572cf6a",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "3ff970f5cf769f2d"
            ],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "3ff970f5cf769f2d",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "96d6519f73143009"
            ],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "80a861b3a4f591d6",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "9d1cce1f55989b11"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "96d6519f73143009",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "80a861b3a4f591d6"
            ]
        ]
    },
    {
        "id": "d7d6c543ec9bf34e",
        "type": "debug",
        "z": "7d3b2d5805495822",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "1ffdf25e72d78ec1",
        "type": "function",
        "z": "7d3b2d5805495822",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "d7d6c543ec9bf34e"
            ]
        ]
    },
    {
        "id": "ccc91f0686ec377f",
        "type": "catch",
        "z": "7d3b2d5805495822",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "c57b4a7096fd1b09"
            ]
        ]
    },
    {
        "id": "c57b4a7096fd1b09",
        "type": "debug",
        "z": "7d3b2d5805495822",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "e52b48c285b0df17",
        "type": "status",
        "z": "7d3b2d5805495822",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "692270fc4aa76b55",
        "type": "debug",
        "z": "7d3b2d5805495822",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "62736d0729045fa4",
        "type": "debug",
        "z": "7d3b2d5805495822",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "a3966c36a53790c3",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "c91185a7f360c432",
        "type": "mqtt in",
        "z": "6ae11647b552316e",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "0c588dc33c6da796",
                "5f4cdfb41c85fcb1"
            ]
        ]
    },
    {
        "id": "b909e28aa903d762",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "c91185a7f360c432"
            ]
        ]
    },
    {
        "id": "98477f04f95d75a8",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "c91185a7f360c432"
            ]
        ]
    },
    {
        "id": "577f55e563cc9ecd",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1d3b9111a43a44a3",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "b909e28aa903d762",
                "98477f04f95d75a8",
                "374202cce610587d",
                "34e5a8364d4af1e0"
            ]
        ]
    },
    {
        "id": "374202cce610587d",
        "type": "delay",
        "z": "6ae11647b552316e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "577f55e563cc9ecd"
            ]
        ]
    },
    {
        "id": "34e5a8364d4af1e0",
        "type": "delay",
        "z": "6ae11647b552316e",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "a3966c36a53790c3"
            ]
        ]
    },
    {
        "id": "0c588dc33c6da796",
        "type": "switch",
        "z": "6ae11647b552316e",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "c676f4d2da08d13f",
                "f52047abe6ece722"
            ],
            [
                "e486637e29470825",
                "f52047abe6ece722",
                "5f34a85e7d615123"
            ]
        ]
    },
    {
        "id": "6eb836b5f4a88039",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "05265447f6e862fd",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "b2d1f232b67184b8"
            ],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "b64dab1d2b7ce457",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "05265447f6e862fd"
            ],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "e486637e29470825",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "b64dab1d2b7ce457"
            ]
        ]
    },
    {
        "id": "b2d1f232b67184b8",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "064b58311977c25d",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "edc529771024eb61"
            ],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c676f4d2da08d13f",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "064b58311977c25d"
            ]
        ]
    },
    {
        "id": "edc529771024eb61",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "e702d6553282a157"
            ],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "e702d6553282a157",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 220,
        "wires": [
            [
                "4a6a95abb1148e80"
            ],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "c24e9d3a4132418e",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "6eb836b5f4a88039"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "4a6a95abb1148e80",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 220,
        "wires": [
            [
                "c24e9d3a4132418e"
            ]
        ]
    },
    {
        "id": "7a5deb383806b971",
        "type": "debug",
        "z": "6ae11647b552316e",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "f52047abe6ece722",
        "type": "function",
        "z": "6ae11647b552316e",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "7a5deb383806b971"
            ]
        ]
    },
    {
        "id": "7982923ff82c07e6",
        "type": "catch",
        "z": "6ae11647b552316e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "27d5cef1a962c976"
            ]
        ]
    },
    {
        "id": "27d5cef1a962c976",
        "type": "debug",
        "z": "6ae11647b552316e",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "1cef9e3cb541329c",
        "type": "status",
        "z": "6ae11647b552316e",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "5f4cdfb41c85fcb1",
        "type": "debug",
        "z": "6ae11647b552316e",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "5f34a85e7d615123",
        "type": "debug",
        "z": "6ae11647b552316e",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "63373ba35b460ce5",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "connection state",
        "func": "// connection Nachtricht bauen\nconst serialNumber = flow.get(\"$parent.serialNumber\");\nconst connection = flow.get(\"$parent.connection\");\nconnection.serialNumber = serialNumber;\nconnection.timestamp = new Date().toISOString();\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/connection\";\nmsg.payload = connection;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "3a6b4df8781b22f5",
        "type": "mqtt in",
        "z": "4a591b1ca8fe0bf6",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "1f7f706f7a1db7f3",
                "24aae377424d99dd"
            ]
        ]
    },
    {
        "id": "a71fedea25ab74ea",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "sub order",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "3a6b4df8781b22f5"
            ]
        ]
    },
    {
        "id": "99405aecbd8ec2ae",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "sub instantAction",
        "func": "msg.topic = flow.get(\"$parent.MQTT_topic\") + \"/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 600,
        "wires": [
            [
                "3a6b4df8781b22f5"
            ]
        ]
    },
    {
        "id": "4984958e50b05d95",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "leere state",
        "func": "const state = flow.get(\"$parent.state\");\nconst loads = flow.get(\"$parent.loads\");\nstate.timestamp = new Date().toISOString();\nstate.actionState = null;\nstate.loads = loads ?? [];\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "57499961c19ee016",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "factsheet Update",
        "func": "// Timestamp\nconst timestamp = new Date().toISOString();\n\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nif (!serialNumberObj.value) {\n    node.error(\"SerialNumber is not available\", msg.payload);\n    return;\n}\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\nconst modelObj = msg.payload.resultsConverted[1] ?? {};\nconst model = modelObj.value ?? \"Unknown\";\nconst versionObj = msg.payload.resultsConverted[2] ?? {};\nconst version = versionObj.value ?? \"N/A\";\nmsg.model = model;\nmsg.serialNumber = serialNumber;\nmsg.version = version\n\n\nnode.log(serialNumber);\n\n// Werte in Flow speichern\nflow.set('$parent.MQTT_topic', 'module/v1/ff/' + serialNumber);\nflow.set(\"$parent.model\", model);\nflow.set(\"$parent.serialNumber\", serialNumber);\nflow.set(\"$parent.version\", version);\n\nnode.status({ shape: \"dot\", fill: \"green\", text: `${serialNumber} / ${model}`})\n\n// state serialNumber update\nconst state = flow.get(\"$parent.state\");\nstate.serialNumber = serialNumber;\nflow.set(\"$parent.state\", state);\n\n// connection update\nconst connection = flow.get(\"$parent.connection\");\nconnection.version = version;\nflow.set(\"$parent.connection\", connection);\n\n// factsheet Update\nconst factsheet = flow.get(\"$parent.factsheet\");\nfactsheet.serialNumber = serialNumber;\nfactsheet.version = version;\nfactsheet.typeSpecification.seriesName = \"MOD-FF22+\" + model + \"+24V\";\nfactsheet.typeSpecification.moduleClass = model;\nflow.set(\"$parent.factsheet\", factsheet);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "a71fedea25ab74ea",
                "99405aecbd8ec2ae",
                "af529caece4b6e2f",
                "7b4878ad781993e1"
            ]
        ]
    },
    {
        "id": "af529caece4b6e2f",
        "type": "delay",
        "z": "4a591b1ca8fe0bf6",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "4984958e50b05d95"
            ]
        ]
    },
    {
        "id": "7b4878ad781993e1",
        "type": "delay",
        "z": "4a591b1ca8fe0bf6",
        "name": "Verzgerung",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "63373ba35b460ce5"
            ]
        ]
    },
    {
        "id": "1f7f706f7a1db7f3",
        "type": "switch",
        "z": "4a591b1ca8fe0bf6",
        "name": "topicswitch",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "instantAction",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "a0d02ccb4691e7c5",
                "5957e61a4b737136"
            ],
            [
                "66763a2c537067eb",
                "a0d02ccb4691e7c5",
                "cf34305720c9540a"
            ]
        ]
    },
    {
        "id": "2bc0059c06184adf",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "Publish vda_status_FAILED",
        "func": "// state bauen\nconst state = flow.get(\"$parent.state\");\nstate.headerId = parseInt(flow.get(\"$parent.headerId\"), 10);\nstate.loads = flow.get(\"$parent.loads\");\nstate.actionState = flow.get(\"$parent.actionState\");\nstate.actionState.id = msg.actionId;\nstate.actionState.state = \"FAILED\";\nstate.actionState.command = msg.order ?? msg.instantAction;\nstate.timestamp = new Date().toISOString();\nstate.orderId = msg.orderId;\nstate.orderUpdateId = msg.orderUpdateId;\nconst flowErrors = flow.get(\"$parent.errors\");\nstate.errors = flowErrors ? Array.isArray(flowErrors) ? flowErrors : [flowErrors] : [];\n\n// flow update\nflow.set(\"$parent.headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"$parent.MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3020,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "fcac61880e547e24",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "isInstantAction?",
        "func": "if (!msg.instantAction) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an instantAction\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 740,
        "wires": [
            [
                "f3a27f6e0f6daf68"
            ],
            [
                "2bc0059c06184adf"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "e039923eb4b5bf42",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const headerId = flow.get(\"$parent.headerId\");\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": headerId },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "fcac61880e547e24"
            ],
            [
                "2bc0059c06184adf"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "66763a2c537067eb",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "expand-instant-action-payload",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\nif (!msg.payload) {\n    return;\n}\n\nconst action = (msg.payload.actions ?? [])[0];\nconst instantAction = action?.actionType;\nconst actionId = action?.actionId;\nconst actionMetadata = action?.metadata ?? {};\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.instantAction = instantAction;\nmsg.actionId = actionId;\nmsg.actionMetadata = actionMetadata;\nmsg.actionCommand = instantAction;\nmsg.actionState = updateActionState(\"PENDING\", actionMetadata);\nflow.set(\"$parent.actionState\", msg.actionState);\nnode.status({ fill: \"green\", shape: \"ring\", text: msg.instantAction });\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 740,
        "wires": [
            [
                "e039923eb4b5bf42"
            ]
        ]
    },
    {
        "id": "f3a27f6e0f6daf68",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "isSupportedInstantAction?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst factsheetInstantActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return (act.actionScopes ?? []).includes(\"INSTANT\");\n}).map(act => act.actionType);\nconst supportedInstantActions = [\"factsheetRequest\", \"SET_STORAGE\", \"setStatusLED\", \"reset\", ...factsheetInstantActions];\nif (supportedInstantActions.indexOf(msg.instantAction) == -1) {\n    return;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 700,
        "wires": [
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction"
        ]
    },
    {
        "id": "266960a20bedee60",
        "type": "debug",
        "z": "4a591b1ca8fe0bf6",
        "name": "after-topic-switch",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "a0d02ccb4691e7c5",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "extract-model",
        "func": "msg.model = msg.model ?? flow.get(\"$parent.model\");\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "266960a20bedee60"
            ]
        ]
    },
    {
        "id": "e5b1abcd6069db89",
        "type": "catch",
        "z": "4a591b1ca8fe0bf6",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 240,
        "y": 780,
        "wires": [
            [
                "165ff1d413201bdf"
            ]
        ]
    },
    {
        "id": "165ff1d413201bdf",
        "type": "debug",
        "z": "4a591b1ca8fe0bf6",
        "name": "debug-catch-all",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 420,
        "y": 780,
        "wires": []
    },
    {
        "id": "47b449a6503aa3b4",
        "type": "status",
        "z": "4a591b1ca8fe0bf6",
        "name": "",
        "scope": null,
        "x": 240,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "24aae377424d99dd",
        "type": "debug",
        "z": "4a591b1ca8fe0bf6",
        "name": "from-mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "cf34305720c9540a",
        "type": "debug",
        "z": "4a591b1ca8fe0bf6",
        "name": "Instant Action",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 580,
        "wires": []
    },
    {
        "id": "5957e61a4b737136",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "expand-order-action-payload",
        "func": "if (!msg.payload) {\n    return;\n}\n\nconst orderCommand = msg.payload.action?.command;\nconst actionId = msg.payload.action?.id;\nconst serialNumber = msg.payload.serialNumber ?? \"NoSerial\";\nconst orderId = msg.payload.orderId;\nconst orderUpdateId = msg.payload.orderUpdateId;\n\nmsg.order = orderCommand;\nmsg.orderAction = msg.payload.action;\nmsg.actionId = actionId;\nmsg.serialNumber = serialNumber;\nmsg.orderId = orderId;\nmsg.orderUpdateId = orderUpdateId;\nnode.status({ fill: \"green\", shape: \"dot\", text: orderCommand });\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 340,
        "wires": [
            [
                "2d74b6b498410dc0"
            ]
        ]
    },
    {
        "id": "2d74b6b498410dc0",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "matchesSerialNumber?",
        "func": "const serialNumber = flow.get(\"$parent.serialNumber\") ?? \"MISSING-SERIALNUMBER\";\nif (msg.serialNumber != serialNumber) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"SerialNumber does not match\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [null, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 220,
        "wires": [
            [
                "f9b3c2ead1fed98b"
            ],
            [
                "2bc0059c06184adf"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "f4eec2fde57a011e",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "isOrder?",
        "func": "if (!msg.order) {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": \"Not an order\"\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 160,
        "wires": [
            [
                "ce7dfb7d8e3812cb"
            ],
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "ce7dfb7d8e3812cb",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "isSupportedOrder?",
        "func": "/**\n * @typedef {object} ModuleAction\n * @property {string} actionType\n * @property {string[]} actionScopes\n * @property {object[]} actionParameters\n * \n * @typedef {object} ProtocolFeatures\n * @property {ModuleAction[]} moduleActions\n * \n * @typedef {object} Factsheet\n * @property {ProtocolFeatures} protocolFeatures\n */\n\n/** @type {Factsheet} */\nconst factsheet = flow.get(\"$parent.factsheet\");\nconst supportedActions = factsheet.protocolFeatures.moduleActions.filter(act => {\n    return act.actionScopes == undefined || \n    act.actionScopes.includes(\"NODE\") || \n    act.actionScopes.includes(\"ORDER\");\n}).map(act => act.actionType);\nif (supportedActions.indexOf(msg.order) == -1) {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"$parent.headerId\") },\n            { \"orderId\": msg.orderId },\n            { \"orderUpdateId\": msg.orderUpdateId }\n        ],\n        \"errorMessage\": `Command \"${msg.order}\" is not supported`\n    }\n    // Error in Flow\n    flow.set(\"$parent.errors\", error);\n    return [undefined, msg];\n}\nreturn msg;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1710,
        "y": 140,
        "wires": [
            [
                "15c5650b38e1ea21"
            ],
            []
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "instantAction",
            "error"
        ]
    },
    {
        "id": "15c5650b38e1ea21",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "discard-duplicate-order",
        "func": "const knownOrderId = flow.get(\"$parent.orderId\");\nconst knownOrderUpdateId = flow.get(\"$parent.orderUpdateId\");\nconst receivedOrderId = msg.orderId;\nconst receivedOrderUpdateId = msg.orderUpdateId;\n\nif (knownOrderId == receivedOrderId && knownOrderUpdateId == receivedOrderUpdateId) {\n    return;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "f9b3c2ead1fed98b",
        "type": "function",
        "z": "4a591b1ca8fe0bf6",
        "name": "isMatchingOrderId?",
        "func": "const existingOrderId = flow.get(\"$parent.orderId\");\nconst actionState = flow.get(\"$parent.actionState.state\");\n\nif (actionState == \"FINISHED\" || actionState == \"FAILED\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nif (msg.orderId == existingOrderId || existingOrderId == \"0\") {\n    flow.set(\"$parent.orderId\", msg.orderId);\n    return msg;\n}\n\nconst error = {\n    \"errorType\": \"Validation\",\n    \"errorLevel\": \"WARNING\",\n    \"errorReferences\": [\n        { \"topic\": \"order\" },\n        { \"headerId\": flow.get(\"$parent.headerId\") },\n        { \"orderId\": msg.orderId },\n        { \"orderUpdateId\": msg.orderUpdateId }\n    ],\n    \"errorMessage\": `OrderId \"${msg.orderId}\" not valid`\n}\n// Error in Flow\nflow.set(\"$parent.errors\", error);\nreturn [null, msg];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 220,
        "wires": [
            [],
            [
                "2bc0059c06184adf"
            ]
        ],
        "inputLabels": [
            "order"
        ],
        "outputLabels": [
            "order",
            "error"
        ]
    },
    {
        "id": "cc39c4d3b65e4757",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 640,
        "wires": [
            [
                "6432c89e07b683b0",
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "a9542fcbe3ab0702",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1710,
        "y": 400,
        "wires": []
    },
    {
        "id": "6432c89e07b683b0",
        "type": "debug",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt-ret",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 520,
        "wires": []
    },
    {
        "id": "71fe35ae64da53e0",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 740,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "e0f9d6c3043a9148",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 800,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "5750634c354369fa",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 900,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "0e7d0e27556842ae",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 640,
        "wires": [
            [
                "4cf41789acca2eeb"
            ]
        ]
    },
    {
        "id": "5295c55b7d5605ac",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 610,
        "y": 840,
        "wires": [
            [
                "52e9b4bd4986e614"
            ]
        ]
    },
    {
        "id": "03cc8e466cbf4639",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 1080,
        "wires": [
            [
                "07b4ee142581ff56"
            ]
        ]
    },
    {
        "id": "a682c99f7ac302b7",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1290,
        "y": 1120,
        "wires": [
            [
                "b667b176ca6e1651"
            ]
        ]
    },
    {
        "id": "5fc430711234c826",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1680,
        "y": 980,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "61bbc5b06ae4dd0f",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 940,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "f6492342aaa4ec3f",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1930,
        "y": 1180,
        "wires": [
            [
                "982a5e050bb8471f"
            ]
        ]
    },
    {
        "id": "f903a4a02c4c93ed",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2140,
        "y": 600,
        "wires": [
            [
                "a9542fcbe3ab0702"
            ]
        ]
    },
    {
        "id": "e8b4313ffc338ae9",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2350,
        "y": 940,
        "wires": [
            [
                "421d4fd7dd737277"
            ]
        ]
    },
    {
        "id": "e8b29a27b33a8f99",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1370,
        "y": 1260,
        "wires": [
            [
                "99b3c0d6aeea84c5"
            ]
        ]
    },
    {
        "id": "4cf41789acca2eeb",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go dps",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:16.400Z\",\n  \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdateId\": 0,\n  \"description\":\"Go to DPS\",\n  \"nodes\": [\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"3\"\n        }\n      }\n    }\n  ],\n  \"edges\": [],\n  \"serialNumber\": \"4gcx\"\n}",
        "x": 530,
        "y": 640,
        "wires": [
            [
                "cc39c4d3b65e4757"
            ]
        ]
    },
    {
        "id": "52e9b4bd4986e614",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "fix pos",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n    \"topic\": \"fts/v1/ff/80F4/order\",\n\n    \"payload\": {\n      \"timestamp\": \"2025-03-06T10:16:24.117Z\",\n      \"serialNumber\": \"80F4\",\n      \"description\":\"Fix position\",\n      \"actions\": [\n        {\n          \"actionType\": \"findInitialDockPosition\",\n          \"actionId\": \"ad5328c1-2d42-46fe-9fd8-c29831f5871d\",\n          \"metadata\": {\n            \"nodeId\": \"SVR4PW6408\"\n          }\n        }\n      ]\n    }\n  }",
        "x": 870,
        "y": 760,
        "wires": [
            [
                "71fe35ae64da53e0"
            ]
        ]
    },
    {
        "id": "07b4ee142581ff56",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go hbw",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": " {\n      \"timestamp\": \"2025-02-28T09:55:31.618Z\",\n      \"orderId\": \"9da5c66d-2d1d-4312-a49a-ec7d72f4243c\",\n      \"orderUpdatedId\": 2,\n       \"description\" : \"From DPS to HBW\",\n      \"nodes\": [\n        {\n          \"id\": \"SVR4PW6408\",\n          \"linkedEdges\": [\"SVR4PW6408-2\"]\n        },\n        {\n          \"id\": \"2\",\n          \"linkedEdges\": [\"SVR4PW6408-2\", \"2-1\"],\n          \"action\": {\n            \"id\": \"6367b144-4350-434e-bfc8-6bb687dcef66\",\n            \"type\": \"PASS\"\n          }\n        },\n        {\n          \"id\": \"1\",\n          \"linkedEdges\": [\"2-1\", \"1-SVR5H85409\"],\n          \"action\": {\n            \"id\": \"9140b17e-d5e4-42ae-888e-557d491d379c\",\n            \"type\": \"PASS\"\n          }\n        },\n        {\n          \"id\": \"SVR5H85409\",\n          \"linkedEdges\": [\"1-SVR5H85409\"],\n          \"action\": {\n            \"type\": \"DOCK\",\n            \"id\": \"ab916e13-a5f2-4b00-bbd4-e18f0940cfa3\",\n            \"metadata\": {\n              \"loadId\": \"043169ca341290\",\n              \"loadType\": \"BLUE\",\n              \"loadPosition\": \"1\"\n            }\n          }\n        }\n      ],\n      \"edges\": [\n        {\n          \"id\": \"SVR4PW6408-2\",\n          \"length\": 380,\n          \"linkedNodes\": [\"SVR4PW6408\", \"2\"]\n        },\n        {\n          \"id\": \"2-1\",\n          \"length\": 360,\n          \"linkedNodes\": [\"2\", \"1\"]\n        },\n        {\n          \"id\": \"1-SVR5H85409\",\n          \"length\": 380,\n          \"linkedNodes\": [\"1\", \"SVR5H85409\"]\n        }\n      ],\n      \"serialNumber\": \"4gcx\"\n    }",
        "x": 1000,
        "y": 960,
        "wires": [
            [
                "e0f9d6c3043a9148"
            ]
        ]
    },
    {
        "id": "b667b176ca6e1651",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go from hbw to drill ",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:58:25.039Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 2,\n  \"description\":\"From HBW to DRILL\",\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"SVR5H85409-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H85409-1\", \"1-3\"],\n      \"action\": {\n        \"id\": \"6d3c47c7-01bb-4040-ab3e-84e5a069ed12\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"1-3\", \"3-SVR5H85384\"],\n      \"action\": {\n        \"id\": \"436a70c6-00b6-42b3-9fa0-ba321a809c16\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"3-SVR5H85384\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"6d8631b4-a0d1-4e13-a962-23e07a143b1f\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85409-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85409\", \"1\"]\n    },\n    {\n      \"id\": \"1-3\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"3\"]\n    },\n    {\n      \"id\": \"3-SVR5H85384\",\n      \"length\": 380,\n      \"linkedNodes\": [\"3\", \"SVR5H85384\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 1410,
        "y": 1020,
        "wires": [
            [
                "5750634c354369fa"
            ]
        ]
    },
    {
        "id": "99b3c0d6aeea84c5",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go from drill to mill ",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:12.944Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 6,\n  \"description\":\"From DRILL to MILL\",\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"SVR5H85384-3\"]\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"SVR5H85384-3\", \"3-1\"],\n      \"action\": {\n        \"id\": \"5ba43542-bc85-4796-9b9b-44d1d8308d04\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"3-1\", \"1-SVR5H59286\"],\n      \"action\": {\n        \"id\": \"b148724e-5ae5-4a29-930e-324ea2fd1b10\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H59286\",\n      \"linkedEdges\": [\"1-SVR5H59286\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"38cf85be-4a93-490d-937f-63309550b447\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85384-3\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85384\", \"3\"]\n    },\n    {\n      \"id\": \"3-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"3\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H59286\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H59286\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 1690,
        "y": 1060,
        "wires": [
            [
                "5fc430711234c826"
            ]
        ]
    },
    {
        "id": "982a5e050bb8471f",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go from mill to quality",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:57.157Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 10,\n  \"description\":\"From MILL to QAIS\",\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H59286\",  \n      \"linkedEdges\": [\"SVR5H59286-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H59286-1\", \"1-2\"],  \n      \"action\": {\n        \"id\": \"91084976-31d0-470e-b595-8b596a4ae39f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"1-2\", \"2-SVR4LR8731\"],   \n      \"action\": {\n        \"id\": \"56a5dae2-ad10-4fb7-9456-c7b97cc1688f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"2-SVR4LR8731\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"d1b48ccd-8948-4ec7-a358-fa8f732b5c8e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H59286-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H59286\", \"1\"]\n    },\n    {\n      \"id\": \"1-2\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4LR8731\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4LR8731\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 2100,
        "y": 1080,
        "wires": [
            [
                "61bbc5b06ae4dd0f"
            ]
        ]
    },
    {
        "id": "421d4fd7dd737277",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "go from quality to dps",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T10:00:38.690Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 14,\n  \"description\":\"From QAIS to DPS\",\n\n  \"nodes\": [\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"SVR4LR8731-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4LR8731-2\", \"2-SVR4PW6408\"],\n      \"action\": {\n        \"id\": \"1c2fa219-3c87-44fe-ac27-f19c95753bd4\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"2-SVR4PW6408\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"74cb9844-ff20-469c-96f4-a35a5c199f1e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR4LR8731-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4LR8731\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4PW6408\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4PW6408\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 2260,
        "y": 760,
        "wires": [
            [
                "f903a4a02c4c93ed"
            ]
        ]
    },
    {
        "id": "30f3cc158e9df50b",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "fill hbw",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"ts\": \"2025-02-28T09:55:45.982Z\",\n  \"stockItems\": [\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04d998ca341290\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044768ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"047798ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"042369ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04e26aca341290\",\n        \"type\": \"BLUE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044998ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B1\",\n      \"hbw\": \"SVR5H85409\"\n    }\n  ]\n}\n",
        "x": 1290,
        "y": 1480,
        "wires": [
            [
                "dbf9f9098da52989"
            ]
        ]
    },
    {
        "id": "cdff521723bb36c4",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Fill Hbw",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1120,
        "y": 1480,
        "wires": [
            [
                "30f3cc158e9df50b"
            ]
        ]
    },
    {
        "id": "dbf9f9098da52989",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Convert_HBW_State",
        "func": "msg.topic = \"/j1/txt/1/f/i/stock\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "342c44beda33923e",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Convert_DPS_Color",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 1680,
        "wires": [
            [
                "9bdebb48c7abef48"
            ]
        ]
    },
    {
        "id": "9bdebb48c7abef48",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1690,
        "y": 1680,
        "wires": []
    },
    {
        "id": "b7a0b84b388ead5e",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "choise_color",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"action\": {\n    \"command\": \"RGB_NFC\",\n    \"metadata\": {\n      \"type\": \"BLUE\"\n    }\n  }\n}\n",
        "x": 1270,
        "y": 1680,
        "wires": [
            [
                "342c44beda33923e"
            ]
        ]
    },
    {
        "id": "18cd81e7f798c304",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger color ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1090,
        "y": 1680,
        "wires": [
            [
                "b7a0b84b388ead5e"
            ]
        ]
    },
    {
        "id": "a8a898253eced251",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1410,
        "y": 3180,
        "wires": []
    },
    {
        "id": "527972f4a92e02e4",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DRILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 3320,
        "wires": [
            [
                "a8a898253eced251"
            ]
        ]
    },
    {
        "id": "0c7133cb010d7700",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DRILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 3360,
        "wires": [
            [
                "a8a898253eced251"
            ]
        ]
    },
    {
        "id": "ee747a609d045dae",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DRILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 3360,
        "wires": [
            [
                "a8a898253eced251"
            ]
        ]
    },
    {
        "id": "d7a6ca9e476ef884",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 370,
        "y": 3440,
        "wires": [
            [
                "79f7ade3510ac825"
            ]
        ]
    },
    {
        "id": "79f7ade3510ac825",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start pick",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DRILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 600,
        "y": 3440,
        "wires": [
            [
                "527972f4a92e02e4"
            ]
        ]
    },
    {
        "id": "2b11b7feae3bdf75",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 850,
        "y": 3560,
        "wires": [
            [
                "7306289c6371d302"
            ]
        ]
    },
    {
        "id": "7306289c6371d302",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drill",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DRILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 4,\n  \"action\": {\n    \"id\": \"action-0002\",\n    \"command\": \"DRILL\",\n      \"metadata\": {   \n    \"duration\": 20,                      \n    \"type\":  \"BLUE\"                  \n   }\n    \n  }\n\n}\n",
        "x": 1040,
        "y": 3560,
        "wires": [
            [
                "0c7133cb010d7700"
            ]
        ]
    },
    {
        "id": "33895939ac0fac56",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1410,
        "y": 3640,
        "wires": [
            [
                "ac5e3d72a958cb86"
            ]
        ]
    },
    {
        "id": "ac5e3d72a958cb86",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drop",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DRILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 5,\n  \"action\": {\n    \"id\": \"action-0003\",\n    \"command\": \"DROP\"\n    \n  },\n  \"metadata\": {                      \n    \"type\":  \"BLUE\"                  \n   }\n}",
        "x": 1600,
        "y": 3640,
        "wires": [
            [
                "ee747a609d045dae"
            ]
        ]
    },
    {
        "id": "395ffbf90016eb9f",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1290,
        "y": 4120,
        "wires": []
    },
    {
        "id": "ee78e640e53eb214",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/MILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 4260,
        "wires": [
            [
                "395ffbf90016eb9f"
            ]
        ]
    },
    {
        "id": "64e9197b23f5d87a",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/MILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 4300,
        "wires": [
            [
                "395ffbf90016eb9f"
            ]
        ]
    },
    {
        "id": "a0f48e427a8fd6a5",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/MILL001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 4300,
        "wires": [
            [
                "395ffbf90016eb9f"
            ]
        ]
    },
    {
        "id": "2e20d8e0a7c86582",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 410,
        "y": 4480,
        "wires": [
            [
                "b74628d08cd1fc70"
            ]
        ]
    },
    {
        "id": "b74628d08cd1fc70",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start pick",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"MILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 480,
        "y": 4380,
        "wires": [
            [
                "ee78e640e53eb214"
            ]
        ]
    },
    {
        "id": "c44d2d5b493edc45",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 730,
        "y": 4500,
        "wires": [
            [
                "38012d768419d9b4"
            ]
        ]
    },
    {
        "id": "38012d768419d9b4",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start mill",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"MILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 4,\n  \"action\": {\n    \"id\": \"action-0002\",\n    \"command\": \"MILL\",\n      \"metadata\": {   \n    \"duration\": 20,                      \n    \"type\":  \"BLUE\"                  \n   }\n    \n  }\n\n}\n",
        "x": 920,
        "y": 4500,
        "wires": [
            [
                "64e9197b23f5d87a"
            ]
        ]
    },
    {
        "id": "859fd00f2fd7d369",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1290,
        "y": 4580,
        "wires": [
            [
                "b28a8f1373623d8d"
            ]
        ]
    },
    {
        "id": "b28a8f1373623d8d",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drop",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"MILL001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 5,\n  \"action\": {\n    \"id\": \"action-0003\",\n    \"command\": \"DROP\"\n    \n  },\n  \"metadata\": {                      \n    \"type\":  \"BLUE\"                  \n   }\n}",
        "x": 1480,
        "y": 4580,
        "wires": [
            [
                "a0f48e427a8fd6a5"
            ]
        ]
    },
    {
        "id": "e73e30df373ce975",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1230,
        "y": 4740,
        "wires": []
    },
    {
        "id": "57f60aa51adbc15b",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/AIQS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 4880,
        "wires": [
            [
                "e73e30df373ce975"
            ]
        ]
    },
    {
        "id": "f3f4910f4ba8db74",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/AIQS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 4920,
        "wires": [
            [
                "e73e30df373ce975"
            ]
        ]
    },
    {
        "id": "760a9e93896b01d6",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 5100,
        "wires": [
            [
                "8e80488b2e8d8d43"
            ]
        ]
    },
    {
        "id": "8e80488b2e8d8d43",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start pick",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"AIQS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 420,
        "y": 5000,
        "wires": [
            [
                "57f60aa51adbc15b"
            ]
        ]
    },
    {
        "id": "18a29247ce39d3aa",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1230,
        "y": 5200,
        "wires": [
            [
                "9687ed8b26e1a360"
            ]
        ]
    },
    {
        "id": "9687ed8b26e1a360",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drop",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"AIQS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 100,\n  \"action\": {\n    \"id\": \"action-0003\",\n    \"command\": \"DROP\"\n    \n  },\n  \"metadata\": {                      \n    \"type\":  \"BLUE\"                  \n   }\n}",
        "x": 1420,
        "y": 5200,
        "wires": [
            [
                "f3f4910f4ba8db74"
            ]
        ]
    },
    {
        "id": "d912604c913433c2",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/AIQS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 5100,
        "wires": [
            [
                "e73e30df373ce975"
            ]
        ]
    },
    {
        "id": "311017c5b9be95d9",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 5440,
        "wires": [
            [
                "f9d7031713e7dac0"
            ]
        ]
    },
    {
        "id": "f9d7031713e7dac0",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "check quality command",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"AIQS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"CHECK_QUALITY\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 750,
        "y": 5260,
        "wires": [
            [
                "d912604c913433c2"
            ]
        ]
    },
    {
        "id": "30d6481af06edf75",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 570,
        "y": 5660,
        "wires": []
    },
    {
        "id": "44ea1fb4bbdd545a",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/AIQS001/state\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 5660,
        "wires": [
            [
                "30d6481af06edf75"
            ]
        ]
    },
    {
        "id": "16094e76887f835b",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "good piece",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"AIQS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"actionState\": {\n    \"id\": \"action-0001\",\n    \"result\": \"PASSED\",\n    \"state\":\"FINISHED\",\n    \"command\":\"CHECK_QUALITY\"\n  }\n\n}",
        "x": 170,
        "y": 5640,
        "wires": [
            [
                "44ea1fb4bbdd545a"
            ]
        ]
    },
    {
        "id": "f85651cd7230236a",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 5540,
        "wires": [
            [
                "16094e76887f835b"
            ]
        ]
    },
    {
        "id": "921c5f052390d3ba",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "Bad Piece",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"AIQS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"result\":\"FAILED\",\n    \"command\": \"PICK\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 250,
        "y": 5860,
        "wires": [
            [
                "83532ab3b03df26a"
            ]
        ]
    },
    {
        "id": "60809b62adccb331",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 5980,
        "wires": [
            [
                "921c5f052390d3ba"
            ]
        ]
    },
    {
        "id": "c97015235a6023ff",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 910,
        "y": 5920,
        "wires": []
    },
    {
        "id": "83532ab3b03df26a",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/AIQS001/state\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 5920,
        "wires": [
            [
                "c97015235a6023ff"
            ]
        ]
    },
    {
        "id": "2546ce614b5dd1ba",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt not retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 1330,
        "y": 6240,
        "wires": []
    },
    {
        "id": "6c5ed27094aad0e6",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/HBW001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 6380,
        "wires": [
            [
                "2546ce614b5dd1ba"
            ]
        ]
    },
    {
        "id": "dc51506961584ce0",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/HBW001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 6420,
        "wires": [
            [
                "2546ce614b5dd1ba"
            ]
        ]
    },
    {
        "id": "a62f415fbb8c7fa0",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 430,
        "y": 6600,
        "wires": [
            [
                "37f0ce986ed6343a"
            ]
        ]
    },
    {
        "id": "37f0ce986ed6343a",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start pick process",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"HBW001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n    \"rackPosition\":\"A2\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 530,
        "y": 6500,
        "wires": [
            [
                "6c5ed27094aad0e6"
            ]
        ]
    },
    {
        "id": "ab42538262de4e9e",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 750,
        "y": 6620,
        "wires": [
            [
                "9a484b418b427d70"
            ]
        ]
    },
    {
        "id": "9a484b418b427d70",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drop process",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"HBW001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"DROP\",\n    \"rackPosition\":\"A2\",\n\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n    \n  }\n\n}",
        "x": 970,
        "y": 6620,
        "wires": [
            [
                "dc51506961584ce0"
            ]
        ]
    },
    {
        "id": "c1a68d270abb1005",
        "type": "mqtt out",
        "z": "e25f4966a4da0bd8",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 1250,
        "y": 7500,
        "wires": []
    },
    {
        "id": "544c08e035172150",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DPS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 7640,
        "wires": [
            [
                "c1a68d270abb1005"
            ]
        ]
    },
    {
        "id": "cbfb0156f3354725",
        "type": "function",
        "z": "e25f4966a4da0bd8",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DPS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 7680,
        "wires": [
            [
                "c1a68d270abb1005"
            ]
        ]
    },
    {
        "id": "3575b2f817756167",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 370,
        "y": 7860,
        "wires": [
            [
                "a5b2a68861acd701"
            ]
        ]
    },
    {
        "id": "a5b2a68861acd701",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start pick process dps",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DPS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n  }\n\n}",
        "x": 480,
        "y": 7760,
        "wires": [
            [
                "544c08e035172150"
            ]
        ]
    },
    {
        "id": "b64c8264207e3e44",
        "type": "inject",
        "z": "e25f4966a4da0bd8",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 690,
        "y": 7880,
        "wires": [
            [
                "7268da13c338ab41"
            ]
        ]
    },
    {
        "id": "7268da13c338ab41",
        "type": "data-generator",
        "z": "e25f4966a4da0bd8",
        "name": "start drop process",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DPS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"DROP\",\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n  }\n\n}",
        "x": 910,
        "y": 7880,
        "wires": [
            [
                "cbfb0156f3354725"
            ]
        ]
    },
    {
        "id": "fc327a28ca924b9a",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "dps",
        "info": "",
        "x": 170,
        "y": 7440,
        "wires": []
    },
    {
        "id": "5cdf2156a5f58ec7",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "hbw",
        "info": "",
        "x": 310,
        "y": 6280,
        "wires": []
    },
    {
        "id": "2f0d3b4b2982e104",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "quality",
        "info": "",
        "x": 290,
        "y": 4720,
        "wires": []
    },
    {
        "id": "88b9fabd11041c78",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "mill",
        "info": "",
        "x": 390,
        "y": 3980,
        "wires": []
    },
    {
        "id": "67ccda67ab6748d5",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "drill",
        "info": "",
        "x": 370,
        "y": 3040,
        "wires": []
    },
    {
        "id": "6b5943e5cfa1b901",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "store hbw",
        "info": "",
        "x": 980,
        "y": 1400,
        "wires": []
    },
    {
        "id": "762e22ed9f108c70",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "color",
        "info": "",
        "x": 1010,
        "y": 1760,
        "wires": []
    },
    {
        "id": "122b16e203517481",
        "type": "comment",
        "z": "e25f4966a4da0bd8",
        "name": "agv",
        "info": "",
        "x": 570,
        "y": 180,
        "wires": []
    },
    {
        "id": "29819a58acef789f",
        "type": "OPCUA-IIoT-Listener",
        "z": "e1de889cd6928bd7",
        "connector": "061fc1a8298650a8",
        "action": "subscribe",
        "queueSize": "30",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 600,
        "y": 440,
        "wires": [
            [
                "4dd20b720b52a24d"
            ]
        ]
    },
    {
        "id": "a624e1520108b3d7",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "vda_status_finished PICK",
        "func": "const nodeValue = msg.payload.value.value.value;\nconst moduleStsate = flow.get(\"moduleState\");\nif (nodeValue == true && moduleStsate == \"RPICK\") {\n    const state = flow.get(\"state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"headerId\");\n    const actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\"; // Waiting for FTS\n\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = flow.get(\"actionState\");\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n    flow.set(\"orderId\", 0);\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"moduleState\", \"IDLE\");\n\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n} else {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 480,
        "wires": [
            [
                "4a529720bbcc2180"
            ]
        ]
    },
    {
        "id": "4dd20b720b52a24d",
        "type": "switch",
        "z": "e1de889cd6928bd7",
        "name": "topicswitch",
        "property": "payload.nodeId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ns=4;i=247",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=243",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 440,
        "wires": [
            [
                "86b4995d7b24ae20"
            ],
            [
                "a624e1520108b3d7"
            ]
        ],
        "outputLabels": [
            "drop_finished",
            "pick_finished"
        ]
    },
    {
        "id": "86b4995d7b24ae20",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "vda_status_finished DROP",
        "func": "const nodeValue = msg.payload.value.value.value;\nconst moduleState = flow.get(\"moduleState\");\nif (nodeValue == true && moduleState == \"RDROP\") {\n    const state = flow.get(\"state\");\n    const timestamp = new Date().toISOString();\n    const headerId = flow.get(\"headerId\");\n    const actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\";\n    // get the workpieceId from the flow state (set during initial determination of the rack position)\n    let workpieceId = flow.get(\"workpieceId\");\n    // unknown should never happen if a workpiece is introduced via DPS\n    actionState.result = workpieceId ?? \"unknown\"; \n\n\n    // state\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n    flow.set(\"orderId\", 0);\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"moduleState\", \"IDLE\");\n    flow.set(\"workpieceId\", undefined);\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n\n\n    \n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n\n\n    msg.payload = state;\n    return msg;\n} else {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 440,
        "wires": [
            [
                "4a529720bbcc2180"
            ]
        ]
    },
    {
        "id": "b8c12a90dbcce9aa",
        "type": "OPCUA-IIoT-Inject",
        "z": "e1de889cd6928bd7",
        "injectType": "inject",
        "payload": "{\"interval\":100}",
        "payloadType": "json",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "10",
        "name": "hbw",
        "addressSpaceItems": [
            {
                "name": "DROP finsih",
                "nodeId": "ns=4;i=247",
                "datatypeName": ""
            },
            {
                "name": "pick finish",
                "nodeId": "ns=4;i=243",
                "datatypeName": ""
            }
        ],
        "x": 270,
        "y": 440,
        "wires": [
            [
                "29819a58acef789f"
            ]
        ]
    },
    {
        "id": "4a529720bbcc2180",
        "type": "link out",
        "z": "e1de889cd6928bd7",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2085,
        "y": 520,
        "wires": []
    },
    {
        "id": "280aac3d203aa982",
        "type": "inject",
        "z": "e1de889cd6928bd7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 330,
        "y": 100,
        "wires": [
            [
                "e8b7d429d18686cb"
            ]
        ]
    },
    {
        "id": "e8b7d429d18686cb",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "variable setup",
        "func": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"HBW\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"HBW\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"hbw\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"HBW001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/HBW001\"); // Added for consistency",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"HBW\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"HBW\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"hbw\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"HBW001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/HBW001\"); // Added for consistency",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "d31fc585b549d87c",
        "type": "mqtt out",
        "z": "e1de889cd6928bd7",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 1150,
        "y": 860,
        "wires": []
    },
    {
        "id": "e37ddc571c7859fe",
        "type": "data-generator",
        "z": "e1de889cd6928bd7",
        "name": "fill hbw",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"ts\": \"2025-02-28T09:55:45.982Z\",\n  \"stockItems\": [\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04d998ca341290\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044768ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"047798ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"042369ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04e26aca341290\",\n        \"type\": \"BLUE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044998ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B1\",\n      \"hbw\": \"SVR5H85409\"\n    }\n  ]\n}\n",
        "x": 530,
        "y": 860,
        "wires": [
            [
                "da84e4c3c02ced7a"
            ]
        ]
    },
    {
        "id": "6828306fa4644cb2",
        "type": "inject",
        "z": "e1de889cd6928bd7",
        "name": "Trigger Fill Hbw",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 860,
        "wires": [
            [
                "e37ddc571c7859fe"
            ]
        ]
    },
    {
        "id": "da84e4c3c02ced7a",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "Convert_HBW_State",
        "func": "msg.topic = \"/j1/txt/1/f/i/stock\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 860,
        "wires": [
            [
                "d31fc585b549d87c"
            ]
        ]
    },
    {
        "id": "fbefb534ec136259",
        "type": "OPCUA-IIoT-Inject",
        "z": "e1de889cd6928bd7",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=116",
                "datatypeName": "String"
            },
            {
                "name": "version",
                "nodeId": "ns=4;i=315",
                "datatypeName": "String"
            }
        ],
        "x": 290,
        "y": 280,
        "wires": [
            [
                "118d95583aaf6422"
            ]
        ]
    },
    {
        "id": "118d95583aaf6422",
        "type": "OPCUA-IIoT-Read",
        "z": "e1de889cd6928bd7",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "061fc1a8298650a8",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 550,
        "y": 280,
        "wires": [
            [
                "9ad94bab6c5e8c9a"
            ]
        ]
    },
    {
        "id": "9ad94bab6c5e8c9a",
        "type": "subflow:4a591b1ca8fe0bf6",
        "z": "e1de889cd6928bd7",
        "name": "",
        "x": 830,
        "y": 280,
        "wires": [
            [
                "062252aac45bdebf"
            ],
            [],
            [
                "1e0f03f14a59d9df"
            ]
        ]
    },
    {
        "id": "062252aac45bdebf",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "Order Handling",
        "func": "if (flow.get(\"orderId\") == msg.payload.orderId || flow.get(\"orderId\") == \"0\") {\n    // orderId im Flow speichern\n    flow.set(\"orderId\", msg.payload.orderId);\n\n    // orderUpdateId Fallunterscheidung\n    if (1==1) {\n        // duration in actionState\n        let actionState = flow.get(\"actionState\");\n        actionState.command = msg.payload.action.command;\n        actionState.id = msg.payload.action.id;\n\n        if (actionState.command == \"PICK\") {\n            // ModulState busy setzen\n         flow.set(\"moduleState\", \"RPICK\"); // modulestate zu \"RUNNING PICK\" setzen\n\n            flow.set(\"actionState\", msg.payload.action);\n\n\n            \n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=245\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"String\",\n                        value: msg.payload.action.rackPosition\n                    },\n                    {\n                        nodeId: \"ns=4;i=244\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n            \n        } else if (actionState.command == \"DROP\" ) {\n            // ModulState busy setzen\n            flow.set(\"moduleState\", \"RDROP\");\n\n            \n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=248\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"String\",\n                        value:msg.payload.action.rackPosition\n                    },\n                    {\n                        nodeId: \"ns=4;i=249\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;        \n        } else {\n            const flowErrors = flow.get(\"errors\") ?? [];\n            const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n            let error = {\n                \"errorType\": \"Validation\",\n                \"errorLevel\": \"WARNING\",\n                \"errorReferences\": [\n                    { \"topic\": \"order\" },\n                    { \"headerId\": flow.get(\"headerId\") },\n                    { \"orderId\": msg.payload.orderId },\n                    { \"orderUpdateId\": msg.payload.orderUpdateId }\n                ],\n                \"errorMessage\": \"OrderId not valid\"\n            }\n            // Error in Flow\n            flow.set(\"errors\", [...errors, error]);\n            return [null, msg];\n        }\n    }\n\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 260,
        "wires": [
            [
                "e346eb2aaf61bbd4"
            ],
            []
        ]
    },
    {
        "id": "e346eb2aaf61bbd4",
        "type": "OPCUA-IIoT-Write",
        "z": "e1de889cd6928bd7",
        "connector": "061fc1a8298650a8",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 1390,
        "y": 260,
        "wires": [
            [
                "f65efbeaf56dc125"
            ]
        ]
    },
    {
        "id": "f65efbeaf56dc125",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "Publish vda_status_RUNNING",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n//state bauen\nlet headerId = flow.get(\"headerId\");\nlet actionState = flow.get(\"actionState\");\nactionState.id = msg.actionId ?? actionState.id;\nlet state = flow.get(\"state\");\n\nactionState.state = \"RUNNING\";\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\nmsg.payload = state;\n\n// flowVariable Update\nflow.set(\"headerId\", headerId + 1);\nflow.set(\"errors\", null);\n\n\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState = moduleState;\n\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 260,
        "wires": [
            [
                "1e0f03f14a59d9df"
            ]
        ]
    },
    {
        "id": "1e0f03f14a59d9df",
        "type": "link out",
        "z": "e1de889cd6928bd7",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2205,
        "y": 300,
        "wires": []
    },
    {
        "id": "52e620145c6cbe0e",
        "type": "function",
        "z": "e1de889cd6928bd7",
        "name": "Collect Flow State",
        "func": "const debugState = {\n    flowName: flow.get(\"flowName\"),\n    moduleState: flow.get(\"moduleState\"),\n    orderUpdateId: flow.get(\"orderUpdateId\"),\n    orderId: flow.get(\"orderId\"),\n    loads: flow.get(\"loads\"),\n    headerId: flow.get(\"headerId\"),\n    actionState: flow.get(\"actionState\"),\n    model: flow.get(\"model\"),\n    errors: flow.get(\"errors\"),\n    state: flow.get(\"state\"),\n    factsheet: flow.get(\"factsheet\"),\n    connection: flow.get(\"connection\"),\n    opcuaState: flow.get(\"opcuaState\"),\n    mqtt_topic: flow.get(\"MQTT_topic\")\n};\n\nmsg.payload = debugState;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 660,
        "wires": [
            [
                "5f0278276dca6b9c"
            ]
        ]
    },
    {
        "id": "5f0278276dca6b9c",
        "type": "debug",
        "z": "e1de889cd6928bd7",
        "name": "Debug Flow Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 660,
        "wires": []
    },
    {
        "id": "d7e2f190e743d3c6",
        "type": "inject",
        "z": "e1de889cd6928bd7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 290,
        "y": 660,
        "wires": [
            [
                "52e620145c6cbe0e"
            ]
        ]
    },
    {
        "id": "105770bf76ec0db4",
        "type": "subflow:468f2460ce66f11e",
        "z": "e1de889cd6928bd7",
        "name": "",
        "x": 1630,
        "y": 100,
        "wires": [
            [
                "1e0f03f14a59d9df"
            ]
        ]
    },
    {
        "id": "de2d4096cb5b8fcd",
        "type": "OPCUA-IIoT-Inject",
        "z": "e1de889cd6928bd7",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=116",
                "datatypeName": "String"
            }
        ],
        "x": 1170,
        "y": 100,
        "wires": [
            [
                "d8c4db2ad9496dc3",
                "105770bf76ec0db4"
            ]
        ]
    },
    {
        "id": "d8c4db2ad9496dc3",
        "type": "OPCUA-IIoT-Read",
        "z": "e1de889cd6928bd7",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "484db7503e21eb9d",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 1390,
        "y": 60,
        "wires": [
            [
                "105770bf76ec0db4"
            ]
        ]
    },
    {
        "id": "9d1c7b185b062b08",
        "type": "mqtt out",
        "z": "b097a95f4a4d5fd0",
        "name": "mqtt not retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1410,
        "y": 200,
        "wires": []
    },
    {
        "id": "89d218489b77c207",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 340,
        "wires": [
            [
                "9d1c7b185b062b08"
            ]
        ]
    },
    {
        "id": "602f416d84a07edc",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 380,
        "wires": [
            [
                "9d1c7b185b062b08"
            ]
        ]
    },
    {
        "id": "f2d7aca3ae4c8639",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1700,
        "y": 380,
        "wires": [
            [
                "9d1c7b185b062b08"
            ]
        ]
    },
    {
        "id": "26cc5b8a5627c9ac",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 460,
        "wires": [
            [
                "872d8b931306e890"
            ]
        ]
    },
    {
        "id": "872d8b931306e890",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "INPUT RGB",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "  {\n    \"timestamp\": \"2025-02-28T09:54:41.724Z\",\n    \"orderId\": \"0ed8e450-4348-4dfd-8e6a-74eb535c135b\",\n    \"orderUpdateId\": 1,\n    \"action\": {\n      \"id\": \"0ed8e450-4348-4dfd-8e6a-74eb535c135b\",\n      \"command\": \"INPUT_RGB\",\n      \"metadata\": {}\n    }\n  }",
        "x": 590,
        "y": 460,
        "wires": [
            [
                "89d218489b77c207"
            ]
        ]
    },
    {
        "id": "25ca87983c70bc9d",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 830,
        "y": 580,
        "wires": [
            [
                "d507efa115945178"
            ]
        ]
    },
    {
        "id": "d507efa115945178",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "RGB_NFC",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:18.130Z\",\n  \"serialNumber\": \"SVR4PW6408\",\n  \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdateId\": 1,\n  \"action\": {\n    \"command\": \"RGB_NFC\",\n    \"metadata\": {\n      \"type\": \"BLUE\"\n    }\n  }\n}\n",
        "x": 1030,
        "y": 580,
        "wires": [
            [
                "602f416d84a07edc"
            ]
        ]
    },
    {
        "id": "7d528d52997ab1cc",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1390,
        "y": 660,
        "wires": [
            [
                "d39582859dea0e83"
            ]
        ]
    },
    {
        "id": "d39582859dea0e83",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "drop_to_avg",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "  {\n    \"timestamp\": \"2025-02-28T09:55:18.130Z\",\n    \"serialNumber\": \"SVR4PW6408\",\n    \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n    \"orderUpdateId\": 1,\n    \"action\": {\n      \"id\": \"b2496c1a-60f1-4fc6-9ec2-03c4c6be67ab\",\n      \"command\": \"DROP\",\n      \"metadata\": {\n        \"workpiece\": {\n          \"workpieceId\": \"043169ca341290\",\n          \"type\": \"BLUE\",\n          \"history\": [],\n          \"state\": \"PROCESSED\"\n        }\n      }\n    }\n  }",
        "x": 1590,
        "y": 660,
        "wires": [
            [
                "f2d7aca3ae4c8639"
            ]
        ]
    },
    {
        "id": "9c4f46d12a97d11f",
        "type": "comment",
        "z": "b097a95f4a4d5fd0",
        "name": "drop logic ",
        "info": "",
        "x": 320,
        "y": 120,
        "wires": []
    },
    {
        "id": "14358bb89257dc08",
        "type": "comment",
        "z": "b097a95f4a4d5fd0",
        "name": "pick",
        "info": "",
        "x": 330,
        "y": 780,
        "wires": []
    },
    {
        "id": "5fab9e85a2e1caf1",
        "type": "mqtt out",
        "z": "b097a95f4a4d5fd0",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1490,
        "y": 840,
        "wires": []
    },
    {
        "id": "e3802e9ad85cf3d7",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 980,
        "wires": [
            [
                "5fab9e85a2e1caf1"
            ]
        ]
    },
    {
        "id": "a04782b160c953e9",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 1020,
        "wires": [
            [
                "5fab9e85a2e1caf1"
            ]
        ]
    },
    {
        "id": "e7283abc26f5978c",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 930,
        "y": 1220,
        "wires": [
            [
                "523dec7d68c04be8"
            ]
        ]
    },
    {
        "id": "523dec7d68c04be8",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "pick",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "\n  {\n    \"timestamp\": \"2025-02-28T09:55:18.130Z\",\n    \"serialNumber\": \"SVR4PW6408\",\n    \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n    \"orderUpdateId\": 1,\n    \"action\": {\n      \"id\": \"b2496c1a-60f1-4fc6-9ec2-03c4c6be67ab\",\n      \"command\": \"PICK\",\n      \"metadata\": {\n        \"workpiece\": {\n          \"workpieceId\": \"043169ca341290\",\n          \"type\": \"BLUE\",\n          \"history\": [],\n          \"state\": \"PROCESSED\"\n        }\n      }\n    }\n  }\n",
        "x": 1110,
        "y": 1220,
        "wires": [
            [
                "a04782b160c953e9"
            ]
        ]
    },
    {
        "id": "70cc54576c794c7d",
        "type": "OPCUA-IIoT-Inject",
        "z": "b097a95f4a4d5fd0",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            },
            {
                "name": "version",
                "nodeId": "ns=4;i=51",
                "datatypeName": "String"
            }
        ],
        "x": 150,
        "y": 1740,
        "wires": [
            [
                "b4d94f418172a3f7"
            ]
        ]
    },
    {
        "id": "b4d94f418172a3f7",
        "type": "OPCUA-IIoT-Read",
        "z": "b097a95f4a4d5fd0",
        "attributeId": "0",
        "maxAge": "1000",
        "depth": 1,
        "connector": "",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 410,
        "y": 1740,
        "wires": [
            [
                "17c745941778d2a2"
            ]
        ]
    },
    {
        "id": "17c745941778d2a2",
        "type": "subflow:4a591b1ca8fe0bf6",
        "z": "b097a95f4a4d5fd0",
        "name": "",
        "x": 660,
        "y": 1740,
        "wires": [
            [
                "e0372d20f6d47e39"
            ],
            [],
            [
                "ed5e95c71779bfd7"
            ]
        ]
    },
    {
        "id": "e0372d20f6d47e39",
        "type": "switch",
        "z": "b097a95f4a4d5fd0",
        "name": "orderswitch",
        "property": "payload.action.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "PICK",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "DROP",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1310,
        "y": 1680,
        "wires": [
            [
                "f678292721101920"
            ],
            [
                "e0422cabfa6fe12a"
            ]
        ]
    },
    {
        "id": "f678292721101920",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "PICK",
        "func": "// wenn nicht IDLE dann nichts tun\nif (flow.get(\"moduleState\") == \"IDLE\" ) {\n    node.status({fill:\"green\",shape:\"ring\",text:\"PICK\"});\n    // ModulState busy setzen\n    flow.set(\"moduleState\", \"BUSY\");\n\n\n    let moduleState = flow.get(\"moduleState\");\n    msg.moduleState =moduleState;\n\n\n    flow.set(\"actionState\", msg.payload.action);\n\n    let actionState = flow.get(\"moduleState\");\n\n    msg.actionState = actionState;\n\n    \n\n    return [msg, null];\n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Module is not IDLE\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 1600,
        "wires": [
            [
                "5272ed5085e15c23",
                "d462e47c0173e491"
            ],
            []
        ]
    },
    {
        "id": "e0422cabfa6fe12a",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "DROP",
        "func": "if (flow.get(\"moduleState\") == \"IDLE\") {\n    node.status({fill:\"green\",shape:\"ring\",text:\"DROP\"});\n    // ModulState busy setzen\n    flow.set(\"moduleState\", \"BUSY\");\n\n\n    let moduleState = flow.get(\"moduleState\");\n    msg.moduleState = moduleState;\n\n\n\n    flow.set(\"actionState\", msg.payload.action);\n\n    let actionState = flow.get(\"moduleState\");\n\n    msg.actionState = actionState;\n\n    \n    return [msg, null];\n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Internal modulestate does not accept DROP\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 1780,
        "wires": [
            [
                "5272ed5085e15c23",
                "d462e47c0173e491"
            ],
            []
        ]
    },
    {
        "id": "5272ed5085e15c23",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Publish vda_status_RUNNING",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.state = state;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"RUNNING\");\n\n// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\n\n\n// flowVariable Update\nflow.set(\"errors\", {});\nflow.set(\"headerId\", state.headerId + 1);\n\n\n\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState =moduleState;\n\n\nmsg.payload = state;\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2170,
        "y": 1620,
        "wires": [
            [
                "ed5e95c71779bfd7"
            ]
        ]
    },
    {
        "id": "d462e47c0173e491",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "send-order-to-txt",
        "func": "/** @type {string} */\nconst txtTopicBase = flow.get(\"TXT_MQTT_topic\");\n/** @type {string} */\nconst spsSerial = flow.get(\"serialNumber\");\nmsg.topic = `${txtTopicBase}/triggerorder`;\nmsg.payload.serialNumber = spsSerial;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2160,
        "y": 1540,
        "wires": [
            [
                "0a105943644fd5f8"
            ]
        ]
    },
    {
        "id": "0a105943644fd5f8",
        "type": "link out",
        "z": "b097a95f4a4d5fd0",
        "name": "mqtt-not-retained",
        "mode": "link",
        "links": [
            "2cf6c7eff0bc4658"
        ],
        "x": 2405,
        "y": 1560,
        "wires": []
    },
    {
        "id": "ed5e95c71779bfd7",
        "type": "link out",
        "z": "b097a95f4a4d5fd0",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2405,
        "y": 1660,
        "wires": []
    },
    {
        "id": "deb97fbf9c4ddabd",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Collect Flow State",
        "func": "const debugState = {\n    flowName: flow.get(\"flowName\"),\n    moduleState: flow.get(\"moduleState\"),\n    orderUpdateId: flow.get(\"orderUpdateId\"),\n    orderId: flow.get(\"orderId\"),\n    loads: flow.get(\"loads\"),\n    headerId: flow.get(\"headerId\"),\n    actionState: flow.get(\"actionState\"),\n    model: flow.get(\"model\"),\n    errors: flow.get(\"errors\"),\n    state: flow.get(\"state\"),\n    factsheet: flow.get(\"factsheet\"),\n    connection: flow.get(\"connection\"),\n    opcuaState: flow.get(\"opcuaState\"),\n    mqtt_topic: flow.get(\"MQTT_topic\"),\n    txt_topic: flow.get(\"TXT_MQTT_topic\")\n};\n\nmsg.payload = debugState;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1540,
        "wires": [
            [
                "e8da4989d7ab90c5"
            ]
        ]
    },
    {
        "id": "e8da4989d7ab90c5",
        "type": "debug",
        "z": "b097a95f4a4d5fd0",
        "name": "Debug Flow Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 1540,
        "wires": []
    },
    {
        "id": "62242dbf1d767748",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1540,
        "wires": [
            [
                "deb97fbf9c4ddabd"
            ]
        ]
    },
    {
        "id": "69c06d3ff1386ad0",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n    \"headerId\": 1,\n    \"timestamp\": \"<replace_in_vda5050>\",\n    \"version\": \"1.6.0+gitc321c85\",\n    \"manufacturer\": \"Fischertechnik\",\n    \"serialNumber\": \"<replace_in_vda5050>\",\n    \"typeSpecification\": {\n        \"seriesName\": \"MOD-FF22+DPS\",\n        \"moduleClass\": \"DPS\"\n    },\n    \"physicalParameters\": {},\n    \"protocolLimits\": {},\n    \"protocolFeatures\": {\n        \"moduleActions\": [\n            {\n                \"actionType\": \"DROP\",\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"type\",\n                        \"parameterType\": \"string\",\n                        \"parameterDescription\": \"The load type to input\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"PICK\",\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"type\",\n                        \"parameterType\": \"string\",\n                        \"parameterDescription\": \"The load type to output\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"startCalibration\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ]\n            },\n            {\n                \"actionType\": \"stopCalibration\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ]\n            },\n            {\n                \"actionType\": \"setCalibrationValues\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"references\",\n                        \"parameterType\": \"array\",\n                        \"parameterDescription\": \"Array of ReferenceValues objects with referenceKey and referenceValue\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"storeCalibrationValues\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"references\",\n                        \"parameterType\": \"array\",\n                        \"parameterDescription\": \"Array of ReferenceValues objects with referenceKey and referenceValue\",\n                        \"isOptional\": true\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"selectCalibrationPosition\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"position\",\n                        \"parameterType\": \"string\",\n                        \"parameterDescription\": \"Position to select\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"testCalibrationPosition\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"position\",\n                        \"parameterType\": \"string\",\n                        \"parameterDescription\": \"Position to test\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"resetCalibration\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"factory\",\n                        \"parameterType\": \"boolean\",\n                        \"parameterDescription\": \"Reset to factory defaults\",\n                        \"isOptional\": true\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"announceOutput\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ],\n                \"actionParameters\": [\n                    {\n                        \"parameterName\": \"orderId\",\n                        \"parameterType\": \"string\",\n                        \"parameterDescription\": \"The orderId that will deliver the workpiece to output\"\n                    }\n                ]\n            },\n            {\n                \"actionType\": \"cancelStorageOrder\",\n                \"actionScopes\": [\n                    \"INSTANT\"\n                ]\n            }\n        ],\n        \"moduleParameters\": {\n            \"clearModuleOnPick\": true\n        }\n    },\n    \"localizationParameters\": {},\n    \"loadSpecification\": {\n        \"loadSets\": [\n            {\n                \"setName\": \"WHITES\",\n                \"loadType\": \"WHITE\"\n            },\n            {\n                \"setName\": \"REDS\",\n                \"loadType\": \"RED\"\n            },\n            {\n                \"setName\": \"BLUES\",\n                \"loadType\": \"BLUE\"\n            }\n        ]\n    }\n}\n",
        "x": 140,
        "y": 1460,
        "wires": [
            [
                "6ca863c364fdb6d2"
            ]
        ]
    },
    {
        "id": "6ca863c364fdb6d2",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "variable setup",
        "func": "// Ntige Werte im Flow speichern\n\n\nflow.set(\"flowName\", \"DPS\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"DPS\");\nflow.set(\"errors\", []);\nflow.set(\"TXT_MQTT_topic\", \"module/v1/ff/NodeRed/SVR4PW6408\")\n\n\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"dps\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"DPS001\",\n    connectionState: \"ONLINE\"\n});\n\n\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/DPS001\"); ",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Ntige Werte im Flow speichern\n\n\nflow.set(\"flowName\", \"DPS\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"DPS\");\nflow.set(\"errors\", []);\nflow.set(\"TXT_MQTT_topic\", \"module/v1/ff/NodeRed/SVR4PW6408\")\n\n\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"dps\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"DPS001\",\n    connectionState: \"ONLINE\"\n});\n\n\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/DPS001\"); ",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "9817a99231312471",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "internal state txt",
        "func": "msg.topic = flow.get(\"TXT_MQTT_topic\") + \"/state\";\nmsg.action = \"subscribe\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 2260,
        "wires": [
            [
                "2f58e5f3adce36d0"
            ]
        ]
    },
    {
        "id": "2f58e5f3adce36d0",
        "type": "mqtt in",
        "z": "b097a95f4a4d5fd0",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 570,
        "y": 2260,
        "wires": [
            [
                "7e0f84b9ee43a110"
            ]
        ]
    },
    {
        "id": "7e0f84b9ee43a110",
        "type": "switch",
        "z": "b097a95f4a4d5fd0",
        "name": "actionState.command",
        "property": "payload.action.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "DROP",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "PICK",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 860,
        "y": 2260,
        "wires": [
            [
                "2c9d3e1c4912843c"
            ],
            [
                "2c9d3e1c4912843c"
            ]
        ]
    },
    {
        "id": "2c9d3e1c4912843c",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "forward-to-sps-state",
        "func": "\n\n/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\n\n\nflow.set(\"moduleState\", \"IDLE\");\n\n\n\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.state = state;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\n// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\n\n\n// flowVariable Update\nflow.set(\"errors\", {});\nflow.set(\"headerId\", state.headerId + 1);\n\n\n\n\n\nmsg.payload = state;\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n\n\n\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState =moduleState;\n\n\nif (actionState.command == \"DROP\") {\n    // If the successful command was drop, make sure\n    // to clear the loads.\n    const loads = [];\n    const state = flow.get(\"state\");\n    state.loads = loads;\n    flow.set(\"state\", state);\n    flow.set(\"loads\", loads);\n}\n\n\nflow.set(\"state\",state)\nmsg.payload.serialNumber = flow.get(\"serialNumber\");\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 2260,
        "wires": [
            [
                "fcef693cc1c0b541"
            ]
        ]
    },
    {
        "id": "fcef693cc1c0b541",
        "type": "link out",
        "z": "b097a95f4a4d5fd0",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 1515,
        "y": 2260,
        "wires": []
    },
    {
        "id": "6f1bf42800648035",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 1100,
        "wires": [
            [
                "8df43db230dae581"
            ]
        ]
    },
    {
        "id": "8df43db230dae581",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "INPUT RGB",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:18.130Z\",\n  \"serialNumber\": \"SVR4PW6408\",\n  \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdateId\": 1,\n  \"action\": {\n    \"command\": \"RGB_NFC\",\n    \"metadata\": {\n      \"type\": \"BLUE\"\n    }\n  }\n}\n",
        "x": 690,
        "y": 1100,
        "wires": [
            [
                "e3802e9ad85cf3d7"
            ]
        ]
    },
    {
        "id": "8429aed5fe85cd8e",
        "type": "mqtt out",
        "z": "b097a95f4a4d5fd0",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 1150,
        "y": 3460,
        "wires": []
    },
    {
        "id": "a7cdd241268e1a5d",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DPS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 3600,
        "wires": [
            [
                "8429aed5fe85cd8e"
            ]
        ]
    },
    {
        "id": "a5c5a306fdf424c9",
        "type": "function",
        "z": "b097a95f4a4d5fd0",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"module/v1/ff/DPS001/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 3640,
        "wires": [
            [
                "8429aed5fe85cd8e"
            ]
        ]
    },
    {
        "id": "04838f3a8eab0509",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 270,
        "y": 3820,
        "wires": [
            [
                "adcfba5deddf9c78"
            ]
        ]
    },
    {
        "id": "adcfba5deddf9c78",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "start pick process dps",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DPS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"PICK\",\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n  }\n\n}",
        "x": 380,
        "y": 3720,
        "wires": [
            [
                "a7cdd241268e1a5d"
            ]
        ]
    },
    {
        "id": "49d6781c64c785b8",
        "type": "inject",
        "z": "b097a95f4a4d5fd0",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 590,
        "y": 3840,
        "wires": [
            [
                "a016a59e3d760220"
            ]
        ]
    },
    {
        "id": "a016a59e3d760220",
        "type": "data-generator",
        "z": "b097a95f4a4d5fd0",
        "name": "start drop process",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"serialNumber\": \"DPS001\",\n  \"orderId\": \"0\",\n  \"orderUpdateId\": 3,\n  \"action\": {\n    \"id\": \"action-0001\",\n    \"command\": \"DROP\",\n    \"metadata\": {   \n        \"type\":  \"BLUE\"                  \n    }\n  }\n\n}",
        "x": 810,
        "y": 3840,
        "wires": [
            [
                "a5c5a306fdf424c9"
            ]
        ]
    },
    {
        "id": "ae688263c021feeb",
        "type": "OPCUA-IIoT-Read",
        "z": "b097a95f4a4d5fd0",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "46f8b2363b259b7f",
        "name": "Read serial",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 330,
        "y": 2060,
        "wires": [
            [
                "9817a99231312471"
            ]
        ]
    },
    {
        "id": "5e4b60874b60a3ed",
        "type": "OPCUA-IIoT-Inject",
        "z": "b097a95f4a4d5fd0",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            }
        ],
        "x": 110,
        "y": 2060,
        "wires": [
            [
                "ae688263c021feeb"
            ]
        ]
    },
    {
        "id": "0baf23b89a2534d2",
        "type": "subflow:468f2460ce66f11e",
        "z": "b097a95f4a4d5fd0",
        "name": "",
        "x": 2010,
        "y": 1920,
        "wires": [
            [
                "ed5e95c71779bfd7"
            ]
        ]
    },
    {
        "id": "75623f2889b3620d",
        "type": "OPCUA-IIoT-Inject",
        "z": "b097a95f4a4d5fd0",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            }
        ],
        "x": 1550,
        "y": 1920,
        "wires": [
            [
                "57578a76a7b1fe01",
                "0baf23b89a2534d2"
            ]
        ]
    },
    {
        "id": "57578a76a7b1fe01",
        "type": "OPCUA-IIoT-Read",
        "z": "b097a95f4a4d5fd0",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "484db7503e21eb9d",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 1770,
        "y": 1880,
        "wires": [
            [
                "0baf23b89a2534d2"
            ]
        ]
    },
    {
        "id": "d2584a49c037dd2f",
        "type": "OPCUA-IIoT-Listener",
        "z": "b68bbce92754c7f5",
        "connector": "b4d433573f375564",
        "action": "subscribe",
        "queueSize": 10,
        "name": "",
        "topic": "",
        "justValue": false,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 580,
        "y": 820,
        "wires": [
            [
                "9419d54e1c57a01b",
                "55fe54ba4d315963"
            ]
        ]
    },
    {
        "id": "012afe3e3ba72890",
        "type": "OPCUA-IIoT-Inject",
        "z": "b68bbce92754c7f5",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            },
            {
                "name": "version",
                "nodeId": "ns=4;i=20",
                "datatypeName": "String"
            }
        ],
        "x": 150,
        "y": 380,
        "wires": [
            [
                "467a5503307fafba"
            ]
        ]
    },
    {
        "id": "467a5503307fafba",
        "type": "OPCUA-IIoT-Read",
        "z": "b68bbce92754c7f5",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "90582fb778f3aece",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 390,
        "y": 380,
        "wires": [
            [
                "1159419974a3e1aa"
            ]
        ]
    },
    {
        "id": "5ceaf88faf51d021",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "Order Handling",
        "func": "if (flow.get(\"orderId\") == msg.payload.orderId || flow.get(\"orderId\") == \"0\") {\n    // orderId im Flow speichern\n    flow.set(\"orderId\", msg.payload.orderId);\n\n    // orderUpdateId Fallunterscheidung\n    if (1==1) {\n\n\n\n        // duration in actionState\n        let actionState = flow.get(\"actionState\");\n        actionState.command = msg.payload.action.command;\n        actionState.id = msg.payload.action.id;\n        let loads = flow.get(\"loads\");\n        let newLoad = loads[0] ?? {};\n\n        // Command Fallunterscheidung\n        if (actionState.command == \"PICK\" && flow.get(\"moduleState\") == \"IDLE\") {\n            // ModulState busy setzen\n            flow.set(\"moduleState\", \"PICKBUSY\");\n\n  //     node.warn(`moduleState=${flow.get(\"moduleState\")}, actionState.command=${actionState.command}`);\n\n\n            // actionState in Flow speichern\n            flow.set(\"actionState\", msg.payload.action);\n\n            // // loads for order im Flow speichern\n           // newLoad.loadType = msg.payload.action.metadata.type;\n            // flow.set(\"loads\", [newLoad]);\n\n            // // orderUpdateId updaten\n            //flow.set(\"orderUpdateId\", msg.payload.orderUpdateId);\n            \n            \n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=4\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n            \n        } else if (actionState.command == \"DROP\" && flow.get(\"moduleState\") == \"WAITING_AFTER_DRILL\") {\n            // ModulState busy setzen\n            flow.set(\"moduleState\", \"DROPBUSY\");\n\n            \n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=5\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n\n            // OPCUA Write Content\n           // msg.payload.valuesToWrite = [{ \"value\": true }];\n            //msg.payload.nodesToWrite = [{ \"nodeId\": \"ns=4;i=5\", \"datatypeName\": \"Boolean\" }];\n        } else if (actionState.command == \"DRILL\" && flow.get(\"moduleState\") == \"WAITING_AFTER_PICK\") {\n            // state.loads bearbeiten\n          // newLoad.duration = msg.payload.action.metadata.duration ? msg.payload.action.metadata.duration : 2\n\n            // ModulState busy setzen\n            flow.set(\"moduleState\", \"DRILLBUSY\");\n\n            // // OPCUA Write Content\n            // msg.payload.valuesToWrite = [\n            //     { \"value\": true },\n            //     { \"value\": newLoad.duration}];\n            // msg.payload.nodesToWrite = [\n            //     { \"nodeId\": \"ns=4;i=6\", \"datatypeName\": \"Boolean\" },\n            //     { \"nodeId\": \"ns=4;i=10\", \"datatypeName\": \"Int16\" }];\n            // actionState.duration = newLoad.duration;\n\n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=6\",  // cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    },\n                    {\n                        nodeId: \"ns=4;i=10\", // drill_duration\n                        datatypeName: \"Int16\",\n                        value: 10\n                    }\n                ]\n            };\n\n\n            return msg;\n        } else {\n            const flowErrors = flow.get(\"errors\") ?? [];\n            const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n            let error = {\n                \"errorType\": \"Validation\",\n                \"errorLevel\": \"WARNING\",\n                \"errorReferences\": [\n                    { \"topic\": \"order\" },\n                    { \"headerId\": flow.get(\"headerId\") },\n                    { \"orderId\": msg.payload.orderId },\n                    { \"orderUpdateId\": msg.payload.orderUpdateId }\n                ],\n                \"errorMessage\": \"Command not supported\"\n            }\n            // Error in Flow\n            flow.set(\"errors\", [...errors, error]);\n            return [null, msg];\n        }\n\n        // actionState in Flow speichern\n        flow.set(\"actionState\", actionState);\n\n        // loads for order im Flow speichern\n        newLoad.loadType = msg.payload.action.metadata.type;\n        flow.set(\"loads\", [newLoad]);\n\n        // orderUpdateId updaten\n        flow.set(\"orderUpdateId\", msg.payload.orderUpdateId);\n\n        // OPCUA write Content\n        msg.payload.nodetype = \"inject\";\n        msg.payload.injectType = \"write\";\n\n        node.warn('Message to Write Order: ' + JSON.stringify(msg.payload, null, 2));\n        node.warn(`Flow Context - moduleState: ${flow.get(\"moduleState\")}, actionState: ${JSON.stringify(flow.get(\"actionState\"))}, orderId: ${flow.get(\"orderId\")}, orderUpdateId: ${flow.get(\"orderUpdateId\")}`);\n\n        return [msg,null];\n    } else {\n        const flowErrors = flow.get(\"errors\") ?? [];\n        const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n        let error = {\n            \"errorType\": \"Validation\",\n            \"errorLevel\": \"WARNING\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": msg.payload.orderId },\n                { \"orderUpdateId\": msg.payload.orderUpdateId }\n            ],\n            \"errorMessage\": \"OrderUpdateId not valid\"\n        }\n        // Error in Flow\n        flow.set(\"errors\", [...errors, error]);\n        return [null, msg];\n    }\n} else {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": msg.payload.orderId },\n            { \"orderUpdateId\": msg.payload.orderUpdateId }\n        ],\n        \"errorMessage\": \"OrderId not valid\"\n    }\n    // Error in Flow\n    flow.set(\"errors\", [...errors, error]);\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 240,
        "wires": [
            [
                "363d547e5174c6da"
            ],
            [
                "e60a2bc356707413"
            ]
        ]
    },
    {
        "id": "363d547e5174c6da",
        "type": "OPCUA-IIoT-Write",
        "z": "b68bbce92754c7f5",
        "connector": "90582fb778f3aece",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 1210,
        "y": 160,
        "wires": [
            [
                "c4af20563dd4fd53",
                "25d0a53e2f44c3e0"
            ]
        ]
    },
    {
        "id": "25d0a53e2f44c3e0",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "write oerder debugg",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1500,
        "y": 60,
        "wires": []
    },
    {
        "id": "b9665d2232fa7077",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "vda_status_finished PICK",
        "func": "// wenn \"TRUE\" im OPCUA und die richtige interne state\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"PICKBUSY\") {\n\n    // state\n    let state = flow.get(\"state\");\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    // erfolgreich mit der NodeId\n    if (msg.payload.nodeId == \"ns=4;i=7\") {\n        if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"PICKBUSY\") {\n            flow.set(\"moduleState\", \"WAITING_AFTER_PICK\");\n            actionState.state = \"FINISHED\"; // Waiting for FTS\n        }\n    }\n\n\n\n\n    // nicht erfolgreich mit der NodeId\n    else if (msg.payload.nodeId == \"ns=4;i=11\") {\n\n        let error = {\n            timestamp,\n            \"errorType\": \"PICK_failed\",\n            \"errorMessage\": \"PICK failed\",\n            \"errorLevel\": \"FATAL\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        actionState.state = \"FAILED\"; // FAILED PICK\n        errors.push(error);\n        flow.set(\"errors\", errors);\n        flow.set(\"moduleState\", \"IDLE\");\n    }\n\n\n\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = flow.get(\"actionState\");\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = flow.get(\"errors\") ? flow.get(\"errors\") : [];\n\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n} else {\n\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 840,
        "wires": [
            [
                "f19fb7718b67e287",
                "9aeefe5d9adb7be5"
            ]
        ]
    },
    {
        "id": "9419d54e1c57a01b",
        "type": "switch",
        "z": "b68bbce92754c7f5",
        "name": "topicswitch",
        "property": "payload.nodeId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ns=4;i=15",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=9",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=14",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=12",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=8",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=13",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=11",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=7",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 770,
        "y": 820,
        "wires": [
            [],
            [
                "4dac8af718944bdd"
            ],
            [],
            [
                "b63130df029b220d",
                "6186396e23e4ef99",
                "011ba6e1c25079d3"
            ],
            [
                "6186396e23e4ef99",
                "011ba6e1c25079d3"
            ],
            [
                "579b5eed5e2177e0"
            ],
            [],
            [
                "1af7e5b9bd84f2f3",
                "b9665d2232fa7077"
            ],
            [
                "b9665d2232fa7077"
            ]
        ],
        "outputLabels": [
            "drill_aktiv",
            "drill_finished",
            "drop_aktiv",
            "drop_failed",
            "drop_finished",
            "idle",
            "pick_aktiv",
            "pick_failed",
            "pick_finished"
        ]
    },
    {
        "id": "c4af20563dd4fd53",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "Publish vda_status_RUNNING",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet headerId = flow.get(\"headerId\");\nlet actionState = flow.get(\"actionState\");\n//actionState.id = msg.payload.action.id ? msg.payload.action.id : \"noIdfound\";\nlet state = flow.get(\"state\");\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState =moduleState;\nactionState.state = \"RUNNING\";\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\n//state.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\nmsg.payload = state;\n\n// flowVariable Update\nflow.set(\"headerId\", headerId + 1);\nflow.set(\"errors\", null);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n\n// Debug log\nnode.warn('Publish vda_status_RUNNING Output: ' + JSON.stringify(msg.payload, null, 2));\nnode.warn(`Flow Context - headerId: ${flow.get(\"headerId\")}, actionState: ${JSON.stringify(flow.get(\"actionState\"))}, orderId: ${flow.get(\"orderId\")}, orderUpdateId: ${flow.get(\"orderUpdateId\")}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 160,
        "wires": [
            [
                "9dded58fb7798681",
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "9dded58fb7798681",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "Order State",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1850,
        "y": 240,
        "wires": []
    },
    {
        "id": "011ba6e1c25079d3",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "vda_status_finished DROP",
        "func": "// wenn OPCUA den Wert True liefert\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"DROPBUSY\") {\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let state = flow.get(\"state\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // wenn drop_finished gesetzt wurde\n    if (msg.payload.nodeId == \"ns=4;i=8\") {\n        actionState.state = \"FINISHED\";\n    }\n\n    // wenn drop_failed gesetzt wurde\n    else if (msg.payload.nodeId == \"ns=4;i=12\") {\n        actionState.state = \"FAILED\";\n        let error = {\n            timestamp,\n            \"errorType\": \"DROP_failed\",\n            \"errorMessage\": \"DROP failed\",\n            \"errorLevel\": \"WARNING\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        errors.push(error);\n        flow.set(\"errors\", errors);\n    } else {\n        return\n    }\n\n    // state\n    state.headerId = headerId;\n    state.loads = [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = flow.get(\"errors\") ? flow.get(\"errors\") : [];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n    flow.set(\"orderId\", 0);\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"loads\", []);\n    flow.set(\"moduleState\", \"IDLE\");\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    flow.set(\"errors\", []);\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 800,
        "wires": [
            [
                "f19fb7718b67e287",
                "9aeefe5d9adb7be5"
            ]
        ]
    },
    {
        "id": "f19fb7718b67e287",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "finished",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1780,
        "y": 740,
        "wires": []
    },
    {
        "id": "4dac8af718944bdd",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "vda_status_finished DRILL",
        "func": "if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"DRILLBUSY\") {\n    let state = flow.get(\"state\");\n    flow.set(\"moduleState\", \"WAITING_AFTER_DRILL\");\n\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\"\n    \n    // state\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 760,
        "wires": [
            [
                "f19fb7718b67e287",
                "9aeefe5d9adb7be5"
            ]
        ]
    },
    {
        "id": "579b5eed5e2177e0",
        "type": "change",
        "z": "b68bbce92754c7f5",
        "name": "OPCUA state IDLE",
        "rules": [
            {
                "t": "set",
                "p": "SPS_idle",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1070,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "1af7e5b9bd84f2f3",
        "type": "change",
        "z": "b68bbce92754c7f5",
        "name": "OPCUA state PICK",
        "rules": [
            {
                "t": "set",
                "p": "pick_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1070,
        "y": 620,
        "wires": [
            [
                "17e9c415c67e04e3"
            ]
        ]
    },
    {
        "id": "b63130df029b220d",
        "type": "change",
        "z": "b68bbce92754c7f5",
        "name": "OPCUA state DROP",
        "rules": [
            {
                "t": "set",
                "p": "drop_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1080,
        "y": 700,
        "wires": [
            [
                "17e9c415c67e04e3"
            ]
        ]
    },
    {
        "id": "beb905bf6a33d813",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "variable setup",
        "func": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"DRILL\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"DRILL\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"drill\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"DRILL001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/DRILL001\"); // Added for consistency",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Le code ajout ici sera excut une fois\n//  chaque dmarrage du noeud.\n// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"DRILL\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 2);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"DRILL\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"drill\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"DRILL001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/DRILL001\"); // Added for consistency",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "55fe54ba4d315963",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "listener out",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 960,
        "wires": []
    },
    {
        "id": "e60a2bc356707413",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "Publish vda_status_FAILED",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = flow.get(\"actionState\");\nstate.actionState.state = \"FAILED\";\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// flow update\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 240,
        "wires": [
            [
                "9dded58fb7798681",
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "db3e737973786db8",
        "type": "OPCUA-IIoT-Browser",
        "z": "b68bbce92754c7f5",
        "nodeId": "ns=4;i=1",
        "name": "browse",
        "justValue": true,
        "sendNodesToRead": false,
        "sendNodesToBrowser": false,
        "sendNodesToListener": true,
        "multipleOutputs": false,
        "showStatusActivities": true,
        "showErrors": true,
        "recursiveBrowse": false,
        "recursiveDepth": 1,
        "delayPerMessage": 0.2,
        "connector": "b4d433573f375564",
        "x": 360,
        "y": 660,
        "wires": [
            [
                "27a9715fb0e3b5f6",
                "5543472d02204931"
            ]
        ]
    },
    {
        "id": "45611040a7f4fe4d",
        "type": "OPCUA-IIoT-Inject",
        "z": "b68bbce92754c7f5",
        "injectType": "inject",
        "payload": "{\"interval\":100}",
        "payloadType": "json",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "10",
        "name": "inject",
        "addressSpaceItems": [],
        "x": 90,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "27a9715fb0e3b5f6",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "browser",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 660,
        "wires": []
    },
    {
        "id": "5543472d02204931",
        "type": "change",
        "z": "b68bbce92754c7f5",
        "name": "BrowserArray",
        "rules": [
            {
                "t": "set",
                "p": "BrowseArray",
                "pt": "flow",
                "to": "payload.browserResults",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "9aeefe5d9adb7be5",
        "type": "link out",
        "z": "b68bbce92754c7f5",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 1835,
        "y": 820,
        "wires": []
    },
    {
        "id": "1159419974a3e1aa",
        "type": "subflow:4a591b1ca8fe0bf6",
        "z": "b68bbce92754c7f5",
        "name": "",
        "x": 630,
        "y": 380,
        "wires": [
            [
                "5ceaf88faf51d021",
                "ed65db61732ab61b"
            ],
            [
                "05afed3fedb18212",
                "1bb8dc430e707d0d"
            ],
            [
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "ce7a72fe85d97322",
        "type": "link out",
        "z": "b68bbce92754c7f5",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 1825,
        "y": 460,
        "wires": []
    },
    {
        "id": "07723f7c80e87221",
        "type": "subflow:6a25ecd632542087",
        "z": "b68bbce92754c7f5",
        "name": "",
        "env": [
            {
                "name": "FACTSHEET_FILE",
                "value": "/data/factsheets/factsheet-drill.json",
                "type": "str"
            }
        ],
        "x": 100,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "b49debd8c5649031",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "vda_action factsheetRequest",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"RUNNING\");\n\n// factsheet timestamp aktualisieren\nconst factsheet = flow.get(\"factsheet\");\nfactsheet.timestamp = new Date().toISOString();\nflow.set(\"factsheet\", factsheet);\n\n//publish on topic\nmsg.topic = flow.get(\"MQTT_topic\") + \"/factsheet\";\nmsg.payload = factsheet;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 320,
        "wires": [
            [
                "e88524d504017b46",
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "e88524d504017b46",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.actionState = actionState\nstate.timestamp = new Date().toISOString();\nstate.orderId = actionState.id;\nstate.orderUpdateId = \"0\";\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// flow update\nflow.set(\"headerId\", state.headerId + 1);\nflow.set(\"errors\", {});\nflow.set(\"orderId\", 0);\nflow.set(\"orderUpdateId\", 0);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 320,
        "wires": [
            [
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "05afed3fedb18212",
        "type": "switch",
        "z": "b68bbce92754c7f5",
        "name": "handleInstantAction",
        "property": "instantAction",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "factsheetRequest",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 930,
        "y": 320,
        "wires": [
            [
                "b49debd8c5649031",
                "1bb8dc430e707d0d"
            ]
        ]
    },
    {
        "id": "42da948f9a9bd9b4",
        "type": "catch",
        "z": "b68bbce92754c7f5",
        "name": "Catch all Errors",
        "scope": null,
        "uncaught": true,
        "x": 160,
        "y": 120,
        "wires": [
            [
                "7f5e458c071db9ff"
            ]
        ]
    },
    {
        "id": "7f5e458c071db9ff",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "display-error",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 120,
        "wires": []
    },
    {
        "id": "1bb8dc430e707d0d",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "supportedInstantAction",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1200,
        "y": 380,
        "wires": []
    },
    {
        "id": "ed65db61732ab61b",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "Debug-Order-Actions",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 220,
        "wires": []
    },
    {
        "id": "6186396e23e4ef99",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "drop-end-state",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1060,
        "y": 1080,
        "wires": []
    },
    {
        "id": "17e9c415c67e04e3",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "state switch",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1410,
        "y": 1060,
        "wires": []
    },
    {
        "id": "6b1ba92e38fb2fcc",
        "type": "subflow:468f2460ce66f11e",
        "z": "b68bbce92754c7f5",
        "name": "",
        "x": 610,
        "y": 500,
        "wires": [
            [
                "ce7a72fe85d97322"
            ]
        ]
    },
    {
        "id": "3a92daec86651829",
        "type": "OPCUA-IIoT-Inject",
        "z": "b68bbce92754c7f5",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            }
        ],
        "x": 150,
        "y": 500,
        "wires": [
            [
                "7397eef437079aa0",
                "6b1ba92e38fb2fcc"
            ]
        ]
    },
    {
        "id": "7397eef437079aa0",
        "type": "OPCUA-IIoT-Read",
        "z": "b68bbce92754c7f5",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "b4d433573f375564",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 370,
        "y": 460,
        "wires": [
            [
                "6b1ba92e38fb2fcc"
            ]
        ]
    },
    {
        "id": "241ce49ab8725c84",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "Collect Flow State",
        "func": "const debugState = {\n    flowName: flow.get(\"flowName\"),\n    moduleState: flow.get(\"moduleState\"),\n    orderUpdateId: flow.get(\"orderUpdateId\"),\n    orderId: flow.get(\"orderId\"),\n    loads: flow.get(\"loads\"),\n    headerId: flow.get(\"headerId\"),\n    actionState: flow.get(\"actionState\"),\n    model: flow.get(\"model\"),\n    errors: flow.get(\"errors\"),\n    state: flow.get(\"state\"),\n    factsheet: flow.get(\"factsheet\"),\n    connection: flow.get(\"connection\"),\n    opcuaState: flow.get(\"opcuaState\"),\n    mqtt_topic: flow.get(\"MQTT_topic\")\n};\n\nmsg.payload = debugState;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 1400,
        "wires": [
            [
                "fb67fba24dc56d53"
            ]
        ]
    },
    {
        "id": "fb67fba24dc56d53",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "name": "Debug Flow Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 1400,
        "wires": []
    },
    {
        "id": "9647e9a7771cdcfd",
        "type": "inject",
        "z": "b68bbce92754c7f5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 410,
        "y": 1400,
        "wires": [
            [
                "241ce49ab8725c84"
            ]
        ]
    },
    {
        "id": "6bbaac0ad766cb02",
        "type": "inject",
        "z": "b68bbce92754c7f5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 330,
        "y": 60,
        "wires": [
            [
                "beb905bf6a33d813"
            ]
        ]
    },
    {
        "id": "6c134ba16bb7ae30",
        "type": "OPCUA-IIoT-Inject",
        "z": "b68bbce92754c7f5",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_DRILL",
        "addressSpaceItems": [
            {
                "name": "finish_pick",
                "nodeId": "ns=4;i=7",
                "datatypeName": ""
            },
            {
                "name": "finish_drill",
                "nodeId": "ns=4;i=9",
                "datatypeName": ""
            },
            {
                "name": "finish_drop",
                "nodeId": "ns=4;i=8",
                "datatypeName": ""
            }
        ],
        "x": 370,
        "y": 820,
        "wires": [
            [
                "d2584a49c037dd2f"
            ]
        ]
    },
    {
        "id": "5a529c03d5820414",
        "type": "inject",
        "z": "b68bbce92754c7f5",
        "name": "Start Drill",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 720,
        "y": 60,
        "wires": [
            [
                "b097cc207b6fb7a9"
            ]
        ]
    },
    {
        "id": "b097cc207b6fb7a9",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "name": "Write cmd__start_drill = true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=6\",\n            datatypeName: \"Boolean\",\n            value: true\n        },\n        {\n            nodeId: \"ns=4;i=10\",\n            datatypeName: \"Int16\",\n            value: 10\n        }\n    ]\n};\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 60,
        "wires": [
            [
                "4d5d809eaf6fc465"
            ]
        ]
    },
    {
        "id": "4d5d809eaf6fc465",
        "type": "OPCUA-IIoT-Write",
        "z": "b68bbce92754c7f5",
        "connector": "90582fb778f3aece",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 1210,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "e6aa627fa2d83815",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 740,
        "y": 1680,
        "wires": []
    },
    {
        "id": "73003f37ba2b43ca",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "function 4",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 1720,
        "wires": [
            [
                "dc3f1461c9ceda1e",
                "22ef9861d495dd8b"
            ]
        ]
    },
    {
        "id": "dc3f1461c9ceda1e",
        "type": "debug",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 900,
        "y": 1720,
        "wires": []
    },
    {
        "id": "22ef9861d495dd8b",
        "type": "function",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "function 5",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `DRILL;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1760,
        "wires": [
            [
                "9ffeceb7ac71f3c1"
            ]
        ]
    },
    {
        "id": "940ebb3618ee3c08",
        "type": "OPCUA-IIoT-Inject",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_DRILL",
        "addressSpaceItems": [
            {
                "name": "raus",
                "nodeId": "ns=4;i=31",
                "datatypeName": ""
            },
            {
                "name": "rein",
                "nodeId": "ns=4;i=30",
                "datatypeName": ""
            },
            {
                "name": "runter",
                "nodeId": "ns=4;i=32",
                "datatypeName": ""
            },
            {
                "name": "Bohrer",
                "nodeId": "ns=4;i=34",
                "datatypeName": ""
            },
            {
                "name": "Band-Bohrer",
                "nodeId": "ns=4;i=28",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=29",
                "datatypeName": ""
            }
        ],
        "x": 380,
        "y": 1680,
        "wires": [
            [
                "d1bde1208aefd194"
            ]
        ]
    },
    {
        "id": "cad68111d8c4d32f",
        "type": "comment",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "MILL_OPC_UA",
        "info": "",
        "x": 370,
        "y": 1740,
        "wires": []
    },
    {
        "id": "d1bde1208aefd194",
        "type": "OPCUA-IIoT-Listener",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "connector": "90582fb778f3aece",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 570,
        "y": 1680,
        "wires": [
            [
                "e6aa627fa2d83815",
                "73003f37ba2b43ca"
            ]
        ]
    },
    {
        "id": "9ffeceb7ac71f3c1",
        "type": "link out",
        "z": "b68bbce92754c7f5",
        "g": "903773a8fcd9e150",
        "name": "link out 13",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1135,
        "y": 1880,
        "wires": []
    },
    {
        "id": "4225cda79f061041",
        "type": "OPCUA-IIoT-Inject",
        "z": "12d77bbd6f79a8bf",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            },
            {
                "name": "version",
                "nodeId": "ns=4;i=21",
                "datatypeName": "String"
            }
        ],
        "x": 170,
        "y": 460,
        "wires": [
            [
                "031febf6919749fa"
            ]
        ]
    },
    {
        "id": "031febf6919749fa",
        "type": "OPCUA-IIoT-Read",
        "z": "12d77bbd6f79a8bf",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "484db7503e21eb9d",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 390,
        "y": 460,
        "wires": [
            [
                "070a8b045d8da44d",
                "328e9a4f67df51fe"
            ]
        ]
    },
    {
        "id": "d9987a7416c51333",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "Order Handling",
        "func": "if (flow.get(\"orderId\") == msg.payload.orderId || flow.get(\"orderId\") == \"0\") {\n    // orderId im Flow speichern\n    flow.set(\"orderId\", msg.payload.orderId);\n\n    // orderUpdateId Fallunterscheidung\n    if (1==1) {\n\n        // duration in actionState\n        let actionState = flow.get(\"actionState\");\n        actionState.command = msg.payload.action.command;\n        actionState.id = msg.payload.action.id;\n        let loads = flow.get(\"loads\");\n        let newLoad = loads[0] ?? {};\n\n        // Command Fallunterscheidung\n        if (actionState.command == \"PICK\") {\n            // ModulState busy setzen\n            flow.set(\"moduleState\", \"PICKBUSY\");\n\n\n             flow.set(\"actionState\", msg.payload.action);\n            \n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=5\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n        } else if (actionState.command == \"DROP\") {\n            // ModulState busy setzen\n                       flow.set(\"moduleState\", \"DROPBUSY\");\n\n            \n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=6\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n        } else if (actionState.command == \"MILL\" && flow.get(\"moduleState\") == \"WAITING_AFTER_PICK\") {\n            // state.loads bearbeiten\n            flow.set(\"moduleState\", \"MILLBUSY\");\n\n            \n\n            // // OPCUA Write Content\n            // msg.payload.valuesToWrite = [\n            //     { \"value\": true },\n            //     { \"value\": newLoad.duration}];\n            // msg.payload.nodesToWrite = [\n            //     { \"nodeId\": \"ns=4;i=6\", \"datatypeName\": \"Boolean\" },\n            //     { \"nodeId\": \"ns=4;i=10\", \"datatypeName\": \"Int16\" }];\n            // actionState.duration = newLoad.duration;\n\n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=4\",  // cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    },\n                    {\n                        nodeId: \"ns=4;i=11\", // mill_duration\n                        datatypeName: \"Int16\",\n                        value: 10\n                    }\n                ]\n            };\n\n\n            return msg;\n\n\n        } else {\n            const flowErrors = flow.get(\"errors\") ?? [];\n            const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n            let error = {\n                \"errorType\": \"Validation\",\n                \"errorLevel\": \"WARNING\",\n                \"errorReferences\": [\n                    { \"topic\": \"order\" },\n                    { \"headerId\": flow.get(\"headerId\") },\n                    { \"orderId\": msg.payload.orderId },\n                    { \"orderUpdateId\": msg.payload.orderUpdateId }\n                ],\n                \"errorMessage\": \"Command not supported\"\n            }\n            // Error in Flow\n            flow.set(\"errors\", [...errors, error]);\n            return [null, msg];\n        }\n\n    } else {\n        const flowErrors = flow.get(\"errors\") ?? [];\n        const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n        let error = {\n            \"errorType\": \"Validation\",\n            \"errorLevel\": \"WARNING\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": msg.payload.orderId },\n                { \"orderUpdateId\": msg.payload.orderUpdateId }\n            ],\n            \"errorMessage\": \"OrderUpdateId not valid\"\n        }\n        // Error in Flow\n        flow.set(\"errors\", [...errors, error]);\n        return [null, msg];\n    }\n} else {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": msg.payload.orderId },\n            { \"orderUpdateId\": msg.payload.orderUpdateId }\n        ],\n        \"errorMessage\": \"OrderId not valid\"\n    }\n    // Error in Flow\n    flow.set(\"errors\", [...errors, error]);\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 240,
        "wires": [
            [
                "a0a318ecd5dda069"
            ],
            [
                "f151338f17c3a70a"
            ]
        ]
    },
    {
        "id": "a0a318ecd5dda069",
        "type": "OPCUA-IIoT-Write",
        "z": "12d77bbd6f79a8bf",
        "connector": "484db7503e21eb9d",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 1190,
        "y": 180,
        "wires": [
            [
                "ab177f5a58f36a70"
            ]
        ]
    },
    {
        "id": "024110e55b651e49",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "vda_status_finished PICK",
        "func": "// wenn \"TRUE\" im OPCUA und die richtige interne state\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"PICKBUSY\") {\n\n    // state\n    let state = flow.get(\"state\");\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    // erfolgreich mit der NodeId\n    if (msg.payload.nodeId == \"ns=4;i=8\") {\n        if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"PICKBUSY\") {\n            flow.set(\"moduleState\", \"WAITING_AFTER_PICK\");\n            actionState.state = \"FINISHED\"; // Waiting for FTS\n        }\n    }\n\n    // nicht erfolgreich mit der NodeId\n    else if (msg.payload.nodeId == \"ns=4;i=12\") {\n        let error = {\n            timestamp,\n            \"errorType\": \"PICK_failed\",\n            \"errorMessage\": \"PICK failed\",\n            \"errorLevel\": \"FATAL\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        actionState.state = \"FAILED\"; // FAILED PICK\n        errors.push(error);\n        flow.set(\"errors\", errors);\n        flow.set(\"moduleState\", \"IDLE\");\n    }\n\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = flow.get(\"actionState\");\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = flow.get(\"errors\") ? flow.get(\"errors\") : [];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n} else {\n\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1020,
        "wires": [
            [
                "3167e43eb9b92e7c",
                "439dd835f0daf7b3"
            ]
        ]
    },
    {
        "id": "d175178a06968f46",
        "type": "switch",
        "z": "12d77bbd6f79a8bf",
        "name": "topicswitch",
        "property": "payload.nodeId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ns=4;i=14",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=13",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=9",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=16",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=10",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=15",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=12",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=8",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 770,
        "y": 980,
        "wires": [
            [],
            [
                "12ba7b1bab88968c",
                "c70930f13f134f41"
            ],
            [
                "c70930f13f134f41"
            ],
            [
                "6ef80b327f388abb"
            ],
            [],
            [
                "ce045e6a15b935d7"
            ],
            [],
            [
                "4fd512e8e1717b7a",
                "024110e55b651e49"
            ],
            [
                "024110e55b651e49"
            ]
        ],
        "outputLabels": [
            "drop_aktiv",
            "drop_failed",
            "drop_finished",
            "idle",
            "mill_aktiv",
            "mill_finished",
            "pick_aktiv",
            "pick_failed",
            "pick_finished"
        ]
    },
    {
        "id": "ab177f5a58f36a70",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "Publish vda_status_RUNNING",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet headerId = flow.get(\"headerId\");\nlet actionState = flow.get(\"actionState\");\n//actionState.id = msg.payload.action.id ? msg.payload.action.id : \"noIdfound\";\nlet state = flow.get(\"state\");\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState = moduleState;\nactionState.state = \"RUNNING\";\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\n//state.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\nmsg.payload = state;\n\n// flowVariable Update\nflow.set(\"headerId\", headerId + 1);\nflow.set(\"errors\", null);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n\n// Debug log\nnode.warn('Publish vda_status_RUNNING Output: ' + JSON.stringify(msg.payload, null, 2));\nnode.warn(`Flow Context - headerId: ${flow.get(\"headerId\")}, actionState: ${JSON.stringify(flow.get(\"actionState\"))}, orderId: ${flow.get(\"orderId\")}, orderUpdateId: ${flow.get(\"orderUpdateId\")}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 220,
        "wires": [
            [
                "97485b7bf8dfc16d",
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "97485b7bf8dfc16d",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "Order State",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1810,
        "y": 220,
        "wires": []
    },
    {
        "id": "c70930f13f134f41",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "vda_status_finished DROP",
        "func": "// wenn OPCUA den Wert True liefert\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"DROPBUSY\") {\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let state = flow.get(\"state\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // wenn drop_finished gesetzt wurde\n    if (msg.payload.nodeId == \"ns=4;i=9\") {\n        actionState.state = \"FINISHED\";\n    }\n\n    // wenn drop_failed gesetzt wurde\n    else if (msg.payload.nodeId == \"ns=4;i=13\") {\n        actionState.state = \"FAILED\";\n        let error = {\n            timestamp,\n            \"errorType\": \"DROP_failed\",\n            \"errorMessage\": \"DROP failed\",\n            \"errorLevel\": \"WARNING\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        errors.push(error);\n        flow.set(\"errors\", errors);\n    } else {\n        return\n    }\n\n    // state\n    state.headerId = headerId;\n    state.loads = [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = flow.get(\"errors\") ? flow.get(\"errors\") : [];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n    flow.set(\"orderId\", 0);\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"loads\", []);\n    flow.set(\"moduleState\", \"IDLE\");\n    flow.set(\"errors\", []);\n\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 940,
        "wires": [
            [
                "3167e43eb9b92e7c",
                "439dd835f0daf7b3"
            ]
        ]
    },
    {
        "id": "3167e43eb9b92e7c",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "finished",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1700,
        "y": 1140,
        "wires": []
    },
    {
        "id": "ce045e6a15b935d7",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "vda_status_finished MILL",
        "func": "if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"MILLBUSY\") {\n\n    let state = flow.get(\"state\");\n    flow.set(\"moduleState\", \"WAITING_AFTER_MILL\");\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\"\n    \n    // state\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 980,
        "wires": [
            [
                "3167e43eb9b92e7c",
                "439dd835f0daf7b3"
            ]
        ]
    },
    {
        "id": "6ef80b327f388abb",
        "type": "change",
        "z": "12d77bbd6f79a8bf",
        "name": "OPCUA state IDLE",
        "rules": [
            {
                "t": "set",
                "p": "SPS_idle",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1130,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "4fd512e8e1717b7a",
        "type": "change",
        "z": "12d77bbd6f79a8bf",
        "name": "OPCUA state PICK",
        "rules": [
            {
                "t": "set",
                "p": "pick_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1130,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "12ba7b1bab88968c",
        "type": "change",
        "z": "12d77bbd6f79a8bf",
        "name": "OPCUA state DROP",
        "rules": [
            {
                "t": "set",
                "p": "drop_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "79bdc92ed0be9113",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "variable setup",
        "func": "// Ntige Werte im Flow speichern\nflow.set(\"flowName\", \"MILL\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"MILL\");\nflow.set(\"errors\", []);\n\nflow.set(\"state\", {\n    \"headerId\": 0,\n    \"loads\": [],\n    \"actionState\": null,\n    \"serialNumber\": \"notReadYet\",\n    \"timestamp\": \"timestamp\",\n    \"errors\": [],\n    \"orderUpdateId\": 0,\n    \"orderId\": 0,\n    \"paused\": false,\n    \"metadata\": {\n        \"opcuaState\": \"connected\"\n    }\n});\n\n// factsheet for MILL\nconst factsheet = msg.factsheet ?? {};\nflow.set(\"factsheet\", factsheet);\n\nflow.set(\"connection\", {\n    \"headerId\": 0,\n    \"timestamp\": \"timestamp\",\n    \"ip\": \"192.168.0.40\",\n    \"version\": \"1.0.0\",\n    \"manufacturer\": \"Fischertechnik\",\n    \"serialNumber\": \"serialNumber\",\n    \"connectionState\": \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\n\nreturn ",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "f151338f17c3a70a",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "Publish vda_status_FAILED",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = flow.get(\"actionState\");\nstate.actionState.state = \"FAILED\";\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// flow update\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 320,
        "wires": [
            [
                "97485b7bf8dfc16d",
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "439dd835f0daf7b3",
        "type": "link out",
        "z": "12d77bbd6f79a8bf",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 1735,
        "y": 960,
        "wires": []
    },
    {
        "id": "070a8b045d8da44d",
        "type": "subflow:4a591b1ca8fe0bf6",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "x": 620,
        "y": 460,
        "wires": [
            [
                "d9987a7416c51333"
            ],
            [
                "b790c6927d7ec35c"
            ],
            [
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "986051368e9cd46b",
        "type": "link out",
        "z": "12d77bbd6f79a8bf",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 1935,
        "y": 480,
        "wires": []
    },
    {
        "id": "8f4b515ad4599c32",
        "type": "subflow:6a25ecd632542087",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "env": [
            {
                "name": "FACTSHEET_FILE",
                "value": "/data/factsheets/factsheet-mill.json",
                "type": "str"
            },
            {
                "name": "FACTSHEET_FILENAME",
                "value": "factsheet-mill.json",
                "type": "str"
            }
        ],
        "x": 150,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "c0b0c0462f0704fb",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "vda_action factsheetRequest",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"RUNNING\");\n\n// factsheet timestamp aktualisieren\nconst factsheet = flow.get(\"factsheet\");\nfactsheet.timestamp = new Date().toISOString();\nflow.set(\"factsheet\", factsheet);\n\n//publish on topic\nmsg.topic = flow.get(\"MQTT_topic\") + \"/factsheet\";\nmsg.payload = factsheet;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 420,
        "wires": [
            [
                "88b916d7ac0ea154",
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "88b916d7ac0ea154",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "vda_status_finished instantAction",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"FINISHED\");\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.actionState = actionState\nstate.timestamp = new Date().toISOString();\nstate.orderId = actionState.id;\nstate.orderUpdateId = \"0\";\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// flow update\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 420,
        "wires": [
            [
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "b790c6927d7ec35c",
        "type": "switch",
        "z": "12d77bbd6f79a8bf",
        "name": "handleInstantAction",
        "property": "instantAction",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "factsheetRequest",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 970,
        "y": 420,
        "wires": [
            [
                "c0b0c0462f0704fb"
            ]
        ]
    },
    {
        "id": "6d9eac0ae87377fe",
        "type": "catch",
        "z": "12d77bbd6f79a8bf",
        "name": "Catch all Errors",
        "scope": null,
        "uncaught": true,
        "x": 140,
        "y": 260,
        "wires": [
            [
                "aff1319091a73e82"
            ]
        ]
    },
    {
        "id": "aff1319091a73e82",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "display-error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 260,
        "wires": []
    },
    {
        "id": "00e2bc9613cb309d",
        "type": "subflow:468f2460ce66f11e",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "x": 650,
        "y": 620,
        "wires": [
            [
                "986051368e9cd46b"
            ]
        ]
    },
    {
        "id": "eb39ac63b006666e",
        "type": "OPCUA-IIoT-Inject",
        "z": "12d77bbd6f79a8bf",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            }
        ],
        "x": 190,
        "y": 620,
        "wires": [
            [
                "f2c2c712841063be",
                "00e2bc9613cb309d"
            ]
        ]
    },
    {
        "id": "f2c2c712841063be",
        "type": "OPCUA-IIoT-Read",
        "z": "12d77bbd6f79a8bf",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "484db7503e21eb9d",
        "name": "read serialNumber",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 410,
        "y": 580,
        "wires": [
            [
                "00e2bc9613cb309d"
            ]
        ]
    },
    {
        "id": "328e9a4f67df51fe",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 360,
        "wires": []
    },
    {
        "id": "69db8f7e0ce32439",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 1340,
        "wires": []
    },
    {
        "id": "d3db79d5217f406e",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "function 11",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 1400,
        "wires": [
            [
                "ac30716d1ba8e546",
                "6c55793d50e82b5e"
            ]
        ]
    },
    {
        "id": "ac30716d1ba8e546",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1010,
        "y": 1360,
        "wires": []
    },
    {
        "id": "6c55793d50e82b5e",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "function 12",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `MILL;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 1400,
        "wires": [
            [
                "0281ac883fa8ca1a"
            ]
        ]
    },
    {
        "id": "53625ba49b360793",
        "type": "comment",
        "z": "12d77bbd6f79a8bf",
        "name": "AIQS_OPC_UA",
        "info": "",
        "x": 340,
        "y": 1440,
        "wires": []
    },
    {
        "id": "0281ac883fa8ca1a",
        "type": "link out",
        "z": "12d77bbd6f79a8bf",
        "name": "link out 20",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1235,
        "y": 1440,
        "wires": []
    },
    {
        "id": "8e0949e1e6f61b36",
        "type": "inject",
        "z": "12d77bbd6f79a8bf",
        "name": "Start Mill",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 280,
        "y": 1260,
        "wires": [
            [
                "666a08fed92f6d4e"
            ]
        ]
    },
    {
        "id": "666a08fed92f6d4e",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "Write cmd__start_mill = true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=99\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 1260,
        "wires": [
            [
                "068999652675aff5"
            ]
        ]
    },
    {
        "id": "1fd8d39408e35d25",
        "type": "OPCUA-IIoT-Inject",
        "z": "12d77bbd6f79a8bf",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_MILL",
        "addressSpaceItems": [
            {
                "name": "Frser",
                "nodeId": "ns=4;i=35",
                "datatypeName": ""
            },
            {
                "name": "Raus",
                "nodeId": "ns=4;i=32",
                "datatypeName": ""
            },
            {
                "name": "Rein",
                "nodeId": "ns=4;i=31",
                "datatypeName": ""
            },
            {
                "name": "Runter/Hoch",
                "nodeId": "ns=4;i=33",
                "datatypeName": ""
            },
            {
                "name": "Band-Frser",
                "nodeId": "ns=4;i=29",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=30",
                "datatypeName": ""
            }
        ],
        "x": 290,
        "y": 1400,
        "wires": [
            [
                "7b01d6fe07b37452"
            ]
        ]
    },
    {
        "id": "7b01d6fe07b37452",
        "type": "OPCUA-IIoT-Listener",
        "z": "12d77bbd6f79a8bf",
        "connector": "484db7503e21eb9d",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 520,
        "y": 1400,
        "wires": [
            [
                "69db8f7e0ce32439",
                "d3db79d5217f406e"
            ]
        ]
    },
    {
        "id": "068999652675aff5",
        "type": "OPCUA-IIoT-Write",
        "z": "12d77bbd6f79a8bf",
        "connector": "484db7503e21eb9d",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 820,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "e2a7e40e85c3c573",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "variable setup",
        "func": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"MILL\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"MILL\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"mill\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"MILL001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/MILL001\"); // Added for consistency",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"MILL\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"MILL\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"mill\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"MILL001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/MILL001\"); // Added for consistency",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "7f1c8736ed1c6447",
        "type": "inject",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 160,
        "wires": [
            [
                "e2a7e40e85c3c573"
            ]
        ]
    },
    {
        "id": "a48f77bb1be968c4",
        "type": "function",
        "z": "12d77bbd6f79a8bf",
        "name": "Collect Flow State",
        "func": "const debugState = {\n    flowName: flow.get(\"flowName\"),\n    moduleState: flow.get(\"moduleState\"),\n    orderUpdateId: flow.get(\"orderUpdateId\"),\n    orderId: flow.get(\"orderId\"),\n    loads: flow.get(\"loads\"),\n    headerId: flow.get(\"headerId\"),\n    actionState: flow.get(\"actionState\"),\n    model: flow.get(\"model\"),\n    errors: flow.get(\"errors\"),\n    state: flow.get(\"state\"),\n    factsheet: flow.get(\"factsheet\"),\n    connection: flow.get(\"connection\"),\n    opcuaState: flow.get(\"opcuaState\"),\n    mqtt_topic: flow.get(\"MQTT_topic\")\n};\n\nmsg.payload = debugState;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1160,
        "wires": [
            [
                "39c6a0db72131967"
            ]
        ]
    },
    {
        "id": "39c6a0db72131967",
        "type": "debug",
        "z": "12d77bbd6f79a8bf",
        "name": "Debug Flow Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 1160,
        "wires": []
    },
    {
        "id": "87310e79598a269f",
        "type": "inject",
        "z": "12d77bbd6f79a8bf",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 1160,
        "wires": [
            [
                "a48f77bb1be968c4"
            ]
        ]
    },
    {
        "id": "b663066aa3c55353",
        "type": "OPCUA-IIoT-Listener",
        "z": "12d77bbd6f79a8bf",
        "connector": "484db7503e21eb9d",
        "action": "subscribe",
        "queueSize": 10,
        "name": "",
        "topic": "",
        "justValue": false,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 520,
        "y": 980,
        "wires": [
            [
                "d175178a06968f46"
            ]
        ]
    },
    {
        "id": "10428832a562bb0d",
        "type": "OPCUA-IIoT-Inject",
        "z": "12d77bbd6f79a8bf",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_DRILL",
        "addressSpaceItems": [
            {
                "name": "finish_pick",
                "nodeId": "ns=4;i=8",
                "datatypeName": ""
            },
            {
                "name": "finish_mill",
                "nodeId": "ns=4;i=10",
                "datatypeName": ""
            },
            {
                "name": "finish_drop",
                "nodeId": "ns=4;i=9",
                "datatypeName": ""
            }
        ],
        "x": 310,
        "y": 980,
        "wires": [
            [
                "b663066aa3c55353"
            ]
        ]
    },
    {
        "id": "5f7f07094e9adde1",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            },
            {
                "name": "version",
                "nodeId": "ns=4;i=45",
                "datatypeName": "String"
            }
        ],
        "x": 170,
        "y": 260,
        "wires": [
            [
                "eb0a5eb309fe6704"
            ]
        ]
    },
    {
        "id": "eb0a5eb309fe6704",
        "type": "OPCUA-IIoT-Read",
        "z": "2acde404c8501321",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "46f8b2363b259b7f",
        "name": "Read serial",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 370,
        "y": 260,
        "wires": [
            [
                "41f9a3d798edb230"
            ]
        ]
    },
    {
        "id": "6b4db1faee72887d",
        "type": "switch",
        "z": "2acde404c8501321",
        "name": "topicswitch",
        "property": "payload.nodeId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ns=4;i=37",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=10",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=21",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=34",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=15",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=9",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=24",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=36",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=11",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=17",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=19",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=38",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=13",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=35",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=12",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=8",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=26",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ns=4;i=28",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 19,
        "x": 850,
        "y": 1920,
        "wires": [
            [],
            [
                "b268df4a2b1ec997",
                "12dc75ef98250f1c"
            ],
            [],
            [],
            [
                "c11d22e275b948c0",
                "86fd5ef390d08162"
            ],
            [
                "12dc75ef98250f1c",
                "86fd5ef390d08162"
            ],
            [
                "126cee3c77536702"
            ],
            [],
            [
                "2f25d8061e838571",
                "12dc75ef98250f1c"
            ],
            [
                "9ffe624fe9c80c8d"
            ],
            [],
            [
                "126cee3c77536702"
            ],
            [],
            [
                "0424fc990b21791f",
                "12dc75ef98250f1c"
            ],
            [
                "12dc75ef98250f1c"
            ],
            [
                "44d833641c796fa7",
                "1f705e54fc5adf20"
            ],
            [
                "12dc75ef98250f1c",
                "1f705e54fc5adf20"
            ],
            [
                "126cee3c77536702"
            ],
            []
        ],
        "outputLabels": [
            "bad_aktiv",
            "bad_finished",
            "default_finished",
            "drop_aktiv",
            "drop_failed",
            "drop_finished",
            "fahre_finished",
            "good_aktiv",
            "good_finished",
            "idle",
            "kalib_aktiv",
            "kalib_finished",
            "move_to_cam_aktiv",
            "move_to_cam_finished",
            "pick_aktiv",
            "pick_failed",
            "pick_finished",
            "zurueck_finished",
            "zurueck_kurz_finished"
        ]
    },
    {
        "id": "60755152ac60ad51",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 1950,
        "y": 260,
        "wires": [
            [
                "5d62acb9285dbc6e",
                "2f8ad1a41d82caee"
            ]
        ]
    },
    {
        "id": "5d62acb9285dbc6e",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "Publish vda_status_RUNNING",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\nlet actionState = flow.get(\"actionState\");\nactionState.state = \"RUNNING\";\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = actionState;\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\n\nlet moduleState = flow.get(\"moduleState\");\nstate.moduleState =moduleState;\n\n\n\n\n// flowVariable Update\nflow.set(\"errors\", []);\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.payload = state;\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 260,
        "wires": [
            [
                "7a3d68557e4c5dc5",
                "854d353bbcb73a78"
            ]
        ]
    },
    {
        "id": "8b8f10bf7f1c7bee",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "internal state txt",
        "func": "msg.topic = flow.get(\"TXT_MQTT_topic\") + \"/state\";\nmsg.action = \"subscribe\";\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 1180,
        "wires": [
            [
                "8d73691b68a65639"
            ]
        ]
    },
    {
        "id": "43a127570f7bbc14",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "PICK",
        "func": "// wenn nicht IDLE dann nichts tun\nif (flow.get(\"moduleState\") == \"IDLE\") {\n    // loads for order im Flow speichern\n    let loads = flow.get(\"loads\");\n    let newLoad = loads[0] ?? {};\n    newLoad.loadType = msg.payload.action.metadata.type;\n    flow.set(\"loads\", [newLoad]);\n\n    // ModulState busy setzen\n    flow.set(\"moduleState\", \"RPICK\"); // modulestate zu \"RUNNING PICK\" setzen\n\n    // OPCUA Write Content\n    // msg.payload.valuesToWrite = [{ \"value\": true }];\n    // msg.payload.nodesToWrite = [{ \"name\": \"pick\", \"nodeId\": \"ns=4;i=4\", \"datatypeName\": \"Boolean\" }];\n\n    // // OPCUA write Content\n    // msg.payload.nodetype = \"inject\";\n    // msg.payload.injectType = \"write\";\n\n         flow.set(\"actionState\", msg.payload.action);\n\n                msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=4\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n\n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Internal modulestate accepts only PICK \"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 180,
        "wires": [
            [
                "60755152ac60ad51"
            ],
            [
                "7d890885ce89317a"
            ]
        ]
    },
    {
        "id": "b5a39936ed47d538",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "CHECK_QUALITY",
        "func": "// CHECK_QUALITY\nif (flow.get(\"moduleState\") == \"WCQ\") {\n    \n    // ModulState setzen\n    flow.set(\"moduleState\", \"RCQ\"); // Running Check Quality\n\n    // OPCUA Write Content\n    msg.payload.valuesToWrite = [{ \"value\": true }];\n    msg.payload.nodesToWrite = [{ \"name\": \"move_to_camera\", \"nodeId\": \"ns=4;i=14\", \"datatypeName\": \"Boolean\" }];\n\n    // OPCUA write Content\n    msg.payload.nodetype = \"inject\";\n    msg.payload.injectType = \"write\";\n\n    return [msg, null];\n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Internal modulestate accepts only CHECK_QUALITY\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 260,
        "wires": [
            [
                "60755152ac60ad51"
            ],
            [
                "7d890885ce89317a"
            ]
        ]
    },
    {
        "id": "aec0ec48cfc5dd40",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "DROP",
        "func": "// Drop\nif (flow.get(\"moduleState\") == \"WDROP\") {\n\n    // ModulState busy setzen\n            flow.set(\"moduleState\", \"RDROP\");\n\n            \n             flow.set(\"actionState\", msg.payload.action);\n\n\n            msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=5\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n\n            \n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Internal modulestate accepts only DROP\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}\n\n\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 220,
        "wires": [
            [
                "60755152ac60ad51"
            ],
            [
                "7d890885ce89317a"
            ]
        ]
    },
    {
        "id": "0424fc990b21791f",
        "type": "function",
        "z": "2acde404c8501321",
        "g": "c5d50add89336f77",
        "name": "Nachricht fr Controller mit Cam",
        "func": "let moduleState = flow.get(\"moduleState\");\nlet value = msg.payload.value.value.value;\n\nif (value != true) {\n    return;\n} else {\n    if (moduleState != \"RCQ\") {\n        msg.payload = {\n            \"value\": value,\n            \"moduleState\": moduleState\n        };\n        return msg;\n    } else {\n        // modulestate auf waiting for Result\n        flow.set(\"moduleState\", \"WR\");\n        let actionState = flow.get(\"actionState\");\n        let action = {};\n        action.command = actionState.command;\n        action.id = actionState.id;\n        action.metadata = actionState.metadata;\n        \n        // Timestamp\n        let now = new Date();\n        let timestamp = now.toISOString();\n\n\n        \n        let moduleState = flow.get(\"moduleState\");\n        msg.payload.moduleState = moduleState;\n\n\n\n\n        // Nachricht an den Controller mit Kamera\n        msg.payload = {\n            \"serialNumber\": flow.get(\"serialNumber\"),\n            \"orderId\": flow.get(\"orderId\"),\n            \"orderUpdateId\": flow.get(\"orderUpdateId\" ) + 10,\n            \"timestamp\": timestamp,\n            \"action\": action\n        }\n\n        msg.topic = flow.get(\"TXT_MQTT_topic\") + \"/order\";\n\n        return msg;\n    }\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 1980,
        "wires": [
            [
                "0e1592f93726ce2e",
                "fc1841ebfae81247"
            ]
        ]
    },
    {
        "id": "1f705e54fc5adf20",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "vda_status_finished PICK",
        "func": "// wenn \"TRUE\" im OPCUA und die richtige interne state\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"RPICK\") {\n\n    // state\n    let state = flow.get(\"state\");\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    // erfolgreich mit der NodeId\n    if (msg.payload.nodeId == \"ns=4;i=8\") {\n        flow.set(\"moduleState\", \"WCQ\");\n        actionState.state = \"FINISHED\"; // Waiting for FTS\n    }\n\n    // nicht erfolgreich mit der NodeId\n    else if (msg.payload.nodeId == \"ns=4;i=12\") {\n\n        let error = {\n            timestamp,\n            \"errorType\": \"PICK_failed\",\n            \"errorMessage\": \"PICK failed\",\n            \"errorLevel\": \"FATAL\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        actionState.state = \"FAILED\"; // FAILED PICK\n        errors.push(error);\n        flow.set(\"errors\", errors);\n        flow.set(\"moduleState\", \"IDLE\");\n    }\n\n    state.headerId = headerId;\n    state.loads = flow.get(\"loads\");\n    state.actionState = flow.get(\"actionState\");\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = errors;\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n} else {\n    return;\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 1740,
        "wires": [
            [
                "18fdf11aa09f0f91",
                "7b5ad9fd0e960ec4"
            ],
            [
                "ae2bfc4d7d088a14"
            ]
        ]
    },
    {
        "id": "86fd5ef390d08162",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "vda_status_finished DROP",
        "func": "// wenn OPCUA den Wert True liefert\nif (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"RDROP\") {\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n    let headerId = flow.get(\"headerId\");\n    let actionState = flow.get(\"actionState\");\n    let state = flow.get(\"state\");\n    let flowErrors = flow.get(\"errors\") ?? [];\n    let errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // wenn drop_finished gesetzt wurde (erfolgreich)\n    if (msg.payload.nodeId == \"ns=4;i=9\") {\n        actionState.state = \"FINISHED\";\n    }\n\n    // wenn drop_failed gesetzt wurde (nicht erfolgreich)\n    else if (msg.payload.nodeId == \"ns=4;i=15\") {\n        actionState.state = \"FAILED\";\n        let error = {\n            timestamp,\n            \"errorType\": \"DROP_failed\",\n            \"errorMessage\": \"DROP failed\",\n            \"errorLevel\": \"WARNING\",\n            \"errorReferences\": [\n                { \"topic\": \"order\" },\n                { \"headerId\": flow.get(\"headerId\") },\n                { \"orderId\": flow.get(\"orderId\") },\n                { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n            ],\n        }\n        errors.push(error);\n    } else {\n        return\n    }\n\n    // state\n    state.headerId = headerId;\n    state.loads = [];\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    state.errors = errors;\n\n    // headerId Update\n    flow.set(\"headerId\", headerId + 1);\n    flow.set(\"orderId\", \"0\");\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"loads\", []);\n    flow.set(\"moduleState\", \"IDLE\");\n    flow.set(\"errors\", []);\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1620,
        "y": 1780,
        "wires": [
            [
                "18fdf11aa09f0f91",
                "7b5ad9fd0e960ec4"
            ],
            [
                "ae2bfc4d7d088a14"
            ]
        ]
    },
    {
        "id": "2f25d8061e838571",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "vda_status_finished GOOD",
        "func": "if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"RGOOD\") {\n    flow.set(\"moduleState\", \"WDROP\"); // waiting for drop\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    // actionstate von order holen und anpassen\n    let actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\"; // Waiting for FTS\n     actionState.result = \"PASSED\";\n    // state bauen\n    let state = flow.get(\"state\");\n    state.headerId = flow.get(\"headerId\");\n    state.loads = flow.get(\"loads\");\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // Flow Update\n    flow.set(\"headerId\", state.headerId + 1);\n    flow.set(\"actionState\", actionState);\n    flow.set(\"errors\", []);\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1640,
        "y": 1880,
        "wires": [
            [
                "18fdf11aa09f0f91",
                "7b5ad9fd0e960ec4"
            ]
        ]
    },
    {
        "id": "b268df4a2b1ec997",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "vda_status_finished BAD",
        "func": "if (msg.payload.value.value.value == true && flow.get(\"moduleState\") == \"RBAD\") {\n    \n    flow.set(\"moduleState\", \"IDLE\"); // return to IDLE\n    // Timestamp\n    let now = new Date();\n    let timestamp = now.toISOString();\n\n    // set actionstate\n    let actionState = flow.get(\"actionState\");\n    actionState.state = \"FINISHED\"; // Waiting for FTS\n\n\n    actionState.result = \"FAILED\";\n    let loads = [];\n\n    // state bauen\n    let state = flow.get(\"state\");\n    state.headerId = flow.get(\"headerId\");\n    state.loads = loads;\n    state.actionState = actionState;\n    state.timestamp = timestamp;\n    state.orderId = flow.get(\"orderId\");\n    state.orderUpdateId = flow.get(\"orderUpdateId\");\n    const flowErrors = flow.get(\"errors\") ?? [];\n    state.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n    // Flow Update\n    flow.set(\"headerId\", state.headerId + 1);\n    flow.set(\"actionState\", actionState);\n    flow.set(\"errors\", []);\n\n    flow.set(\"orderId\", \"0\");\n    flow.set(\"orderUpdateId\", 0);\n    flow.set(\"loads\", loads);\n    flow.set(\"actionState\", {});\n\n    let moduleState = flow.get(\"moduleState\");\n    state.moduleState = moduleState;\n\n    msg.topic = flow.get(\"MQTT_topic\") + \"/state\";\n    msg.payload = state;\n    return msg;\n}\nelse {\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 1840,
        "wires": [
            [
                "18fdf11aa09f0f91",
                "7b5ad9fd0e960ec4"
            ]
        ]
    },
    {
        "id": "44d4c6b781d97f07",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "state subscription handle",
        "func": "if (flow.get(\"moduleState\") != \"WR\") {\n    return;\n}\nlet actionStateCommand = msg.payload.actionState?.command ?? \"unknown\";\nlet actionStateState = msg.payload.actionState?.state ?? \"unknown\";\nlet result = msg.payload.actionState?.result ?? \"noResult\";\nlet actionState = flow.get(\"actionState\");\n\n//Vorbereitungen fr OPCUA write\nmsg.payload.nodetype = \"inject\";\nmsg.payload.injectType = \"write\";\n\n// Fallunterscheidung fr gutes oder schlechtes Werkstck\n\nif (actionStateCommand != \"CHECK_QUALITY\" || msg.payload.actionState.state != \"FINISHED\") {\n    return;\n}\n\nif (result == \"PASSED\") {\n    // Adresse fr gutes Werkstck\n    // msg.payload.valuesToWrite = [{ \"value\": true }];\n    // msg.payload.nodesToWrite = [{ \"name\": \"good\", \"nodeId\": \"ns=4;i=6\", \"datatypeName\": \"Boolean\" }];\n    // flow.set(\"moduleState\", \"RGOOD\"); // Running Good Quality\n    // actionState.result = result;\n    // flow.set(\"actionState\", actionState);\n    // return [msg, null];\n\n     flow.set(\"moduleState\", \"RGOOD\"); \n\n                msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=6\", \n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n\n\n\n} else if (result == \"FAILED\") {\n    // Adresse fr schlechtes Werkstck\n   // msg.payload.valuesToWrite = [{ \"value\": true }];\n   // msg.payload.nodesToWrite = [{ \"name\": \"bad\", \"nodeId\": \"ns=4;i=7\", \"datatypeName\": \"Boolean\" }];\n    flow.set(\"moduleState\", \"RBAD\"); // Running Bad Quality\n    //actionState.result = result;\n    flow.set(\"actionState\", actionState);\n\n                    msg.payload = {\n                injectType: \"write\",\n                nodetype: \"inject\",\n                nodesToWrite: [\n                    {\n                        nodeId: \"ns=4;i=7\", // Replace with your actual NodeId for cmd__start_drill\n                        datatypeName: \"Boolean\",\n                        value: true\n                    }\n                ]\n            };\n            return msg;\n\n\n\n\n//    return [msg, null];\n} else {\n    let error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"FATAL\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Result not specified or no Result\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1830,
        "y": 1200,
        "wires": [
            [
                "1c5e505ecfb68349"
            ],
            [
                "ae2bfc4d7d088a14"
            ]
        ]
    },
    {
        "id": "0e1592f93726ce2e",
        "type": "debug",
        "z": "2acde404c8501321",
        "g": "c5d50add89336f77",
        "name": "order to TXT",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 1960,
        "wires": []
    },
    {
        "id": "1adc2902f16e4ada",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "internal connection txt",
        "func": "\nconst serialNumberObj = msg.payload.resultsConverted[0] ?? {};\nconst serialNumber = serialNumberObj.value.trim().replace(\" \", \"\").replace(\"-\", \"\");\n\n\nconst spsSerialNumber = flow.get(\"serialNumber\");\nflow.set('TXT_MQTT_topic', `module/v1/ff/NodeRed/${serialNumber}`);\n\n// msg.topic = flow.get(\"TXT_MQTT_topic\");\n// msg.payload = {\n//     \"host\": serialNumber,\n//     \"serialNumber\": serialNumber,\n//     \"timestamp\": new Date().toISOString(),\n//     \"actions\": [\n//         {\n//             \"actionId\": \"SOME_ID\",\n//             \"actionType\": \"factsheetRequest\",\n//             \"metadata\": {}\n//         }\n//     ]\n// }\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 1120,
        "wires": [
            [
                "8b8f10bf7f1c7bee"
            ]
        ]
    },
    {
        "id": "8d73691b68a65639",
        "type": "mqtt in",
        "z": "2acde404c8501321",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 1390,
        "y": 1180,
        "wires": [
            [
                "44d4c6b781d97f07"
            ]
        ]
    },
    {
        "id": "1c5e505ecfb68349",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 2090,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "9ffe624fe9c80c8d",
        "type": "change",
        "z": "2acde404c8501321",
        "name": "OPCUA state IDLE",
        "rules": [
            {
                "t": "set",
                "p": "SPS_idle",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1230,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "44d833641c796fa7",
        "type": "change",
        "z": "2acde404c8501321",
        "name": "OPCUA state PICK",
        "rules": [
            {
                "t": "set",
                "p": "pick_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1230,
        "y": 1760,
        "wires": [
            []
        ]
    },
    {
        "id": "c11d22e275b948c0",
        "type": "change",
        "z": "2acde404c8501321",
        "name": "OPCUA state DROP",
        "rules": [
            {
                "t": "set",
                "p": "drop_failed",
                "pt": "flow",
                "to": "payload.value.value.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "9d8fe5bf747f5511",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "vda_action factsheetRequest",
        "func": "/**\n * @typedef {object} ActionState\n * @property {string} id\n * @property {string} state\n * @property {string} command\n * @property {object} [metadata]\n * \n * @param {string} state\n * @returns {ActionState}\n */\nfunction updateActionState(state, metadata = undefined) {\n    const actionState = flow.get(\"actionState\") ?? {};\n    actionState.id = msg.actionId;\n    actionState.state = state;\n    actionState.command = msg.actionCommand;\n    actionState.metadata = metadata ?? undefined;\n    flow.set(\"actionState\", actionState);\n    return actionState;\n}\n\nconst actionState = updateActionState(\"RUNNING\");\n\n// factsheet timestamp aktualisieren\nconst factsheet = flow.get(\"factsheet\");\nfactsheet.timestamp = new Date().toISOString();\nflow.set(\"factsheet\", factsheet);\n\n//publish on topic\nmsg.topic = flow.get(\"MQTT_topic\") + \"/factsheet\";\nmsg.payload = factsheet;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 520,
        "wires": [
            [
                "f49445298902a6ec",
                "7c3723eae19c30ca"
            ]
        ]
    },
    {
        "id": "57aa850724bd23e9",
        "type": "OPCUA-IIoT-Browser",
        "z": "2acde404c8501321",
        "nodeId": "ns=4;i=2",
        "name": "browse",
        "justValue": true,
        "sendNodesToRead": false,
        "sendNodesToBrowser": false,
        "sendNodesToListener": true,
        "multipleOutputs": false,
        "showStatusActivities": true,
        "showErrors": true,
        "recursiveBrowse": false,
        "recursiveDepth": 1,
        "delayPerMessage": 0.2,
        "connector": "46f8b2363b259b7f",
        "x": 440,
        "y": 1600,
        "wires": [
            [
                "628f1ccb31682ff4",
                "c02491164c2a45a4",
                "06dbce976e834b24"
            ]
        ]
    },
    {
        "id": "9732bb5fed4a9ab9",
        "type": "OPCUA-IIoT-Listener",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "action": "subscribe",
        "queueSize": "20",
        "name": "",
        "topic": "",
        "justValue": false,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 660,
        "y": 1920,
        "wires": [
            [
                "6b4db1faee72887d"
            ]
        ]
    },
    {
        "id": "628f1ccb31682ff4",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "browser",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 1640,
        "wires": []
    },
    {
        "id": "86142316ed79d443",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "injectType": "inject",
        "payload": "{\"interval\":100}",
        "payloadType": "json",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "10",
        "name": "inject",
        "addressSpaceItems": [],
        "x": 270,
        "y": 1580,
        "wires": [
            [
                "57aa850724bd23e9"
            ]
        ]
    },
    {
        "id": "c02491164c2a45a4",
        "type": "change",
        "z": "2acde404c8501321",
        "name": "BrowserArray",
        "rules": [
            {
                "t": "set",
                "p": "BrowseArray",
                "pt": "flow",
                "to": "payload.browserResults",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "18fdf11aa09f0f91",
        "type": "link out",
        "z": "2acde404c8501321",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2285,
        "y": 1860,
        "wires": []
    },
    {
        "id": "12dc75ef98250f1c",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Finish listener out",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 1620,
        "wires": []
    },
    {
        "id": "7b5ad9fd0e960ec4",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "FINISHED_STATE_msg",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2190,
        "y": 1580,
        "wires": []
    },
    {
        "id": "41f9a3d798edb230",
        "type": "subflow:4a591b1ca8fe0bf6",
        "z": "2acde404c8501321",
        "name": "",
        "x": 580,
        "y": 260,
        "wires": [
            [
                "c3467c46a724a26f",
                "ae86f0198aabfcea"
            ],
            [
                "46e9d7aa518574fc"
            ],
            [
                "81dc4bad09c17a79",
                "7a3d68557e4c5dc5"
            ]
        ]
    },
    {
        "id": "f49445298902a6ec",
        "type": "link out",
        "z": "2acde404c8501321",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2515,
        "y": 520,
        "wires": []
    },
    {
        "id": "46e9d7aa518574fc",
        "type": "switch",
        "z": "2acde404c8501321",
        "name": "instantActionSwitch",
        "property": "instantAction",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "factsheetRequest",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "startCalibration",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "stopCalibration",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "setCalibrationValues",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "storeCalibrationValues",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "selectCalibrationPosition",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "testCalibrationPosition",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "resetCalibration",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "reset",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 970,
        "y": 660,
        "wires": [
            [
                "9d8fe5bf747f5511"
            ],
            [
                "e43ecca64aab42f3"
            ],
            [
                "6b4f79d2abe99a7b"
            ],
            [
                "37bc901afa8cb064"
            ],
            [
                "d8fe14348e43c001"
            ],
            [
                "e4b7b771ed9a06cc"
            ],
            [
                "a0a3e3a554433347",
                "702e0d4ef7f8668c"
            ],
            [
                "a54f8bb6e58787b3"
            ],
            [
                "e2ea4080e41bf815"
            ]
        ]
    },
    {
        "id": "7d890885ce89317a",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "publish errorState",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = flow.get(\"actionState\");\nstate.actionState.state = \"FAILED\";\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// Flow Update\nflow.set(\"errors\", []);\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 320,
        "wires": [
            [
                "7a3d68557e4c5dc5",
                "03a4058dc9a17fdb"
            ]
        ]
    },
    {
        "id": "7a3d68557e4c5dc5",
        "type": "link out",
        "z": "2acde404c8501321",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2475,
        "y": 300,
        "wires": []
    },
    {
        "id": "0fc7da9230e32d86",
        "type": "link out",
        "z": "2acde404c8501321",
        "name": "MQTT_retained",
        "mode": "link",
        "links": [
            "4f49132e8d1d3911"
        ],
        "x": 2255,
        "y": 1360,
        "wires": []
    },
    {
        "id": "ae2bfc4d7d088a14",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "publish errorState",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = flow.get(\"actionState\");\nstate.actionState.state = \"FAILED\";\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// Flow Update\nflow.set(\"errors\", []);\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2110,
        "y": 1360,
        "wires": [
            [
                "0fc7da9230e32d86"
            ]
        ]
    },
    {
        "id": "e43ecca64aab42f3",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "startCalibration",
        "func": "/**\n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {{referenceKey: string, referenceValue: number}[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\n/**\n * @param {string} nodeName\n * @param {number} nodeValue\n * @returns {ReferenceData}\n */\nfunction createReferenceData(nodeName, nodeValue) {\n    return {\n        referenceKey: nodeName,\n        referenceValue: nodeValue,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {ReferenceData[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            const refData = createReferenceData(nodeName, nodeValue);\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions() {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": currentPosition },\n        ]\n    }\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"IDLE\" || moduleState == \"CALIBRATION\") {\n    flow.set(\"moduleState\", \"CALIBRATION\");\n\n    const isCalibActive = flow.get(\"calibration.state.stat__calibActive.nodeValue\") ?? false;\n    msg.calibrationData = [createCalibrationData(), createCalibrationPositions()];\n    msg.modulePaused = true;\n    msg.operatingMode = \"TEACHIN\";\n    msg.actionCommand = \"startCalibration\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite: [\n            { nodeId: \"ns=4;i=16\", \"datatypeName\": \"Boolean\" }\n        ],\n        valuesToWrite: [\n            { value: !isCalibActive }\n        ]\n    };\n    return msg;\n} else {\n    createError(\"Module is not IDLE and cannot be set to CALIBRATION mode\");\n    return [null, msg];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 620,
        "wires": [
            [
                "d55eaf27274acc02",
                "b69933bb7d965165"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "b401e8879ea85010",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "publish errorState",
        "func": "// Timestamp\nlet now = new Date();\nlet timestamp = now.toISOString();\n\n// state bauen\nlet state = flow.get(\"state\");\nstate.headerId = flow.get(\"headerId\");\nstate.loads = flow.get(\"loads\");\nstate.actionState = flow.get(\"actionState\");\nstate.actionState.state = \"FAILED\";\nstate.timestamp = timestamp;\nstate.orderId = flow.get(\"orderId\");\nstate.orderUpdateId = flow.get(\"orderUpdateId\");\nconst flowErrors = flow.get(\"errors\") ?? [];\nstate.errors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n\n// Flow Update\nflow.set(\"errors\", []);\nflow.set(\"headerId\", state.headerId + 1);\n\nmsg.topic = flow.get(\"MQTT_topic\") + \"/state\";\nmsg.payload = state\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 760,
        "wires": [
            [
                "f49445298902a6ec"
            ]
        ]
    },
    {
        "id": "6b4f79d2abe99a7b",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "stopCalibration",
        "func": "/**\n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {{referenceKey: string, referenceValue: number}[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    flow.set(\"moduleState\", \"IDLE\");\n    flow.set(\"state.information\", []);\n\n    msg.actionCommand = \"stopCalibration\";\n    msg.calibrationData = [];\n    msg.modulePaused = false;\n    msg.operatingMode = \"AUTOMATIC\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite: [\n            { nodeId: \"ns=4;i=18\", \"datatypeName\": \"Boolean\" }\n        ],\n        valuesToWrite: [\n            { value: true }\n        ]\n    };\n    return msg;\n} else {\n    createError(\"Module is not in CALIBRATION mode\");\n    return [null, msg];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 660,
        "wires": [
            [
                "9cf1a6828632aea8",
                "b69933bb7d965165"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "9cf1a6828632aea8",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 1650,
        "y": 680,
        "wires": [
            [
                "0a78a28c7c773a25",
                "a7ec42e748cb6d6a"
            ]
        ]
    },
    {
        "id": "37bc901afa8cb064",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "setCalibrationValues",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n *\n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\n/**\n * @param {ActionMetadata} metadata\n * @returns {{ nodesToWrite: Array, valuesToWrite: Array }}\n */\nfunction createOpcuaUpdate(metadata) {\n    if (metadata.references?.length > 0) {\n        const nodesToWrite = [];\n        const valuesToWrite = [];\n        for (let ref of metadata.references) {\n            /** @type {CalibrationValue} */\n            const toUpdate = flow.get(`calibration.state.${ref.referenceKey}`);\n            nodesToWrite.push({ nodeId: toUpdate.nodeId, \"datatypeName\": \"Int32\" });\n            valuesToWrite.push({ value: ref.referenceValue });\n        }\n        return { nodesToWrite, valuesToWrite };\n    }\n    return { nodesToWrite: [], valuesToWrite: [] };\n}\n\n/**\n * @param {string} nodeName\n * @param {number} nodeValue\n * @returns {ReferenceData}\n */\nfunction createReferenceData(nodeName, nodeValue) {\n    return {\n        referenceKey: nodeName,\n        referenceValue: nodeValue,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {Reference[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            /** @tye {Reference} */\n            const refData = {\n                referenceKey: nodeName,\n                referenceValue: nodeValue,\n            };\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions() {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": currentPosition },\n        ]\n    }\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    const metadata = msg.actionMetadata;\n    const { nodesToWrite, valuesToWrite } = createOpcuaUpdate(metadata);\n\n    msg.calibrationData = [createCalibrationData(), createCalibrationPositions()];\n    msg.actionCommand = \"setCalibrationValues\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite,\n        valuesToWrite,\n    };\n    return msg;\n} else {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Module is not in CALIBRATION mode\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 700,
        "wires": [
            [
                "b69933bb7d965165",
                "d55eaf27274acc02"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "d8fe14348e43c001",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "storeCalibrationValues",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n *\n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\n/**\n * @param {ActionMetadata} metadata\n * @returns {{ nodesToWrite: Array, valuesToWrite: Array }}\n */\nfunction createOpcuaUpdate(metadata) {\n    if (metadata.references?.length > 0) {\n        const nodesToWrite = [];\n        const valuesToWrite = [];\n        for (let ref of metadata.references) {\n            /** @type {CalibrationValue} */\n            const toUpdate = flow.get(`calibration.state.${ref.referenceKey}`);\n            nodesToWrite.push({ nodeId: toUpdate.nodeId, \"datatypeName\": \"Int32\" });\n            valuesToWrite.push({ value: toUpdate.nodeValue });\n        }\n        return { nodesToWrite, valuesToWrite };\n    }\n    return { nodesToWrite: [], valuesToWrite: [] };\n}\n\n/**\n * @param {string} nodeName\n * @param {number} nodeValue\n * @returns {ReferenceData}\n */\nfunction createReferenceData(nodeName, nodeValue) {\n    return {\n        referenceKey: nodeName,\n        referenceValue: nodeValue,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {Reference[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            /** @tye {Reference} */\n            const refData = {\n                referenceKey: nodeName,\n                referenceValue: nodeValue,\n            };\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions() {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": currentPosition },\n        ]\n    }\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    const metadata = msg.actionMetadata;\n    const { nodesToWrite, valuesToWrite } = createOpcuaUpdate(metadata);\n\n    msg.calibrationData = [createCalibrationData(), createCalibrationPositions()];\n    msg.actionCommand = \"storeCalibrationValues\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite,\n        valuesToWrite,\n    };\n    return msg;\n} else {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Module is not in CALIBRATION mode\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 740,
        "wires": [
            [
                "b69933bb7d965165",
                "d55eaf27274acc02"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "e4b7b771ed9a06cc",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "selectCalibrationPosition",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n *\n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {Reference[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            /** @tye {Reference} */\n            const refData = {\n                referenceKey: nodeName,\n                referenceValue: nodeValue,\n            };\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions() {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": currentPosition },\n        ]\n    }\n}\n\n/**\n * @returns {{ nodesToWrite: Array, valuesToWrite: Array }}\n */\nfunction createOpcuaUpdate() {\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    if (currentPosition?.length > 0) {\n        let nodesToWrite = [];\n        let valuesToWrite = [];\n\n        switch (currentPosition) {\n            case \"TO_NIO_BIN\": {\n                const nodeValue = flow.get(\"calibration.state.cal__badTime.nodeValue\") ?? 0;\n                nodesToWrite = [{ nodeId: \"ns=4;i=23\", \"datatypeName\": \"Int32\" }];\n                valuesToWrite = [{ value: nodeValue }];\n                break;\n            }\n            case \"TO_CAMERA\": {\n                const nodeValue = flow.get(\"calibration.state.cal__cameraTime.nodeValue\") ?? 0;\n                nodesToWrite = [{ nodeId: \"ns=4;i=23\", \"datatypeName\": \"Int32\" }];\n                valuesToWrite = [{ value: nodeValue }];\n                break;\n            }\n            case \"CHECK\": {\n                const nodeValue = 0;\n                nodesToWrite = [{ nodeId: \"ns=4;i=23\", \"datatypeName\": \"Int32\" }];\n                valuesToWrite = [{ value: nodeValue }];\n                break;\n            }\n            case \"TO_PICKUP\": {\n                // We stop the movement, if the workpiece is detected by the photoelectric sensor\n                const nodeValue = 60000;\n                nodesToWrite = [{ nodeId: \"ns=4;i=23\", \"datatypeName\": \"Int32\" }];\n                valuesToWrite = [{ value: nodeValue }];\n                break;\n            }\n        }\n        return { nodesToWrite, valuesToWrite };\n    }\n    return { nodesToWrite: [], valuesToWrite: [] };\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    /** @type {ActionMetadata} */\n    const metadata = msg.actionMetadata;\n    /** @type {string[]} */\n    const availablePosition = flow.get(\"calibration.positions.available\");\n    if (availablePosition.indexOf(metadata.position) == -1) {\n        createError(`${metadata.position} is not a valid position`);\n        return [null, msg];\n    }\n\n    const newPosition = metadata.position;\n    flow.set(\"calibration.positions.current\", newPosition);\n\n    const { nodesToWrite, valuesToWrite } = createOpcuaUpdate();\n\n    msg.calibrationData = [createCalibrationData(), createCalibrationPositions()];\n    msg.actionCommand = \"selectCalibrationPosition\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite,\n        valuesToWrite,\n    };\n    return msg;\n} else {\n    createError(\"Module is not in CALIBRATION mode\");\n    return [null, msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "b69933bb7d965165",
                "d55eaf27274acc02"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "a0a3e3a554433347",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "testCalibrationPosition",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {Reference[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n * \n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\n/**\n * @param {string} message\n * @param {string} [errorLevel]\n */\nfunction createError(message, errorLevel = \"WARNING\") {\n    const flowErrors = flow.get(\"errors\") ?? [];\n    const existingErrors = Array.isArray(flowErrors) ? flowErrors : [flowErrors];\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": errorLevel,\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": message\n    }\n    flow.set(\"errors\", [...existingErrors, error]);\n    return error;\n}\n\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {Reference[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            /** @tye {Reference} */\n            const refData = {\n                referenceKey: nodeName,\n                referenceValue: nodeValue,\n            };\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @param {string} newCurrentPosition\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions(newCurrentPosition) {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": newCurrentPosition },\n        ]\n    }\n}\n\n/**\n * @param {ActionMetadata} metadata\n * @returns {{ nodesToWrite: Array, valuesToWrite: Array }}\n */\nfunction createOpcuaUpdate(metadata) {\n    if (metadata.position?.length > 0) {\n        let nodesToWrite = [];\n        let valuesToWrite = [];\n\n        switch (metadata.position) {\n            case \"TO_NIO_BIN\": {\n                nodesToWrite = [{ nodeId: \"ns=4;i=22\", \"datatypeName\": \"Boolean\" }];\n                valuesToWrite = [{ value: true }];\n                break;\n            }\n            case \"TO_CAMERA\": {\n                nodesToWrite = [{ nodeId: \"ns=4;i=22\", \"datatypeName\": \"Boolean\" }];\n                valuesToWrite = [{ value: true }];\n                break;\n            }\n            case \"CHECK\": {\n                nodesToWrite = [{ nodeId: \"ns=4;i=22\", \"datatypeName\": \"Boolean\" }];\n                valuesToWrite = [{ value: false }];\n                break;\n            }\n            case \"TO_PICKUP\": {\n                nodesToWrite = [{ nodeId: \"ns=4;i=25\", \"datatypeName\": \"Boolean\" }];\n                valuesToWrite = [{ value: true }];\n                break;\n            }\n        }\n        return { nodesToWrite, valuesToWrite };\n    }\n    return { nodesToWrite: [], valuesToWrite: [] };\n}\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    /** @type {ActionMetadata} */\n    const metadata = msg.actionMetadata;\n    const { nodesToWrite, valuesToWrite } = createOpcuaUpdate(metadata);\n    msg.calibrationData = [createCalibrationData(), createCalibrationPositions(metadata)];\n    msg.actionCommand = \"testCalibrationPosition\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite,\n        valuesToWrite\n    };\n    return msg;\n} else {\n    createError(\"Module is not in CALIBRATION mode\");\n    return [null, msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 820,
        "wires": [
            [
                "9cf1a6828632aea8",
                "b69933bb7d965165"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "a54f8bb6e58787b3",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "resetCalibration",
        "func": "/**\n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {{referenceKey: string, referenceValue: number}[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n */\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    msg.actionCommand = \"resetCalibration\";\n    msg.payload = {\n        nodetype: 'inject',\n        injectType: 'write',\n        nodesToWrite: [\n            { nodeId: \"ns=4;i=20\", \"datatypeName\": \"Boolean\" }\n        ],\n        valuesToWrite: [\n            { value: true }\n        ]\n    };\n    return msg;\n} else {\n    const error = {\n        \"errorType\": \"Validation\",\n        \"errorLevel\": \"WARNING\",\n        \"errorReferences\": [\n            { \"topic\": \"order\" },\n            { \"headerId\": flow.get(\"headerId\") },\n            { \"orderId\": flow.get(\"orderId\") },\n            { \"orderUpdateId\": flow.get(\"orderUpdateId\") }\n        ],\n        \"errorMessage\": \"Module is not in CALIBRATION mode\"\n    }\n    flow.set(\"errors\", error);\n    return [null, msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 860,
        "wires": [
            [
                "9cf1a6828632aea8",
                "b69933bb7d965165"
            ],
            [
                "b401e8879ea85010"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite",
            "error"
        ]
    },
    {
        "id": "d3c35b0929606b75",
        "type": "catch",
        "z": "2acde404c8501321",
        "name": "Catch all Errors",
        "scope": null,
        "uncaught": true,
        "x": 160,
        "y": 140,
        "wires": [
            [
                "1cf2922f8e395b17"
            ]
        ]
    },
    {
        "id": "1cf2922f8e395b17",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "display-error",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 140,
        "wires": []
    },
    {
        "id": "c3467c46a724a26f",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Order To Handle",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 160,
        "wires": []
    },
    {
        "id": "8bd22ccbf48a2191",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "updated state message",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 80,
        "wires": []
    },
    {
        "id": "2f8ad1a41d82caee",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "After Write",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2150,
        "y": 180,
        "wires": []
    },
    {
        "id": "03a4058dc9a17fdb",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Publish error",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2230,
        "y": 380,
        "wires": []
    },
    {
        "id": "854d353bbcb73a78",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Publish running",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2480,
        "y": 160,
        "wires": []
    },
    {
        "id": "81dc4bad09c17a79",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Errors after subflow",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 320,
        "wires": []
    },
    {
        "id": "d55eaf27274acc02",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 1650,
        "y": 620,
        "wires": [
            [
                "9c1458385571fc8c",
                "0a78a28c7c773a25"
            ]
        ]
    },
    {
        "id": "9c1458385571fc8c",
        "type": "delay",
        "z": "2acde404c8501321",
        "name": "",
        "pauseType": "delay",
        "timeout": "1.5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1810,
        "y": 620,
        "wires": [
            [
                "c031bb426a50dcf9"
            ]
        ]
    },
    {
        "id": "c031bb426a50dcf9",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "update-calibration-data",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n *\n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\n/**\n * @param {string} nodeName\n * @param {number} nodeValue\n * @returns {ReferenceData}\n */\nfunction createReferenceData(nodeName, nodeValue) {\n    return {\n        referenceKey: nodeName,\n        referenceValue: nodeValue,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationData() {\n    /** @type {Record<string, CalibrationValue>} */\n    const calibrationState = flow.get(\"calibration.state\") ?? {};\n    /** @type {Reference[]} */\n    const infoReferences = Object.keys(calibrationState)\n        .filter(key => key.indexOf(\"cal__\") > -1 && key.indexOf(\"Limit\") == -1)\n        .reduce((agg, key) => {\n            const { nodeName, nodeValue } = calibrationState[key];\n            /** @tye {Reference} */\n            const refData = {\n                referenceKey: nodeName,\n                referenceValue: nodeValue,\n            };\n            return [\n                ...agg,\n                refData\n            ];\n        }, []);\n    return {\n        infoType: \"calibration_data\",\n        infoLevel: \"DEBUG\",\n        infoReferences,\n    };\n}\n\n/**\n * @returns {CalibrationData}\n */\nfunction createCalibrationPositions() {\n    const availablePositions = flow.get(\"calibration.positions.available\");\n    const currentPosition = flow.get(\"calibration.positions.current\");\n    return {\n        infoType: \"calibration_status\",\n        infoLevel: \"DEBUG\",\n        infoReferences: [\n            { \"referenceKey\": \"POSITIONS.AVAILABLE\", \"referenceValue\": availablePositions },\n            { \"referenceKey\": \"POSITIONS.CURRENT\", \"referenceValue\": currentPosition },\n        ]\n    }\n}\n\nmsg.calibrationData = [createCalibrationData(), createCalibrationPositions()];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2000,
        "y": 620,
        "wires": [
            [
                "f406e179d4394c4b"
            ]
        ]
    },
    {
        "id": "f406e179d4394c4b",
        "type": "subflow:76fb0696f941be3b",
        "z": "2acde404c8501321",
        "name": "",
        "x": 2250,
        "y": 620,
        "wires": [
            [
                "f49445298902a6ec"
            ]
        ]
    },
    {
        "id": "7c3723eae19c30ca",
        "type": "subflow:76fb0696f941be3b",
        "z": "2acde404c8501321",
        "name": "",
        "x": 1720,
        "y": 500,
        "wires": [
            [
                "f49445298902a6ec"
            ]
        ]
    },
    {
        "id": "06dbce976e834b24",
        "type": "subflow:7173b966cb38f0e0",
        "z": "2acde404c8501321",
        "name": "",
        "env": [
            {
                "name": "AVAILABLE_POSITIONS",
                "value": "TO_CAMERA,TO_NIO_BIN,TO_PICKUP,CALIBRATION_TESTIMAGE",
                "type": "str"
            },
            {
                "name": "CURRENT_POSITION",
                "value": "TO_PICKUP",
                "type": "str"
            }
        ],
        "x": 870,
        "y": 1720,
        "wires": []
    },
    {
        "id": "b69933bb7d965165",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "before-write",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 560,
        "wires": []
    },
    {
        "id": "0a78a28c7c773a25",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "after-write",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1840,
        "y": 560,
        "wires": []
    },
    {
        "id": "126cee3c77536702",
        "type": "subflow:105d02aba31c4a1d",
        "z": "2acde404c8501321",
        "g": "651507c0d9985127",
        "x": 1390,
        "y": 2080,
        "wires": [
            [
                "f72e14b5fc7abbf2"
            ]
        ]
    },
    {
        "id": "f72e14b5fc7abbf2",
        "type": "subflow:76fb0696f941be3b",
        "z": "2acde404c8501321",
        "g": "651507c0d9985127",
        "name": "",
        "x": 1660,
        "y": 2080,
        "wires": [
            [
                "18fdf11aa09f0f91"
            ]
        ]
    },
    {
        "id": "fc1841ebfae81247",
        "type": "link out",
        "z": "2acde404c8501321",
        "g": "c5d50add89336f77",
        "name": "mqtt_notRetained",
        "mode": "link",
        "links": [
            "2cf6c7eff0bc4658"
        ],
        "x": 1775,
        "y": 1980,
        "wires": []
    },
    {
        "id": "0783aec6a1731686",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "g": "0c2639f67b75e26f",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "15",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            },
            {
                "name": "model",
                "nodeId": "ns=4;i=2",
                "datatypeName": "String"
            }
        ],
        "x": 180,
        "y": 440,
        "wires": [
            [
                "3a6767b90d2575ab",
                "37409311a820900f"
            ]
        ]
    },
    {
        "id": "3a6767b90d2575ab",
        "type": "OPCUA-IIoT-Read",
        "z": "2acde404c8501321",
        "g": "0c2639f67b75e26f",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "46f8b2363b259b7f",
        "name": "Read serial",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 370,
        "y": 400,
        "wires": [
            [
                "37409311a820900f"
            ]
        ]
    },
    {
        "id": "37409311a820900f",
        "type": "subflow:468f2460ce66f11e",
        "z": "2acde404c8501321",
        "g": "0c2639f67b75e26f",
        "name": "",
        "x": 590,
        "y": 440,
        "wires": [
            [
                "7a3d68557e4c5dc5"
            ]
        ]
    },
    {
        "id": "702e0d4ef7f8668c",
        "type": "function",
        "z": "2acde404c8501321",
        "g": "2b02fa69cc69be86",
        "name": "Order to take Picture",
        "func": "/**\n * @typedef {object} Reference\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} ActionMetadata\n * @property {string} [position]\n * @property {boolean} [factory]\n * @property {Reference[]} [references]\n * \n * @typedef {object} Action\n * @property {\"startCalibration\" \n *    | \"stopCalibration\" \n *    | \"setCalibrationValues\" \n *    | \"storeCalibrationValues\" \n *    | \"selectCalibrationPosition\" \n *    | \"testCalibrationPosition\" \n *    | \"resetCalibration\"} actionType\n * @property {string} actionId\n * @property {ActionMetadata} metadata\n * \n * @typedef {object} CalibrationInstantAction\n * @property {string} serialNumber\n * @property {Date} timestamp\n * @property {Action[]} actions\n * \n * @typedef {object} ReferenceData\n * @property {string} referenceKey\n * @property {number} referenceValue\n * \n * @typedef {object} CalibrationData\n * @property {string} infoType\n * @property {string} infoLevel\n * @property {ReferenceData[]} infoReferences\n * \n * @typedef {object} CalibrationValue\n * @property {string} nodeId\n * @property {string} nodeName\n * @property {string} nodeValue\n *\n * @typedef {object} PositionTargetData\n * @property {number | string | undefined} position_dreh\n * @property {number | string | undefined} position_x\n * @property {number | string | undefined} position_y\n */\n\nconst moduleState = flow.get(\"moduleState\");\nif (moduleState == \"CALIBRATION\") {\n    return {\n        topic: flow.get(\"TXT_MQTT_topic\") + \"/order\",\n        payload: {\n            serialNumber: flow.get(\"serialNumber\"),\n            orderId: `CHECK_QUALITY__${Date.now()}`,\n            orderUpdateId: Math.floor(Math.random() * 10),\n            timestamp: new Date().toISOString(),\n            action: {\n                id: `CHECK_QUALITY__${Date.now()}`,\n                command: \"CHECK_QUALITY\",\n                metadata: {}\n            },\n        }\n    };\n    return msg;\n} else {\n    // Ignore Message, if Module is not in calibration mode\n    return;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 980,
        "wires": [
            [
                "e462e67586083065"
            ]
        ]
    },
    {
        "id": "e462e67586083065",
        "type": "link out",
        "z": "2acde404c8501321",
        "g": "2b02fa69cc69be86",
        "name": "mqtt_notRetained",
        "mode": "link",
        "links": [
            "2cf6c7eff0bc4658"
        ],
        "x": 1455,
        "y": 980,
        "wires": []
    },
    {
        "id": "a1e0e1f2484ab75a",
        "type": "subflow:07a7fc5bcd60a12a",
        "z": "2acde404c8501321",
        "name": "",
        "x": 2250,
        "y": 680,
        "wires": [
            [
                "f49445298902a6ec"
            ]
        ]
    },
    {
        "id": "a7ec42e748cb6d6a",
        "type": "delay",
        "z": "2acde404c8501321",
        "name": "",
        "pauseType": "delay",
        "timeout": "250",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1810,
        "y": 680,
        "wires": [
            [
                "a1e0e1f2484ab75a"
            ]
        ]
    },
    {
        "id": "e2ea4080e41bf815",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "reset",
        "func": "msg.payload = {\n    nodetype: 'inject',\n    injectType: 'write',\n    nodesToWrite: [\n        { nodeId: \"ns=4;i=18\", \"datatypeName\": \"Boolean\" }\n    ],\n    valuesToWrite: [\n        { value: true }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 900,
        "wires": [
            [
                "b54f3fbcecd3cfca",
                "b69933bb7d965165"
            ]
        ],
        "inputLabels": [
            "instantAction"
        ],
        "outputLabels": [
            "opcuaWrite"
        ]
    },
    {
        "id": "b54f3fbcecd3cfca",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "c7fddcd91d392583",
        "name": "Write Order",
        "justValue": true,
        "showStatusActivities": true,
        "showErrors": false,
        "x": 1650,
        "y": 900,
        "wires": [
            [
                "0a78a28c7c773a25"
            ]
        ]
    },
    {
        "id": "ae86f0198aabfcea",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "update-action-state",
        "func": "//let orderAction = msg.orderAction;\n\n// get current actionState \nlet actionState = {};\n\nactionState.command = msg.payload.action.command;\n//actionState.command = orderAction.command;\nactionState.id = msg.payload.action.id;\nactionState.metadata = msg.payload.action.metadata;\n\n// actionState in Flow speichern\nflow.set(\"actionState\", actionState);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "8bd22ccbf48a2191",
                "178d999e96534ace"
            ]
        ]
    },
    {
        "id": "178d999e96534ace",
        "type": "switch",
        "z": "2acde404c8501321",
        "name": "orderswitch",
        "property": "payload.action.command",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "PICK",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "DROP",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "CHECK_QUALITY",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1270,
        "y": 200,
        "wires": [
            [
                "43a127570f7bbc14"
            ],
            [
                "aec0ec48cfc5dd40"
            ],
            [
                "b5a39936ed47d538"
            ]
        ]
    },
    {
        "id": "26c2085cbbc8caa3",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "variable setup",
        "func": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"AIQS\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"AIQS\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"quality\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"AIQS001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/AIQS001\"); // Added for consistency",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// On Start tab\n// Initialize flow context variables for the parent flow\nflow.set(\"flowName\", \"AIQS\");\nflow.set(\"moduleState\", \"IDLE\");\nflow.set(\"orderUpdateId\", 0);\nflow.set(\"orderId\", \"0\");\nflow.set(\"loads\", []);\nflow.set(\"headerId\", 1);\nflow.set(\"actionState\", {});\nflow.set(\"model\", \"AIQS\");\nflow.set(\"errors\", []);\nflow.set(\"state\", {\n    headerId: 0,\n    loads: [],\n    actionState: { state: \"FINISHED\" },\n    serialNumber: \"notReadYet\",\n    timestamp: \"timestamp\",\n    errors: [],\n    orderUpdateId: 0,\n    orderId: \"\",\n    paused: false,\n    metadata: {\n        opcuaState: \"connected\"\n    }\n});\n\nflow.set(\"factsheet\", {\n    protocolFeatures: {\n        moduleActions: [\n            {\n                actionType: \"PICK\",\n                actionScopes: [\"ORDER\", \"NODE\"],\n                actionParameters: []\n            },\n            {\n                actionType: \"PLACE\",\n                actionScopes: [\"ORDER\"],\n                actionParameters: []\n            }\n        ]\n    },\n    typeSpecification: {} // Added to prevent TypeError\n});\n\nflow.set(\"connection\", {\n    headerId: 0,\n    timestamp: \"timestamp\",\n    ip: \"quality\",\n    version: \"v1.0\",\n    manufacturer: \"Fischertechnik\",\n    serialNumber: \"AIQS001\",\n    connectionState: \"ONLINE\"\n});\nflow.set(\"opcuaState\", \"connected\");\nflow.set(\"MQTT_topic\", \"module/v1/ff/AIQS001\"); // Added for consistency",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c0a2f82ec34c030a",
        "type": "inject",
        "z": "2acde404c8501321",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 80,
        "wires": [
            [
                "26c2085cbbc8caa3"
            ]
        ]
    },
    {
        "id": "5ea8beba9ed66a73",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_DRILL",
        "addressSpaceItems": [
            {
                "name": "finish_pick",
                "nodeId": "ns=4;i=8",
                "datatypeName": ""
            },
            {
                "name": "finish_drop",
                "nodeId": "ns=4;i=9",
                "datatypeName": ""
            },
            {
                "name": "",
                "nodeId": "ns=4;i=13",
                "datatypeName": ""
            },
            {
                "name": "",
                "nodeId": "ns=4;i=6",
                "datatypeName": ""
            },
            {
                "name": "",
                "nodeId": "ns=4;i=7",
                "datatypeName": ""
            },
            {
                "name": "finish_ck_good",
                "nodeId": "ns=4;i=11",
                "datatypeName": ""
            },
            {
                "name": "finish_ck_bad",
                "nodeId": "ns=4;i=10",
                "datatypeName": ""
            }
        ],
        "x": 470,
        "y": 1920,
        "wires": [
            [
                "9732bb5fed4a9ab9"
            ]
        ]
    },
    {
        "id": "2a1bfb2c522d36dd",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "true",
        "x": 830,
        "y": 2500,
        "wires": []
    },
    {
        "id": "30a993cfafb41a60",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "function 13",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 2560,
        "wires": [
            [
                "c9fd20e663f16be0",
                "2ac0c3867f169bf6"
            ]
        ]
    },
    {
        "id": "c9fd20e663f16be0",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "true",
        "x": 1010,
        "y": 2520,
        "wires": []
    },
    {
        "id": "2ac0c3867f169bf6",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "function 14",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `AIQS;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 2560,
        "wires": [
            [
                "b330421cd958e630"
            ]
        ]
    },
    {
        "id": "65d66adf2ea6f064",
        "type": "comment",
        "z": "2acde404c8501321",
        "name": "DPS_OPC_UA",
        "info": "",
        "x": 480,
        "y": 2600,
        "wires": []
    },
    {
        "id": "b330421cd958e630",
        "type": "link out",
        "z": "2acde404c8501321",
        "name": "link out 21",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1135,
        "y": 2620,
        "wires": []
    },
    {
        "id": "bfb41ca707ef7a77",
        "type": "inject",
        "z": "2acde404c8501321",
        "name": "Start Ai",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 2420,
        "wires": [
            [
                "b35093960796ab08"
            ]
        ]
    },
    {
        "id": "b35093960796ab08",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "Write cmd__start_ai= true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=99\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 2420,
        "wires": [
            [
                "32a5f2aed08991e0"
            ]
        ]
    },
    {
        "id": "21f2eac9224572d1",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_AIQS",
        "addressSpaceItems": [
            {
                "name": "Raus",
                "nodeId": "ns=4;i=62",
                "datatypeName": ""
            },
            {
                "name": "Rein",
                "nodeId": "ns=4;i=61",
                "datatypeName": ""
            },
            {
                "name": "Runter/Hoch",
                "nodeId": "ns=4;i=65",
                "datatypeName": ""
            },
            {
                "name": "Band-AI",
                "nodeId": "ns=4;i=63",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=64",
                "datatypeName": ""
            }
        ],
        "x": 490,
        "y": 2560,
        "wires": [
            [
                "8a96e24f4db3e986"
            ]
        ]
    },
    {
        "id": "8a96e24f4db3e986",
        "type": "OPCUA-IIoT-Listener",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 660,
        "y": 2560,
        "wires": [
            [
                "2a1bfb2c522d36dd",
                "30a993cfafb41a60"
            ]
        ]
    },
    {
        "id": "32a5f2aed08991e0",
        "type": "OPCUA-IIoT-Write",
        "z": "2acde404c8501321",
        "connector": "46f8b2363b259b7f",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 990,
        "y": 2420,
        "wires": [
            []
        ]
    },
    {
        "id": "e7e3204fc2174aac",
        "type": "function",
        "z": "2acde404c8501321",
        "name": "Collect Flow State",
        "func": "const debugState = {\n    flowName: flow.get(\"flowName\"),\n    moduleState: flow.get(\"moduleState\"),\n    orderUpdateId: flow.get(\"orderUpdateId\"),\n    orderId: flow.get(\"orderId\"),\n    loads: flow.get(\"loads\"),\n    headerId: flow.get(\"headerId\"),\n    actionState: flow.get(\"actionState\"),\n    model: flow.get(\"model\"),\n    errors: flow.get(\"errors\"),\n    state: flow.get(\"state\"),\n    factsheet: flow.get(\"factsheet\"),\n    connection: flow.get(\"connection\"),\n    opcuaState: flow.get(\"opcuaState\"),\n    mqtt_topic: flow.get(\"MQTT_topic\"),\n    txt_topic: flow.get(\"TXT_MQTT_topic\")\n};\n\nmsg.payload = debugState;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 2200,
        "wires": [
            [
                "afcbf6ae46b0cb4e"
            ]
        ]
    },
    {
        "id": "afcbf6ae46b0cb4e",
        "type": "debug",
        "z": "2acde404c8501321",
        "name": "Debug Flow Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 2200,
        "wires": []
    },
    {
        "id": "fc1081a6e214845e",
        "type": "inject",
        "z": "2acde404c8501321",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 2200,
        "wires": [
            [
                "e7e3204fc2174aac"
            ]
        ]
    },
    {
        "id": "25e2d57e59442f26",
        "type": "OPCUA-IIoT-Read",
        "z": "2acde404c8501321",
        "attributeId": "0",
        "maxAge": 1,
        "depth": 1,
        "connector": "46f8b2363b259b7f",
        "name": "Read serial",
        "justValue": false,
        "showStatusActivities": true,
        "showErrors": true,
        "parseStrings": true,
        "historyDays": 1,
        "x": 490,
        "y": 1120,
        "wires": [
            [
                "1adc2902f16e4ada"
            ]
        ]
    },
    {
        "id": "d6ebfaf95418a195",
        "type": "OPCUA-IIoT-Inject",
        "z": "2acde404c8501321",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "readSerial",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "20",
        "name": "serialnumber",
        "addressSpaceItems": [
            {
                "name": "SerialNumber",
                "nodeId": "ns=3;s=SerialNumber",
                "datatypeName": "String"
            }
        ],
        "x": 270,
        "y": 1120,
        "wires": [
            [
                "25e2d57e59442f26"
            ]
        ]
    },
    {
        "id": "311287dbfbf37fd3",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 590,
        "y": 240,
        "wires": []
    },
    {
        "id": "fc599d22ccd574a2",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "function 9",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 280,
        "wires": [
            [
                "7574b19f8c742349",
                "4938b2e07b92453e"
            ]
        ]
    },
    {
        "id": "7574b19f8c742349",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 750,
        "y": 280,
        "wires": []
    },
    {
        "id": "4938b2e07b92453e",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "function 10",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `DRILL;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 320,
        "wires": [
            [
                "ce7a90dd937307c8"
            ]
        ]
    },
    {
        "id": "4e8c19bbae111924",
        "type": "comment",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "MILL_OPC_UA",
        "info": "",
        "x": 220,
        "y": 300,
        "wires": []
    },
    {
        "id": "ce7a90dd937307c8",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "name": "link out 14",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 985,
        "y": 440,
        "wires": []
    },
    {
        "id": "aff60f34e83520f1",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 1080,
        "wires": []
    },
    {
        "id": "ee9ed8e912aaaf4b",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1120,
        "wires": [
            [
                "c699a3ec6c716278",
                "d0cc1e826561c3c9"
            ]
        ]
    },
    {
        "id": "c699a3ec6c716278",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 770,
        "y": 1080,
        "wires": []
    },
    {
        "id": "d0cc1e826561c3c9",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 1",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `HBW;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1120,
        "wires": [
            [
                "fb1b91b79bc6444b"
            ]
        ]
    },
    {
        "id": "fe8be80fce1519fe",
        "type": "comment",
        "z": "3f8971c7785c0a4b",
        "name": "DRILL_OPC_UA",
        "info": "",
        "x": 160,
        "y": 1140,
        "wires": []
    },
    {
        "id": "fb1b91b79bc6444b",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1025,
        "y": 1120,
        "wires": []
    },
    {
        "id": "086a0dd642f68340",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 740,
        "wires": []
    },
    {
        "id": "523fbf0240334673",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 2",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 800,
        "wires": [
            [
                "cb9471eef2f633a3",
                "61583b44630b3a5e"
            ]
        ]
    },
    {
        "id": "cb9471eef2f633a3",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 900,
        "y": 760,
        "wires": []
    },
    {
        "id": "61583b44630b3a5e",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 3",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `MILL;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 800,
        "wires": [
            [
                "bedc7a94872039d3"
            ]
        ]
    },
    {
        "id": "404ac46451e3d70b",
        "type": "comment",
        "z": "3f8971c7785c0a4b",
        "name": "AIQS_OPC_UA",
        "info": "",
        "x": 230,
        "y": 840,
        "wires": []
    },
    {
        "id": "492454cf04977f3e",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 570,
        "y": 1260,
        "wires": []
    },
    {
        "id": "2f8bd5deb6119115",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 5",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1300,
        "wires": [
            [
                "ac2aaacaa91ca8fa",
                "52015399c5f638bf"
            ]
        ]
    },
    {
        "id": "ac2aaacaa91ca8fa",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 770,
        "y": 1300,
        "wires": []
    },
    {
        "id": "52015399c5f638bf",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 6",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `DPS;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1340,
        "wires": [
            [
                "c2ac86a40c009f39"
            ]
        ]
    },
    {
        "id": "bedc7a94872039d3",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "name": "link out 16",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1125,
        "y": 840,
        "wires": []
    },
    {
        "id": "c2ac86a40c009f39",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "name": "link out 17",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1035,
        "y": 1340,
        "wires": []
    },
    {
        "id": "dfedc79f9c8e3b8a",
        "type": "inject",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 570,
        "y": 1460,
        "wires": [
            [
                "13b75ae128c53483",
                "66e055f1f053982b",
                "d5152b4134dcfb1f",
                "d479659b47100903",
                "14c894248b36e415",
                "76bcb858cb35637f"
            ]
        ]
    },
    {
        "id": "a4407ff64d862642",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1980,
        "y": 1720,
        "wires": []
    },
    {
        "id": "7b1c186d0126121a",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1980,
        "y": 1660,
        "wires": []
    },
    {
        "id": "12b6aa988c96c9fb",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 1800,
        "wires": []
    },
    {
        "id": "13b75ae128c53483",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "444d2d13d871c4d1",
        "name": "80F4/order",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1480,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "d479659b47100903",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "444d2d13d871c4d1",
        "name": "4gcx/order",
        "func": "msg.topic = \"fts/v1/ff/4gcx/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1520,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "14c894248b36e415",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "444d2d13d871c4d1",
        "name": "4gcx/instantAction",
        "func": "msg.topic = \"fts/v1/ff/4gcx/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1560,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "76bcb858cb35637f",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "444d2d13d871c4d1",
        "name": "80F4/instantAction",
        "func": "msg.topic = \"fts/v1/ff/80F4/instantAction\";\nmsg.action = \"subscribe\";\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1600,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "d5152b4134dcfb1f",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "31a3ee846bfad4d2",
        "name": "i/stock",
        "func": "msg.topic = \"/j1/txt/1/f/i/stock\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1700,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "66e055f1f053982b",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "069e736edfbf73dc",
        "name": "SVR4PW6408/order",
        "func": "msg.topic = \"module/v1/ff/NodeRed/SVR4PW6408/order\";\nmsg.action = \"subscribe\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 1800,
        "wires": [
            [
                "ee49f6de58624806"
            ]
        ]
    },
    {
        "id": "ee49f6de58624806",
        "type": "mqtt in",
        "z": "3f8971c7785c0a4b",
        "g": "0b67e1207ab5fbfe",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 1110,
        "y": 1700,
        "wires": [
            [
                "12b6aa988c96c9fb",
                "c03d070a1bd0d44e"
            ]
        ]
    },
    {
        "id": "c03d070a1bd0d44e",
        "type": "switch",
        "z": "3f8971c7785c0a4b",
        "g": "0b67e1207ab5fbfe",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fts/v1/ff/80F4/order",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "fts/v1/ff/4gcx/order",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "fts/v1/ff/4gcx/instantAction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "fts/v1/ff/80F4/instantAction",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "/j1/txt/1/f/i/stock",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "module/v1/ff/NodeRed/SVR4PW6408/order",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 1270,
        "y": 1700,
        "wires": [
            [
                "7614537a083b33af"
            ],
            [
                "7614537a083b33af"
            ],
            [
                "7614537a083b33af"
            ],
            [
                "7614537a083b33af"
            ],
            [
                "144b6bc9e6bc95fe"
            ],
            [
                "b1a76099fe2cd28f",
                "dfd7cfeb7049b921"
            ]
        ]
    },
    {
        "id": "7614537a083b33af",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "e75b1cb10a38be2a",
        "name": "Convert_Driving_Data",
        "func": "var payload = msg.payload;\n\n// Standardwerte bernehmen\nvar timestamp = payload.timestamp;\nvar serialNumber = payload.serialNumber;\n\n// Prfen, ob actions existiert und ob eine Aktion mit \"findInitialDockPosition\" enthalten ist\nvar hasFindInitialDocking = payload.actions && payload.actions.some(action => action.actionType === \"findInitialDockPosition\");\n\n// Falls `nodes` oder `edges` fehlen und `findInitialDockPosition` vorhanden ist, alternative JSON erzeugen\nif ((!payload.nodes || !payload.edges) && hasFindInitialDocking) {\n    payload = {\n        \"timestamp\": timestamp,\n        \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n        \"orderUpdateId\": 0,\n        \"nodes\": [\n            {\n                \"id\": \"SVR4PW6408\",\n                \"linkedEdges\": [],\n                \"action\": {\n                    \"type\": \"DOCK\",\n                    \"metadata\": {\n                        \"loadId\": \"043169ca341290\",\n                        \"loadType\": \"\",\n                        \"loadPosition\": \"3\"\n                    }\n                }\n            }\n        ],\n        \"edges\": [],\n        \"serialNumber\": serialNumber\n    };\n}\n\n// Jetzt die allgemeine Verarbeitung starten\nvar nodes = payload.nodes;\nvar edges = payload.edges;\n\n// Mapping der Edge-Lngen zu den Nodes\nvar edgeLengths = {};\nedges.forEach(edge => {\n    edge.linkedNodes.forEach(nodeId => {\n        if (!edgeLengths[nodeId]) {\n            edgeLengths[nodeId] = edge.length;\n        }\n    });\n});\n\n// Erste Node entfernen (nur wenn mehr als eine Node vorhanden ist)\nif (nodes.length > 1) {\n    nodes.shift();\n}\n\n// Lngen zuweisen und \"DOCK\"-Nodes auf 0 setzen\nnodes.forEach(node => {\n    node.length = edgeLengths[node.id] || 0;\n    if (node.action && node.action.type === \"DOCK\") {\n        node.length = 0;\n    } else if (node.length === 360) {\n        node.length = 500; // Umwandlung von 360 auf 500\n    }\n\n    // Unntige Felder entfernen (nur action.id wird entfernt)\n    if (node.action) {\n        delete node.action.id;\n    }\n});\n\n// Endgltige JSON erstellen\nvar output = {\n    timestamp: timestamp,\n    nodes: nodes,\n    serialNumber: serialNumber\n};\n\n// JSON in einen String umwandeln\nvar jsonString = JSON.stringify(output);\n\n// msg.payload fr den nchsten Block vorbereiten\nmsg.payload = {\n    variableName: \"drivingdata\", // Variablenname\n    variableValue: jsonString // Variablenwert (der JSON-String)\n};\n\n// Nachricht zurckgeben\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1660,
        "wires": [
            [
                "7b1c186d0126121a",
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "144b6bc9e6bc95fe",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "e75b1cb10a38be2a",
        "name": "Convert_HBW_State",
        "func": "// Annahme: msg.payload enthlt bereits die empfangene JSON-Datenstruktur\n\n// JSON-Daten als String formatieren\nconst jsonString = JSON.stringify(msg.payload);\n\n// Nachricht fr WebSocket vorbereiten\nmsg.payload = {\n    variableName: \"hbw_state\", // Variablenname\n    variableValue: jsonString    // JSON als String\n};\n\n// Weitergeben an den nchsten Node (z. B. WebSocket)\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1720,
        "wires": [
            [
                "a4407ff64d862642",
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "b1a76099fe2cd28f",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "35e48063b1c5fb09",
        "name": "Convert_DPS",
        "func": "// JSON-Daten parsen, falls ntig\nlet json = msg.payload;\nif (typeof json === \"string\") {\n    json = JSON.parse(json);\n}\n\n// Standardwerte fr die Ausgabe\nlet variableName = json.action.command;\nlet variableValue = null;\n\n// Prfen, ob es Metadaten gibt und ob eine relevante Variable existiert\nif (json.action.metadata) {\n    if (json.action.metadata.type) {\n        variableValue = json.action.metadata.type;\n    } else if (json.action.metadata.workpiece && json.action.metadata.workpiece.type) {\n        variableValue = json.action.metadata.workpiece.type;\n    }\n}\n\n// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: variableName,\n    variableValue: true\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1920,
        "wires": [
            [
                "49cc93164bff6a2c"
            ]
        ]
    },
    {
        "id": "49cc93164bff6a2c",
        "type": "switch",
        "z": "3f8971c7785c0a4b",
        "g": "35e48063b1c5fb09",
        "name": "",
        "property": "payload.variableName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "INPUT_RGB",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "RGB_NFC",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "To_Output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "DROP",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "PICK",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 1890,
        "y": 1920,
        "wires": [
            [
                "6399f50d6c88fc6e"
            ],
            [
                "dc4a1e7192773f8c"
            ],
            [
                "328027d52c8d6a95"
            ],
            [
                "2e8859e6fb018137"
            ],
            [
                "54a1d3db60c49611",
                "54b198c624ec43e0"
            ]
        ]
    },
    {
        "id": "dfd7cfeb7049b921",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "35e48063b1c5fb09",
        "name": "Convert_DPS_Color",
        "func": "// JSON-Daten parsen, falls ntig\nlet json = msg.payload;\nif (typeof json === \"string\") {\n    json = JSON.parse(json);\n}\n\n// Prfen, ob der Befehl RGB_NFC ist\nif (json.action.command === \"RGB_NFC\" && json.action.metadata.type) {\n    msg.payload = {\n        variableName: \"DPS;Color\",\n        variableValue: json.action.metadata.type\n    };\n    return msg;\n}\n\n// Falls der Befehl nicht RGB_NFC ist, keine Nachricht senden\nreturn null;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1680,
        "y": 1960,
        "wires": [
            [
                "c0d620d24d447148"
            ]
        ]
    },
    {
        "id": "2e8859e6fb018137",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 1980,
        "wires": [
            [
                "54a1d3db60c49611",
                "76f8732ebcd1de6f"
            ]
        ]
    },
    {
        "id": "dc4a1e7192773f8c",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 1900,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "6399f50d6c88fc6e",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 1860,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "c0d620d24d447148",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 2020,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "328027d52c8d6a95",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 1940,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "33ec3fc4f13273af",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2580,
        "y": 2060,
        "wires": [
            [
                "9f67fbf39105ca72"
            ]
        ]
    },
    {
        "id": "0ea7be49ac02efa6",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "To_Output",
        "func": "// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: \"To_Output\",\n    variableValue: true\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3150,
        "y": 2060,
        "wires": [
            [
                "54a1d3db60c49611",
                "764a332ab38c7996"
            ]
        ]
    },
    {
        "id": "ce3ceaf769e2af71",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "To_Standby",
        "func": "// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: \"To_Standby\",\n    variableValue: true\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3530,
        "y": 2060,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "764a332ab38c7996",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3340,
        "y": 2060,
        "wires": [
            [
                "ce3ceaf769e2af71"
            ]
        ]
    },
    {
        "id": "9f67fbf39105ca72",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "RGB_NFC",
        "func": "// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: \"RGB_NFC\",\n    variableValue: true\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2770,
        "y": 2060,
        "wires": [
            [
                "bb6475ebad4b3a4b",
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "bb6475ebad4b3a4b",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2960,
        "y": 2060,
        "wires": [
            [
                "0ea7be49ac02efa6"
            ]
        ]
    },
    {
        "id": "54b198c624ec43e0",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2240,
        "y": 2060,
        "wires": [
            [
                "ecf41d5240381885"
            ]
        ]
    },
    {
        "id": "ecf41d5240381885",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "DROP",
        "func": "// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: \"DROP\",\n    variableValue: true\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2410,
        "y": 2060,
        "wires": [
            [
                "33ec3fc4f13273af",
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "76f8732ebcd1de6f",
        "type": "delay",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2420,
        "y": 1980,
        "wires": [
            [
                "41cae3d6cdebf43e"
            ]
        ]
    },
    {
        "id": "41cae3d6cdebf43e",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "g": "5f4c11218571e240",
        "name": "To_Standby",
        "func": "// Ausgabe in msg.payload setzen\nmsg.payload = {\n    variableName: \"To_Standby\",\n    variableValue: true\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2610,
        "y": 1980,
        "wires": [
            [
                "54a1d3db60c49611"
            ]
        ]
    },
    {
        "id": "54a1d3db60c49611",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "g": "651b892d91c059ed",
        "name": "link out 18",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 3765,
        "y": 1760,
        "wires": []
    },
    {
        "id": "4f34b5fe5c1821ed",
        "type": "inject",
        "z": "3f8971c7785c0a4b",
        "name": "Start Drill",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 140,
        "wires": [
            [
                "1645a86506028670"
            ]
        ]
    },
    {
        "id": "1645a86506028670",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "Write cmd__start_drill = true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=99\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 140,
        "wires": [
            [
                "85654a63519ac801"
            ]
        ]
    },
    {
        "id": "e75c5d8c6f9add34",
        "type": "inject",
        "z": "3f8971c7785c0a4b",
        "name": "Start Mill",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 660,
        "wires": [
            [
                "1391b26647fd9132"
            ]
        ]
    },
    {
        "id": "1391b26647fd9132",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "Write cmd__start_mill = true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=99\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 660,
        "wires": [
            [
                "4846825d3c26a99e"
            ]
        ]
    },
    {
        "id": "8f11f5d980bfb40b",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "true",
        "x": 1610,
        "y": 580,
        "wires": []
    },
    {
        "id": "1ee3451ed5551fa5",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 7",
        "func": "\n// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// berprfen, ob die bentigten Daten vorhanden sind\nif (payload && payload.value && payload.value.value !== undefined) {\n    let variableName = payload.nodeId || \"Unbekannt\";\n    let variableValue = payload.value.value;\n\n    // Das Ergebnis in die msg.payload schreiben\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    msg.payload = { error: \"Datenstruktur unvollstndig oder ungltig\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 640,
        "wires": [
            [
                "8d7ab738a111b5ec",
                "956f7b16af7c759c"
            ]
        ]
    },
    {
        "id": "8d7ab738a111b5ec",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "true",
        "x": 1790,
        "y": 600,
        "wires": []
    },
    {
        "id": "956f7b16af7c759c",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "function 8",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = `AIQS;${payload.variableName}`; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Debug-Ausgabe\n    //node.warn(`Variable: ${variableName}, Wert: ${variableValue}`);\n\n    // Ausgabe in msg.payload formatieren\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Debug-Ausgabe fr Fehler\n    node.warn(\"Ungltige Datenstruktur im Payload.\");\n    // Originalnachricht unverndert weitergeben\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1800,
        "y": 640,
        "wires": [
            [
                "35948efeed5206ad"
            ]
        ]
    },
    {
        "id": "26815788099f63f3",
        "type": "comment",
        "z": "3f8971c7785c0a4b",
        "name": "DPS_OPC_UA",
        "info": "",
        "x": 1260,
        "y": 680,
        "wires": []
    },
    {
        "id": "35948efeed5206ad",
        "type": "link out",
        "z": "3f8971c7785c0a4b",
        "name": "link out 19",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1915,
        "y": 700,
        "wires": []
    },
    {
        "id": "614e0162ec5ebb58",
        "type": "inject",
        "z": "3f8971c7785c0a4b",
        "name": "Start Ai",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1250,
        "y": 500,
        "wires": [
            [
                "4325f0fb14be1726"
            ]
        ]
    },
    {
        "id": "4325f0fb14be1726",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "Write cmd__start_ai= true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=99\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 500,
        "wires": [
            [
                "c59bef421c5474af"
            ]
        ]
    },
    {
        "id": "e572a650f7fb5a7a",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "startDelay": "30",
        "name": "SPS_DRILL",
        "addressSpaceItems": [
            {
                "name": "raus",
                "nodeId": "ns=4;i=31",
                "datatypeName": ""
            },
            {
                "name": "rein",
                "nodeId": "ns=4;i=30",
                "datatypeName": ""
            },
            {
                "name": "runter",
                "nodeId": "ns=4;i=32",
                "datatypeName": ""
            },
            {
                "name": "Bohrer",
                "nodeId": "ns=4;i=34",
                "datatypeName": ""
            },
            {
                "name": "Band-Bohrer",
                "nodeId": "ns=4;i=28",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=29",
                "datatypeName": ""
            }
        ],
        "x": 230,
        "y": 240,
        "wires": [
            [
                "681458b8eb61d615"
            ]
        ]
    },
    {
        "id": "44d1ba0e2d1daf36",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_HBW",
        "addressSpaceItems": [
            {
                "name": "Pick",
                "nodeId": "ns=4;i=248",
                "datatypeName": ""
            },
            {
                "name": "Drop",
                "nodeId": "ns=4;i=245",
                "datatypeName": ""
            },
            {
                "name": "ref_drehung",
                "nodeId": "ns=4;i=359",
                "datatypeName": ""
            },
            {
                "name": "sauger_hoch",
                "nodeId": "ns=4;i=360",
                "datatypeName": ""
            },
            {
                "name": "sauger_runter",
                "nodeId": "ns=4;i=361",
                "datatypeName": ""
            },
            {
                "name": "Schalter_sauger_mitte",
                "nodeId": "ns=4;i=362",
                "datatypeName": ""
            },
            {
                "name": "Schalter_sauger_oben",
                "nodeId": "ns=4;i=363",
                "datatypeName": ""
            },
            {
                "name": "Schalter_sauger_unten",
                "nodeId": "ns=4;i=364",
                "datatypeName": ""
            },
            {
                "name": "ventil_vakuum",
                "nodeId": "ns=4;i=365",
                "datatypeName": ""
            },
            {
                "name": "RBG_vor",
                "nodeId": "ns=4;i=366",
                "datatypeName": ""
            },
            {
                "name": "RBG_zurueck",
                "nodeId": "ns=4;i=367",
                "datatypeName": ""
            },
            {
                "name": "ref_hrl_X_horizontal",
                "nodeId": "ns=4;i=368",
                "datatypeName": ""
            },
            {
                "name": "ref_HRL_Y",
                "nodeId": "ns=4;i=369",
                "datatypeName": ""
            },
            {
                "name": "Schalter_RBG_hinten",
                "nodeId": "ns=4;i=370",
                "datatypeName": ""
            },
            {
                "name": "Schalter_RBG_vorn",
                "nodeId": "ns=4;i=371",
                "datatypeName": ""
            },
            {
                "name": "xAchsezumBand",
                "nodeId": "ns=4;i=372",
                "datatypeName": ""
            },
            {
                "name": "xAchseZumRegal",
                "nodeId": "ns=4;i=373",
                "datatypeName": ""
            },
            {
                "name": "yAchseHoch",
                "nodeId": "ns=4;i=374",
                "datatypeName": ""
            },
            {
                "name": "yAchseRunter",
                "nodeId": "ns=4;i=375",
                "datatypeName": ""
            },
            {
                "name": "drehung_cl",
                "nodeId": "ns=4;i=376",
                "datatypeName": ""
            },
            {
                "name": "drehung_ccl",
                "nodeId": "ns=4;i=377",
                "datatypeName": ""
            }
        ],
        "x": 170,
        "y": 1080,
        "wires": [
            [
                "cb9d0dd2ff978d82"
            ]
        ]
    },
    {
        "id": "8c552f6a44eb0d2a",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_MILL",
        "addressSpaceItems": [
            {
                "name": "Frser",
                "nodeId": "ns=4;i=35",
                "datatypeName": ""
            },
            {
                "name": "Raus",
                "nodeId": "ns=4;i=32",
                "datatypeName": ""
            },
            {
                "name": "Rein",
                "nodeId": "ns=4;i=31",
                "datatypeName": ""
            },
            {
                "name": "Runter/Hoch",
                "nodeId": "ns=4;i=33",
                "datatypeName": ""
            },
            {
                "name": "Band-Frser",
                "nodeId": "ns=4;i=29",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=30",
                "datatypeName": ""
            }
        ],
        "x": 180,
        "y": 800,
        "wires": [
            [
                "87e04427c60b19ea"
            ]
        ]
    },
    {
        "id": "e30ba5763a63ba08",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "15",
        "name": "SPS_DPS",
        "addressSpaceItems": [
            {
                "name": "Input",
                "nodeId": "ns=4;i=45",
                "datatypeName": ""
            }
        ],
        "x": 210,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "791e945d0aa16dec",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "startDelay": "30",
        "name": "SPS_AIQS",
        "addressSpaceItems": [
            {
                "name": "Raus",
                "nodeId": "ns=4;i=62",
                "datatypeName": ""
            },
            {
                "name": "Rein",
                "nodeId": "ns=4;i=61",
                "datatypeName": ""
            },
            {
                "name": "Runter/Hoch",
                "nodeId": "ns=4;i=65",
                "datatypeName": ""
            },
            {
                "name": "Band-AI",
                "nodeId": "ns=4;i=63",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=64",
                "datatypeName": ""
            }
        ],
        "x": 1270,
        "y": 640,
        "wires": [
            [
                "bc3e0cb3591efd0f"
            ]
        ]
    },
    {
        "id": "681458b8eb61d615",
        "type": "OPCUA-IIoT-Listener",
        "z": "3f8971c7785c0a4b",
        "g": "2daeb980dd1c982f",
        "connector": "90582fb778f3aece",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 420,
        "y": 240,
        "wires": [
            [
                "311287dbfbf37fd3",
                "fc599d22ccd574a2"
            ]
        ]
    },
    {
        "id": "cb9d0dd2ff978d82",
        "type": "OPCUA-IIoT-Listener",
        "z": "3f8971c7785c0a4b",
        "connector": "061fc1a8298650a8",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 360,
        "y": 1080,
        "wires": [
            [
                "aff60f34e83520f1",
                "ee9ed8e912aaaf4b"
            ]
        ]
    },
    {
        "id": "87e04427c60b19ea",
        "type": "OPCUA-IIoT-Listener",
        "z": "3f8971c7785c0a4b",
        "connector": "484db7503e21eb9d",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": true,
        "showErrors": true,
        "x": 410,
        "y": 800,
        "wires": [
            [
                "086a0dd642f68340",
                "523fbf0240334673"
            ]
        ]
    },
    {
        "id": "bc3e0cb3591efd0f",
        "type": "OPCUA-IIoT-Listener",
        "z": "3f8971c7785c0a4b",
        "connector": "46f8b2363b259b7f",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 1440,
        "y": 640,
        "wires": [
            [
                "8f11f5d980bfb40b",
                "1ee3451ed5551fa5"
            ]
        ]
    },
    {
        "id": "85654a63519ac801",
        "type": "OPCUA-IIoT-Write",
        "z": "3f8971c7785c0a4b",
        "connector": "90582fb778f3aece",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 790,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "4846825d3c26a99e",
        "type": "OPCUA-IIoT-Write",
        "z": "3f8971c7785c0a4b",
        "connector": "484db7503e21eb9d",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 710,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "c59bef421c5474af",
        "type": "OPCUA-IIoT-Write",
        "z": "3f8971c7785c0a4b",
        "connector": "46f8b2363b259b7f",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 1770,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "ab9cfd273c884b9a",
        "type": "OPCUA-IIoT-Listener",
        "z": "3f8971c7785c0a4b",
        "connector": "90582fb778f3aece",
        "action": "subscribe",
        "queueSize": "1000",
        "name": "",
        "topic": "",
        "justValue": true,
        "useGroupItems": false,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 1580,
        "y": 120,
        "wires": [
            [
                "03a63f57753e14d6"
            ]
        ]
    },
    {
        "id": "69df50ad03ab9f30",
        "type": "OPCUA-IIoT-Inject",
        "z": "3f8971c7785c0a4b",
        "injectType": "read",
        "payload": "",
        "payloadType": "date",
        "topic": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "startDelay": "30",
        "name": "SPS_DRILL_test",
        "addressSpaceItems": [
            {
                "name": "raus",
                "nodeId": "ns=4;i=31",
                "datatypeName": ""
            },
            {
                "name": "rein",
                "nodeId": "ns=4;i=30",
                "datatypeName": ""
            },
            {
                "name": "runter",
                "nodeId": "ns=4;i=32",
                "datatypeName": ""
            },
            {
                "name": "Bohrer",
                "nodeId": "ns=4;i=34",
                "datatypeName": ""
            },
            {
                "name": "Band-Bohrer",
                "nodeId": "ns=4;i=28",
                "datatypeName": ""
            },
            {
                "name": "Band-FTS",
                "nodeId": "ns=4;i=29",
                "datatypeName": ""
            }
        ],
        "x": 1360,
        "y": 120,
        "wires": [
            [
                "ab9cfd273c884b9a"
            ]
        ]
    },
    {
        "id": "03a63f57753e14d6",
        "type": "debug",
        "z": "3f8971c7785c0a4b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1810,
        "y": 120,
        "wires": []
    },
    {
        "id": "e7cbd6dc1be796b8",
        "type": "inject",
        "z": "3f8971c7785c0a4b",
        "name": "Start Hbw",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1000,
        "wires": [
            [
                "b261a6e80401fd0f"
            ]
        ]
    },
    {
        "id": "b261a6e80401fd0f",
        "type": "function",
        "z": "3f8971c7785c0a4b",
        "name": "Write cmd__start_mill = true",
        "func": "msg.payload = {\n    injectType: \"write\",\n    nodetype: \"inject\",\n    nodesToWrite: [\n        {\n            nodeId: \"ns=4;i=1\", // Replace with your actual NodeId for cmd__start_drill\n            datatypeName: \"Boolean\",\n            value: true\n        }\n    ]\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1000,
        "wires": [
            [
                "88f857e2627be33a"
            ]
        ]
    },
    {
        "id": "88f857e2627be33a",
        "type": "OPCUA-IIoT-Write",
        "z": "3f8971c7785c0a4b",
        "connector": "061fc1a8298650a8",
        "name": "Write to OPC UA Server",
        "justValue": true,
        "showStatusActivities": false,
        "showErrors": true,
        "x": 690,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "bf6abef7b6dade45",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 180,
        "wires": [
            [
                "ef3a47be889b7ee7"
            ]
        ]
    },
    {
        "id": "ef3a47be889b7ee7",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=74 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=74\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 180,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "5f7729e8994a0d50",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 60,
        "wires": [
            [
                "36a5418662d6f319"
            ]
        ]
    },
    {
        "id": "36a5418662d6f319",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=73 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=73\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 60,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "c905f1b78d171355",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 300,
        "wires": [
            [
                "9005ea976bba4b3b"
            ]
        ]
    },
    {
        "id": "9005ea976bba4b3b",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=75 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=75\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 300,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "5384c3cc548d7972",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 340,
        "wires": [
            [
                "89f0293437699a5e"
            ]
        ]
    },
    {
        "id": "89f0293437699a5e",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=75 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=75\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 340,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "830c2584d4010f9c",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 220,
        "wires": [
            [
                "21153eb180adce70"
            ]
        ]
    },
    {
        "id": "21153eb180adce70",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=74 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=74\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 220,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "7159700b33c8a71d",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=73 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=73\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 100,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "d7a0922443bbf880",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 100,
        "wires": [
            [
                "7159700b33c8a71d"
            ]
        ]
    },
    {
        "id": "e5adb92607f7d751",
        "type": "comment",
        "z": "0fed82592f6f61c7",
        "name": "Camera-up",
        "info": "",
        "x": 100,
        "y": 60,
        "wires": []
    },
    {
        "id": "53808435bd40f609",
        "type": "comment",
        "z": "0fed82592f6f61c7",
        "name": "Camera-down",
        "info": "",
        "x": 110,
        "y": 180,
        "wires": []
    },
    {
        "id": "1101a1f095fa2615",
        "type": "comment",
        "z": "0fed82592f6f61c7",
        "name": "Camera-left",
        "info": "",
        "x": 110,
        "y": 300,
        "wires": []
    },
    {
        "id": "8d14b048da418cfe",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 420,
        "wires": [
            [
                "77b7404e7124735b"
            ]
        ]
    },
    {
        "id": "77b7404e7124735b",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=76 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=76\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 420,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "4bef02ad0a6c2d61",
        "type": "comment",
        "z": "0fed82592f6f61c7",
        "name": "Camera-right",
        "info": "",
        "x": 110,
        "y": 420,
        "wires": []
    },
    {
        "id": "473fe26a3961a1e4",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 460,
        "wires": [
            [
                "72e819198b686a9c"
            ]
        ]
    },
    {
        "id": "72e819198b686a9c",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS-Schnittstelle;ns=4;i=76 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS-Schnittstelle;ns=4;i=76\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 460,
        "wires": [
            [
                "5688fbcd06c49d30"
            ]
        ]
    },
    {
        "id": "53676f15075292c4",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 660,
        "wires": [
            [
                "45627f1284403c5f"
            ]
        ]
    },
    {
        "id": "45627f1284403c5f",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Trash (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Trash\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 660,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "c337660daf8c4d1b",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 700,
        "wires": [
            [
                "4cf3f9bee757f5c1"
            ]
        ]
    },
    {
        "id": "4cf3f9bee757f5c1",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Trash (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Trash\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 700,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "d27e6b3806be434b",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 540,
        "wires": [
            [
                "7e02c88ad13aa05e"
            ]
        ]
    },
    {
        "id": "7e02c88ad13aa05e",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS;ns=4;i=45 (To_Input) (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS;ns=4;i=45\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 540,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "53fab6d751e90767",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 580,
        "wires": [
            [
                "e683a6e9121b4f42"
            ]
        ]
    },
    {
        "id": "e683a6e9121b4f42",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS;ns=4;i=45 (To_Input) (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS;ns=4;i=45\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 580,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "520f07759b7d3487",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 540,
        "wires": [
            [
                "3e443703d9d236d9"
            ]
        ]
    },
    {
        "id": "3e443703d9d236d9",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "INPUT_RGB (To_Color) (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"INPUT_RGB\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 540,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "14c00cc951b2dc6b",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 580,
        "wires": [
            [
                "224ef1ab9c2a5ff9"
            ]
        ]
    },
    {
        "id": "224ef1ab9c2a5ff9",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "INPUT_RGB (To_Color) (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"INPUT_RGB\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 580,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "aea9645191e157be",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 660,
        "wires": [
            [
                "560a3611fe37416c"
            ]
        ]
    },
    {
        "id": "560a3611fe37416c",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "RGB_NFC (To_NFC) (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"RGB_NFC\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 660,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "6c84beea9c45b2e6",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 700,
        "wires": [
            [
                "365e50feb7bd76a3"
            ]
        ]
    },
    {
        "id": "365e50feb7bd76a3",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "RGB_NFC (To_NFC) (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"RGB_NFC\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 700,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "5312e6328b054f72",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 780,
        "wires": [
            [
                "d3cd1fe56f05d683"
            ]
        ]
    },
    {
        "id": "d3cd1fe56f05d683",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DROP (To_FTS-L2) (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DROP\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 780,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "58532379e282dcd7",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 820,
        "wires": [
            [
                "10bf722c6d54d194"
            ]
        ]
    },
    {
        "id": "10bf722c6d54d194",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DROP (To_FTS-L2) (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DROP\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 820,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "10bec1c1d7883673",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1360,
        "y": 1280,
        "wires": [
            [
                "13e6f9261f4f5cd9"
            ]
        ]
    },
    {
        "id": "13e6f9261f4f5cd9",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "Tester01 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"Tester01\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 1280,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "fd767cc2caf846d3",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1360,
        "y": 1320,
        "wires": [
            [
                "eb185655553e7562"
            ]
        ]
    },
    {
        "id": "eb185655553e7562",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "Tester01 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"Tester01\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 1320,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "1002126cec9aa3ef",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 780,
        "wires": [
            [
                "650bc813a8186ea4"
            ]
        ]
    },
    {
        "id": "650bc813a8186ea4",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Output (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Output\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 780,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "bcc10f01acd3d026",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 820,
        "wires": [
            [
                "ad4abfefbc1de1d9"
            ]
        ]
    },
    {
        "id": "ad4abfefbc1de1d9",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Output (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Output\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 820,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "c9bd02067bdb1a6e",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 900,
        "wires": [
            [
                "77f352a1b5a825b5"
            ]
        ]
    },
    {
        "id": "77f352a1b5a825b5",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Standby (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Standby\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 900,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "9b89af4e030bb5bb",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 940,
        "wires": [
            [
                "3b5b6c771f73e432"
            ]
        ]
    },
    {
        "id": "3b5b6c771f73e432",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Standby (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Standby\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 940,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "5688fbcd06c49d30",
        "type": "link out",
        "z": "0fed82592f6f61c7",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 915,
        "y": 260,
        "wires": []
    },
    {
        "id": "bb456ec0c4204dba",
        "type": "comment",
        "z": "0fed82592f6f61c7",
        "name": "Robot",
        "info": "",
        "x": 90,
        "y": 540,
        "wires": []
    },
    {
        "id": "dc29e4c8e3ce0902",
        "type": "link out",
        "z": "0fed82592f6f61c7",
        "name": "link out 11",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 795,
        "y": 800,
        "wires": []
    },
    {
        "id": "75f317283378c5e2",
        "type": "link out",
        "z": "0fed82592f6f61c7",
        "name": "link out 12",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1335,
        "y": 800,
        "wires": []
    },
    {
        "id": "3a64a10703237db0",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1020,
        "wires": [
            [
                "117c30fde7897f80"
            ]
        ]
    },
    {
        "id": "117c30fde7897f80",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid1 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid1\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1020,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "7b397c50aa5f1f83",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1060,
        "wires": [
            [
                "4740241a2778f3c3"
            ]
        ]
    },
    {
        "id": "4740241a2778f3c3",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid1 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid1\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1060,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "bd9c1e010c52ef1d",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 1020,
        "wires": [
            [
                "94e69025204ec28b"
            ]
        ]
    },
    {
        "id": "94e69025204ec28b",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid2 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid2\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1020,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "2a928129922c7303",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 1060,
        "wires": [
            [
                "2ef93321bc82027b"
            ]
        ]
    },
    {
        "id": "2ef93321bc82027b",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid2 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid2\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1060,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "f5760d9517578f50",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1140,
        "wires": [
            [
                "bbb47e307b33ab69"
            ]
        ]
    },
    {
        "id": "bbb47e307b33ab69",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid3 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid3\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1140,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "859af8332610e65c",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1180,
        "wires": [
            [
                "5a1a04b9aa6780bd"
            ]
        ]
    },
    {
        "id": "5a1a04b9aa6780bd",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid3 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid3\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1180,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "31043a5014c1d3cc",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 1140,
        "wires": [
            [
                "d3051d8aa7299ec7"
            ]
        ]
    },
    {
        "id": "d3051d8aa7299ec7",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid4 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid4\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1140,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "1c09d5786774da11",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 1180,
        "wires": [
            [
                "3604b744f0d2f51f"
            ]
        ]
    },
    {
        "id": "3604b744f0d2f51f",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid4 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid4\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1180,
        "wires": [
            [
                "75f317283378c5e2"
            ]
        ]
    },
    {
        "id": "33491172458ee89d",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1260,
        "wires": [
            [
                "b0ec98b869336874"
            ]
        ]
    },
    {
        "id": "b0ec98b869336874",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid5 (true)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid5\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1260,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "14df2bf0ea375630",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1300,
        "wires": [
            [
                "e9f097869c1b9ccc"
            ]
        ]
    },
    {
        "id": "e9f097869c1b9ccc",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "To_Mid5 (false)",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"To_Mid5\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1300,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "ae0a6f77d8dd6a30",
        "type": "inject",
        "z": "0fed82592f6f61c7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 1380,
        "wires": [
            [
                "e94efd972b6ee680"
            ]
        ]
    },
    {
        "id": "e94efd972b6ee680",
        "type": "function",
        "z": "0fed82592f6f61c7",
        "name": "DPS;Color",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DPS;Color\", // Name der Variable\n    variableValue: { value: \"BLUE\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1380,
        "wires": [
            [
                "dc29e4c8e3ce0902"
            ]
        ]
    },
    {
        "id": "1b7af3b0e5b19661",
        "type": "websocket out",
        "z": "71de62f6245167bc",
        "name": "",
        "server": "1688373ab61bf50e",
        "client": "",
        "x": 670,
        "y": 100,
        "wires": []
    },
    {
        "id": "f4ea2cefeb1def06",
        "type": "link in",
        "z": "71de62f6245167bc",
        "name": "link in 2",
        "links": [
            "0281ac883fa8ca1a",
            "250581bd3ea00060",
            "35948efeed5206ad",
            "54a1d3db60c49611",
            "5578c4f858a79816",
            "5688fbcd06c49d30",
            "6da64426fbd2415f",
            "75f317283378c5e2",
            "7b2aca1d999df693",
            "931a98602dd2d3f9",
            "9ffeceb7ac71f3c1",
            "a20055410395383e",
            "b330421cd958e630",
            "bbe713de01baa609",
            "bedc7a94872039d3",
            "c2ac86a40c009f39",
            "ce7a90dd937307c8",
            "dc29e4c8e3ce0902",
            "f3b12caa2f1123ae",
            "fb1b91b79bc6444b",
            "fe711d7db3b76a10"
        ],
        "x": 35,
        "y": 100,
        "wires": [
            [
                "1b7af3b0e5b19661",
                "2e851637d6c7e733"
            ]
        ]
    },
    {
        "id": "11ef60cd331d7548",
        "type": "websocket in",
        "z": "71de62f6245167bc",
        "name": "",
        "server": "1688373ab61bf50e",
        "client": "",
        "x": 90,
        "y": 40,
        "wires": [
            [
                "1dd26a6463e41a86"
            ]
        ]
    },
    {
        "id": "1dd26a6463e41a86",
        "type": "function",
        "z": "71de62f6245167bc",
        "name": "Pong",
        "func": "if (msg.payload === \"ping\") {\n    // Reagiere auf das Ping und sende eine Antwort zurck\n    msg.payload = \"pong\";\n    return msg; // Nachrichten an den WebSocket Out-Node senden\n} else {\n    // Andere Nachrichten ignorieren\n    return null;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 40,
        "wires": [
            [
                "0be9418488f5db01"
            ]
        ]
    },
    {
        "id": "298d8f5e2004704a",
        "type": "debug",
        "z": "71de62f6245167bc",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 40,
        "wires": []
    },
    {
        "id": "0be9418488f5db01",
        "type": "function",
        "z": "71de62f6245167bc",
        "name": "function 18",
        "func": "// Zugriff auf das \"payload\"-Objekt\nlet payload = msg.payload;\n// Ausgabe in msg.payload formatieren\nmsg.payload = {\n    variableName: \"PING\",\n    variableValue: payload\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 40,
        "wires": [
            [
                "298d8f5e2004704a",
                "1b7af3b0e5b19661"
            ]
        ]
    },
    {
        "id": "2e851637d6c7e733",
        "type": "debug",
        "z": "71de62f6245167bc",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 160,
        "wires": []
    },
    {
        "id": "3a56b6387a3a89e6",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "c1033c3aa3c7dc4f"
            ]
        ]
    },
    {
        "id": "af6a47ef86e2e593",
        "type": "function",
        "z": "efa2a92c452b46f6",
        "name": "Convert_Driving_Data",
        "func": "var payload = msg.payload;\n\n// Standardwerte bernehmen\nvar timestamp = payload.timestamp;\nvar serialNumber = payload.serialNumber;\n\n// Falls `nodes` oder `edges` fehlen, alternative JSON erzeugen\nif (!payload.nodes || !payload.edges) {\n    payload = {\n        \"timestamp\": timestamp,\n        \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n        \"orderUpdateId\": 0,\n        \"nodes\": [\n            {\n                \"id\": \"SVR4PW6408\",\n                \"linkedEdges\": [],\n                \"action\": {\n                    \"type\": \"DOCK\",\n                    \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n                    \"metadata\": {\n                        \"loadId\": \"043169ca341290\",\n                        \"loadType\": \"\",\n                        \"loadPosition\": \"3\"\n                    }\n                }\n            }\n        ],\n        \"edges\": [],\n        \"serialNumber\": serialNumber\n    };\n}\n\n// Jetzt die allgemeine Verarbeitung starten\nvar nodes = payload.nodes;\nvar edges = payload.edges;\n\n// Mapping der Edge-Lngen zu den Nodes\nvar edgeLengths = {};\nedges.forEach(edge => {\n    edge.linkedNodes.forEach(nodeId => {\n        if (!edgeLengths[nodeId]) {\n            edgeLengths[nodeId] = edge.length;\n        }\n    });\n});\n\n// Erste Node entfernen (nur wenn mehr als eine Node vorhanden ist)\nif (nodes.length > 1) {\n    nodes.shift();\n}\n\n// Lngen zuweisen und \"DOCK\"-Nodes auf 0 setzen\nnodes.forEach(node => {\n    node.length = edgeLengths[node.id] || 0;\n    if (node.action && node.action.type === \"DOCK\") {\n        node.length = 0;\n    } else if (node.length === 360) {\n        node.length = 500; // Umwandlung von 360 auf 500\n    }\n\n    // Unntige Felder entfernen (nur action.id wird entfernt)\n    if (node.action) {\n        delete node.action.id;\n    }\n});\n\n// Endgltige JSON erstellen\nvar output = {\n    timestamp: timestamp,\n    nodes: nodes,\n    serialNumber: serialNumber\n};\n\n// JSON in einen String umwandeln\nvar jsonString = JSON.stringify(output);\n\n// msg.payload fr den nchsten Block vorbereiten\nmsg.payload = {\n    variableName: \"drivingdata\", // Variablenname\n    variableValue: jsonString // Variablenwert (der JSON-String)\n};\n\n// Nachricht zurckgeben\nreturn msg;\n\n\n\n\n/*\n\n// Eingehende JSON-Nachricht parsen\nvar payload = msg.payload;\n\n// Relevante Daten extrahieren\nvar nodes = payload.nodes;\nvar edges = payload.edges;\nvar serialNumber = payload.serialNumber;\n\n// Mapping der Edge-Lngen zu den Nodes\nvar edgeLengths = {};\nedges.forEach(edge => {\n    edge.linkedNodes.forEach(nodeId => {\n        if (!edgeLengths[nodeId]) {\n            edgeLengths[nodeId] = edge.length;\n        }\n    });\n});\n\n// Erste Node entfernen (nur wenn mehr als eine Node vorhanden ist)\nif (nodes.length > 1) {\n    nodes.shift();\n}\n\n// Lngen zuweisen und \"DOCK\"-Nodes auf 0 setzen\nnodes.forEach(node => {\n    node.length = edgeLengths[node.id] || 0;\n    if (node.action && node.action.type === \"DOCK\") {\n        node.length = 0;\n    } else if (node.length === 360) {\n        node.length = 500; // Umwandlung von 360 auf 500\n    }\n    \n    // Unntige Felder entfernen (nur action.id wird entfernt)\n    if (node.action) {\n        delete node.action.id;\n    }\n});\n\n// Neue JSON erstellen\nvar output = {\n    nodes: nodes,\n    serialNumber: serialNumber\n};\n\n// JSON in einen String umwandeln\nvar jsonString = JSON.stringify(output);\n\n// Escape-Anfhrungszeichen fr den String\n//jsonString = jsonString.replace(/\"/g, '\\\\\"');\n\n// msg.payload fr den nchsten Block vorbereiten\nmsg.payload = {\n    variableName: \"drivingdata\", // Variablenname\n    variableValue: jsonString // Variablenwert (der JSON-String, korrekt escaped)\n};\n\n// Debug-Ausgabe\n// node.warn(`Variable: ${msg.payload.variableName}, Wert: ${msg.payload.variableValue}`);\n\nreturn msg;\n*/",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 260,
        "wires": [
            [
                "f3b12caa2f1123ae"
            ]
        ]
    },
    {
        "id": "3ef0bb33a03505f2",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 260,
        "wires": [
            [
                "dbab4679fe105540"
            ]
        ]
    },
    {
        "id": "701df2c89be26fc6",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 320,
        "wires": [
            [
                "40a035275984a727"
            ]
        ]
    },
    {
        "id": "ec90531febb26eda",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 380,
        "wires": [
            [
                "42fe9fb5e642ed6c"
            ]
        ]
    },
    {
        "id": "663aaded6a3ee266",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 440,
        "wires": [
            [
                "bf3e5d20c312aa8e"
            ]
        ]
    },
    {
        "id": "efe4834abe5f2f45",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 40,
        "wires": [
            [
                "c530c40b616fd94c"
            ]
        ]
    },
    {
        "id": "7e408a21be9b3a17",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 120,
        "wires": [
            [
                "22a5fe861d185584"
            ]
        ]
    },
    {
        "id": "1d727447ca89181c",
        "type": "comment",
        "z": "efa2a92c452b46f6",
        "name": "FTS",
        "info": "",
        "x": 90,
        "y": 20,
        "wires": []
    },
    {
        "id": "f3b12caa2f1123ae",
        "type": "link out",
        "z": "efa2a92c452b46f6",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 755,
        "y": 260,
        "wires": []
    },
    {
        "id": "0136270294afcfde",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 1280,
        "wires": [
            [
                "569e94565cb72f09"
            ]
        ]
    },
    {
        "id": "4ad8796d0346f8e2",
        "type": "function",
        "z": "efa2a92c452b46f6",
        "name": "Convert_Driving_Data",
        "func": "var payload = msg.payload;\n\n// Standardwerte bernehmen\nvar timestamp = payload.timestamp;\nvar serialNumber = payload.serialNumber;\n\n// Falls `nodes` oder `edges` fehlen, alternative JSON erzeugen\nif (!payload.nodes || !payload.edges) {\n    payload = {\n        \"timestamp\": timestamp,\n        \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n        \"orderUpdateId\": 0,\n        \"nodes\": [\n            {\n                \"id\": \"SVR4PW6408\",\n                \"linkedEdges\": [],\n                \"action\": {\n                    \"type\": \"DOCK\",\n                    \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n                    \"metadata\": {\n                        \"loadId\": \"043169ca341290\",\n                        \"loadType\": \"\",\n                        \"loadPosition\": \"3\"\n                    }\n                }\n            }\n        ],\n        \"edges\": [],\n        \"serialNumber\": serialNumber\n    };\n}\n\n// Jetzt die allgemeine Verarbeitung starten\nvar nodes = payload.nodes;\nvar edges = payload.edges;\n\n// Mapping der Edge-Lngen zu den Nodes\nvar edgeLengths = {};\nedges.forEach(edge => {\n    edge.linkedNodes.forEach(nodeId => {\n        if (!edgeLengths[nodeId]) {\n            edgeLengths[nodeId] = edge.length;\n        }\n    });\n});\n\n// Erste Node entfernen (nur wenn mehr als eine Node vorhanden ist)\nif (nodes.length > 1) {\n    nodes.shift();\n}\n\n// Lngen zuweisen und \"DOCK\"-Nodes auf 0 setzen\nnodes.forEach(node => {\n    node.length = edgeLengths[node.id] || 0;\n    if (node.action && node.action.type === \"DOCK\") {\n        node.length = 0;\n    } else if (node.length === 360) {\n        node.length = 500; // Umwandlung von 360 auf 500\n    }\n\n    // Unntige Felder entfernen (nur action.id wird entfernt)\n    if (node.action) {\n        delete node.action.id;\n    }\n});\n\n// Endgltige JSON erstellen\nvar output = {\n    timestamp: timestamp,\n    nodes: nodes,\n    serialNumber: serialNumber\n};\n\n// JSON in einen String umwandeln\nvar jsonString = JSON.stringify(output);\n\n// msg.payload fr den nchsten Block vorbereiten\nmsg.payload = {\n    variableName: \"drivingdata\", // Variablenname\n    variableValue: jsonString // Variablenwert (der JSON-String)\n};\n\n// Nachricht zurckgeben\nreturn msg;\n\n\n\n\n/*\n\n// Eingehende JSON-Nachricht parsen\nvar payload = msg.payload;\n\n// Relevante Daten extrahieren\nvar nodes = payload.nodes;\nvar edges = payload.edges;\nvar serialNumber = payload.serialNumber;\n\n// Mapping der Edge-Lngen zu den Nodes\nvar edgeLengths = {};\nedges.forEach(edge => {\n    edge.linkedNodes.forEach(nodeId => {\n        if (!edgeLengths[nodeId]) {\n            edgeLengths[nodeId] = edge.length;\n        }\n    });\n});\n\n// Erste Node entfernen (nur wenn mehr als eine Node vorhanden ist)\nif (nodes.length > 1) {\n    nodes.shift();\n}\n\n// Lngen zuweisen und \"DOCK\"-Nodes auf 0 setzen\nnodes.forEach(node => {\n    node.length = edgeLengths[node.id] || 0;\n    if (node.action && node.action.type === \"DOCK\") {\n        node.length = 0;\n    } else if (node.length === 360) {\n        node.length = 500; // Umwandlung von 360 auf 500\n    }\n    \n    // Unntige Felder entfernen (nur action.id wird entfernt)\n    if (node.action) {\n        delete node.action.id;\n    }\n});\n\n// Neue JSON erstellen\nvar output = {\n    nodes: nodes,\n    serialNumber: serialNumber\n};\n\n// JSON in einen String umwandeln\nvar jsonString = JSON.stringify(output);\n\n// Escape-Anfhrungszeichen fr den String\n//jsonString = jsonString.replace(/\"/g, '\\\\\"');\n\n// msg.payload fr den nchsten Block vorbereiten\nmsg.payload = {\n    variableName: \"drivingdata\", // Variablenname\n    variableValue: jsonString // Variablenwert (der JSON-String, korrekt escaped)\n};\n\n// Debug-Ausgabe\n// node.warn(`Variable: ${msg.payload.variableName}, Wert: ${msg.payload.variableValue}`);\n\nreturn msg;\n*/",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1340,
        "wires": [
            [
                "250581bd3ea00060"
            ]
        ]
    },
    {
        "id": "39896f18dadc5a2d",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 1340,
        "wires": [
            [
                "3191ca4b9021a90b"
            ]
        ]
    },
    {
        "id": "73b3bf43ce85cd6c",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 1400,
        "wires": [
            [
                "e7b837570ca764c6"
            ]
        ]
    },
    {
        "id": "23bc3b2b5e5c3f40",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 1460,
        "wires": [
            [
                "c23cbcbcec1ff1ae"
            ]
        ]
    },
    {
        "id": "36a4ab5be19d5324",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 1520,
        "wires": [
            [
                "b54f14fe59e3e461"
            ]
        ]
    },
    {
        "id": "b137e1831f89bbca",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 560,
        "y": 1120,
        "wires": [
            [
                "87cf2644314f27af"
            ]
        ]
    },
    {
        "id": "ee78381fa250eef0",
        "type": "inject",
        "z": "efa2a92c452b46f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 560,
        "y": 1200,
        "wires": [
            [
                "ddd32eca0d9a10ad"
            ]
        ]
    },
    {
        "id": "00eeb7f529e82734",
        "type": "comment",
        "z": "efa2a92c452b46f6",
        "name": "FTS",
        "info": "",
        "x": 450,
        "y": 1040,
        "wires": []
    },
    {
        "id": "250581bd3ea00060",
        "type": "link out",
        "z": "efa2a92c452b46f6",
        "name": "link out 15",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1185,
        "y": 1340,
        "wires": []
    },
    {
        "id": "c1033c3aa3c7dc4f",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "DPS to HBW",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:31.618Z\",\n  \"orderId\": \"9da5c66d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdatedId\": 2,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"SVR4PW6408-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4PW6408-2\", \"2-1\"],\n      \"action\": {\n        \"id\": \"6367b144-4350-434e-bfc8-6bb687dcef66\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"2-1\", \"1-SVR5H85409\"],\n      \"action\": {\n        \"id\": \"9140b17e-d5e4-42ae-888e-557d491d379c\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"1-SVR5H85409\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"ab916e13-a5f2-4b00-bbd4-e18f0940cfa3\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR4PW6408-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4PW6408\", \"2\"]\n    },\n    {\n      \"id\": \"2-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"2\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H85409\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H85409\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 310,
        "y": 200,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "dbab4679fe105540",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "HBW to DRILL",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:58:25.039Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 2,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"SVR5H85409-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H85409-1\", \"1-3\"],\n      \"action\": {\n        \"id\": \"6d3c47c7-01bb-4040-ab3e-84e5a069ed12\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"1-3\", \"3-SVR5H85384\"],\n      \"action\": {\n        \"id\": \"436a70c6-00b6-42b3-9fa0-ba321a809c16\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"3-SVR5H85384\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"6d8631b4-a0d1-4e13-a962-23e07a143b1f\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85409-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85409\", \"1\"]\n    },\n    {\n      \"id\": \"1-3\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"3\"]\n    },\n    {\n      \"id\": \"3-SVR5H85384\",\n      \"length\": 380,\n      \"linkedNodes\": [\"3\", \"SVR5H85384\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 300,
        "y": 260,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "40a035275984a727",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "DRILL to MILL",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:12.944Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 6,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"SVR5H85384-3\"]\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"SVR5H85384-3\", \"3-1\"],\n      \"action\": {\n        \"id\": \"5ba43542-bc85-4796-9b9b-44d1d8308d04\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"3-1\", \"1-SVR5H59286\"],\n      \"action\": {\n        \"id\": \"b148724e-5ae5-4a29-930e-324ea2fd1b10\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H59286\",\n      \"linkedEdges\": [\"1-SVR5H59286\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"38cf85be-4a93-490d-937f-63309550b447\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85384-3\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85384\", \"3\"]\n    },\n    {\n      \"id\": \"3-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"3\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H59286\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H59286\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 300,
        "y": 320,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "42fe9fb5e642ed6c",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "MILL to AIQS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:57.157Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 10,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H59286\",  \n      \"linkedEdges\": [\"SVR5H59286-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H59286-1\", \"1-2\"],  \n      \"action\": {\n        \"id\": \"91084976-31d0-470e-b595-8b596a4ae39f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"1-2\", \"2-SVR4LR8731\"],   \n      \"action\": {\n        \"id\": \"56a5dae2-ad10-4fb7-9456-c7b97cc1688f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"2-SVR4LR8731\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"d1b48ccd-8948-4ec7-a358-fa8f732b5c8e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H59286-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H59286\", \"1\"]\n    },\n    {\n      \"id\": \"1-2\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4LR8731\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4LR8731\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 300,
        "y": 380,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "bf3e5d20c312aa8e",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "AIQS to DPS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T10:00:38.690Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 14,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"SVR4LR8731-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4LR8731-2\", \"2-SVR4PW6408\"],\n      \"action\": {\n        \"id\": \"1c2fa219-3c87-44fe-ac27-f19c95753bd4\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"2-SVR4PW6408\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"74cb9844-ff20-469c-96f4-a35a5c199f1e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR4LR8731-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4LR8731\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4PW6408\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4PW6408\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 310,
        "y": 440,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "c530c40b616fd94c",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "Dock DPS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:16.400Z\",\n  \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdateId\": 0,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [],\n  \"serialNumber\": \"4gcx\"\n}",
        "x": 310,
        "y": 40,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "22a5fe861d185584",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "Initial Docking",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-03-06T10:16:24.117Z\",\n  \"serialNumber\": \"80F4\",\n  \"actions\": [\n    {\n      \"actionType\": \"findInitialDockPosition\",\n      \"actionId\": \"ad5328c1-2d42-46fe-9fd8-c29831f5871d\",\n      \"metadata\": {\n        \"nodeId\": \"SVR4PW6408\"\n      }\n    }\n  ]\n}",
        "x": 320,
        "y": 120,
        "wires": [
            [
                "af6a47ef86e2e593"
            ]
        ]
    },
    {
        "id": "569e94565cb72f09",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "DPS to HBW",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:31.618Z\",\n  \"orderId\": \"9da5c66d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdatedId\": 2,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"SVR4PW6408-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4PW6408-2\", \"2-1\"],\n      \"action\": {\n        \"id\": \"6367b144-4350-434e-bfc8-6bb687dcef66\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"2-1\", \"1-SVR5H85409\"],\n      \"action\": {\n        \"id\": \"9140b17e-d5e4-42ae-888e-557d491d379c\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"1-SVR5H85409\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"ab916e13-a5f2-4b00-bbd4-e18f0940cfa3\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR4PW6408-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4PW6408\", \"2\"]\n    },\n    {\n      \"id\": \"2-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"2\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H85409\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H85409\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 740,
        "y": 1280,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "3191ca4b9021a90b",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "HBW to DRILL",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:58:25.039Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 2,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"SVR5H85409-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H85409-1\", \"1-3\"],\n      \"action\": {\n        \"id\": \"6d3c47c7-01bb-4040-ab3e-84e5a069ed12\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"1-3\", \"3-SVR5H85384\"],\n      \"action\": {\n        \"id\": \"436a70c6-00b6-42b3-9fa0-ba321a809c16\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"3-SVR5H85384\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"6d8631b4-a0d1-4e13-a962-23e07a143b1f\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85409-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85409\", \"1\"]\n    },\n    {\n      \"id\": \"1-3\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"3\"]\n    },\n    {\n      \"id\": \"3-SVR5H85384\",\n      \"length\": 380,\n      \"linkedNodes\": [\"3\", \"SVR5H85384\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 730,
        "y": 1340,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "e7b837570ca764c6",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "DRILL to MILL",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:12.944Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 6,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"SVR5H85384-3\"]\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"SVR5H85384-3\", \"3-1\"],\n      \"action\": {\n        \"id\": \"5ba43542-bc85-4796-9b9b-44d1d8308d04\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"3-1\", \"1-SVR5H59286\"],\n      \"action\": {\n        \"id\": \"b148724e-5ae5-4a29-930e-324ea2fd1b10\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H59286\",\n      \"linkedEdges\": [\"1-SVR5H59286\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"38cf85be-4a93-490d-937f-63309550b447\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85384-3\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85384\", \"3\"]\n    },\n    {\n      \"id\": \"3-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"3\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H59286\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H59286\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 730,
        "y": 1400,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "c23cbcbcec1ff1ae",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "MILL to AIQS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:59:57.157Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 10,\n  \"nodes\": [\n    {\n      \"id\": \"SVR5H59286\",  \n      \"linkedEdges\": [\"SVR5H59286-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H59286-1\", \"1-2\"],  \n      \"action\": {\n        \"id\": \"91084976-31d0-470e-b595-8b596a4ae39f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"1-2\", \"2-SVR4LR8731\"],   \n      \"action\": {\n        \"id\": \"56a5dae2-ad10-4fb7-9456-c7b97cc1688f\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"2-SVR4LR8731\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"d1b48ccd-8948-4ec7-a358-fa8f732b5c8e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H59286-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H59286\", \"1\"]\n    },\n    {\n      \"id\": \"1-2\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4LR8731\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4LR8731\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 730,
        "y": 1460,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "b54f14fe59e3e461",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "AIQS to DPS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T10:00:38.690Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 14,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4LR8731\",\n      \"linkedEdges\": [\"SVR4LR8731-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4LR8731-2\", \"2-SVR4PW6408\"],\n      \"action\": {\n        \"id\": \"1c2fa219-3c87-44fe-ac27-f19c95753bd4\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"LEFT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"2-SVR4PW6408\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"74cb9844-ff20-469c-96f4-a35a5c199f1e\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR4LR8731-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4LR8731\", \"2\"]\n    },\n    {\n      \"id\": \"2-SVR4PW6408\",\n      \"length\": 380,\n      \"linkedNodes\": [\"2\", \"SVR4PW6408\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 740,
        "y": 1520,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "87cf2644314f27af",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "Dock DPS",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:55:16.400Z\",\n  \"orderId\": \"9da5c06d-2d1d-4312-a49a-ec7d72f4243c\",\n  \"orderUpdateId\": 0,\n  \"nodes\": [\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n      }\n    }\n  ],\n  \"edges\": [],\n  \"serialNumber\": \"4gcx\"\n}",
        "x": 740,
        "y": 1120,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "ddd32eca0d9a10ad",
        "type": "data-generator",
        "z": "efa2a92c452b46f6",
        "name": "Initial Docking",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"timestamp\": \"2025-03-06T10:16:24.117Z\",\n  \"serialNumber\": \"80F4\",\n  \"actions\": [\n    {\n      \"actionType\": \"findInitialDockPosition\",\n      \"actionId\": \"ad5328c1-2d42-46fe-9fd8-c29831f5871d\",\n      \"metadata\": {\n        \"nodeId\": \"SVR4PW6408\"\n      }\n    }\n  ]\n}",
        "x": 750,
        "y": 1200,
        "wires": [
            [
                "4ad8796d0346f8e2"
            ]
        ]
    },
    {
        "id": "0c918be5c0410a30",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "192743e57543e580"
            ]
        ]
    },
    {
        "id": "192743e57543e580",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=30",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=30\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 180,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "67824f85c1955042",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 60,
        "wires": [
            [
                "fb5c09be2ac2be4e"
            ]
        ]
    },
    {
        "id": "fb5c09be2ac2be4e",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=31",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=31\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 60,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "d784771d79037ec5",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 300,
        "wires": [
            [
                "9c205e1fce4f0c96"
            ]
        ]
    },
    {
        "id": "9c205e1fce4f0c96",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=32",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=32\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 300,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "5552dd9eef603746",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 340,
        "wires": [
            [
                "c2fd159a663c37f1"
            ]
        ]
    },
    {
        "id": "c2fd159a663c37f1",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=32",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=32\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 340,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "561d789ba82ae23b",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 420,
        "wires": [
            [
                "ac83e1f356fc87c7"
            ]
        ]
    },
    {
        "id": "ac83e1f356fc87c7",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=34",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=34\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 420,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "bc0229041381850f",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 460,
        "wires": [
            [
                "97ef0fd3cf16b855"
            ]
        ]
    },
    {
        "id": "97ef0fd3cf16b855",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=34",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=34\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 460,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "34394b29ba47e416",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 220,
        "wires": [
            [
                "0cbd951a396e12b9"
            ]
        ]
    },
    {
        "id": "0cbd951a396e12b9",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=30 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=30\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 220,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "2178fcfdc96c5987",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=31",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=31\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 100,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "8291c89760345813",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 100,
        "wires": [
            [
                "2178fcfdc96c5987"
            ]
        ]
    },
    {
        "id": "3e5347e411c77e2b",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-out",
        "info": "",
        "x": 90,
        "y": 60,
        "wires": []
    },
    {
        "id": "745253e55d9720a6",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-in",
        "info": "",
        "x": 90,
        "y": 180,
        "wires": []
    },
    {
        "id": "16b6d194843128cf",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-Vacuum-down",
        "info": "",
        "x": 130,
        "y": 300,
        "wires": []
    },
    {
        "id": "f4ee19e2d4d7dc02",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-Vacuum-up",
        "info": "",
        "x": 120,
        "y": 340,
        "wires": []
    },
    {
        "id": "f16e9040f66c0f0a",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-activ",
        "info": "",
        "x": 100,
        "y": 420,
        "wires": []
    },
    {
        "id": "855f4d87106bb7fd",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-inactiv",
        "info": "",
        "x": 100,
        "y": 460,
        "wires": []
    },
    {
        "id": "34226fd42c3fc198",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 540,
        "wires": [
            [
                "84da7920c091779d"
            ]
        ]
    },
    {
        "id": "84da7920c091779d",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=28",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=28\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 540,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "8fc833955ec27b2e",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 660,
        "wires": [
            [
                "2382d9ea4c98f51e"
            ]
        ]
    },
    {
        "id": "2382d9ea4c98f51e",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=29",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=29\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 660,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "42c7a50376385ba8",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-Workpiece-in",
        "info": "",
        "x": 120,
        "y": 540,
        "wires": []
    },
    {
        "id": "5087dcc255b686cf",
        "type": "comment",
        "z": "04fb1970364bf715",
        "name": "Drill-Workpiece-out",
        "info": "",
        "x": 130,
        "y": 660,
        "wires": []
    },
    {
        "id": "0fd92606f4afab7c",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 580,
        "wires": [
            [
                "a3c91c7cb27d0c19"
            ]
        ]
    },
    {
        "id": "a3c91c7cb27d0c19",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=28",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=28\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 580,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "7d96fc783463aa40",
        "type": "inject",
        "z": "04fb1970364bf715",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 700,
        "wires": [
            [
                "4914f4a3e591fd05"
            ]
        ]
    },
    {
        "id": "4914f4a3e591fd05",
        "type": "function",
        "z": "04fb1970364bf715",
        "name": "DRILL;ns=4;i=29",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"DRILL;ns=4;i=29\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 700,
        "wires": [
            [
                "fe711d7db3b76a10"
            ]
        ]
    },
    {
        "id": "fe711d7db3b76a10",
        "type": "link out",
        "z": "04fb1970364bf715",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 785,
        "y": 380,
        "wires": []
    },
    {
        "id": "ae48b67aab920d7b",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "b1d5e998bc408353"
            ]
        ]
    },
    {
        "id": "b1d5e998bc408353",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=31 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=31\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 180,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "2500133f6bf1fb91",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 60,
        "wires": [
            [
                "546e23a2b86d2918"
            ]
        ]
    },
    {
        "id": "546e23a2b86d2918",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=32 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=32\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 60,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "5372c97d35bd5cb9",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 300,
        "wires": [
            [
                "5148a8113f7d78c1"
            ]
        ]
    },
    {
        "id": "5148a8113f7d78c1",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=33 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=33\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 300,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "6ce8d1df3ce639a0",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 340,
        "wires": [
            [
                "f63122383c2b2793"
            ]
        ]
    },
    {
        "id": "f63122383c2b2793",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=33 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=33\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 340,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "0ccb767f2ea56fee",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 420,
        "wires": [
            [
                "d5f80d19a36dc3bb"
            ]
        ]
    },
    {
        "id": "d5f80d19a36dc3bb",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=35 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=35\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 420,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "a9ea2a600bd93dd9",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 460,
        "wires": [
            [
                "24ecd3b418375676"
            ]
        ]
    },
    {
        "id": "24ecd3b418375676",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=35 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=35\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 460,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "d9847904b4c9ef6d",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 220,
        "wires": [
            [
                "03c7dbec4e324fbd"
            ]
        ]
    },
    {
        "id": "03c7dbec4e324fbd",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=31 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=31\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 220,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "9c2f8c4f5c9f98d1",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=32 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=32\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 100,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "e95d351ec86a9377",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 100,
        "wires": [
            [
                "9c2f8c4f5c9f98d1"
            ]
        ]
    },
    {
        "id": "de277d4fc6d765a5",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "MILL-out",
        "info": "",
        "x": 100,
        "y": 60,
        "wires": []
    },
    {
        "id": "799901e52f677d4a",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "MILL-in",
        "info": "",
        "x": 90,
        "y": 180,
        "wires": []
    },
    {
        "id": "6660805ee0a495f1",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "Vacuum-down",
        "info": "",
        "x": 110,
        "y": 300,
        "wires": []
    },
    {
        "id": "06c120126d151449",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "Vacuum-up",
        "info": "",
        "x": 110,
        "y": 340,
        "wires": []
    },
    {
        "id": "8fe2194d3e14fda4",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "MILL-activ",
        "info": "",
        "x": 100,
        "y": 420,
        "wires": []
    },
    {
        "id": "e91a8e64a34dcdfb",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "MILL-inactiv",
        "info": "",
        "x": 110,
        "y": 460,
        "wires": []
    },
    {
        "id": "f90daa9ec7a02b02",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 540,
        "wires": [
            [
                "96c68aa305513b9f"
            ]
        ]
    },
    {
        "id": "96c68aa305513b9f",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=29 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=29\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 540,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "fc9dfd3e6ecfbd2f",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 660,
        "wires": [
            [
                "cadf9d04f8865a17"
            ]
        ]
    },
    {
        "id": "cadf9d04f8865a17",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=30 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=30\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 660,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "017701fec1f998ea",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "DRILL-Workpiece-in",
        "info": "",
        "x": 130,
        "y": 540,
        "wires": []
    },
    {
        "id": "daacb003eccad121",
        "type": "comment",
        "z": "19d805df40a787da",
        "name": "DRILL-Workpiece-out",
        "info": "",
        "x": 140,
        "y": 660,
        "wires": []
    },
    {
        "id": "ed7057f69ceae184",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 580,
        "wires": [
            [
                "bf32d919a9aebe41"
            ]
        ]
    },
    {
        "id": "bf32d919a9aebe41",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=29 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=29\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 580,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "18c90a0e6e5642c4",
        "type": "inject",
        "z": "19d805df40a787da",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 700,
        "wires": [
            [
                "3d7f41f7826de3e4"
            ]
        ]
    },
    {
        "id": "3d7f41f7826de3e4",
        "type": "function",
        "z": "19d805df40a787da",
        "name": "MILL;ns=4;i=30 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"MILL;ns=4;i=30\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 700,
        "wires": [
            [
                "5578c4f858a79816"
            ]
        ]
    },
    {
        "id": "5578c4f858a79816",
        "type": "link out",
        "z": "19d805df40a787da",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 825,
        "y": 380,
        "wires": []
    },
    {
        "id": "9417be2a5c9b83ba",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 840,
        "wires": [
            [
                "bced1c6dcb26cb37"
            ]
        ]
    },
    {
        "id": "bced1c6dcb26cb37",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=373",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=373\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 840,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "01c5f99017807887",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "HBW Position",
        "info": "",
        "x": 80,
        "y": 240,
        "wires": []
    },
    {
        "id": "bee3094530377c7e",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Start x-movement +",
        "info": "",
        "x": 130,
        "y": 840,
        "wires": []
    },
    {
        "id": "40fc2c2217895d04",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 960,
        "wires": [
            [
                "b4cbba4741f9f546"
            ]
        ]
    },
    {
        "id": "b4cbba4741f9f546",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=372",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=372\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 960,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "c44e6f436234980e",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Start x-movement -",
        "info": "",
        "x": 130,
        "y": 960,
        "wires": []
    },
    {
        "id": "5913f09ab662f097",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 360,
        "wires": [
            [
                "39f65bd44c69025e"
            ]
        ]
    },
    {
        "id": "39f65bd44c69025e",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"A1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 360,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "df5c1b40e21d6b6d",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "4724998941b309a5"
            ]
        ]
    },
    {
        "id": "4724998941b309a5",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"A2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 400,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "10fe08e1355ec2b6",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 440,
        "wires": [
            [
                "33013e9f6fce654d"
            ]
        ]
    },
    {
        "id": "33013e9f6fce654d",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"A3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 440,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "4d4d0b79e07899de",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 500,
        "wires": [
            [
                "fc0c087e5cced598"
            ]
        ]
    },
    {
        "id": "fc0c087e5cced598",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"B1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 500,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "2d9b103127d6475d",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 540,
        "wires": [
            [
                "6452d1c68d50eb2e"
            ]
        ]
    },
    {
        "id": "6452d1c68d50eb2e",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"B2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 540,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "c983218e05da8c03",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 580,
        "wires": [
            [
                "c8f981b780031daf"
            ]
        ]
    },
    {
        "id": "c8f981b780031daf",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"B3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 580,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "4ce7fa96bbd57f6a",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 620,
        "wires": [
            [
                "68c3fdbe4aca4df3"
            ]
        ]
    },
    {
        "id": "68c3fdbe4aca4df3",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"C1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 640,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "a25ebe82d4f25136",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 680,
        "wires": [
            [
                "7c5ada416dd39478"
            ]
        ]
    },
    {
        "id": "7c5ada416dd39478",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"C2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 680,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "05937be0f2e31f39",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 720,
        "wires": [
            [
                "59abc110286374ea"
            ]
        ]
    },
    {
        "id": "59abc110286374ea",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=248",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=248\", // Name der Variable\n    variableValue: { value: \"C3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 720,
        "wires": [
            [
                "bbe713de01baa609"
            ]
        ]
    },
    {
        "id": "322a3d411164d8e3",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "HBW Drop",
        "info": "",
        "x": 70,
        "y": 300,
        "wires": []
    },
    {
        "id": "bbe713de01baa609",
        "type": "link out",
        "z": "2e420980abe586e7",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 515,
        "y": 540,
        "wires": []
    },
    {
        "id": "f57ceb0ad8627758",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 360,
        "wires": [
            [
                "159ba0841c90250f"
            ]
        ]
    },
    {
        "id": "159ba0841c90250f",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"A1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 360,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "fa9989ae88760f80",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 400,
        "wires": [
            [
                "60d0c814c5a3dbe0"
            ]
        ]
    },
    {
        "id": "60d0c814c5a3dbe0",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"A2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 400,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "1cd57e78bf6f2d49",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "A3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 440,
        "wires": [
            [
                "16cbfc3aaa1dc368"
            ]
        ]
    },
    {
        "id": "16cbfc3aaa1dc368",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"A3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 440,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "d5ab8573e892109b",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 500,
        "wires": [
            [
                "e7b032b80dabc538"
            ]
        ]
    },
    {
        "id": "e7b032b80dabc538",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"B1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 500,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "ba475a2ba50306d1",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 540,
        "wires": [
            [
                "cadb6e9836e8feaa"
            ]
        ]
    },
    {
        "id": "cadb6e9836e8feaa",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"B2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 540,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "6c1ca4d247ca0857",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "B3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 580,
        "wires": [
            [
                "9c11d98de039271c"
            ]
        ]
    },
    {
        "id": "9c11d98de039271c",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"B3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 580,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "91d3929e37f7385c",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 640,
        "wires": [
            [
                "16e407ee816ede5f"
            ]
        ]
    },
    {
        "id": "16e407ee816ede5f",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"C1\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 640,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "25c22d1edd84b60e",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C2",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 680,
        "wires": [
            [
                "6f14424179320c9b"
            ]
        ]
    },
    {
        "id": "6f14424179320c9b",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"C2\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 680,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "81ddd891fc35c7d1",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "C3",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 640,
        "y": 720,
        "wires": [
            [
                "366a194d61d1137c"
            ]
        ]
    },
    {
        "id": "366a194d61d1137c",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=245",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=245\", // Name der Variable\n    variableValue: { value: \"C3\" } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 720,
        "wires": [
            [
                "a20055410395383e"
            ]
        ]
    },
    {
        "id": "20b67523eff0f418",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "HBW Pick",
        "info": "",
        "x": 600,
        "y": 300,
        "wires": []
    },
    {
        "id": "a20055410395383e",
        "type": "link out",
        "z": "2e420980abe586e7",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 1035,
        "y": 540,
        "wires": []
    },
    {
        "id": "874d46dbce8a3af8",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "f1ddb4c1ee850d6f"
            ]
        ]
    },
    {
        "id": "c9a7d0b0f1e9e571",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "Convert_HBW_State",
        "func": "// Annahme: msg.payload enthlt bereits die empfangene JSON-Datenstruktur\n\n// JSON-Daten als String formatieren\nconst jsonString = JSON.stringify(msg.payload);\n\n// Nachricht fr WebSocket vorbereiten\nmsg.payload = {\n    variableName: \"hbw_state\", // Variablenname\n    variableValue: jsonString    // JSON als String\n};\n\n// Weitergeben an den nchsten Node (z. B. WebSocket)\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 160,
        "wires": [
            [
                "931a98602dd2d3f9"
            ]
        ]
    },
    {
        "id": "40c6fdd58514699b",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 180,
        "wires": [
            [
                "9ddb4c562be9c4e7"
            ]
        ]
    },
    {
        "id": "3e5cdc55fed1e73e",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "HBW Stock Update",
        "info": "",
        "x": 110,
        "y": 80,
        "wires": []
    },
    {
        "id": "931a98602dd2d3f9",
        "type": "link out",
        "z": "2e420980abe586e7",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 705,
        "y": 160,
        "wires": []
    },
    {
        "id": "afa70e3426c3ecbb",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1080,
        "wires": [
            [
                "40d234202352dd4a"
            ]
        ]
    },
    {
        "id": "40d234202352dd4a",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=361",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=361\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1080,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "c3b4e58ef0399c9a",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1120,
        "wires": [
            [
                "11c9bffafe1bb05f"
            ]
        ]
    },
    {
        "id": "11c9bffafe1bb05f",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=361",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=361\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1120,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "0616a7e4fe612ea0",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vacuum",
        "info": "",
        "x": 90,
        "y": 1040,
        "wires": []
    },
    {
        "id": "07a27ae9f6e96a9c",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vacuum-down",
        "info": "",
        "x": 110,
        "y": 1080,
        "wires": []
    },
    {
        "id": "5fc723dd06f61dfd",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "x-Axis",
        "info": "",
        "x": 90,
        "y": 800,
        "wires": []
    },
    {
        "id": "4cc837a97d1523a3",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1200,
        "wires": [
            [
                "8b00286e72ea466b"
            ]
        ]
    },
    {
        "id": "8b00286e72ea466b",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=360",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=360\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1200,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "570ac34fc2e4151e",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1240,
        "wires": [
            [
                "98f332efafc895eb"
            ]
        ]
    },
    {
        "id": "98f332efafc895eb",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=360",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=360\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1240,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "fda0b23e6b43b13f",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vacuum",
        "info": "",
        "x": 90,
        "y": 1160,
        "wires": []
    },
    {
        "id": "d9dd71c16ea0124a",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vacuum-up",
        "info": "",
        "x": 110,
        "y": 1200,
        "wires": []
    },
    {
        "id": "7b2aca1d999df693",
        "type": "link out",
        "z": "2e420980abe586e7",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 825,
        "y": 1640,
        "wires": []
    },
    {
        "id": "ce29bd46dbdf7c5f",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1000,
        "wires": [
            [
                "4f69f0a6fa480d4a"
            ]
        ]
    },
    {
        "id": "4f69f0a6fa480d4a",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=372",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=372\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1000,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "210c0b19c5053ac5",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 880,
        "wires": [
            [
                "344f6e9d85334ba4"
            ]
        ]
    },
    {
        "id": "344f6e9d85334ba4",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=373",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=373\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 880,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "3db58a9f35bcd479",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1320,
        "wires": [
            [
                "c1627e16c445e520"
            ]
        ]
    },
    {
        "id": "c1627e16c445e520",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=366",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=366\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1320,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "893f96298a4e24b0",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RGB-out",
        "info": "",
        "x": 100,
        "y": 1320,
        "wires": []
    },
    {
        "id": "7fa3e41679699790",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Slider",
        "info": "",
        "x": 90,
        "y": 1280,
        "wires": []
    },
    {
        "id": "090bf330f838c4b2",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1360,
        "wires": [
            [
                "cd28e7e0d1b31064"
            ]
        ]
    },
    {
        "id": "cd28e7e0d1b31064",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=366",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=366\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1360,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "47065483f8aafc7b",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1440,
        "wires": [
            [
                "ac537441e0daefa3"
            ]
        ]
    },
    {
        "id": "ac537441e0daefa3",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=367",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=367\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1440,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "f5db4a5f6c52f347",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RGB-in",
        "info": "",
        "x": 90,
        "y": 1440,
        "wires": []
    },
    {
        "id": "0dab293a4985787a",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Slider",
        "info": "",
        "x": 90,
        "y": 1400,
        "wires": []
    },
    {
        "id": "8465d26600cf8559",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1480,
        "wires": [
            [
                "79b5e476a9cbb81f"
            ]
        ]
    },
    {
        "id": "79b5e476a9cbb81f",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=367",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=367\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1480,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "9219915c0cba0537",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1800,
        "wires": [
            [
                "db51d7bb3ca80a92"
            ]
        ]
    },
    {
        "id": "db51d7bb3ca80a92",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=371",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=371\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1800,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "4fd73912e67c5260",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1840,
        "wires": [
            [
                "10bc6af1be3f2f01"
            ]
        ]
    },
    {
        "id": "10bc6af1be3f2f01",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=371",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=371\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1840,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "8a932a0843f32bb4",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RBG-switch-in",
        "info": "",
        "x": 110,
        "y": 1800,
        "wires": []
    },
    {
        "id": "5af43b94aeee6154",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1680,
        "wires": [
            [
                "7ce07b06b34c328b"
            ]
        ]
    },
    {
        "id": "7ce07b06b34c328b",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=374",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=374\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1680,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "0bdcd7ee8e39304f",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RBG-up",
        "info": "",
        "x": 100,
        "y": 1680,
        "wires": []
    },
    {
        "id": "f0d5217799fd72ae",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1720,
        "wires": [
            [
                "6ee38a78a9f555fa"
            ]
        ]
    },
    {
        "id": "6ee38a78a9f555fa",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=374",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=374\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1720,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "c1a5f9f32b4fa75e",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1560,
        "wires": [
            [
                "8e9cf60d84fd7ee1"
            ]
        ]
    },
    {
        "id": "8e9cf60d84fd7ee1",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=375",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=375\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1560,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "87ee649657e62969",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RBG-down",
        "info": "",
        "x": 100,
        "y": 1560,
        "wires": []
    },
    {
        "id": "291e9a4e8d24197a",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1600,
        "wires": [
            [
                "29affaa531252999"
            ]
        ]
    },
    {
        "id": "29affaa531252999",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=375",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=375\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1600,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "4f51cc67e11b5893",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "RBG-switch-out",
        "info": "",
        "x": 120,
        "y": 1920,
        "wires": []
    },
    {
        "id": "fc452154ce0b6027",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1920,
        "wires": [
            [
                "3e26d7c1943c1045"
            ]
        ]
    },
    {
        "id": "3e26d7c1943c1045",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=370",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=370\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1920,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "dae44ba3325d3fd8",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1960,
        "wires": [
            [
                "ea836149af237bfd"
            ]
        ]
    },
    {
        "id": "ea836149af237bfd",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=370",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=370\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1960,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "a6d1fc9b0e124904",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vaccum-rotate-clockwise",
        "info": "",
        "x": 150,
        "y": 2000,
        "wires": []
    },
    {
        "id": "07f592135dec9980",
        "type": "comment",
        "z": "2e420980abe586e7",
        "name": "Vaccum-rotate-counterclockwise",
        "info": "",
        "x": 170,
        "y": 2120,
        "wires": []
    },
    {
        "id": "63f08711e34e4050",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 2080,
        "wires": [
            [
                "db031c15245f3395"
            ]
        ]
    },
    {
        "id": "db031c15245f3395",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=376",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=376\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 2080,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "aac2878869067f22",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 2040,
        "wires": [
            [
                "cd8afa3d97b0948f"
            ]
        ]
    },
    {
        "id": "cd8afa3d97b0948f",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=376",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=376\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 2040,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "54de9d57a4eefa3b",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 2200,
        "wires": [
            [
                "81132138c9a3e435"
            ]
        ]
    },
    {
        "id": "81132138c9a3e435",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=377",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=377\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 2200,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "c8750fb08a798ae6",
        "type": "inject",
        "z": "2e420980abe586e7",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 2160,
        "wires": [
            [
                "b614b445ae45a63b"
            ]
        ]
    },
    {
        "id": "b614b445ae45a63b",
        "type": "function",
        "z": "2e420980abe586e7",
        "name": "HBW;ns=4;i=377",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"HBW;ns=4;i=377\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 2160,
        "wires": [
            [
                "7b2aca1d999df693"
            ]
        ]
    },
    {
        "id": "f1ddb4c1ee850d6f",
        "type": "data-generator",
        "z": "2e420980abe586e7",
        "name": "HBW State - 1",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"ts\": \"2025-02-28T09:58:24.898Z\",\n  \"stockItems\": [\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04d998ca341290\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044768ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"047798ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"042369ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044998ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"043169ca341290\",\n        \"type\": \"BLUE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A1\",\n      \"hbw\": \"SVR5H85409\"\n    }\n  ]\n}\n",
        "x": 300,
        "y": 140,
        "wires": [
            [
                "c9a7d0b0f1e9e571"
            ]
        ]
    },
    {
        "id": "9ddb4c562be9c4e7",
        "type": "data-generator",
        "z": "2e420980abe586e7",
        "name": "HBW State - 2",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "json",
        "template": "{\n  \"ts\": \"2025-02-28T09:55:45.982Z\",\n  \"stockItems\": [\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C1\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"\",\n        \"type\": \"\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04d998ca341290\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044768ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"047798ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"A2\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"042369ca341291\",\n        \"type\": \"WHITE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"04e26aca341290\",\n        \"type\": \"BLUE\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"C3\",\n      \"hbw\": \"SVR5H85409\"\n    },\n    {\n      \"workpiece\": {\n        \"id\": \"044998ca341291\",\n        \"type\": \"RED\",\n        \"state\": \"RAW\"\n      },\n      \"location\": \"B1\",\n      \"hbw\": \"SVR5H85409\"\n    }\n  ]\n}\n",
        "x": 300,
        "y": 180,
        "wires": [
            [
                "c9a7d0b0f1e9e571"
            ]
        ]
    },
    {
        "id": "704b7b54439eae08",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "b51f721683f4fcd1"
            ]
        ]
    },
    {
        "id": "b51f721683f4fcd1",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=61 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=61\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 180,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "8aa50d0749923b58",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 60,
        "wires": [
            [
                "394e102f56bc8361"
            ]
        ]
    },
    {
        "id": "394e102f56bc8361",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=62 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=62\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 60,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "863953029609b074",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 300,
        "wires": [
            [
                "8bacec916d8019d0"
            ]
        ]
    },
    {
        "id": "8bacec916d8019d0",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=65 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=65\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 300,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "b7ccdbddc0ef3476",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 340,
        "wires": [
            [
                "994a41641b046dae"
            ]
        ]
    },
    {
        "id": "994a41641b046dae",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=65 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=65\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 340,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "2685c08f1e1961d4",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 220,
        "wires": [
            [
                "ddd461868ab3a426"
            ]
        ]
    },
    {
        "id": "ddd461868ab3a426",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=61 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=62\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 220,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "7ef6a4121ebd7ef7",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=62 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=62\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 100,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "7b9512ba65d52f71",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 100,
        "wires": [
            [
                "7ef6a4121ebd7ef7"
            ]
        ]
    },
    {
        "id": "0f3934982861d447",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS-out",
        "info": "",
        "x": 100,
        "y": 60,
        "wires": []
    },
    {
        "id": "d299cb6d5d7f9b9f",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS-in",
        "info": "",
        "x": 90,
        "y": 180,
        "wires": []
    },
    {
        "id": "b93b6e747f7cfd6f",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "Vacuum-down",
        "info": "",
        "x": 110,
        "y": 300,
        "wires": []
    },
    {
        "id": "e5c2516e89dc2977",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "Vacuum-up",
        "info": "",
        "x": 110,
        "y": 340,
        "wires": []
    },
    {
        "id": "1eb47045f1a83528",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 420,
        "wires": [
            [
                "20685fd86d9f444f"
            ]
        ]
    },
    {
        "id": "20685fd86d9f444f",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=63 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=63\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 420,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "213b29c90e5013cf",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 540,
        "wires": [
            [
                "19f84d0fac05217a"
            ]
        ]
    },
    {
        "id": "19f84d0fac05217a",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=64 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=64\", // Name der Variable\n    variableValue: { value: true } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 540,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "cf302ee0f88d0a2f",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS-Workpiece-in",
        "info": "",
        "x": 130,
        "y": 420,
        "wires": []
    },
    {
        "id": "5fd20826489a4331",
        "type": "comment",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS-Workpiece-out",
        "info": "",
        "x": 130,
        "y": 540,
        "wires": []
    },
    {
        "id": "51d586ecb49ae7a1",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 460,
        "wires": [
            [
                "58d50c02d67e034a"
            ]
        ]
    },
    {
        "id": "58d50c02d67e034a",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=63 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=63\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 460,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "7ca9704abdb0c968",
        "type": "inject",
        "z": "bdd8e8bb1cc76f16",
        "name": "false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 580,
        "wires": [
            [
                "bb925225eebc6a11"
            ]
        ]
    },
    {
        "id": "bb925225eebc6a11",
        "type": "function",
        "z": "bdd8e8bb1cc76f16",
        "name": "AIQS;ns=4;i=64 ",
        "func": "// Manuelle Definition der Daten\nlet payload = {\n    variableName: \"AIQS;ns=4;i=64\", // Name der Variable\n    variableValue: { value: false } // Wert der Variable (im verschachtelten Objekt)\n};\n\n// Sicherstellen, dass die bentigten Felder existieren\nif (payload && payload.variableName && payload.variableValue && payload.variableValue.value !== undefined) {\n    let variableName = payload.variableName; // Variablenname\n    let variableValue = payload.variableValue.value; // Variablenwert\n\n    // Formatierte Ausgabe\n    msg.payload = {\n        variableName: variableName,\n        variableValue: variableValue\n    };\n} else {\n    // Fehlerausgabe bei ungltigen Daten\n    msg.payload = {\n        error: \"Ungltige Datenstruktur\",\n        originalPayload: payload\n    };\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 580,
        "wires": [
            [
                "6da64426fbd2415f"
            ]
        ]
    },
    {
        "id": "6da64426fbd2415f",
        "type": "link out",
        "z": "bdd8e8bb1cc76f16",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "f4ea2cefeb1def06"
        ],
        "x": 825,
        "y": 320,
        "wires": []
    },
    {
        "id": "ddf93ff003187840",
        "type": "comment",
        "z": "178d4ec7b06e55a6",
        "name": "",
        "info": "aktuell werden sie in jedem Flow selbst gesetzt",
        "x": 210,
        "y": 120,
        "wires": []
    },
    {
        "id": "1134207aeba37347",
        "type": "inject",
        "z": "178d4ec7b06e55a6",
        "name": "Json for dynamic connection (testing)",
        "props": [
            {
                "p": "action",
                "v": "connect",
                "vt": "str"
            },
            {
                "p": "broker",
                "v": "{\"broker\":\"host.docker.internal\",\"port\":1883,\"force\":true}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 270,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "5a157de669d249bd",
        "type": "inject",
        "z": "178d4ec7b06e55a6",
        "name": "Json for dynamic connection",
        "props": [
            {
                "p": "action",
                "v": "connect",
                "vt": "str"
            },
            {
                "p": "broker",
                "v": "{\"broker\":\"mqtt://mqtt-broker\",\"port\":1883,\"username\":\"default\",\"password\":\"default\",\"force\":true}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 260,
        "y": 460,
        "wires": [
            [
                "ae7decc69d832c65"
            ]
        ]
    },
    {
        "id": "ae7decc69d832c65",
        "type": "mqtt in",
        "z": "178d4ec7b06e55a6",
        "name": "dynamic Connection",
        "topic": "",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 590,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "4f49132e8d1d3911",
        "type": "link in",
        "z": "178d4ec7b06e55a6",
        "name": "MQTT_retained_in",
        "links": [
            "18fdf11aa09f0f91",
            "9aeefe5d9adb7be5",
            "439dd835f0daf7b3",
            "986051368e9cd46b",
            "ce7a72fe85d97322",
            "4a529720bbcc2180",
            "f49445298902a6ec",
            "7a3d68557e4c5dc5",
            "0fc7da9230e32d86",
            "1e0f03f14a59d9df",
            "ed5e95c71779bfd7",
            "fcef693cc1c0b541"
        ],
        "x": 675,
        "y": 180,
        "wires": [
            [
                "40bcb5453770e948",
                "b33c9c99af6f97c7"
            ]
        ]
    },
    {
        "id": "40bcb5453770e948",
        "type": "mqtt out",
        "z": "178d4ec7b06e55a6",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 830,
        "y": 180,
        "wires": []
    },
    {
        "id": "2cf6c7eff0bc4658",
        "type": "link in",
        "z": "178d4ec7b06e55a6",
        "name": "MQTT_notRetained_in",
        "links": [
            "e462e67586083065",
            "fc1841ebfae81247",
            "0a105943644fd5f8"
        ],
        "x": 675,
        "y": 260,
        "wires": [
            [
                "49a81bc808f64417",
                "2fb9ce764c4556ce"
            ]
        ]
    },
    {
        "id": "49a81bc808f64417",
        "type": "mqtt out",
        "z": "178d4ec7b06e55a6",
        "name": "mqtt not retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 850,
        "y": 260,
        "wires": []
    },
    {
        "id": "bd74752c530dbeb4",
        "type": "inject",
        "z": "178d4ec7b06e55a6",
        "name": "Json for dynamic connection 192.168.0.100",
        "props": [
            {
                "p": "action",
                "v": "connect",
                "vt": "str"
            },
            {
                "p": "broker",
                "v": "{\"broker\":\"192.168.0.100\",\"port\":1883,\"force\":true}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 290,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "b33c9c99af6f97c7",
        "type": "debug",
        "z": "178d4ec7b06e55a6",
        "name": "mqtt-retained",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 120,
        "wires": []
    },
    {
        "id": "2fb9ce764c4556ce",
        "type": "debug",
        "z": "178d4ec7b06e55a6",
        "name": "mqtt-not-retained",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 340,
        "wires": []
    },
    {
        "id": "d2eca94f5d095240",
        "type": "mqtt in",
        "z": "178d4ec7b06e55a6",
        "g": "18add21960208cd5",
        "name": "global-reset",
        "topic": "ccu/global",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 620,
        "wires": [
            [
                "811aa747b8613b24"
            ]
        ]
    },
    {
        "id": "02cea52e4d112e16",
        "type": "delay",
        "z": "178d4ec7b06e55a6",
        "g": "18add21960208cd5",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 580,
        "y": 620,
        "wires": [
            [
                "6926a73975a02af4"
            ]
        ]
    },
    {
        "id": "6926a73975a02af4",
        "type": "http request",
        "z": "178d4ec7b06e55a6",
        "g": "18add21960208cd5",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/flows",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Node-RED-Deployment-Type",
                "valueType": "other",
                "valueValue": "reload"
            }
        ],
        "x": 750,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "811aa747b8613b24",
        "type": "function",
        "z": "178d4ec7b06e55a6",
        "g": "18add21960208cd5",
        "name": "is-reset-message",
        "func": "const { payload } = msg;\nconst msgType = String(payload.type ?? \"\").toLowerCase();\nif (msgType == \"reset\") {\n    node.status({ fill: \"green\", shape: \"dot\", text: \"Received reset...\" });\n    return msg;\n}\nreturn;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 620,
        "wires": [
            [
                "02cea52e4d112e16"
            ]
        ]
    },
    {
        "id": "4d9daa6d15404570",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1180,
        "y": 740,
        "wires": [
            [
                "e7e858090e2b3382",
                "e8361004d31126c5"
            ]
        ]
    },
    {
        "id": "4d8424ef697d5079",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1180,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "27d83d505b328386",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1180,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "78422b5789fbad04",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1180,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "d9243580e78a4664",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1180,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "e70d5ffbfe7b6bb1",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1190,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "4da5721c04b7823a",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 890,
        "y": 2440,
        "wires": [
            [
                "6f7b958c4fadfc3c"
            ]
        ]
    },
    {
        "id": "329ccc4c56db4226",
        "type": "mqtt in",
        "z": "6c1ff1b06d8a3172",
        "name": "module/v1/ff/AIQS001/state",
        "topic": "module/v1/ff/AIQS001/state",
        "qos": "1",
        "datatype": "auto",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 500,
        "y": 2440,
        "wires": [
            [
                "4da5721c04b7823a"
            ]
        ]
    },
    {
        "id": "dff0721493e0394e",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 870,
        "y": 1920,
        "wires": [
            [
                "6f7b958c4fadfc3c"
            ]
        ]
    },
    {
        "id": "62527a99109a3492",
        "type": "mqtt in",
        "z": "6c1ff1b06d8a3172",
        "name": "Subscribe module/v1/ff/DRILL001/state",
        "topic": "module/v1/ff/DRILL001/state",
        "qos": "1",
        "datatype": "auto",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 550,
        "y": 1920,
        "wires": [
            [
                "dff0721493e0394e"
            ]
        ]
    },
    {
        "id": "81bed2409bc0b057",
        "type": "mqtt in",
        "z": "6c1ff1b06d8a3172",
        "name": "Subscribe module/v1/ff/MILL001/state",
        "topic": "module/v1/ff/MILL001/state",
        "qos": "1",
        "datatype": "auto",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 550,
        "y": 2060,
        "wires": [
            [
                "87c9920fd779705e"
            ]
        ]
    },
    {
        "id": "87c9920fd779705e",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 870,
        "y": 2060,
        "wires": [
            [
                "6f7b958c4fadfc3c"
            ]
        ]
    },
    {
        "id": "cdb52c54b02952bd",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 870,
        "y": 2180,
        "wires": [
            [
                "6f7b958c4fadfc3c"
            ]
        ]
    },
    {
        "id": "a9c49d863bfde969",
        "type": "mqtt in",
        "z": "6c1ff1b06d8a3172",
        "name": "Subscribe module/v1/ff/HBW001/state",
        "topic": "module/v1/ff/HBW001/state",
        "qos": "1",
        "datatype": "auto",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 550,
        "y": 2180,
        "wires": [
            [
                "cdb52c54b02952bd"
            ]
        ]
    },
    {
        "id": "c8497dbf2826f254",
        "type": "mqtt in",
        "z": "6c1ff1b06d8a3172",
        "name": "Subscribe module/v1/ff/DPS001/state",
        "topic": "module/v1/ff/DPS001/state",
        "qos": "1",
        "datatype": "auto",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 530,
        "y": 2320,
        "wires": [
            [
                "1c551a48bcba39fa"
            ]
        ]
    },
    {
        "id": "1c551a48bcba39fa",
        "type": "json",
        "z": "6c1ff1b06d8a3172",
        "name": "Parse JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 890,
        "y": 2320,
        "wires": [
            [
                "6f7b958c4fadfc3c"
            ]
        ]
    },
    {
        "id": "6f7b958c4fadfc3c",
        "type": "function",
        "z": "6c1ff1b06d8a3172",
        "name": "function 15",
        "func": "let p = msg.payload;\n\n// Unique signature for deduplication\nlet currentState = `${p.actionState?.command || \"\"}-${p.actionState?.state || \"\"}-${p.serialNumber}`;\nlet lastState = flow.get(\"last_module_state\") || \"\";\n\nif (currentState === lastState) {\n    return null;  // Skip if no change\n}\n\nflow.set(\"last_module_state\", currentState);\n\n// Prepare SQL params for module_state table\nmsg.params = [\n    p.serialNumber || null,                  // ref_module ($1)\n    p.timestamp || new Date().toISOString(),// timestamp ($2)\n    p.moduleState || null,                   // module_state ($3)\n    p.actionState?.command || null,          // command_name ($4)\n    p.actionState?.state || null,            // command_state ($5)\n    p.metadata?.opcuaState || null,          // connection_state ($6)\n    JSON.stringify(p.errors || null)         // errors ($7)\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 2160,
        "wires": [
            [
                "5e7bf0bd572dbc58"
            ]
        ]
    },
    {
        "id": "5e7bf0bd572dbc58",
        "type": "postgresql",
        "z": "6c1ff1b06d8a3172",
        "name": "db connection",
        "query": "INSERT INTO module_state (\n    ref_module, timestamp, module_state, command_name, command_state, connection_state, errors\n) VALUES (\n    $1, $2, $3, $4, $5, $6, $7\n);\n",
        "postgreSQLConfig": "cb4dd2325f0bfab1",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1420,
        "y": 2160,
        "wires": [
            [
                "5e301d6f82d74628"
            ]
        ]
    },
    {
        "id": "5e301d6f82d74628",
        "type": "debug",
        "z": "6c1ff1b06d8a3172",
        "name": "check_db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1710,
        "y": 2000,
        "wires": []
    },
    {
        "id": "e7e858090e2b3382",
        "type": "debug",
        "z": "6c1ff1b06d8a3172",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 620,
        "wires": []
    },
    {
        "id": "e8361004d31126c5",
        "type": "function",
        "z": "6c1ff1b06d8a3172",
        "name": "function 16",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "058c487ce32e3539",
        "type": "postgresql",
        "z": "6c1ff1b06d8a3172",
        "name": "",
        "query": "SELECT DISTINCT ON (ref_module)\n    ref_module,\n    module_state,\n    command_name,\n    command_state,\n    connection_state,\n    errors,\n    timestamp as last_update\nFROM module_state \nWHERE \n    ref_module IN ('DPS001', 'AIQS001', 'MILL001', 'DRILL001', 'HBW001')\n    AND module_state IS NOT NULL\nORDER BY ref_module, timestamp DESC;\n",
        "postgreSQLConfig": "cb4dd2325f0bfab1",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 610,
        "y": 2700,
        "wires": [
            [
                "split_node_1"
            ]
        ]
    },
    {
        "id": "3ab3a2dc6c50fc3d",
        "type": "postgresql",
        "z": "6c1ff1b06d8a3172",
        "name": "",
        "query": "INSERT INTO module_state_continuous (\n    ref_module, timestamp, module_state, command_name, \n    command_state, connection_state, errors, data_source\n)\nVALUES ($1, $2, $3, $4, $5, $6, $7, $8);",
        "postgreSQLConfig": "cb4dd2325f0bfab1",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1190,
        "y": 2700,
        "wires": [
            []
        ]
    },
    {
        "id": "8393ef726303cfc3",
        "type": "inject",
        "z": "6c1ff1b06d8a3172",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "20",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 410,
        "y": 2700,
        "wires": [
            [
                "058c487ce32e3539"
            ]
        ]
    },
    {
        "id": "split_node_1",
        "type": "split",
        "z": "6c1ff1b06d8a3172",
        "name": "Split rows",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload",
        "x": 780,
        "y": 2700,
        "wires": [
            [
                "2e4b47c0895549a7"
            ]
        ]
    },
    {
        "id": "2e4b47c0895549a7",
        "type": "function",
        "z": "6c1ff1b06d8a3172",
        "name": "function 17",
        "func": "\nlet ts = new Date().toISOString()\n\nmsg.params = [\n    msg.payload.ref_module,\n    ts,\n    msg.payload.module_state,\n    msg.payload.command_name,\n    msg.payload.command_state,\n    msg.payload.connection_state,\n    msg.payload.errors,\n    \"node-red\"\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 2700,
        "wires": [
            [
                "3ab3a2dc6c50fc3d"
            ]
        ]
    },
    {
        "id": "6acc9b25f3de1b1c",
        "type": "inject",
        "z": "01cc220f0e9e940f",
        "name": "Send Every 10s",
        "props": [],
        "repeat": "10",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 370,
        "y": 1540,
        "wires": [
            [
                "8222e1ee09027e54",
                "a8c9bbb3ec625093",
                "c3a8a1fe9ba3b046",
                "8e098613c7de4408"
            ]
        ]
    },
    {
        "id": "8222e1ee09027e54",
        "type": "function",
        "z": "01cc220f0e9e940f",
        "name": "Generate humidity for Drill",
        "func": "const serial_number = \"DRILL001\";\nconst sensor_id = \"drill_humidity1\";\nconst min = 30;\nconst max = 80;\n\nlet value_numeric = (Math.random() * (max - min)) + min;\nvalue_numeric = Number(value_numeric.toFixed(3)); \nconst value_raw = value_numeric.toFixed(2);\nconst timestamp = new Date().toISOString();\n\nmsg.params = [\n  sensor_id,\n  timestamp,\n  value_raw,\n  value_numeric\n];\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1540,
        "wires": [
            [
                "26723802a84b2915"
            ]
        ]
    },
    {
        "id": "26723802a84b2915",
        "type": "postgresql",
        "z": "01cc220f0e9e940f",
        "name": "",
        "query": "INSERT INTO sensor_log (sensor_id, timestamp, value_raw, value_numeric)\nVALUES ($1, $2, $3, $4)",
        "postgreSQLConfig": "1d8af14727bd15b5",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1070,
        "y": 1540,
        "wires": [
            [
                "2d9b3097cb20a31e"
            ]
        ]
    },
    {
        "id": "a8c9bbb3ec625093",
        "type": "function",
        "z": "01cc220f0e9e940f",
        "name": "Generate temp for Drill",
        "func": "const sensor_id = \"drill_temp1\";\nconst min = 20;\nconst max = 60;\n\nlet value_numeric = (Math.random() * (max - min)) + min;\nvalue_numeric = Number(value_numeric.toFixed(3)); \nconst value_raw = value_numeric.toString();\nconst timestamp = new Date().toISOString();\n\nmsg.params = [\n  sensor_id,\n  timestamp,\n  value_raw,\n  value_numeric\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1620,
        "wires": [
            [
                "26723802a84b2915"
            ]
        ]
    },
    {
        "id": "c3a8a1fe9ba3b046",
        "type": "function",
        "z": "01cc220f0e9e940f",
        "name": "Generate temp for mill",
        "func": "const sensor_id = \"mill_temp1\";\nconst min = 20;\nconst max = 60;\n\nlet value_numeric = (Math.random() * (max - min)) + min;\nvalue_numeric = Number(value_numeric.toFixed(3)); \nconst value_raw = value_numeric.toFixed(2);\nconst timestamp = new Date().toISOString();\n\nmsg.params = [\n  sensor_id,\n  timestamp,\n  value_raw,\n  value_numeric\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1700,
        "wires": [
            [
                "26723802a84b2915"
            ]
        ]
    },
    {
        "id": "8e098613c7de4408",
        "type": "function",
        "z": "01cc220f0e9e940f",
        "name": "Generate temp for hbw",
        "func": "const sensor_id = \"hbw_temp1\";\nconst min = 15;\nconst max = 50;\n\nlet value_numeric = (Math.random() * (max - min)) + min;\nvalue_numeric = Number(value_numeric.toFixed(3)); \nconst value_raw = value_numeric.toFixed(2);\nconst timestamp = new Date().toISOString();\n\nmsg.params = [\n  sensor_id,\n  timestamp,\n  value_raw,\n  value_numeric\n];\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1780,
        "wires": [
            [
                "26723802a84b2915"
            ]
        ]
    },
    {
        "id": "2d9b3097cb20a31e",
        "type": "debug",
        "z": "01cc220f0e9e940f",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 1460,
        "wires": []
    },
    {
        "id": "e92f2c5aa5768678",
        "type": "comment",
        "z": "61a81265606bc34b",
        "name": "",
        "info": "aktuell werden sie in jedem Flow selbst gesetzt",
        "x": 210,
        "y": 120,
        "wires": []
    },
    {
        "id": "f53520099a22d00a",
        "type": "inject",
        "z": "61a81265606bc34b",
        "name": "Json for dynamic connection (testing)",
        "props": [
            {
                "p": "action",
                "v": "connect",
                "vt": "str"
            },
            {
                "p": "broker",
                "v": "{\"broker\":\"host.docker.internal\",\"port\":1883,\"force\":true}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 270,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "4113556ae90c4734",
        "type": "link in",
        "z": "61a81265606bc34b",
        "name": "MQTT_retained_in",
        "links": [
            "18fdf11aa09f0f91",
            "9aeefe5d9adb7be5",
            "439dd835f0daf7b3",
            "986051368e9cd46b",
            "ce7a72fe85d97322",
            "4a529720bbcc2180",
            "f49445298902a6ec",
            "7a3d68557e4c5dc5",
            "0fc7da9230e32d86",
            "1e0f03f14a59d9df",
            "ed5e95c71779bfd7",
            "fcef693cc1c0b541"
        ],
        "x": 675,
        "y": 180,
        "wires": [
            [
                "0615f90a0014067f",
                "68ee3b9da9e89347"
            ]
        ]
    },
    {
        "id": "0615f90a0014067f",
        "type": "mqtt out",
        "z": "61a81265606bc34b",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 830,
        "y": 180,
        "wires": []
    },
    {
        "id": "fb174e95dfe76298",
        "type": "link in",
        "z": "61a81265606bc34b",
        "name": "MQTT_notRetained_in",
        "links": [
            "e462e67586083065",
            "fc1841ebfae81247",
            "0a105943644fd5f8"
        ],
        "x": 675,
        "y": 260,
        "wires": [
            [
                "e61f61b40f6aedb1",
                "626ce97a0845af2c"
            ]
        ]
    },
    {
        "id": "e61f61b40f6aedb1",
        "type": "mqtt out",
        "z": "61a81265606bc34b",
        "name": "mqtt not retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 850,
        "y": 260,
        "wires": []
    },
    {
        "id": "bd295fad944c5bf3",
        "type": "inject",
        "z": "61a81265606bc34b",
        "name": "Json for dynamic connection 192.168.0.100",
        "props": [
            {
                "p": "action",
                "v": "connect",
                "vt": "str"
            },
            {
                "p": "broker",
                "v": "{\"broker\":\"192.168.0.100\",\"port\":1883,\"force\":true}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 290,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "68ee3b9da9e89347",
        "type": "debug",
        "z": "61a81265606bc34b",
        "name": "mqtt-retained",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 120,
        "wires": []
    },
    {
        "id": "626ce97a0845af2c",
        "type": "debug",
        "z": "61a81265606bc34b",
        "name": "mqtt-not-retained",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 340,
        "wires": []
    },
    {
        "id": "da007d96a26635d4",
        "type": "mqtt out",
        "z": "61a81265606bc34b",
        "name": "",
        "topic": "test",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "",
        "x": 530,
        "y": 520,
        "wires": []
    },
    {
        "id": "df3c6a162792e175",
        "type": "inject",
        "z": "61a81265606bc34b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "test",
        "payload": "",
        "payloadType": "date",
        "x": 290,
        "y": 520,
        "wires": [
            [
                "da007d96a26635d4"
            ]
        ]
    },
    {
        "id": "334564ac5abc6943",
        "type": "function",
        "z": "5d12353eb287ac3b",
        "name": "Set MQTT Topic",
        "func": "msg.topic = \"fts/v1/ff/80F4/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 340,
        "wires": [
            [
                "557d334e0d9a14a8"
            ]
        ]
    },
    {
        "id": "c68abe850e909d91",
        "type": "inject",
        "z": "5d12353eb287ac3b",
        "name": "Trigger Order",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 950,
        "y": 620,
        "wires": [
            [
                "f47deaef1005082e"
            ]
        ]
    },
    {
        "id": "f47deaef1005082e",
        "type": "data-generator",
        "z": "5d12353eb287ac3b",
        "name": "go from hbw to drill ",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"timestamp\": \"2025-02-28T09:58:25.039Z\",\n  \"orderId\": \"b5d370e3-c585-4b51-b4cb-d79bfd8d2542\",\n  \"orderUpdateId\": 2,\n  \"description\":\"From HBW to DRILL\",\n  \"nodes\": [\n\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"dd463475-c043-43df-86fb-6d9cde3b2a30\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"SVR5H85409-1\"]\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"SVR5H85409-1\", \"1-3\"],\n      \"action\": {\n        \"id\": \"6d3c47c7-01bb-4040-ab3e-84e5a069ed12\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"3\",\n      \"linkedEdges\": [\"1-3\", \"3-SVR5H85384\"],\n      \"action\": {\n        \"id\": \"436a70c6-00b6-42b3-9fa0-ba321a809c16\",\n        \"type\": \"TURN\",\n        \"metadata\": {\n          \"direction\": \"RIGHT\"\n        }\n      }\n    },\n    {\n      \"id\": \"SVR5H85384\",\n      \"linkedEdges\": [\"3-SVR5H85384\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"6d8631b4-a0d1-4e13-a962-23e07a143b1f\",\n        \"metadata\": {\n          \"loadId\": \"04e26aca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    },\n\n    {\n      \"id\": \"SVR4PW6408\",\n      \"linkedEdges\": [\"SVR4PW6408-2\"]\n    },\n    {\n      \"id\": \"2\",\n      \"linkedEdges\": [\"SVR4PW6408-2\", \"2-1\"],\n      \"action\": {\n        \"id\": \"6367b144-4350-434e-bfc8-6bb687dcef66\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"1\",\n      \"linkedEdges\": [\"2-1\", \"1-SVR5H85409\"],\n      \"action\": {\n        \"id\": \"9140b17e-d5e4-42ae-888e-557d491d379c\",\n        \"type\": \"PASS\"\n      }\n    },\n    {\n      \"id\": \"SVR5H85409\",\n      \"linkedEdges\": [\"1-SVR5H85409\"],\n      \"action\": {\n        \"type\": \"DOCK\",\n        \"id\": \"ab916e13-a5f2-4b00-bbd4-e18f0940cfa3\",\n        \"metadata\": {\n          \"loadId\": \"043169ca341290\",\n          \"loadType\": \"BLUE\",\n          \"loadPosition\": \"1\"\n        }\n      }\n    }\n  ],\n  \"edges\": [\n    {\n      \"id\": \"SVR5H85409-1\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR5H85409\", \"1\"]\n    },\n    {\n      \"id\": \"1-3\",\n      \"length\": 360,\n      \"linkedNodes\": [\"1\", \"3\"]\n    },\n    {\n      \"id\": \"3-SVR5H85384\",\n      \"length\": 380,\n      \"linkedNodes\": [\"3\", \"SVR5H85384\"]\n    },\n\n     {\n      \"id\": \"SVR4PW6408-2\",\n      \"length\": 380,\n      \"linkedNodes\": [\"SVR4PW6408\", \"2\"]\n    },\n    {\n      \"id\": \"2-1\",\n      \"length\": 360,\n      \"linkedNodes\": [\"2\", \"1\"]\n    },\n    {\n      \"id\": \"1-SVR5H85409\",\n      \"length\": 380,\n      \"linkedNodes\": [\"1\", \"SVR5H85409\"]\n    }\n  ],\n  \"serialNumber\": \"4gcx\"\n}\n",
        "x": 1070,
        "y": 520,
        "wires": [
            [
                "334564ac5abc6943"
            ]
        ]
    },
    {
        "id": "557d334e0d9a14a8",
        "type": "mqtt out",
        "z": "5d12353eb287ac3b",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1410,
        "y": 220,
        "wires": []
    },
    {
        "id": "mqtt_order_in",
        "type": "mqtt in",
        "z": "590cef45263277f3",
        "name": "Storage Command MQTT In",
        "topic": "/j1/txt/1/f/i/order",
        "qos": "1",
        "datatype": "json",
        "broker": "15b84ed331dcc49c",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 680,
        "y": 360,
        "wires": [
            [
                "process_storage_command"
            ]
        ]
    },
    {
        "id": "process_storage_command",
        "type": "function",
        "z": "590cef45263277f3",
        "name": "Update Store Context",
        "func": "// Get current store (stock items) from flow context\nlet stockItems = flow.get(\"store\") || [];\n\n// Extract command from incoming msg.payload\nlet data = msg.payload;\nconst { command, hbwSerial, location, workpieceId, type, state, metadata, timestamp } = data;\n\n// Find index of the slot in stockItems\nlet index = stockItems.findIndex(item => item.hbw === hbwSerial && item.location === location);\n\n// Process the command\nif (command === \"ADD\") {\n    if (index !== -1) {\n        // Update existing slot\n        stockItems[index].workpiece = {\n            id: workpieceId,\n            type: type || stockItems[index].workpiece.type,\n            state: state || \"RAW\",\n            metadata: metadata || {},\n            timestamp: timestamp || new Date().toISOString()\n        };\n    } else {\n        // Add new slot if missing\n        stockItems.push({\n            hbw: hbwSerial,\n            location: location,\n            workpiece: {\n                id: workpieceId,\n                type: type || \"\",\n                state: state || \"RAW\",\n                metadata: metadata || {},\n                timestamp: timestamp || new Date().toISOString()\n            }\n        });\n    }\n} else if (command === \"REMOVE\") {\n    if (index !== -1) {\n        // Clear the slot\n        stockItems[index].workpiece = { id: \"\", type: \"\", state: \"RAW\", metadata: {}, timestamp: new Date().toISOString() };\n    }\n}\n\n// Save updated stockItems back to flow context\nflow.set(\"store\", stockItems);\n\n// Prepare outgoing message including the command\nmsg.topic = \"/j1/txt/1/f/i/stock\";\nmsg.payload = {\n    ts: new Date().toISOString(),\n    stockItems: stockItems,\n    command: {\n        id: data.id || \"\",\n        command: command,\n        status: \"FINISHED\", // mark it as finished\n        hbwSerial: hbwSerial,\n        workpieceId: workpieceId,\n        location: location,\n        type: type || \"\",\n        state: state || \"RAW\",\n        metadata: metadata || {},\n        timestamp: timestamp || new Date().toISOString()\n    }\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 360,
        "wires": [
            [
                "debug_stock",
                "mqtt_stock_out"
            ]
        ]
    },
    {
        "id": "mqtt_stock_out",
        "type": "mqtt out",
        "z": "590cef45263277f3",
        "name": "Publish Stock",
        "topic": "/j1/txt/1/f/i/stock",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1260,
        "y": 400,
        "wires": []
    },
    {
        "id": "debug_stock",
        "type": "debug",
        "z": "590cef45263277f3",
        "name": "Stock Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 1220,
        "y": 320,
        "wires": []
    },
    {
        "id": "c764db733e4b085e",
        "type": "function",
        "z": "590cef45263277f3",
        "name": "Store Context",
        "func": "// Hard-coded stock items\nvar stockItems = [\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"A1\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"C1\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"C2\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"B2\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"A3\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"A2\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"B3\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"C3\", hbw: \"SVR5H85409\" },\n    { workpiece: { id: \"\", type: \"\", state: \"RAW\" }, location: \"B1\", hbw: \"SVR5H85409\" }\n];\n\n// Save to context\nflow.set(\"store\", stockItems);\nnode.log(\"Store context initialized with stockItems array.\");\n\n// Return msg with payload containing the store\n\n\nmsg.topic = \"/j1/txt/1/f/i/stock\";\nmsg.payload = {\n    ts: new Date().toISOString(),\n    stockItems: stockItems\n};\n\n\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 200,
        "wires": [
            [
                "9c823be78138bb4e",
                "bb00062c517777e0"
            ]
        ]
    },
    {
        "id": "9c823be78138bb4e",
        "type": "debug",
        "z": "590cef45263277f3",
        "name": "show context store",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 200,
        "wires": []
    },
    {
        "id": "7e23acee9e015670",
        "type": "mqtt out",
        "z": "590cef45263277f3",
        "name": "Publish Order stock",
        "topic": "/j1/txt/1/f/i/order",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 1270,
        "y": 540,
        "wires": []
    },
    {
        "id": "6b0940aef575cb38",
        "type": "data-generator",
        "z": "590cef45263277f3",
        "name": "test_add",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"id\": \"ffb892b6c4c8d2ac\",\n  \"command\": \"ADD\",\n  \"status\": \"RUNNING\",\n  \"hbwSerial\": \"SVR5H85409\",\n  \"workpieceId\": \"04d998ca341290\",\n  \"location\": \"A2\",\n  \"type\": \"RED\",\n  \"state\": \"RAW\",\n  \"metadata\": {\n    \"operator\": \"John\",\n    \"priority\": 1\n  },\n  \"timestamp\": \"2025-08-17T15:30:45.123Z\"\n}\n",
        "x": 440,
        "y": 540,
        "wires": [
            [
                "6d9067806bc79f93"
            ]
        ]
    },
    {
        "id": "6d9067806bc79f93",
        "type": "function",
        "z": "590cef45263277f3",
        "name": "test_send_store_order",
        "func": "msg.topic = \"/j1/txt/1/f/i/order\";\nmsg.payload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 540,
        "wires": [
            [
                "7e23acee9e015670",
                "2eecef2cd44c6912"
            ]
        ]
    },
    {
        "id": "7067094c7e43ddcd",
        "type": "inject",
        "z": "590cef45263277f3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 540,
        "wires": [
            [
                "6b0940aef575cb38"
            ]
        ]
    },
    {
        "id": "2eecef2cd44c6912",
        "type": "debug",
        "z": "590cef45263277f3",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 480,
        "wires": []
    },
    {
        "id": "bca2fe3862cc0c3f",
        "type": "function",
        "z": "590cef45263277f3",
        "name": "Store Debug",
        "func": "let store = flow.get(\"store\"); // no fallback to {} if you want to see array\nmsg.payload = JSON.stringify(store, null, 2);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 640,
        "wires": [
            [
                "7e30d9370b7ca376"
            ]
        ]
    },
    {
        "id": "7e30d9370b7ca376",
        "type": "debug",
        "z": "590cef45263277f3",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 640,
        "wires": []
    },
    {
        "id": "5a24c252cc9b304a",
        "type": "inject",
        "z": "590cef45263277f3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 640,
        "wires": [
            [
                "bca2fe3862cc0c3f"
            ]
        ]
    },
    {
        "id": "4ea6f996d04fb736",
        "type": "inject",
        "z": "590cef45263277f3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "c764db733e4b085e"
            ]
        ]
    },
    {
        "id": "5b657361a5299880",
        "type": "data-generator",
        "z": "590cef45263277f3",
        "name": "test_remove",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "text",
        "template": "{\n  \"id\": \"ffb892b6c4c8d2ad\",\n  \"command\": \"REMOVE\",\n  \"status\": \"RUNNING\",\n  \"hbwSerial\": \"SVR5H85409\",\n  \"workpieceId\": \"04d998ca341290\",\n  \"location\": \"A2\",\n  \"metadata\": {\n    \"operator\": \"John\"\n  },\n  \"timestamp\": \"2025-08-17T15:40:00.000Z\"\n}\n",
        "x": 450,
        "y": 580,
        "wires": [
            [
                "6d9067806bc79f93"
            ]
        ]
    },
    {
        "id": "d7df71fa83f29be4",
        "type": "inject",
        "z": "590cef45263277f3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 580,
        "wires": [
            [
                "5b657361a5299880"
            ]
        ]
    },
    {
        "id": "bb00062c517777e0",
        "type": "mqtt out",
        "z": "590cef45263277f3",
        "name": "mqtt retained",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "15b84ed331dcc49c",
        "x": 610,
        "y": 280,
        "wires": []
    }
]